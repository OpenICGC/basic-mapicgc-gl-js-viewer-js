(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const dP="modulepreload",pP=function(i){return"/basic-mapicgc-gl-js-viewer-js/dist/"+i},m2={},ey=function(t,e,r){let n=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));n=Promise.all(e.map(_=>{if(_=pP(_),_ in m2)return;m2[_]=!0;const v=_.endsWith(".css"),S=v?'[rel="stylesheet"]':"";if(!!r)for(let I=o.length-1;I>=0;I--){const z=o[I];if(z.href===_&&(!v||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${_}"]${S}`))return;const P=document.createElement("link");if(P.rel=v?"stylesheet":dP,v||(P.as="script",P.crossOrigin=""),P.href=_,l&&P.setAttribute("nonce",l),document.head.appendChild(P),v)return new Promise((I,z)=>{P.addEventListener("load",I),P.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${_}`)))})}))}return n.then(()=>t()).catch(o=>{const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o})};function fP(i,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const o=Object.getOwnPropertyDescriptor(r,n);o&&Object.defineProperty(i,n,o.get?o:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var Pd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mg(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var S3={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(Pd,function(){var e={},r={};function n(c,l,_){if(r[c]=_,c==="index"){var v="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(e,S),typeof window<"u"&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),e}}n("shared",["exports"],function(c){function l(h,a,d,p){return new(d||(d=Promise))(function(b,x){function E(D){try{R(p.next(D))}catch(U){x(U)}}function L(D){try{R(p.throw(D))}catch(U){x(U)}}function R(D){var U;D.done?b(D.value):(U=D.value,U instanceof d?U:new d(function(V){V(U)})).then(E,L)}R((p=p.apply(h,a||[])).next())})}function _(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var v=S;function S(h,a){this.x=h,this.y=a}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,a){return this.clone()._rotateAround(h,a)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var a=h.x-this.x,d=h.y-this.y;return a*a+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,a){return Math.atan2(this.x*a-this.y*h,this.x*h+this.y*a)},_matMult:function(h){var a=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=a,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var a=Math.cos(h),d=Math.sin(h),p=d*this.x+a*this.y;return this.x=a*this.x-d*this.y,this.y=p,this},_rotateAround:function(h,a){var d=Math.cos(h),p=Math.sin(h),b=a.y+p*(this.x-a.x)+d*(this.y-a.y);return this.x=a.x+d*(this.x-a.x)-p*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(h){return h instanceof S?h:Array.isArray(h)?new S(h[0],h[1]):h};var T=_(v),P=I;function I(h,a,d,p){this.cx=3*h,this.bx=3*(d-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=a,this.p2x=d,this.p2y=p}I.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,a){if(a===void 0&&(a=1e-6),h<0)return 0;if(h>1)return 1;for(var d=h,p=0;p<8;p++){var b=this.sampleCurveX(d)-h;if(Math.abs(b)<a)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=b/x}var E=0,L=1;for(d=h,p=0;p<20&&(b=this.sampleCurveX(d),!(Math.abs(b-h)<a));p++)h>b?E=d:L=d,d=.5*(L-E)+E;return d},solve:function(h,a){return this.sampleCurveY(this.solveCurveX(h,a))}};var z=_(P);let N,X;function H(){return N==null&&(N=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),N}function Z(){if(X==null&&(X=!1,H())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let d=0;d<5*5;d++){const p=4*d;h.fillStyle=`rgb(${p},${p+1},${p+2})`,h.fillRect(d%5,Math.floor(d/5),1,1)}const a=h.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&a[d]!==d){X=!0;break}}}return X||!1}function ot(h,a,d,p){const b=new z(h,a,d,p);return x=>b.solve(x)}const gt=ot(.25,.1,.25,1);function Et(h,a,d){return Math.min(d,Math.max(a,h))}function Ft(h,a,d){const p=d-a,b=((h-a)%p+p)%p+a;return b===a?d:b}function Mt(h){for(var a=arguments.length,d=new Array(a>1?a-1:0),p=1;p<a;p++)d[p-1]=arguments[p];for(const b of d)for(const x in b)h[x]=b[x];return h}let yt=1;function Ut(h,a,d){const p={};for(const b in h)p[b]=a.call(this,h[b],b,h);return p}function zt(h,a,d){const p={};for(const b in h)a.call(this,h[b],b,h)&&(p[b]=h[b]);return p}function at(h){return Array.isArray(h)?h.map(at):typeof h=="object"&&h?Ut(h,at):h}const pt={};function Lt(h){pt[h]||(typeof console<"u"&&console.warn(h),pt[h]=!0)}function bt(h,a,d){return(d.y-h.y)*(a.x-h.x)>(a.y-h.y)*(d.x-h.x)}function ee(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let ie=null;function re(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ce(h,a,d,p,b){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(h,{timestamp:0});try{const E=x==null?void 0:x.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const L=E.startsWith("BGR"),R=new Uint8ClampedArray(p*b*4);if(yield x.copyTo(R,function(D,U,V,J,tt){const st=4*Math.max(-U,0),dt=(Math.max(0,V)-V)*J*4+st,wt=4*J,Pt=Math.max(0,U),Zt=Math.max(0,V);return{rect:{x:Pt,y:Zt,width:Math.min(D.width,U+J)-Pt,height:Math.min(D.height,V+tt)-Zt},layout:[{offset:dt,stride:wt}]}}(h,a,d,p,b)),L)for(let D=0;D<R.length;D+=4){const U=R[D];R[D]=R[D+2],R[D+2]=U}return R}finally{x.close()}})}let le,Be;const nt="AbortError";function St(){return new Error(nt)}const Tt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function jt(h){return Tt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}const qt="global-dispatcher";class Ht extends Error{constructor(a,d,p,b){super(`AJAXError: ${d} (${a}): ${p}`),this.status=a,this.statusText=d,this.url=p,this.body=b}}const Jt=()=>ee(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,$t=function(h,a){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){const p=jt(h.url);if(p)return p(h,a);if(ee(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:qt},a)}if(!(/^file:/.test(d=h.url)||/^file:/.test(Jt())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,b){return l(this,void 0,void 0,function*(){const x=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Jt(),signal:b.signal});p.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");const E=yield fetch(x);if(!E.ok){const D=yield E.blob();throw new Ht(E.status,E.statusText,p.url,D)}let L;L=p.type==="arrayBuffer"||p.type==="image"?E.arrayBuffer():p.type==="json"?E.json():E.text();const R=yield L;if(b.signal.aborted)throw St();return{data:R,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}})}(h,a);if(ee(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:qt},a)}var d;return function(p,b){return new Promise((x,E)=>{var L;const R=new XMLHttpRequest;R.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(R.responseType="arraybuffer");for(const D in p.headers)R.setRequestHeader(D,p.headers[D]);p.type==="json"&&(R.responseType="text",!((L=p.headers)===null||L===void 0)&&L.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=p.credentials==="include",R.onerror=()=>{E(new Error(R.statusText))},R.onload=()=>{if(!b.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let D=R.response;if(p.type==="json")try{D=JSON.parse(R.response)}catch(U){return void E(U)}x({data:D,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const D=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});E(new Ht(R.status,R.statusText,p.url,D))}},b.signal.addEventListener("abort",()=>{R.abort(),E(St())}),R.send(p.body)})}(h,a)};function Ae(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const a=new URL(h),d=window.location;return a.protocol===d.protocol&&a.host===d.host}function Le(h,a,d){d[h]&&d[h].indexOf(a)!==-1||(d[h]=d[h]||[],d[h].push(a))}function Fe(h,a,d){if(d&&d[h]){const p=d[h].indexOf(a);p!==-1&&d[h].splice(p,1)}}class Ne{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Mt(this,d),this.type=a}}class si extends Ne{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Mt({error:a},d))}}class oe{on(a,d){return this._listeners=this._listeners||{},Le(a,d,this._listeners),this}off(a,d){return Fe(a,d,this._listeners),Fe(a,d,this._oneTimeListeners),this}once(a,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},Le(a,d,this._oneTimeListeners),this):new Promise(p=>this.once(a,p))}fire(a,d){typeof a=="string"&&(a=new Ne(a,d||{}));const p=a.type;if(this.listens(p)){a.target=this;const b=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const L of b)L.call(this,a);const x=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const L of x)Fe(p,L,this._oneTimeListeners),L.call(this,a);const E=this._eventedParent;E&&(Mt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(a))}else a instanceof si&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,d){return this._eventedParent=a,this._eventedParentData=d,this}}var it={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ke(h,a){const d={};for(const p in h)p!=="ref"&&(d[p]=h[p]);return pi.forEach(p=>{p in a&&(d[p]=a[p])}),d}function de(h,a){if(Array.isArray(h)){if(!Array.isArray(a)||h.length!==a.length)return!1;for(let d=0;d<h.length;d++)if(!de(h[d],a[d]))return!1;return!0}if(typeof h=="object"&&h!==null&&a!==null){if(typeof a!="object"||Object.keys(h).length!==Object.keys(a).length)return!1;for(const d in h)if(!de(h[d],a[d]))return!1;return!0}return h===a}function Ee(h,a){h.push(a)}function Me(h,a,d){Ee(d,{command:"addSource",args:[h,a[h]]})}function De(h,a,d){Ee(a,{command:"removeSource",args:[h]}),d[h]=!0}function ei(h,a,d,p){De(h,d,p),Me(h,a,d)}function Si(h,a,d){let p;for(p in h[d])if(Object.prototype.hasOwnProperty.call(h[d],p)&&p!=="data"&&!de(h[d][p],a[d][p]))return!1;for(p in a[d])if(Object.prototype.hasOwnProperty.call(a[d],p)&&p!=="data"&&!de(h[d][p],a[d][p]))return!1;return!0}function vi(h,a,d,p,b,x){h=h||{},a=a||{};for(const E in h)Object.prototype.hasOwnProperty.call(h,E)&&(de(h[E],a[E])||d.push({command:x,args:[p,E,a[E],b]}));for(const E in a)Object.prototype.hasOwnProperty.call(a,E)&&!Object.prototype.hasOwnProperty.call(h,E)&&(de(h[E],a[E])||d.push({command:x,args:[p,E,a[E],b]}))}function Ri(h){return h.id}function zi(h,a){return h[a.id]=a,h}class me{constructor(a,d,p,b){this.message=(a?`${a}: `:"")+p,b&&(this.identifier=b),d!=null&&d.__line__&&(this.line=d.__line__)}}function ci(h){for(var a=arguments.length,d=new Array(a>1?a-1:0),p=1;p<a;p++)d[p-1]=arguments[p];for(const b of d)for(const x in b)h[x]=b[x];return h}class bi extends Error{constructor(a,d){super(d),this.message=d,this.key=a}}class ke{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=a,this.bindings={};for(const[p,b]of d)this.bindings[p]=b}concat(a){return new ke(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const _r={kind:"null"},ge={kind:"number"},yi={kind:"string"},Ue={kind:"boolean"},Vi={kind:"color"},Zr={kind:"object"},ze={kind:"value"},_n={kind:"collator"},ir={kind:"formatted"},Qr={kind:"padding"},tn={kind:"resolvedImage"},xt={kind:"variableAnchorOffsetCollection"};function Y(h,a){return{kind:"array",itemType:h,N:a}}function K(h){if(h.kind==="array"){const a=K(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}return h.kind}const ct=[_r,ge,yi,Ue,Vi,ir,Zr,Y(ze),Qr,tn,xt];function _t(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!_t(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const d of ct)if(!_t(d,a))return null}}return`Expected ${K(h)} but found ${K(a)} instead.`}function kt(h,a){return a.some(d=>d.kind===h.kind)}function Gt(h,a){return a.some(d=>d==="null"?h===null:d==="array"?Array.isArray(h):d==="object"?h&&!Array.isArray(h)&&typeof h=="object":d===typeof h)}function Rt(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const Ct=.96422,te=.82521,he=4/29,Wt=6/29,be=3*Wt*Wt,We=Wt*Wt*Wt,Je=Math.PI/180,Li=180/Math.PI;function Qe(h){return(h%=360)<0&&(h+=360),h}function Ci(h){let[a,d,p,b]=h,x,E;const L=rr((.2225045*(a=xi(a))+.7168786*(d=xi(d))+.0606169*(p=xi(p)))/1);a===d&&d===p?x=E=L:(x=rr((.4360747*a+.3850649*d+.1430804*p)/Ct),E=rr((.0139322*a+.0971045*d+.7141733*p)/te));const R=116*L-16;return[R<0?0:R,500*(x-L),200*(L-E),b]}function xi(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function rr(h){return h>We?Math.pow(h,1/3):h/be+he}function Hi(h){let[a,d,p,b]=h,x=(a+16)/116,E=isNaN(d)?x:x+d/500,L=isNaN(p)?x:x-p/200;return x=1*Fi(x),E=Ct*Fi(E),L=te*Fi(L),[hi(3.1338561*E-1.6168667*x-.4906146*L),hi(-.9787684*E+1.9161415*x+.033454*L),hi(.0719453*E-.2289914*x+1.4052427*L),b]}function hi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function Fi(h){return h>Wt?h*h*h:be*(h-he)}function Qi(h){return parseInt(h.padEnd(2,h),16)/255}function pr(h,a){return Ar(a?h/100:h,0,1)}function Ar(h,a,d){return Math.min(Math.max(a,h),d)}function $r(h){return!h.some(Number.isNaN)}const so={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $i{constructor(a,d,p){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=a,this.g=d,this.b=p,this.a=b,x||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,d,p,b]))}static parse(a){if(a instanceof $i)return a;if(typeof a!="string")return;const d=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=so[p];if(b){const[E,L,R]=b;return[E/255,L/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const E=p.length<6?1:2;let L=1;return[Qi(p.slice(L,L+=E)),Qi(p.slice(L,L+=E)),Qi(p.slice(L,L+=E)),Qi(p.slice(L,L+E)||"ff")]}if(p.startsWith("rgb")){const E=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[L,R,D,U,V,J,tt,st,dt,wt,Pt,Zt]=E,Nt=[U||" ",tt||" ",wt].join("");if(Nt==="  "||Nt==="  /"||Nt===",,"||Nt===",,,"){const Vt=[D,J,dt].join(""),se=Vt==="%%%"?100:Vt===""?255:0;if(se){const Te=[Ar(+R/se,0,1),Ar(+V/se,0,1),Ar(+st/se,0,1),Pt?pr(+Pt,Zt):1];if($r(Te))return Te}}return}}const x=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,L,R,D,U,V,J,tt,st]=x,dt=[R||" ",U||" ",J].join("");if(dt==="  "||dt==="  /"||dt===",,"||dt===",,,"){const wt=[+L,Ar(+D,0,100),Ar(+V,0,100),tt?pr(+tt,st):1];if($r(wt))return function(Pt){let[Zt,Nt,Vt,se]=Pt;function Te(Ge){const mi=(Ge+Zt/30)%12,je=Nt*Math.min(Vt,1-Vt);return Vt-je*Math.max(-1,Math.min(mi-3,9-mi,1))}return Zt=Qe(Zt),Nt/=100,Vt/=100,[Te(0),Te(8),Te(4),se]}(wt)}}}(a);return d?new $i(...d,!1):void 0}get rgb(){const{r:a,g:d,b:p,a:b}=this,x=b||1/0;return this.overwriteGetter("rgb",[a/x,d/x,p/x,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[d,p,b,x]=Ci(a),E=Math.sqrt(p*p+b*b);return[Math.round(1e4*E)?Qe(Math.atan2(b,p)*Li):NaN,E,d,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ci(this.rgb))}overwriteGetter(a,d){return Object.defineProperty(this,a,{value:d}),d}toString(){const[a,d,p,b]=this.rgb;return`rgba(${[a,d,p].map(x=>Math.round(255*x)).join(",")},${b})`}}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1);class yn{constructor(a,d,p){this.sensitivity=a?d?"variant":"case":d?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,d){return this.collator.compare(a,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xn{constructor(a,d,p,b,x){this.text=a,this.image=d,this.scale=p,this.fontStack=b,this.textColor=x}}class Ir{constructor(a){this.sections=a}static fromString(a){return new Ir([new Xn(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof Ir?a:Ir.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Lr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Lr)return a;if(typeof a=="number")return new Lr([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const d of a)if(typeof d!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Lr(a)}}toString(){return JSON.stringify(this.values)}}const oo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Mr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Mr)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let d=0;d<a.length;d+=2){const p=a[d],b=a[d+1];if(typeof p!="string"||!oo.has(p)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Mr(a)}}toString(){return JSON.stringify(this.values)}}class Er{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Er({name:a,available:!1}):null}}function ao(h,a,d,p){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof d=="number"&&d>=0&&d<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[h,a,d,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[h,a,d,p]:[h,a,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zn(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof $i||h instanceof yn||h instanceof Ir||h instanceof Lr||h instanceof Mr||h instanceof Er)return!0;if(Array.isArray(h)){for(const a of h)if(!Zn(a))return!1;return!0}if(typeof h=="object"){for(const a in h)if(!Zn(h[a]))return!1;return!0}return!1}function yr(h){if(h===null)return _r;if(typeof h=="string")return yi;if(typeof h=="boolean")return Ue;if(typeof h=="number")return ge;if(h instanceof $i)return Vi;if(h instanceof yn)return _n;if(h instanceof Ir)return ir;if(h instanceof Lr)return Qr;if(h instanceof Mr)return xt;if(h instanceof Er)return tn;if(Array.isArray(h)){const a=h.length;let d;for(const p of h){const b=yr(p);if(d){if(d===b)continue;d=ze;break}d=b}return Y(d||ze,a)}return Zr}function Yi(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof $i||h instanceof Ir||h instanceof Lr||h instanceof Mr||h instanceof Er?h.toString():JSON.stringify(h)}class un{constructor(a,d){this.type=a,this.value=d}static parse(a,d){if(a.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Zn(a[1]))return d.error("invalid value");const p=a[1];let b=yr(p);const x=d.expectedType;return b.kind!=="array"||b.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(b=x),new un(b,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class fr{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const lo={string:yi,number:ge,boolean:Ue,object:Zr};class dn{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");let p,b=1;const x=a[0];if(x==="array"){let L,R;if(a.length>2){const D=a[1];if(typeof D!="string"||!(D in lo)||D==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);L=lo[D],b++}else L=ze;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return d.error('The length argument to "array" must be a positive integer literal',2);R=a[2],b++}p=Y(L,R)}else{if(!lo[x])throw new Error(`Types doesn't contain name = ${x}`);p=lo[x]}const E=[];for(;b<a.length;b++){const L=d.parse(a[b],b,ze);if(!L)return null;E.push(L)}return new dn(p,E)}evaluate(a){for(let d=0;d<this.args.length;d++){const p=this.args[d].evaluate(a);if(!_t(this.type,yr(p)))return p;if(d===this.args.length-1)throw new fr(`Expected value to be of type ${K(this.type)}, but found ${K(yr(p))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const $o={"to-boolean":Ue,"to-color":Vi,"to-number":ge,"to-string":yi};class Tr{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const p=a[0];if(!$o[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&a.length!==2)return d.error("Expected one argument.");const b=$o[p],x=[];for(let E=1;E<a.length;E++){const L=d.parse(a[E],E,ze);if(!L)return null;x.push(L)}return new Tr(b,x)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let d,p;for(const b of this.args){if(d=b.evaluate(a),p=null,d instanceof $i)return d;if(typeof d=="string"){const x=a.parseColor(d);if(x)return x}else if(Array.isArray(d)&&(p=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:ao(d[0],d[1],d[2],d[3]),!p))return new $i(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new fr(p||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const p of this.args){d=p.evaluate(a);const b=Lr.parse(d);if(b)return b}throw new fr(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const p of this.args){d=p.evaluate(a);const b=Mr.parse(d);if(b)return b}throw new fr(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const p of this.args){if(d=p.evaluate(a),d===null)return 0;const b=Number(d);if(!isNaN(b))return b}throw new fr(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return Ir.fromString(Yi(this.args[0].evaluate(a)));case"resolvedImage":return Er.fromString(Yi(this.args[0].evaluate(a)));default:return Yi(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const $n=["Unknown","Point","LineString","Polygon"];class pn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$n[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let d=this._parseColorCache[a];return d||(d=this._parseColorCache[a]=$i.parse(a)),d}}class as{constructor(a,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],b=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new ke,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=a,this.path=p,this.key=p.map(L=>`[${L}]`).join(""),this.scope=x,this.errors=E,this.expectedType=b,this._isConstant=d}parse(a,d,p,b){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return d?this.concat(d,p,b)._parse(a,x):this._parse(a,x)}_parse(a,d){function p(b,x,E){return E==="assert"?new dn(x,[b]):E==="coerce"?new Tr(x,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[b];if(x){let E=x.parse(a,this);if(!E)return null;if(this.expectedType){const L=this.expectedType,R=E.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||R.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(L.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(L,R))return null}else E=p(E,L,d.typeAnnotation||"coerce");else E=p(E,L,d.typeAnnotation||"coerce");else E=p(E,L,d.typeAnnotation||"coerce");else E=p(E,L,d.typeAnnotation||"assert")}if(!(E instanceof un)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const L=new pn;try{E=new un(E.type,E.evaluate(L))}catch(R){return this.error(R.message),null}}return E}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,d,p){const b=typeof a=="number"?this.path.concat(a):this.path,x=p?this.scope.concat(p):this.scope;return new as(this.registry,this._isConstant,b,d||null,x,this.errors)}error(a){for(var d=arguments.length,p=new Array(d>1?d-1:0),b=1;b<d;b++)p[b-1]=arguments[b];const x=`${this.key}${p.map(E=>`[${E}]`).join("")}`;this.errors.push(new bi(x,a))}checkSubtype(a,d){const p=_t(a,d);return p&&this.error(p),p}}class Yn{constructor(a,d){this.type=d.type,this.bindings=[].concat(a),this.result=d}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const d of this.bindings)a(d[1]);a(this.result)}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const p=[];for(let x=1;x<a.length-1;x+=2){const E=a[x];if(typeof E!="string")return d.error(`Expected string, but found ${typeof E} instead.`,x);if(/[^a-zA-Z0-9_]/.test(E))return d.error("Variable names must contain only alphanumeric characters or '_'.",x);const L=d.parse(a[x+1],x+1);if(!L)return null;p.push([E,L])}const b=d.parse(a[a.length-1],a.length-1,d.expectedType,p);return b?new Yn(p,b):null}outputDefined(){return this.result.outputDefined()}}class Wi{constructor(a,d){this.type=d.type,this.name=a,this.boundExpression=d}static parse(a,d){if(a.length!==2||typeof a[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const p=a[1];return d.scope.has(p)?new Wi(p,d.scope.get(p)):d.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class Aa{constructor(a,d,p){this.type=a,this.index=d,this.input=p}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=d.parse(a[1],1,ge),b=d.parse(a[2],2,Y(d.expectedType||ze));return p&&b?new Aa(b.type.itemType,p,b):null}evaluate(a){const d=this.index.evaluate(a),p=this.input.evaluate(a);if(d<0)throw new fr(`Array index out of bounds: ${d} < 0.`);if(d>=p.length)throw new fr(`Array index out of bounds: ${d} > ${p.length-1}.`);if(d!==Math.floor(d))throw new fr(`Array index must be an integer, but found ${d} instead.`);return p[d]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Ja{constructor(a,d){this.type=Ue,this.needle=a,this.haystack=d}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const p=d.parse(a[1],1,ze),b=d.parse(a[2],2,ze);return p&&b?kt(p.type,[Ue,yi,ge,_r,ze])?new Ja(p,b):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(p.type)} instead`):null}evaluate(a){const d=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Gt(d,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${K(yr(d))} instead.`);if(!Gt(p,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${K(yr(p))} instead.`);return p.indexOf(d)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class rt{constructor(a,d,p){this.type=ge,this.needle=a,this.haystack=d,this.fromIndex=p}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=d.parse(a[1],1,ze),b=d.parse(a[2],2,ze);if(!p||!b)return null;if(!kt(p.type,[Ue,yi,ge,_r,ze]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(p.type)} instead`);if(a.length===4){const x=d.parse(a[3],3,ge);return x?new rt(p,b,x):null}return new rt(p,b)}evaluate(a){const d=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Gt(d,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${K(yr(d))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(a)),Gt(p,["string"])){const x=p.indexOf(d,b);return x===-1?-1:[...p.slice(0,x)].length}if(Gt(p,["array"]))return p.indexOf(d,b);throw new fr(`Expected second argument to be of type array or string, but found ${K(yr(p))} instead.`)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class mt{constructor(a,d,p,b,x,E){this.inputType=a,this.type=d,this.input=p,this.cases=b,this.outputs=x,this.otherwise=E}static parse(a,d){if(a.length<5)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return d.error("Expected an even number of arguments.");let p,b;d.expectedType&&d.expectedType.kind!=="value"&&(b=d.expectedType);const x={},E=[];for(let D=2;D<a.length-1;D+=2){let U=a[D];const V=a[D+1];Array.isArray(U)||(U=[U]);const J=d.concat(D);if(U.length===0)return J.error("Expected at least one branch label.");for(const st of U){if(typeof st!="number"&&typeof st!="string")return J.error("Branch labels must be numbers or strings.");if(typeof st=="number"&&Math.abs(st)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof st=="number"&&Math.floor(st)!==st)return J.error("Numeric branch labels must be integer values.");if(p){if(J.checkSubtype(p,yr(st)))return null}else p=yr(st);if(x[String(st)]!==void 0)return J.error("Branch labels must be unique.");x[String(st)]=E.length}const tt=d.parse(V,D,b);if(!tt)return null;b=b||tt.type,E.push(tt)}const L=d.parse(a[1],1,ze);if(!L)return null;const R=d.parse(a[a.length-1],a.length-1,b);return R?L.type.kind!=="value"&&d.concat(1).checkSubtype(p,L.type)?null:new mt(p,b,L,x,E,R):null}evaluate(a){const d=this.input.evaluate(a);return(yr(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class Dt{constructor(a,d,p){this.type=a,this.branches=d,this.otherwise=p}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return d.error("Expected an odd number of arguments.");let p;d.expectedType&&d.expectedType.kind!=="value"&&(p=d.expectedType);const b=[];for(let E=1;E<a.length-1;E+=2){const L=d.parse(a[E],E,Ue);if(!L)return null;const R=d.parse(a[E+1],E+1,p);if(!R)return null;b.push([L,R]),p=p||R.type}const x=d.parse(a[a.length-1],a.length-1,p);if(!x)return null;if(!p)throw new Error("Can't infer output type");return new Dt(p,b,x)}evaluate(a){for(const[d,p]of this.branches)if(d.evaluate(a))return p.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[d,p]of this.branches)a(d),a(p);a(this.otherwise)}outputDefined(){return this.branches.every(a=>{let[d,p]=a;return p.outputDefined()})&&this.otherwise.outputDefined()}}class ne{constructor(a,d,p,b){this.type=a,this.input=d,this.beginIndex=p,this.endIndex=b}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const p=d.parse(a[1],1,ze),b=d.parse(a[2],2,ge);if(!p||!b)return null;if(!kt(p.type,[Y(ze),yi,ze]))return d.error(`Expected first argument to be of type array or string, but found ${K(p.type)} instead`);if(a.length===4){const x=d.parse(a[3],3,ge);return x?new ne(p.type,p,b,x):null}return new ne(p.type,p,b)}evaluate(a){const d=this.input.evaluate(a),p=this.beginIndex.evaluate(a);let b;if(this.endIndex&&(b=this.endIndex.evaluate(a)),Gt(d,["string"]))return[...d].slice(p,b).join("");if(Gt(d,["array"]))return d.slice(p,b);throw new fr(`Expected first argument to be of type array or string, but found ${K(yr(d))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Se(h,a){const d=h.length-1;let p,b,x=0,E=d,L=0;for(;x<=E;)if(L=Math.floor((x+E)/2),p=h[L],b=h[L+1],p<=a){if(L===d||a<b)return L;x=L+1}else{if(!(p>a))throw new fr("Input is not a number.");E=L-1}return 0}class oi{constructor(a,d,p){this.type=a,this.input=d,this.labels=[],this.outputs=[];for(const[b,x]of p)this.labels.push(b),this.outputs.push(x)}static parse(a,d){if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return d.error("Expected an even number of arguments.");const p=d.parse(a[1],1,ge);if(!p)return null;const b=[];let x=null;d.expectedType&&d.expectedType.kind!=="value"&&(x=d.expectedType);for(let E=1;E<a.length;E+=2){const L=E===1?-1/0:a[E],R=a[E+1],D=E,U=E+1;if(typeof L!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(b.length&&b[b.length-1][0]>=L)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const V=d.parse(R,U,x);if(!V)return null;x=x||V.type,b.push([L,V])}return new oi(x,p,b)}evaluate(a){const d=this.labels,p=this.outputs;if(d.length===1)return p[0].evaluate(a);const b=this.input.evaluate(a);if(b<=d[0])return p[0].evaluate(a);const x=d.length;return b>=d[x-1]?p[x-1].evaluate(a):p[Se(d,b)].evaluate(a)}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Pi(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var cr=fn;function fn(h,a,d,p){this.cx=3*h,this.bx=3*(d-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=a,this.p2x=d,this.p2y=p}fn.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,a){if(a===void 0&&(a=1e-6),h<0)return 0;if(h>1)return 1;for(var d=h,p=0;p<8;p++){var b=this.sampleCurveX(d)-h;if(Math.abs(b)<a)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=b/x}var E=0,L=1;for(d=h,p=0;p<20&&(b=this.sampleCurveX(d),!(Math.abs(b-h)<a));p++)h>b?E=d:L=d,d=.5*(L-E)+E;return d},solve:function(h,a){return this.sampleCurveY(this.solveCurveX(h,a))}};var vn=Pi(cr);function er(h,a,d){return h+d*(a-h)}function Ka(h,a,d){return h.map((p,b)=>er(p,a[b],d))}const Pn={number:er,color:function(h,a,d){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[p,b,x,E]=Ka(h.rgb,a.rgb,d);return new $i(p,b,x,E,!1)}case"hcl":{const[p,b,x,E]=h.hcl,[L,R,D,U]=a.hcl;let V,J;if(isNaN(p)||isNaN(L))isNaN(p)?isNaN(L)?V=NaN:(V=L,x!==1&&x!==0||(J=R)):(V=p,D!==1&&D!==0||(J=b));else{let Pt=L-p;L>p&&Pt>180?Pt-=360:L<p&&p-L>180&&(Pt+=360),V=p+d*Pt}const[tt,st,dt,wt]=function(Pt){let[Zt,Nt,Vt,se]=Pt;return Zt=isNaN(Zt)?0:Zt*Je,Hi([Vt,Math.cos(Zt)*Nt,Math.sin(Zt)*Nt,se])}([V,J??er(b,R,d),er(x,D,d),er(E,U,d)]);return new $i(tt,st,dt,wt,!1)}case"lab":{const[p,b,x,E]=Hi(Ka(h.lab,a.lab,d));return new $i(p,b,x,E,!1)}}},array:Ka,padding:function(h,a,d){return new Lr(Ka(h.values,a.values,d))},variableAnchorOffsetCollection:function(h,a,d){const p=h.values,b=a.values;if(p.length!==b.length)throw new fr(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${a.toString()}`);const x=[];for(let E=0;E<p.length;E+=2){if(p[E]!==b[E])throw new fr(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${p[E]}, to[${E}]: ${b[E]}`);x.push(p[E]);const[L,R]=p[E+1],[D,U]=b[E+1];x.push([er(L,D,d),er(R,U,d)])}return new Mr(x)}};class ui{constructor(a,d,p,b,x){this.type=a,this.operator=d,this.interpolation=p,this.input=b,this.labels=[],this.outputs=[];for(const[E,L]of x)this.labels.push(E),this.outputs.push(L)}static interpolationFactor(a,d,p,b){let x=0;if(a.name==="exponential")x=Ll(d,a.base,p,b);else if(a.name==="linear")x=Ll(d,1,p,b);else if(a.name==="cubic-bezier"){const E=a.controlPoints;x=new vn(E[0],E[1],E[2],E[3]).solve(Ll(d,1,p,b))}return x}static parse(a,d){let[p,b,x,...E]=a;if(!Array.isArray(b)||b.length===0)return d.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const D=b[1];if(typeof D!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:D}}else{if(b[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const D=b.slice(1);if(D.length!==4||D.some(U=>typeof U!="number"||U<0||U>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:D}}}if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(x=d.parse(x,2,ge),!x)return null;const L=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=Vi:d.expectedType&&d.expectedType.kind!=="value"&&(R=d.expectedType);for(let D=0;D<E.length;D+=2){const U=E[D],V=E[D+1],J=D+3,tt=D+4;if(typeof U!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(L.length&&L[L.length-1][0]>=U)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const st=d.parse(V,tt,R);if(!st)return null;R=R||st.type,L.push([U,st])}return Rt(R,ge)||Rt(R,Vi)||Rt(R,Qr)||Rt(R,xt)||Rt(R,Y(ge))?new ui(R,p,b,x,L):d.error(`Type ${K(R)} is not interpolatable.`)}evaluate(a){const d=this.labels,p=this.outputs;if(d.length===1)return p[0].evaluate(a);const b=this.input.evaluate(a);if(b<=d[0])return p[0].evaluate(a);const x=d.length;if(b>=d[x-1])return p[x-1].evaluate(a);const E=Se(d,b),L=ui.interpolationFactor(this.interpolation,b,d[E],d[E+1]),R=p[E].evaluate(a),D=p[E+1].evaluate(a);switch(this.operator){case"interpolate":return Pn[this.type.kind](R,D,L);case"interpolate-hcl":return Pn.color(R,D,L,"hcl");case"interpolate-lab":return Pn.color(R,D,L,"lab")}}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Ll(h,a,d,p){const b=p-d,x=h-d;return b===0?0:a===1?x/b:(Math.pow(a,x)-1)/(Math.pow(a,b)-1)}class Ml{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expectected at least one argument.");let p=null;const b=d.expectedType;b&&b.kind!=="value"&&(p=b);const x=[];for(const L of a.slice(1)){const R=d.parse(L,1+x.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,x.push(R)}if(!p)throw new Error("No output type");const E=b&&x.some(L=>_t(b,L.type));return new Ml(E?ze:p,x)}evaluate(a){let d,p=null,b=0;for(const x of this.args)if(b++,p=x.evaluate(a),p&&p instanceof Er&&!p.available&&(d||(d=p.name),p=null,b===this.args.length&&(p=d)),p!==null)break;return p}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}function xs(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Ac(h,a,d,p){return p.compare(a,d)===0}function Yo(h,a,d){const p=h!=="=="&&h!=="!=";return class A3{constructor(x,E,L){this.type=Ue,this.lhs=x,this.rhs=E,this.collator=L,this.hasUntypedArgument=x.type.kind==="value"||E.type.kind==="value"}static parse(x,E){if(x.length!==3&&x.length!==4)return E.error("Expected two or three arguments.");const L=x[0];let R=E.parse(x[1],1,ze);if(!R)return null;if(!xs(L,R.type))return E.concat(1).error(`"${L}" comparisons are not supported for type '${K(R.type)}'.`);let D=E.parse(x[2],2,ze);if(!D)return null;if(!xs(L,D.type))return E.concat(2).error(`"${L}" comparisons are not supported for type '${K(D.type)}'.`);if(R.type.kind!==D.type.kind&&R.type.kind!=="value"&&D.type.kind!=="value")return E.error(`Cannot compare types '${K(R.type)}' and '${K(D.type)}'.`);p&&(R.type.kind==="value"&&D.type.kind!=="value"?R=new dn(D.type,[R]):R.type.kind!=="value"&&D.type.kind==="value"&&(D=new dn(R.type,[D])));let U=null;if(x.length===4){if(R.type.kind!=="string"&&D.type.kind!=="string"&&R.type.kind!=="value"&&D.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(U=E.parse(x[3],3,_n),!U)return null}return new A3(R,D,U)}evaluate(x){const E=this.lhs.evaluate(x),L=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){const R=yr(E),D=yr(L);if(R.kind!==D.kind||R.kind!=="string"&&R.kind!=="number")throw new fr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${R.kind}, ${D.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=yr(E),D=yr(L);if(R.kind!=="string"||D.kind!=="string")return a(x,E,L)}return this.collator?d(x,E,L,this.collator.evaluate(x)):a(x,E,L)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Bl=Yo("==",function(h,a,d){return a===d},Ac),Rl=Yo("!=",function(h,a,d){return a!==d},function(h,a,d,p){return!Ac(0,a,d,p)}),hh=Yo("<",function(h,a,d){return a<d},function(h,a,d,p){return p.compare(a,d)<0}),$h=Yo(">",function(h,a,d){return a>d},function(h,a,d,p){return p.compare(a,d)>0}),Yh=Yo("<=",function(h,a,d){return a<=d},function(h,a,d,p){return p.compare(a,d)<=0}),kl=Yo(">=",function(h,a,d){return a>=d},function(h,a,d,p){return p.compare(a,d)>=0});class co{constructor(a,d,p){this.type=_n,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=d}static parse(a,d){if(a.length!==2)return d.error("Expected one argument.");const p=a[1];if(typeof p!="object"||Array.isArray(p))return d.error("Collator options argument must be an object.");const b=d.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ue);if(!b)return null;const x=d.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ue);if(!x)return null;let E=null;return p.locale&&(E=d.parse(p.locale,1,yi),!E)?null:new co(b,x,E)}evaluate(a){return new yn(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class To{constructor(a,d,p,b,x){this.type=yi,this.number=a,this.locale=d,this.currency=p,this.minFractionDigits=b,this.maxFractionDigits=x}static parse(a,d){if(a.length!==3)return d.error("Expected two arguments.");const p=d.parse(a[1],1,ge);if(!p)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return d.error("NumberFormat options argument must be an object.");let x=null;if(b.locale&&(x=d.parse(b.locale,1,yi),!x))return null;let E=null;if(b.currency&&(E=d.parse(b.currency,1,yi),!E))return null;let L=null;if(b["min-fraction-digits"]&&(L=d.parse(b["min-fraction-digits"],1,ge),!L))return null;let R=null;return b["max-fraction-digits"]&&(R=d.parse(b["max-fraction-digits"],1,ge),!R)?null:new To(p,x,E,L,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Fl{constructor(a){this.type=ir,this.sections=a}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const p=a[1];if(!Array.isArray(p)&&typeof p=="object")return d.error("First argument must be an image or text section.");const b=[];let x=!1;for(let E=1;E<=a.length-1;++E){const L=a[E];if(x&&typeof L=="object"&&!Array.isArray(L)){x=!1;let R=null;if(L["font-scale"]&&(R=d.parse(L["font-scale"],1,ge),!R))return null;let D=null;if(L["text-font"]&&(D=d.parse(L["text-font"],1,Y(yi)),!D))return null;let U=null;if(L["text-color"]&&(U=d.parse(L["text-color"],1,Vi),!U))return null;const V=b[b.length-1];V.scale=R,V.font=D,V.textColor=U}else{const R=d.parse(a[E],1,ze);if(!R)return null;const D=R.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,b.push({content:R,scale:null,font:null,textColor:null})}}return new Fl(b)}evaluate(a){return new Ir(this.sections.map(d=>{const p=d.content.evaluate(a);return yr(p)===tn?new Xn("",p,null,null,null):new Xn(Yi(p),null,d.scale?d.scale.evaluate(a):null,d.font?d.font.evaluate(a).join(","):null,d.textColor?d.textColor.evaluate(a):null)}))}eachChild(a){for(const d of this.sections)a(d.content),d.scale&&a(d.scale),d.font&&a(d.font),d.textColor&&a(d.textColor)}outputDefined(){return!1}}class Jo{constructor(a){this.type=tn,this.input=a}static parse(a,d){if(a.length!==2)return d.error("Expected two arguments.");const p=d.parse(a[1],1,yi);return p?new Jo(p):d.error("No image name provided.")}evaluate(a){const d=this.input.evaluate(a),p=Er.fromString(d);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(d)>-1),p}eachChild(a){a(this.input)}outputDefined(){return!1}}class Qa{constructor(a){this.type=ge,this.input=a}static parse(a,d){if(a.length!==2)return d.error(`Expected 1 argument, but found ${a.length-1} instead.`);const p=d.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${K(p.type)} instead.`):new Qa(p):null}evaluate(a){const d=this.input.evaluate(a);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new fr(`Expected value to be of type string or array, but found ${K(yr(d))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const Jn=8192;function uh(h,a){const d=(180+h[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(d*b*Jn),Math.round(p*b*Jn)]}function Dl(h,a){const d=Math.pow(2,a.z);return[(b=(h[0]/Jn+a.x)/d,360*b-180),(p=(h[1]/Jn+a.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,b}function Co(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function ho(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function ji(h,a,d){const p=h[0]-a[0],b=h[1]-a[1],x=h[0]-d[0],E=h[1]-d[1];return p*E-x*b==0&&p*x<=0&&b*E<=0}function uo(h,a,d,p){return(b=[p[0]-d[0],p[1]-d[1]])[0]*(x=[a[0]-h[0],a[1]-h[1]])[1]-b[1]*x[0]!=0&&!(!dh(h,a,d,p)||!dh(d,p,h,a));var b,x}function Jh(h,a,d){for(const p of d)for(let b=0;b<p.length-1;++b)if(uo(h,a,p[b],p[b+1]))return!0;return!1}function ws(h,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=!1;for(const L of a)for(let R=0;R<L.length-1;R++){if(ji(h,L[R],L[R+1]))return d;(x=L[R])[1]>(b=h)[1]!=(E=L[R+1])[1]>b[1]&&b[0]<(E[0]-x[0])*(b[1]-x[1])/(E[1]-x[1])+x[0]&&(p=!p)}var b,x,E;return p}function po(h,a){for(const d of a)if(ws(h,d))return!0;return!1}function Ol(h,a){for(const d of h)if(!ws(d,a))return!1;for(let d=0;d<h.length-1;++d)if(Jh(h[d],h[d+1],a))return!1;return!0}function tl(h,a){for(const d of a)if(Ol(h,d))return!0;return!1}function dh(h,a,d,p){const b=p[0]-d[0],x=p[1]-d[1],E=(h[0]-d[0])*x-b*(h[1]-d[1]),L=(a[0]-d[0])*x-b*(a[1]-d[1]);return E>0&&L<0||E<0&&L>0}function Ea(h,a,d){const p=[];for(let b=0;b<h.length;b++){const x=[];for(let E=0;E<h[b].length;E++){const L=uh(h[b][E],d);Co(a,L),x.push(L)}p.push(x)}return p}function ph(h,a,d){const p=[];for(let b=0;b<h.length;b++){const x=Ea(h[b],a,d);p.push(x)}return p}function Nl(h,a,d,p){if(h[0]<d[0]||h[0]>d[2]){const b=.5*p;let x=h[0]-d[0]>b?-p:d[0]-h[0]>b?p:0;x===0&&(x=h[0]-d[2]>b?-p:d[2]-h[0]>b?p:0),h[0]+=x}Co(a,h)}function zl(h,a,d,p){const b=Math.pow(2,p.z)*Jn,x=[p.x*Jn,p.y*Jn],E=[];for(const L of h)for(const R of L){const D=[R.x+x[0],R.y+x[1]];Nl(D,a,d,b),E.push(D)}return E}function Ec(h,a,d,p){const b=Math.pow(2,p.z)*Jn,x=[p.x*Jn,p.y*Jn],E=[];for(const R of h){const D=[];for(const U of R){const V=[U.x+x[0],U.y+x[1]];Co(a,V),D.push(V)}E.push(D)}if(a[2]-a[0]<=b/2){(L=a)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const R of E)for(const D of R)Nl(D,a,d,b)}var L;return E}class ks{constructor(a,d){this.type=Ue,this.geojson=a,this.geometries=d}static parse(a,d){if(a.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Zn(a[1])){const p=a[1];if(p.type==="FeatureCollection"){const b=[];for(const x of p.features){const{type:E,coordinates:L}=x.geometry;E==="Polygon"&&b.push(L),E==="MultiPolygon"&&b.push(...L)}if(b.length)return new ks(p,{type:"MultiPolygon",coordinates:b})}else if(p.type==="Feature"){const b=p.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ks(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new ks(p,p)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(d,p){const b=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=d.canonicalID();if(p.type==="Polygon"){const L=Ea(p.coordinates,x,E),R=zl(d.geometry(),b,x,E);if(!ho(b,x))return!1;for(const D of R)if(!ws(D,L))return!1}if(p.type==="MultiPolygon"){const L=ph(p.coordinates,x,E),R=zl(d.geometry(),b,x,E);if(!ho(b,x))return!1;for(const D of R)if(!po(D,L))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(d,p){const b=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=d.canonicalID();if(p.type==="Polygon"){const L=Ea(p.coordinates,x,E),R=Ec(d.geometry(),b,x,E);if(!ho(b,x))return!1;for(const D of R)if(!Ol(D,L))return!1}if(p.type==="MultiPolygon"){const L=ph(p.coordinates,x,E),R=Ec(d.geometry(),b,x,E);if(!ho(b,x))return!1;for(const D of R)if(!tl(D,L))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let jl=class{constructor(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(d,p)=>d<p?-1:d>p?1:0;if(this.data=h,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:a,compare:d}=this,p=a[h];for(;h>0;){const b=h-1>>1,x=a[b];if(d(p,x)>=0)break;a[h]=x,h=b}a[h]=p}_down(h){const{data:a,compare:d}=this,p=this.length>>1,b=a[h];for(;h<p;){let x=1+(h<<1);const E=x+1;if(E<this.length&&d(a[E],a[x])<0&&(x=E),d(a[x],b)>=0)break;a[h]=a[x],h=x}a[h]=b}};function Tc(h,a,d,p,b){Cc(h,a,d,p||h.length-1,b||Ul)}function Cc(h,a,d,p,b){for(;p>d;){if(p-d>600){var x=p-d+1,E=a-d+1,L=Math.log(x),R=.5*Math.exp(2*L/3),D=.5*Math.sqrt(L*R*(x-R)/x)*(E-x/2<0?-1:1);Cc(h,a,Math.max(d,Math.floor(a-E*R/x+D)),Math.min(p,Math.floor(a+(x-E)*R/x+D)),b)}var U=h[a],V=d,J=p;for(el(h,d,a),b(h[p],U)>0&&el(h,d,p);V<J;){for(el(h,V,J),V++,J--;b(h[V],U)<0;)V++;for(;b(h[J],U)>0;)J--}b(h[d],U)===0?el(h,d,J):el(h,++J,p),J<=a&&(d=J+1),a<=J&&(p=J-1)}}function el(h,a,d){var p=h[a];h[a]=h[d],h[d]=p}function Ul(h,a){return h<a?-1:h>a?1:0}function Po(h,a){if(h.length<=1)return[h];const d=[];let p,b;for(const x of h){const E=Ta(x);E!==0&&(x.area=Math.abs(E),b===void 0&&(b=E<0),b===E<0?(p&&d.push(p),p=[x]):p.push(x))}if(p&&d.push(p),a>1)for(let x=0;x<d.length;x++)d[x].length<=a||(Tc(d[x],a,1,d[x].length-1,Pc),d[x]=d[x].slice(0,a));return d}function Pc(h,a){return a.area-h.area}function Ta(h){let a=0;for(let d,p,b=0,x=h.length,E=x-1;b<x;E=b++)d=h[b],p=h[E],a+=(p.x-d.x)*(d.y+p.y);return a}const Gl=1/298.257223563,k=Gl*(2-Gl),et=Math.PI/180;class At{constructor(a){const d=6378.137*et*1e3,p=Math.cos(a*et),b=1/(1-k*(1-p*p)),x=Math.sqrt(b);this.kx=d*x*p,this.ky=d*x*b*(1-k)}distance(a,d){const p=this.wrap(a[0]-d[0])*this.kx,b=(a[1]-d[1])*this.ky;return Math.sqrt(p*p+b*b)}pointOnLine(a,d){let p,b,x,E,L=1/0;for(let R=0;R<a.length-1;R++){let D=a[R][0],U=a[R][1],V=this.wrap(a[R+1][0]-D)*this.kx,J=(a[R+1][1]-U)*this.ky,tt=0;V===0&&J===0||(tt=(this.wrap(d[0]-D)*this.kx*V+(d[1]-U)*this.ky*J)/(V*V+J*J),tt>1?(D=a[R+1][0],U=a[R+1][1]):tt>0&&(D+=V/this.kx*tt,U+=J/this.ky*tt)),V=this.wrap(d[0]-D)*this.kx,J=(d[1]-U)*this.ky;const st=V*V+J*J;st<L&&(L=st,p=D,b=U,x=R,E=tt)}return{point:[p,b],index:x,t:Math.max(0,Math.min(1,E))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}function Ot(h,a){return a[0]-h[0]}function Xt(h){return h[1]-h[0]+1}function ae(h,a){return h[1]>=h[0]&&h[1]<a}function Ie(h,a){if(h[0]>h[1])return[null,null];const d=Xt(h);if(a){if(d===2)return[h,null];const b=Math.floor(d/2);return[[h[0],h[0]+b],[h[0]+b,h[1]]]}if(d===1)return[h,null];const p=Math.floor(d/2)-1;return[[h[0],h[0]+p],[h[0]+p+1,h[1]]]}function He(h,a){if(!ae(a,h.length))return[1/0,1/0,-1/0,-1/0];const d=[1/0,1/0,-1/0,-1/0];for(let p=a[0];p<=a[1];++p)Co(d,h[p]);return d}function gi(h){const a=[1/0,1/0,-1/0,-1/0];for(const d of h)for(const p of d)Co(a,p);return a}function Ii(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Di(h,a,d){if(!Ii(h)||!Ii(a))return NaN;let p=0,b=0;return h[2]<a[0]&&(p=a[0]-h[2]),h[0]>a[2]&&(p=h[0]-a[2]),h[1]>a[3]&&(b=h[1]-a[3]),h[3]<a[1]&&(b=a[1]-h[3]),d.distance([0,0],[p,b])}function Ui(h,a,d){const p=d.pointOnLine(a,h);return d.distance(h,p.point)}function Br(h,a,d,p,b){const x=Math.min(Ui(h,[d,p],b),Ui(a,[d,p],b)),E=Math.min(Ui(d,[h,a],b),Ui(p,[h,a],b));return Math.min(x,E)}function en(h,a,d,p,b){if(!ae(a,h.length)||!ae(p,d.length))return 1/0;let x=1/0;for(let E=a[0];E<a[1];++E){const L=h[E],R=h[E+1];for(let D=p[0];D<p[1];++D){const U=d[D],V=d[D+1];if(uo(L,R,U,V))return 0;x=Math.min(x,Br(L,R,U,V,b))}}return x}function Oi(h,a,d,p,b){if(!ae(a,h.length)||!ae(p,d.length))return NaN;let x=1/0;for(let E=a[0];E<=a[1];++E)for(let L=p[0];L<=p[1];++L)if(x=Math.min(x,b.distance(h[E],d[L])),x===0)return x;return x}function Fn(h,a,d){if(ws(h,a,!0))return 0;let p=1/0;for(const b of a){const x=b[0],E=b[b.length-1];if(x!==E&&(p=Math.min(p,Ui(h,[E,x],d)),p===0))return p;const L=d.pointOnLine(b,h);if(p=Math.min(p,d.distance(h,L.point)),p===0)return p}return p}function di(h,a,d,p){if(!ae(a,h.length))return NaN;for(let x=a[0];x<=a[1];++x)if(ws(h[x],d,!0))return 0;let b=1/0;for(let x=a[0];x<a[1];++x){const E=h[x],L=h[x+1];for(const R of d)for(let D=0,U=R.length,V=U-1;D<U;V=D++){const J=R[V],tt=R[D];if(uo(E,L,J,tt))return 0;b=Math.min(b,Br(E,L,J,tt,p))}}return b}function ls(h,a){for(const d of h)for(const p of d)if(ws(p,a,!0))return!0;return!1}function Xi(h,a,d){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/0;const b=gi(h),x=gi(a);if(p!==1/0&&Di(b,x,d)>=p)return p;if(ho(b,x)){if(ls(h,a))return 0}else if(ls(a,h))return 0;let E=1/0;for(const L of h)for(let R=0,D=L.length,U=D-1;R<D;U=R++){const V=L[U],J=L[R];for(const tt of a)for(let st=0,dt=tt.length,wt=dt-1;st<dt;wt=st++){const Pt=tt[wt],Zt=tt[st];if(uo(V,J,Pt,Zt))return 0;E=Math.min(E,Br(V,J,Pt,Zt,d))}}return E}function Ji(h,a,d,p,b,x){if(!x)return;const E=Di(He(p,x),b,d);E<a&&h.push([E,x,[0,0]])}function Io(h,a,d,p,b,x,E){if(!x||!E)return;const L=Di(He(p,x),He(b,E),d);L<a&&h.push([L,x,E])}function Ko(h,a,d,p){let b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1/0,x=Math.min(p.distance(h[0],d[0][0]),b);if(x===0)return x;const E=new jl([[0,[0,h.length-1],[0,0]]],Ot),L=gi(d);for(;E.length>0;){const R=E.pop();if(R[0]>=x)continue;const D=R[1],U=a?50:100;if(Xt(D)<=U){if(!ae(D,h.length))return NaN;if(a){const V=di(h,D,d,p);if(isNaN(V)||V===0)return V;x=Math.min(x,V)}else for(let V=D[0];V<=D[1];++V){const J=Fn(h[V],d,p);if(x=Math.min(x,J),x===0)return 0}}else{const V=Ie(D,a);Ji(E,x,p,h,L,V[0]),Ji(E,x,p,h,L,V[1])}}return x}function Qo(h,a,d,p,b){let x=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,E=Math.min(x,b.distance(h[0],d[0]));if(E===0)return E;const L=new jl([[0,[0,h.length-1],[0,d.length-1]]],Ot);for(;L.length>0;){const R=L.pop();if(R[0]>=E)continue;const D=R[1],U=R[2],V=a?50:100,J=p?50:100;if(Xt(D)<=V&&Xt(U)<=J){if(!ae(D,h.length)&&ae(U,d.length))return NaN;let tt;if(a&&p)tt=en(h,D,d,U,b),E=Math.min(E,tt);else if(a&&!p){const st=h.slice(D[0],D[1]+1);for(let dt=U[0];dt<=U[1];++dt)if(tt=Ui(d[dt],st,b),E=Math.min(E,tt),E===0)return E}else if(!a&&p){const st=d.slice(U[0],U[1]+1);for(let dt=D[0];dt<=D[1];++dt)if(tt=Ui(h[dt],st,b),E=Math.min(E,tt),E===0)return E}else tt=Oi(h,D,d,U,b),E=Math.min(E,tt)}else{const tt=Ie(D,a),st=Ie(U,p);Io(L,E,b,h,d,tt[0],st[0]),Io(L,E,b,h,d,tt[0],st[1]),Io(L,E,b,h,d,tt[1],st[0]),Io(L,E,b,h,d,tt[1],st[1])}}return E}function Ca(h){return h.type==="MultiPolygon"?h.coordinates.map(a=>({type:"Polygon",coordinates:a})):h.type==="MultiLineString"?h.coordinates.map(a=>({type:"LineString",coordinates:a})):h.type==="MultiPoint"?h.coordinates.map(a=>({type:"Point",coordinates:a})):[h]}class fo{constructor(a,d){this.type=ge,this.geojson=a,this.geometries=d}static parse(a,d){if(a.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Zn(a[1])){const p=a[1];if(p.type==="FeatureCollection")return new fo(p,p.features.map(b=>Ca(b.geometry)).flat());if(p.type==="Feature")return new fo(p,Ca(p.geometry));if("type"in p&&"coordinates"in p)return new fo(p,Ca(p))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(d,p){const b=d.geometry(),x=b.flat().map(R=>Dl([R.x,R.y],d.canonical));if(b.length===0)return NaN;const E=new At(x[0][1]);let L=1/0;for(const R of p){switch(R.type){case"Point":L=Math.min(L,Qo(x,!1,[R.coordinates],!1,E,L));break;case"LineString":L=Math.min(L,Qo(x,!1,R.coordinates,!0,E,L));break;case"Polygon":L=Math.min(L,Ko(x,!1,R.coordinates,E,L))}if(L===0)return L}return L}(a,this.geometries);if(a.geometryType()==="LineString")return function(d,p){const b=d.geometry(),x=b.flat().map(R=>Dl([R.x,R.y],d.canonical));if(b.length===0)return NaN;const E=new At(x[0][1]);let L=1/0;for(const R of p){switch(R.type){case"Point":L=Math.min(L,Qo(x,!0,[R.coordinates],!1,E,L));break;case"LineString":L=Math.min(L,Qo(x,!0,R.coordinates,!0,E,L));break;case"Polygon":L=Math.min(L,Ko(x,!0,R.coordinates,E,L))}if(L===0)return L}return L}(a,this.geometries);if(a.geometryType()==="Polygon")return function(d,p){const b=d.geometry();if(b.length===0||b[0].length===0)return NaN;const x=Po(b,0).map(R=>R.map(D=>D.map(U=>Dl([U.x,U.y],d.canonical)))),E=new At(x[0][0][0][1]);let L=1/0;for(const R of p)for(const D of x){switch(R.type){case"Point":L=Math.min(L,Ko([R.coordinates],!1,D,E,L));break;case"LineString":L=Math.min(L,Ko(R.coordinates,!0,D,E,L));break;case"Polygon":L=Math.min(L,Xi(D,R.coordinates,E,L))}if(L===0)return L}return L}(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Lo={"==":Bl,"!=":Rl,">":$h,"<":hh,">=":kl,"<=":Yh,array:dn,at:Aa,boolean:dn,case:Dt,coalesce:Ml,collator:co,format:Fl,image:Jo,in:Ja,"index-of":rt,interpolate:ui,"interpolate-hcl":ui,"interpolate-lab":ui,length:Qa,let:Yn,literal:un,match:mt,number:dn,"number-format":To,object:dn,slice:ne,step:oi,string:dn,"to-boolean":Tr,"to-color":Tr,"to-number":Tr,"to-string":Tr,var:Wi,within:ks,distance:fo};class In{constructor(a,d,p,b){this.name=a,this.type=d,this._evaluate=p,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,d){const p=a[0],b=In.definitions[p];if(!b)return d.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(b)?b[0]:b.type,E=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,L=E.filter(D=>{let[U]=D;return!Array.isArray(U)||U.length===a.length-1});let R=null;for(const[D,U]of L){R=new as(d.registry,ta,d.path,null,d.scope);const V=[];let J=!1;for(let tt=1;tt<a.length;tt++){const st=a[tt],dt=Array.isArray(D)?D[tt-1]:D.type,wt=R.parse(st,1+V.length,dt);if(!wt){J=!0;break}V.push(wt)}if(!J)if(Array.isArray(D)&&D.length!==V.length)R.error(`Expected ${D.length} arguments, but found ${V.length} instead.`);else{for(let tt=0;tt<V.length;tt++){const st=Array.isArray(D)?D[tt]:D.type,dt=V[tt];R.concat(tt+1).checkSubtype(st,dt.type)}if(R.errors.length===0)return new In(p,x,U,V)}}if(L.length===1)d.errors.push(...R.errors);else{const D=(L.length?L:E).map(V=>{let[J]=V;return tt=J,Array.isArray(tt)?`(${tt.map(K).join(", ")})`:`(${K(tt.type)}...)`;var tt}).join(" | "),U=[];for(let V=1;V<a.length;V++){const J=d.parse(a[V],1+U.length);if(!J)return null;U.push(K(J.type))}d.error(`Expected arguments of type ${D}, but found (${U.join(", ")}) instead.`)}return null}static register(a,d){In.definitions=d;for(const p in d)a[p]=In}}function Dn(h,a){let[d,p,b,x]=a;d=d.evaluate(h),p=p.evaluate(h),b=b.evaluate(h);const E=x?x.evaluate(h):1,L=ao(d,p,b,E);if(L)throw new fr(L);return new $i(d/255,p/255,b/255,E,!1)}function Pa(h,a){return h in a}function Ia(h,a){const d=a[h];return d===void 0?null:d}function Fs(h){return{type:h}}function ta(h){if(h instanceof Wi)return ta(h.boundExpression);if(h instanceof In&&h.name==="error"||h instanceof co||h instanceof ks||h instanceof fo)return!1;const a=h instanceof Tr||h instanceof dn;let d=!0;return h.eachChild(p=>{d=a?d&&ta(p):d&&p instanceof un}),!!d&&bn(h)&&ea(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function bn(h){if(h instanceof In&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof ks||h instanceof fo)return!1;let a=!0;return h.eachChild(d=>{a&&!bn(d)&&(a=!1)}),a}function La(h){if(h instanceof In&&h.name==="feature-state")return!1;let a=!0;return h.eachChild(d=>{a&&!La(d)&&(a=!1)}),a}function ea(h,a){if(h instanceof In&&a.indexOf(h.name)>=0)return!1;let d=!0;return h.eachChild(p=>{d&&!ea(p,a)&&(d=!1)}),d}function il(h){return{result:"success",value:h}}function On(h){return{result:"error",value:h}}function Mo(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function fh(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Ic(h){return!!h.expression&&h.expression.interpolated}function Ni(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Kn(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function mo(h){return h}function ia(h,a){const d=a.type==="color",p=h.stops&&typeof h.stops[0][0]=="object",b=p||!(p||h.property!==void 0),x=h.type||(Ic(a)?"exponential":"interval");if(d||a.type==="padding"){const U=d?$i.parse:Lr.parse;(h=ci({},h)).stops&&(h.stops=h.stops.map(V=>[V[0],U(V[1])])),h.default=U(h.default?h.default:a.default)}if(h.colorSpace&&(E=h.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var E;let L,R,D;if(x==="exponential")L=Ds;else if(x==="interval")L=ra;else if(x==="categorical"){L=Bo,R=Object.create(null);for(const U of h.stops)R[U[0]]=U[1];D=typeof h.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);L=rl}if(p){const U={},V=[];for(let st=0;st<h.stops.length;st++){const dt=h.stops[st],wt=dt[0].zoom;U[wt]===void 0&&(U[wt]={zoom:wt,type:h.type,property:h.property,default:h.default,stops:[]},V.push(wt)),U[wt].stops.push([dt[0].value,dt[1]])}const J=[];for(const st of V)J.push([U[st].zoom,ia(U[st],a)]);const tt={name:"linear"};return{kind:"composite",interpolationType:tt,interpolationFactor:ui.interpolationFactor.bind(void 0,tt),zoomStops:J.map(st=>st[0]),evaluate:(st,dt)=>{let{zoom:wt}=st;return Ds({stops:J,base:h.base},a,wt).evaluate(wt,dt)}}}if(b){const U=x==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:ui.interpolationFactor.bind(void 0,U),zoomStops:h.stops.map(V=>V[0]),evaluate:V=>{let{zoom:J}=V;return L(h,a,J,R,D)}}}return{kind:"source",evaluate(U,V){const J=V&&V.properties?V.properties[h.property]:void 0;return J===void 0?Qn(h.default,a.default):L(h,a,J,R,D)}}}function Qn(h,a,d){return h!==void 0?h:a!==void 0?a:d!==void 0?d:void 0}function Bo(h,a,d,p,b){return Qn(typeof d===b?p[d]:void 0,h.default,a.default)}function ra(h,a,d){if(Ni(d)!=="number")return Qn(h.default,a.default);const p=h.stops.length;if(p===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[p-1][0])return h.stops[p-1][1];const b=Se(h.stops.map(x=>x[0]),d);return h.stops[b][1]}function Ds(h,a,d){const p=h.base!==void 0?h.base:1;if(Ni(d)!=="number")return Qn(h.default,a.default);const b=h.stops.length;if(b===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[b-1][0])return h.stops[b-1][1];const x=Se(h.stops.map(U=>U[0]),d),E=function(U,V,J,tt){const st=tt-J,dt=U-J;return st===0?0:V===1?dt/st:(Math.pow(V,dt)-1)/(Math.pow(V,st)-1)}(d,p,h.stops[x][0],h.stops[x+1][0]),L=h.stops[x][1],R=h.stops[x+1][1],D=Pn[a.type]||mo;return typeof L.evaluate=="function"?{evaluate(){for(var U=arguments.length,V=new Array(U),J=0;J<U;J++)V[J]=arguments[J];const tt=L.evaluate.apply(void 0,V),st=R.evaluate.apply(void 0,V);if(tt!==void 0&&st!==void 0)return D(tt,st,E,h.colorSpace)}}:D(L,R,E,h.colorSpace)}function rl(h,a,d){switch(a.type){case"color":d=$i.parse(d);break;case"formatted":d=Ir.fromString(d.toString());break;case"resolvedImage":d=Er.fromString(d.toString());break;case"padding":d=Lr.parse(d);break;default:Ni(d)===a.type||a.type==="enum"&&a.values[d]||(d=void 0)}return Qn(d,h.default,a.default)}In.register(Lo,{error:[{kind:"error"},[yi],(h,a)=>{let[d]=a;throw new fr(d.evaluate(h))}],typeof:[yi,[ze],(h,a)=>{let[d]=a;return K(yr(d.evaluate(h)))}],"to-rgba":[Y(ge,4),[Vi],(h,a)=>{let[d]=a;const[p,b,x,E]=d.evaluate(h).rgb;return[255*p,255*b,255*x,E]}],rgb:[Vi,[ge,ge,ge],Dn],rgba:[Vi,[ge,ge,ge,ge],Dn],has:{type:Ue,overloads:[[[yi],(h,a)=>{let[d]=a;return Pa(d.evaluate(h),h.properties())}],[[yi,Zr],(h,a)=>{let[d,p]=a;return Pa(d.evaluate(h),p.evaluate(h))}]]},get:{type:ze,overloads:[[[yi],(h,a)=>{let[d]=a;return Ia(d.evaluate(h),h.properties())}],[[yi,Zr],(h,a)=>{let[d,p]=a;return Ia(d.evaluate(h),p.evaluate(h))}]]},"feature-state":[ze,[yi],(h,a)=>{let[d]=a;return Ia(d.evaluate(h),h.featureState||{})}],properties:[Zr,[],h=>h.properties()],"geometry-type":[yi,[],h=>h.geometryType()],id:[ze,[],h=>h.id()],zoom:[ge,[],h=>h.globals.zoom],"heatmap-density":[ge,[],h=>h.globals.heatmapDensity||0],"line-progress":[ge,[],h=>h.globals.lineProgress||0],accumulated:[ze,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[ge,Fs(ge),(h,a)=>{let d=0;for(const p of a)d+=p.evaluate(h);return d}],"*":[ge,Fs(ge),(h,a)=>{let d=1;for(const p of a)d*=p.evaluate(h);return d}],"-":{type:ge,overloads:[[[ge,ge],(h,a)=>{let[d,p]=a;return d.evaluate(h)-p.evaluate(h)}],[[ge],(h,a)=>{let[d]=a;return-d.evaluate(h)}]]},"/":[ge,[ge,ge],(h,a)=>{let[d,p]=a;return d.evaluate(h)/p.evaluate(h)}],"%":[ge,[ge,ge],(h,a)=>{let[d,p]=a;return d.evaluate(h)%p.evaluate(h)}],ln2:[ge,[],()=>Math.LN2],pi:[ge,[],()=>Math.PI],e:[ge,[],()=>Math.E],"^":[ge,[ge,ge],(h,a)=>{let[d,p]=a;return Math.pow(d.evaluate(h),p.evaluate(h))}],sqrt:[ge,[ge],(h,a)=>{let[d]=a;return Math.sqrt(d.evaluate(h))}],log10:[ge,[ge],(h,a)=>{let[d]=a;return Math.log(d.evaluate(h))/Math.LN10}],ln:[ge,[ge],(h,a)=>{let[d]=a;return Math.log(d.evaluate(h))}],log2:[ge,[ge],(h,a)=>{let[d]=a;return Math.log(d.evaluate(h))/Math.LN2}],sin:[ge,[ge],(h,a)=>{let[d]=a;return Math.sin(d.evaluate(h))}],cos:[ge,[ge],(h,a)=>{let[d]=a;return Math.cos(d.evaluate(h))}],tan:[ge,[ge],(h,a)=>{let[d]=a;return Math.tan(d.evaluate(h))}],asin:[ge,[ge],(h,a)=>{let[d]=a;return Math.asin(d.evaluate(h))}],acos:[ge,[ge],(h,a)=>{let[d]=a;return Math.acos(d.evaluate(h))}],atan:[ge,[ge],(h,a)=>{let[d]=a;return Math.atan(d.evaluate(h))}],min:[ge,Fs(ge),(h,a)=>Math.min(...a.map(d=>d.evaluate(h)))],max:[ge,Fs(ge),(h,a)=>Math.max(...a.map(d=>d.evaluate(h)))],abs:[ge,[ge],(h,a)=>{let[d]=a;return Math.abs(d.evaluate(h))}],round:[ge,[ge],(h,a)=>{let[d]=a;const p=d.evaluate(h);return p<0?-Math.round(-p):Math.round(p)}],floor:[ge,[ge],(h,a)=>{let[d]=a;return Math.floor(d.evaluate(h))}],ceil:[ge,[ge],(h,a)=>{let[d]=a;return Math.ceil(d.evaluate(h))}],"filter-==":[Ue,[yi,ze],(h,a)=>{let[d,p]=a;return h.properties()[d.value]===p.value}],"filter-id-==":[Ue,[ze],(h,a)=>{let[d]=a;return h.id()===d.value}],"filter-type-==":[Ue,[yi],(h,a)=>{let[d]=a;return h.geometryType()===d.value}],"filter-<":[Ue,[yi,ze],(h,a)=>{let[d,p]=a;const b=h.properties()[d.value],x=p.value;return typeof b==typeof x&&b<x}],"filter-id-<":[Ue,[ze],(h,a)=>{let[d]=a;const p=h.id(),b=d.value;return typeof p==typeof b&&p<b}],"filter->":[Ue,[yi,ze],(h,a)=>{let[d,p]=a;const b=h.properties()[d.value],x=p.value;return typeof b==typeof x&&b>x}],"filter-id->":[Ue,[ze],(h,a)=>{let[d]=a;const p=h.id(),b=d.value;return typeof p==typeof b&&p>b}],"filter-<=":[Ue,[yi,ze],(h,a)=>{let[d,p]=a;const b=h.properties()[d.value],x=p.value;return typeof b==typeof x&&b<=x}],"filter-id-<=":[Ue,[ze],(h,a)=>{let[d]=a;const p=h.id(),b=d.value;return typeof p==typeof b&&p<=b}],"filter->=":[Ue,[yi,ze],(h,a)=>{let[d,p]=a;const b=h.properties()[d.value],x=p.value;return typeof b==typeof x&&b>=x}],"filter-id->=":[Ue,[ze],(h,a)=>{let[d]=a;const p=h.id(),b=d.value;return typeof p==typeof b&&p>=b}],"filter-has":[Ue,[ze],(h,a)=>{let[d]=a;return d.value in h.properties()}],"filter-has-id":[Ue,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Ue,[Y(yi)],(h,a)=>{let[d]=a;return d.value.indexOf(h.geometryType())>=0}],"filter-id-in":[Ue,[Y(ze)],(h,a)=>{let[d]=a;return d.value.indexOf(h.id())>=0}],"filter-in-small":[Ue,[yi,Y(ze)],(h,a)=>{let[d,p]=a;return p.value.indexOf(h.properties()[d.value])>=0}],"filter-in-large":[Ue,[yi,Y(ze)],(h,a)=>{let[d,p]=a;return function(b,x,E,L){for(;E<=L;){const R=E+L>>1;if(x[R]===b)return!0;x[R]>b?L=R-1:E=R+1}return!1}(h.properties()[d.value],p.value,0,p.value.length-1)}],all:{type:Ue,overloads:[[[Ue,Ue],(h,a)=>{let[d,p]=a;return d.evaluate(h)&&p.evaluate(h)}],[Fs(Ue),(h,a)=>{for(const d of a)if(!d.evaluate(h))return!1;return!0}]]},any:{type:Ue,overloads:[[[Ue,Ue],(h,a)=>{let[d,p]=a;return d.evaluate(h)||p.evaluate(h)}],[Fs(Ue),(h,a)=>{for(const d of a)if(d.evaluate(h))return!0;return!1}]]},"!":[Ue,[Ue],(h,a)=>{let[d]=a;return!d.evaluate(h)}],"is-supported-script":[Ue,[yi],(h,a)=>{let[d]=a;const p=h.globals&&h.globals.isSupportedScript;return!p||p(d.evaluate(h))}],upcase:[yi,[yi],(h,a)=>{let[d]=a;return d.evaluate(h).toUpperCase()}],downcase:[yi,[yi],(h,a)=>{let[d]=a;return d.evaluate(h).toLowerCase()}],concat:[yi,Fs(ze),(h,a)=>a.map(d=>Yi(d.evaluate(h))).join("")],"resolved-locale":[yi,[_n],(h,a)=>{let[d]=a;return d.evaluate(h).resolvedLocale()}]});class Ma{constructor(a,d){var p;this.expression=a,this._warningHistory={},this._evaluator=new pn,this._defaultValue=d?(p=d).type==="color"&&Kn(p.default)?new $i(0,0,0,0):p.type==="color"?$i.parse(p.default)||null:p.type==="padding"?Lr.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Mr.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(a,d,p,b,x,E){return this._evaluator.globals=a,this._evaluator.feature=d,this._evaluator.featureState=p,this._evaluator.canonical=b,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(a,d,p,b,x,E){this._evaluator.globals=a,this._evaluator.feature=d||null,this._evaluator.featureState=p||null,this._evaluator.canonical=b,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new fr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function go(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Lo}function Nn(h,a){const d=new as(Lo,ta,[],a?function(b){const x={color:Vi,string:yi,number:ge,enum:yi,boolean:Ue,formatted:ir,padding:Qr,resolvedImage:tn,variableAnchorOffsetCollection:xt};return b.type==="array"?Y(x[b.value]||ze,b.length):x[b.type]}(a):void 0),p=d.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?il(new Ma(p,a)):On(d.errors)}class cs{constructor(a,d){this.kind=a,this._styleExpression=d,this.isStateDependent=a!=="constant"&&!La(d.expression)}evaluateWithoutErrorHandling(a,d,p,b,x,E){return this._styleExpression.evaluateWithoutErrorHandling(a,d,p,b,x,E)}evaluate(a,d,p,b,x,E){return this._styleExpression.evaluate(a,d,p,b,x,E)}}class Os{constructor(a,d,p,b){this.kind=a,this.zoomStops=p,this._styleExpression=d,this.isStateDependent=a!=="camera"&&!La(d.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,d,p,b,x,E){return this._styleExpression.evaluateWithoutErrorHandling(a,d,p,b,x,E)}evaluate(a,d,p,b,x,E){return this._styleExpression.evaluate(a,d,p,b,x,E)}interpolationFactor(a,d,p){return this.interpolationType?ui.interpolationFactor(this.interpolationType,a,d,p):0}}function Ba(h,a){const d=Nn(h,a);if(d.result==="error")return d;const p=d.value.expression,b=bn(p);if(!b&&!Mo(a))return On([new bi("","data expressions not supported")]);const x=ea(p,["zoom"]);if(!x&&!fh(a))return On([new bi("","zoom expressions not supported")]);const E=zs(p);return E||x?E instanceof bi?On([E]):E instanceof ui&&!Ic(a)?On([new bi("",'"interpolate" expressions cannot be used with this property')]):il(E?new Os(b?"camera":"composite",d.value,E.labels,E instanceof ui?E.interpolation:void 0):new cs(b?"constant":"source",d.value)):On([new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ns{constructor(a,d){this._parameters=a,this._specification=d,ci(this,ia(this._parameters,this._specification))}static deserialize(a){return new Ns(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function zs(h){let a=null;if(h instanceof Yn)a=zs(h.result);else if(h instanceof Ml){for(const d of h.args)if(a=zs(d),a)break}else(h instanceof oi||h instanceof ui)&&h.input instanceof In&&h.input.name==="zoom"&&(a=h);return a instanceof bi||h.eachChild(d=>{const p=zs(d);p instanceof bi?a=p:!a&&p?a=new bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&p&&a!==p&&(a=new bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function Ra(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!Ra(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const ts={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _o(h){if(h==null)return{filter:()=>!0,needGeometry:!1};Ra(h)||(h=zr(h));const a=Nn(h,ts);if(a.result==="error")throw new Error(a.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,p,b)=>a.value.evaluate(d,p,{},b),needGeometry:vr(h)}}function Cr(h,a){return h<a?-1:h>a?1:0}function vr(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let a=1;a<h.length;a++)if(vr(h[a]))return!0;return!1}function zr(h){if(!h)return!0;const a=h[0];return h.length<=1?a!=="any":a==="=="?rn(h[1],h[2],"=="):a==="!="?nn(rn(h[1],h[2],"==")):a==="<"||a===">"||a==="<="||a===">="?rn(h[1],h[2],a):a==="any"?(d=h.slice(1),["any"].concat(d.map(zr))):a==="all"?["all"].concat(h.slice(1).map(zr)):a==="none"?["all"].concat(h.slice(1).map(zr).map(nn)):a==="in"?Ss(h[1],h.slice(2)):a==="!in"?nn(Ss(h[1],h.slice(2))):a==="has"?js(h[1]):a!=="!has"||nn(js(h[1]));var d}function rn(h,a,d){switch(h){case"$type":return[`filter-type-${d}`,a];case"$id":return[`filter-id-${d}`,a];default:return[`filter-${d}`,h,a]}}function Ss(h,a){if(a.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(d=>typeof d!=typeof a[0])?["filter-in-large",h,["literal",a.sort(Cr)]]:["filter-in-small",h,["literal",a]]}}function js(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function nn(h){return["!",h]}function Ro(h){const a=typeof h;if(a==="number"||a==="boolean"||a==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let b="[";for(const x of h)b+=`${Ro(x)},`;return`${b}]`}const d=Object.keys(h).sort();let p="{";for(let b=0;b<d.length;b++)p+=`${JSON.stringify(d[b])}:${Ro(h[d[b]])},`;return`${p}}`}function Kh(h){let a="";for(const d of pi)a+=`/${Ro(h[d])}`;return a}function Qh(h){const a=h.value;return a?[new me(h.key,a,"constants have been deprecated as of v8")]:[]}function qr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Us(h){if(Array.isArray(h))return h.map(Us);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const d in h)a[d]=Us(h[d]);return a}return qr(h)}function hs(h){const a=h.key,d=h.value,p=h.valueSpec||{},b=h.objectElementValidators||{},x=h.style,E=h.styleSpec,L=h.validateSpec;let R=[];const D=Ni(d);if(D!=="object")return[new me(a,d,`object expected, ${D} found`)];for(const U in d){const V=U.split(".")[0],J=p[V]||p["*"];let tt;if(b[V])tt=b[V];else if(p[V])tt=L;else if(b["*"])tt=b["*"];else{if(!p["*"]){R.push(new me(a,d[U],`unknown property "${U}"`));continue}tt=L}R=R.concat(tt({key:(a&&`${a}.`)+U,value:d[U],valueSpec:J,style:x,styleSpec:E,object:d,objectKey:U,validateSpec:L},d))}for(const U in p)b[U]||p[U].required&&p[U].default===void 0&&d[U]===void 0&&R.push(new me(a,d,`missing required property "${U}"`));return R}function Vl(h){const a=h.value,d=h.valueSpec,p=h.style,b=h.styleSpec,x=h.key,E=h.arrayElementValidator||h.validateSpec;if(Ni(a)!=="array")return[new me(x,a,`array expected, ${Ni(a)} found`)];if(d.length&&a.length!==d.length)return[new me(x,a,`array length ${d.length} expected, length ${a.length} found`)];if(d["min-length"]&&a.length<d["min-length"])return[new me(x,a,`array length at least ${d["min-length"]} expected, length ${a.length} found`)];let L={type:d.value,values:d.values};b.$version<7&&(L.function=d.function),Ni(d.value)==="object"&&(L=d.value);let R=[];for(let D=0;D<a.length;D++)R=R.concat(E({array:a,arrayIndex:D,value:a[D],valueSpec:L,validateSpec:h.validateSpec,style:p,styleSpec:b,key:`${x}[${D}]`}));return R}function Lc(h){const a=h.key,d=h.value,p=h.valueSpec;let b=Ni(d);return b==="number"&&d!=d&&(b="NaN"),b!=="number"?[new me(a,d,`number expected, ${b} found`)]:"minimum"in p&&d<p.minimum?[new me(a,d,`${d} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&d>p.maximum?[new me(a,d,`${d} is greater than the maximum value ${p.maximum}`)]:[]}function nl(h){const a=h.valueSpec,d=qr(h.value.type);let p,b,x,E={};const L=d!=="categorical"&&h.value.property===void 0,R=!L,D=Ni(h.value.stops)==="array"&&Ni(h.value.stops[0])==="array"&&Ni(h.value.stops[0][0])==="object",U=hs({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(tt){if(d==="identity")return[new me(tt.key,tt.value,'identity function may not have a "stops" property')];let st=[];const dt=tt.value;return st=st.concat(Vl({key:tt.key,value:dt,valueSpec:tt.valueSpec,validateSpec:tt.validateSpec,style:tt.style,styleSpec:tt.styleSpec,arrayElementValidator:V})),Ni(dt)==="array"&&dt.length===0&&st.push(new me(tt.key,dt,"array must have at least one stop")),st},default:function(tt){return tt.validateSpec({key:tt.key,value:tt.value,valueSpec:a,validateSpec:tt.validateSpec,style:tt.style,styleSpec:tt.styleSpec})}}});return d==="identity"&&L&&U.push(new me(h.key,h.value,'missing required property "property"')),d==="identity"||h.value.stops||U.push(new me(h.key,h.value,'missing required property "stops"')),d==="exponential"&&h.valueSpec.expression&&!Ic(h.valueSpec)&&U.push(new me(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(R&&!Mo(h.valueSpec)?U.push(new me(h.key,h.value,"property functions not supported")):L&&!fh(h.valueSpec)&&U.push(new me(h.key,h.value,"zoom functions not supported"))),d!=="categorical"&&!D||h.value.property!==void 0||U.push(new me(h.key,h.value,'"property" property is required')),U;function V(tt){let st=[];const dt=tt.value,wt=tt.key;if(Ni(dt)!=="array")return[new me(wt,dt,`array expected, ${Ni(dt)} found`)];if(dt.length!==2)return[new me(wt,dt,`array length 2 expected, length ${dt.length} found`)];if(D){if(Ni(dt[0])!=="object")return[new me(wt,dt,`object expected, ${Ni(dt[0])} found`)];if(dt[0].zoom===void 0)return[new me(wt,dt,"object stop key must have zoom")];if(dt[0].value===void 0)return[new me(wt,dt,"object stop key must have value")];if(x&&x>qr(dt[0].zoom))return[new me(wt,dt[0].zoom,"stop zoom values must appear in ascending order")];qr(dt[0].zoom)!==x&&(x=qr(dt[0].zoom),b=void 0,E={}),st=st.concat(hs({key:`${wt}[0]`,value:dt[0],valueSpec:{zoom:{}},validateSpec:tt.validateSpec,style:tt.style,styleSpec:tt.styleSpec,objectElementValidators:{zoom:Lc,value:J}}))}else st=st.concat(J({key:`${wt}[0]`,value:dt[0],valueSpec:{},validateSpec:tt.validateSpec,style:tt.style,styleSpec:tt.styleSpec},dt));return go(Us(dt[1]))?st.concat([new me(`${wt}[1]`,dt[1],"expressions are not allowed in function stops.")]):st.concat(tt.validateSpec({key:`${wt}[1]`,value:dt[1],valueSpec:a,validateSpec:tt.validateSpec,style:tt.style,styleSpec:tt.styleSpec}))}function J(tt,st){const dt=Ni(tt.value),wt=qr(tt.value),Pt=tt.value!==null?tt.value:st;if(p){if(dt!==p)return[new me(tt.key,Pt,`${dt} stop domain type must match previous stop domain type ${p}`)]}else p=dt;if(dt!=="number"&&dt!=="string"&&dt!=="boolean")return[new me(tt.key,Pt,"stop domain value must be a number, string, or boolean")];if(dt!=="number"&&d!=="categorical"){let Zt=`number expected, ${dt} found`;return Mo(a)&&d===void 0&&(Zt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new me(tt.key,Pt,Zt)]}return d!=="categorical"||dt!=="number"||isFinite(wt)&&Math.floor(wt)===wt?d!=="categorical"&&dt==="number"&&b!==void 0&&wt<b?[new me(tt.key,Pt,"stop domain values must appear in ascending order")]:(b=wt,d==="categorical"&&wt in E?[new me(tt.key,Pt,"stop domain values must be unique")]:(E[wt]=!0,[])):[new me(tt.key,Pt,`integer expected, found ${wt}`)]}}function xn(h){const a=(h.expressionContext==="property"?Ba:Nn)(Us(h.value),h.valueSpec);if(a.result==="error")return a.value.map(p=>new me(`${h.key}${p.key}`,h.value,p.message));const d=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!d.outputDefined())return[new me(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!La(d))return[new me(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!La(d))return[new me(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!ea(d,["zoom","feature-state"]))return[new me(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!bn(d))return[new me(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cn(h){const a=h.key,d=h.value,p=h.valueSpec,b=[];return Array.isArray(p.values)?p.values.indexOf(qr(d))===-1&&b.push(new me(a,d,`expected one of [${p.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(p.values).indexOf(qr(d))===-1&&b.push(new me(a,d,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function ql(h){return Ra(Us(h.value))?xn(ci({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):sl(h)}function sl(h){const a=h.value,d=h.key;if(Ni(a)!=="array")return[new me(d,a,`array expected, ${Ni(a)} found`)];const p=h.styleSpec;let b,x=[];if(a.length<1)return[new me(d,a,"filter array must have at least 1 element")];switch(x=x.concat(cn({key:`${d}[0]`,value:a[0],valueSpec:p.filter_operator,style:h.style,styleSpec:h.styleSpec})),qr(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&qr(a[1])==="$type"&&x.push(new me(d,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&x.push(new me(d,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Ni(a[1]),b!=="string"&&x.push(new me(`${d}[1]`,a[1],`string expected, ${b} found`)));for(let E=2;E<a.length;E++)b=Ni(a[E]),qr(a[1])==="$type"?x=x.concat(cn({key:`${d}[${E}]`,value:a[E],valueSpec:p.geometry_type,style:h.style,styleSpec:h.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&x.push(new me(`${d}[${E}]`,a[E],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let E=1;E<a.length;E++)x=x.concat(sl({key:`${d}[${E}]`,value:a[E],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":b=Ni(a[1]),a.length!==2?x.push(new me(d,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&x.push(new me(`${d}[1]`,a[1],`string expected, ${b} found`))}return x}function mh(h,a){const d=h.key,p=h.validateSpec,b=h.style,x=h.styleSpec,E=h.value,L=h.objectKey,R=x[`${a}_${h.layerType}`];if(!R)return[];const D=L.match(/^(.*)-transition$/);if(a==="paint"&&D&&R[D[1]]&&R[D[1]].transition)return p({key:d,value:E,valueSpec:x.transition,style:b,styleSpec:x});const U=h.valueSpec||R[L];if(!U)return[new me(d,E,`unknown property "${L}"`)];let V;if(Ni(E)==="string"&&Mo(U)&&!U.tokens&&(V=/^{([^}]+)}$/.exec(E)))return[new me(d,E,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(V[1])} }\`.`)];const J=[];return h.layerType==="symbol"&&(L==="text-field"&&b&&!b.glyphs&&J.push(new me(d,E,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Kn(Us(E))&&qr(E.type)==="identity"&&J.push(new me(d,E,'"text-font" does not support identity functions'))),J.concat(p({key:h.key,value:E,valueSpec:U,style:b,styleSpec:x,expressionContext:"property",propertyType:a,propertyKey:L}))}function ol(h){return mh(h,"paint")}function Hl(h){return mh(h,"layout")}function Mc(h){let a=[];const d=h.value,p=h.key,b=h.style,x=h.styleSpec;d.type||d.ref||a.push(new me(p,d,'either "type" or "ref" is required'));let E=qr(d.type);const L=qr(d.ref);if(d.id){const R=qr(d.id);for(let D=0;D<h.arrayIndex;D++){const U=b.layers[D];qr(U.id)===R&&a.push(new me(p,d.id,`duplicate layer id "${d.id}", previously used at line ${U.id.__line__}`))}}if("ref"in d){let R;["type","source","source-layer","filter","layout"].forEach(D=>{D in d&&a.push(new me(p,d[D],`"${D}" is prohibited for ref layers`))}),b.layers.forEach(D=>{qr(D.id)===L&&(R=D)}),R?R.ref?a.push(new me(p,d.ref,"ref cannot reference another ref layer")):E=qr(R.type):a.push(new me(p,d.ref,`ref layer "${L}" not found`))}else if(E!=="background")if(d.source){const R=b.sources&&b.sources[d.source],D=R&&qr(R.type);R?D==="vector"&&E==="raster"?a.push(new me(p,d.source,`layer "${d.id}" requires a raster source`)):D!=="raster-dem"&&E==="hillshade"?a.push(new me(p,d.source,`layer "${d.id}" requires a raster-dem source`)):D==="raster"&&E!=="raster"?a.push(new me(p,d.source,`layer "${d.id}" requires a vector source`)):D!=="vector"||d["source-layer"]?D==="raster-dem"&&E!=="hillshade"?a.push(new me(p,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="line"||!d.paint||!d.paint["line-gradient"]||D==="geojson"&&R.lineMetrics||a.push(new me(p,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new me(p,d,`layer "${d.id}" must specify a "source-layer"`)):a.push(new me(p,d.source,`source "${d.source}" not found`))}else a.push(new me(p,d,'missing required property "source"'));return a=a.concat(hs({key:p,value:d,valueSpec:x.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${p}.type`,value:d.type,valueSpec:x.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:d,objectKey:"type"}),filter:ql,layout:R=>hs({layer:d,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>Hl(ci({layerType:E},D))}}),paint:R=>hs({layer:d,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":D=>ol(ci({layerType:E},D))}})}})),a}function ka(h){const a=h.value,d=h.key,p=Ni(a);return p!=="string"?[new me(d,a,`string expected, ${p} found`)]:[]}const Wl={promoteId:function(h){let{key:a,value:d}=h;if(Ni(d)==="string")return ka({key:a,value:d});{const p=[];for(const b in d)p.push(...ka({key:`${a}.${b}`,value:d[b]}));return p}}};function al(h){const a=h.value,d=h.key,p=h.styleSpec,b=h.style,x=h.validateSpec;if(!a.type)return[new me(d,a,'"type" is required')];const E=qr(a.type);let L;switch(E){case"vector":case"raster":return L=hs({key:d,value:a,valueSpec:p[`source_${E.replace("-","_")}`],style:h.style,styleSpec:p,objectElementValidators:Wl,validateSpec:x}),L;case"raster-dem":return L=function(R){var D;const U=(D=R.sourceName)!==null&&D!==void 0?D:"",V=R.value,J=R.styleSpec,tt=J.source_raster_dem,st=R.style;let dt=[];const wt=Ni(V);if(V===void 0)return dt;if(wt!=="object")return dt.push(new me("source_raster_dem",V,`object expected, ${wt} found`)),dt;const Pt=qr(V.encoding)==="custom",Zt=["redFactor","greenFactor","blueFactor","baseShift"],Nt=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Vt in V)!Pt&&Zt.includes(Vt)?dt.push(new me(Vt,V[Vt],`In "${U}": "${Vt}" is only valid when "encoding" is set to "custom". ${Nt} encoding found`)):tt[Vt]?dt=dt.concat(R.validateSpec({key:Vt,value:V[Vt],valueSpec:tt[Vt],validateSpec:R.validateSpec,style:st,styleSpec:J})):dt.push(new me(Vt,V[Vt],`unknown property "${Vt}"`));return dt}({sourceName:d,value:a,style:h.style,styleSpec:p,validateSpec:x}),L;case"geojson":if(L=hs({key:d,value:a,valueSpec:p.source_geojson,style:b,styleSpec:p,validateSpec:x,objectElementValidators:Wl}),a.cluster)for(const R in a.clusterProperties){const[D,U]=a.clusterProperties[R],V=typeof D=="string"?[D,["accumulated"],["get",R]]:D;L.push(...xn({key:`${d}.${R}.map`,value:U,validateSpec:x,expressionContext:"cluster-map"})),L.push(...xn({key:`${d}.${R}.reduce`,value:V,validateSpec:x,expressionContext:"cluster-reduce"}))}return L;case"video":return hs({key:d,value:a,valueSpec:p.source_video,style:b,validateSpec:x,styleSpec:p});case"image":return hs({key:d,value:a,valueSpec:p.source_image,style:b,validateSpec:x,styleSpec:p});case"canvas":return[new me(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cn({key:`${d}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:x,styleSpec:p})}}function Xl(h){const a=h.value,d=h.styleSpec,p=d.light,b=h.style;let x=[];const E=Ni(a);if(a===void 0)return x;if(E!=="object")return x=x.concat([new me("light",a,`object expected, ${E} found`)]),x;for(const L in a){const R=L.match(/^(.*)-transition$/);x=x.concat(R&&p[R[1]]&&p[R[1]].transition?h.validateSpec({key:L,value:a[L],valueSpec:d.transition,validateSpec:h.validateSpec,style:b,styleSpec:d}):p[L]?h.validateSpec({key:L,value:a[L],valueSpec:p[L],validateSpec:h.validateSpec,style:b,styleSpec:d}):[new me(L,a[L],`unknown property "${L}"`)])}return x}function Bc(h){const a=h.value,d=h.styleSpec,p=d.sky,b=h.style,x=Ni(a);if(a===void 0)return[];if(x!=="object")return[new me("sky",a,`object expected, ${x} found`)];let E=[];for(const L in a)E=E.concat(p[L]?h.validateSpec({key:L,value:a[L],valueSpec:p[L],style:b,styleSpec:d}):[new me(L,a[L],`unknown property "${L}"`)]);return E}function tu(h){const a=h.value,d=h.styleSpec,p=d.terrain,b=h.style;let x=[];const E=Ni(a);if(a===void 0)return x;if(E!=="object")return x=x.concat([new me("terrain",a,`object expected, ${E} found`)]),x;for(const L in a)x=x.concat(p[L]?h.validateSpec({key:L,value:a[L],valueSpec:p[L],validateSpec:h.validateSpec,style:b,styleSpec:d}):[new me(L,a[L],`unknown property "${L}"`)]);return x}function eu(h){let a=[];const d=h.value,p=h.key;if(Array.isArray(d)){const b=[],x=[];for(const E in d)d[E].id&&b.includes(d[E].id)&&a.push(new me(p,d,`all the sprites' ids must be unique, but ${d[E].id} is duplicated`)),b.push(d[E].id),d[E].url&&x.includes(d[E].url)&&a.push(new me(p,d,`all the sprites' URLs must be unique, but ${d[E].url} is duplicated`)),x.push(d[E].url),a=a.concat(hs({key:`${p}[${E}]`,value:d[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return a}return ka({key:p,value:d})}const Rc={"*":()=>[],array:Vl,boolean:function(h){const a=h.value,d=h.key,p=Ni(a);return p!=="boolean"?[new me(d,a,`boolean expected, ${p} found`)]:[]},number:Lc,color:function(h){const a=h.key,d=h.value,p=Ni(d);return p!=="string"?[new me(a,d,`color expected, ${p} found`)]:$i.parse(String(d))?[]:[new me(a,d,`color expected, "${d}" found`)]},constants:Qh,enum:cn,filter:ql,function:nl,layer:Mc,object:hs,source:al,light:Xl,sky:Bc,terrain:tu,projection:function(h){const a=h.value,d=h.styleSpec,p=d.projection,b=h.style,x=Ni(a);if(a===void 0)return[];if(x!=="object")return[new me("projection",a,`object expected, ${x} found`)];let E=[];for(const L in a)E=E.concat(p[L]?h.validateSpec({key:L,value:a[L],valueSpec:p[L],style:b,styleSpec:d}):[new me(L,a[L],`unknown property "${L}"`)]);return E},string:ka,formatted:function(h){return ka(h).length===0?[]:xn(h)},resolvedImage:function(h){return ka(h).length===0?[]:xn(h)},padding:function(h){const a=h.key,d=h.value;if(Ni(d)==="array"){if(d.length<1||d.length>4)return[new me(a,d,`padding requires 1 to 4 values; ${d.length} values found`)];const p={type:"number"};let b=[];for(let x=0;x<d.length;x++)b=b.concat(h.validateSpec({key:`${a}[${x}]`,value:d[x],validateSpec:h.validateSpec,valueSpec:p}));return b}return Lc({key:a,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const a=h.key,d=h.value,p=Ni(d),b=h.styleSpec;if(p!=="array"||d.length<1||d.length%2!=0)return[new me(a,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let E=0;E<d.length;E+=2)x=x.concat(cn({key:`${a}[${E}]`,value:d[E],valueSpec:b.layout_symbol["text-anchor"]})),x=x.concat(Vl({key:`${a}[${E+1}]`,value:d[E+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:b}));return x},sprite:eu};function Zl(h){const a=h.value,d=h.valueSpec,p=h.styleSpec;return h.validateSpec=Zl,d.expression&&Kn(qr(a))?nl(h):d.expression&&go(Us(a))?xn(h):d.type&&Rc[d.type]?Rc[d.type](h):hs(ci({},h,{valueSpec:d.type?p[d.type]:d}))}function Wu(h){const a=h.value,d=h.key,p=ka(h);return p.length||(a.indexOf("{fontstack}")===-1&&p.push(new me(d,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&p.push(new me(d,a,'"glyphs" url must include a "{range}" token'))),p}function Gs(h){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:it,d=[];return d=d.concat(Zl({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Zl,objectElementValidators:{glyphs:Wu,"*":()=>[]}})),h.constants&&(d=d.concat(Qh({key:"constants",value:h.constants,style:h,styleSpec:a,validateSpec:Zl}))),iu(d)}function ko(h){return function(a){return h({...a,validateSpec:Zl})}}function iu(h){return[].concat(h).sort((a,d)=>a.line-d.line)}function As(h){return function(){for(var a=arguments.length,d=new Array(a),p=0;p<a;p++)d[p]=arguments[p];return iu(h.apply(this,d))}}Gs.source=As(ko(al)),Gs.sprite=As(ko(eu)),Gs.glyphs=As(ko(Wu)),Gs.light=As(ko(Xl)),Gs.sky=As(ko(Bc)),Gs.terrain=As(ko(tu)),Gs.layer=As(ko(Mc)),Gs.filter=As(ko(ql)),Gs.paintProperty=As(ko(ol)),Gs.layoutProperty=As(ko(Hl));const na=Gs,kc=na.light,lp=na.sky,Xu=na.paintProperty,ru=na.layoutProperty;function nu(h,a){let d=!1;if(a&&a.length)for(const p of a)h.fire(new si(new Error(p.message))),d=!0;return d}class $l{constructor(a,d,p){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const E=new Int32Array(this.arrayBuffer);a=E[0],this.d=(d=E[1])+2*(p=E[2]);for(let R=0;R<this.d*this.d;R++){const D=E[3+R],U=E[3+R+1];b.push(D===U?null:E.subarray(D,U))}const L=E[3+b.length+1];this.keys=E.subarray(E[3+b.length],L),this.bboxes=E.subarray(L),this.insert=this._insertReadonly}else{this.d=d+2*p;for(let E=0;E<this.d*this.d;E++)b.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=p,this.scale=d/a,this.uid=0;const x=p/d*a;this.min=-x,this.max=a+x}insert(a,d,p,b,x){this._forEachCell(d,p,b,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,d,p,b,x,E){this.cells[x].push(E)}query(a,d,p,b,x){const E=this.min,L=this.max;if(a<=E&&d<=E&&L<=p&&L<=b&&!x)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,d,p,b,this._queryCell,R,{},x),R}}_queryCell(a,d,p,b,x,E,L,R){const D=this.cells[x];if(D!==null){const U=this.keys,V=this.bboxes;for(let J=0;J<D.length;J++){const tt=D[J];if(L[tt]===void 0){const st=4*tt;(R?R(V[st+0],V[st+1],V[st+2],V[st+3]):a<=V[st+2]&&d<=V[st+3]&&p>=V[st+0]&&b>=V[st+1])?(L[tt]=!0,E.push(U[tt])):L[tt]=!1}}}}_forEachCell(a,d,p,b,x,E,L,R){const D=this._convertToCellCoord(a),U=this._convertToCellCoord(d),V=this._convertToCellCoord(p),J=this._convertToCellCoord(b);for(let tt=D;tt<=V;tt++)for(let st=U;st<=J;st++){const dt=this.d*st+tt;if((!R||R(this._convertFromCellCoord(tt),this._convertFromCellCoord(st),this._convertFromCellCoord(tt+1),this._convertFromCellCoord(st+1)))&&x.call(this,a,d,p,b,dt,E,L,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,d=3+this.cells.length+1+1;let p=0;for(let E=0;E<this.cells.length;E++)p+=this.cells[E].length;const b=new Int32Array(d+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let x=d;for(let E=0;E<a.length;E++){const L=a[E];b[3+E]=x,b.set(L,x),x+=L.length}return b[3+a.length]=x,b.set(this.keys,x),x+=this.keys.length,b[3+a.length+1]=x,b.set(this.bboxes,x),x+=this.bboxes.length,b.buffer}static serialize(a,d){const p=a.toArrayBuffer();return d&&d.push(p),{buffer:p}}static deserialize(a){return new $l(a.buffer)}}const Vs={};function Ve(h,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Vs[h])throw new Error(`${h} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:h,writeable:!1}),Vs[h]={klass:a,omit:d.omit||[],shallow:d.shallow||[]}}Ve("Object",Object),Ve("TransferableGridIndex",$l),Ve("Color",$i),Ve("Error",Error),Ve("AJAXError",Ht),Ve("ResolvedImage",Er),Ve("StylePropertyFunction",Ns),Ve("StyleExpression",Ma,{omit:["_evaluator"]}),Ve("ZoomDependentExpression",Os),Ve("ZoomConstantExpression",cs),Ve("CompoundExpression",In,{omit:["_evaluate"]});for(const h in Lo)Lo[h]._classRegistryKey||Ve(`Expression_${h}`,Lo[h]);function yo(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Es(h){return h.$name||h.constructor._classRegistryKey}function Fo(h){return!function(a){if(a===null||typeof a!="object")return!1;const d=Es(a);return!(!d||d==="Object")}(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||yo(h)||re(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function Yl(h,a){if(Fo(h))return(yo(h)||re(h))&&a&&a.push(h),ArrayBuffer.isView(h)&&a&&a.push(h.buffer),h instanceof ImageData&&a&&a.push(h.data.buffer),h;if(Array.isArray(h)){const x=[];for(const E of h)x.push(Yl(E,a));return x}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);const d=Es(h);if(!d)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!Vs[d])throw new Error(`${d} is not registered.`);const{klass:p}=Vs[d],b=p.serialize?p.serialize(h,a):{};if(p.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in h){if(!h.hasOwnProperty(x)||Vs[d].omit.indexOf(x)>=0)continue;const E=h[x];b[x]=Vs[d].shallow.indexOf(x)>=0?E:Yl(E,a)}h instanceof Error&&(b.message=h.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(b.$name=d),b}function ll(h){if(Fo(h))return h;if(Array.isArray(h))return h.map(ll);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);const a=Es(h)||"Object";if(!Vs[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:d}=Vs[a];if(!d)throw new Error(`can't deserialize unregistered class ${a}`);if(d.deserialize)return d.deserialize(h);const p=Object.create(d.prototype);for(const b of Object.keys(h)){if(b==="$name")continue;const x=h[b];p[b]=Vs[a].shallow.indexOf(b)>=0?x:ll(x)}return p}class Do{constructor(){this.first=!0}update(a,d){const p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=d),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))}}const Ti={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function su(h){for(const a of h)if(au(a.charCodeAt(0)))return!0;return!1}function cp(h){for(const a of h)if(!cl(a.charCodeAt(0)))return!1;return!0}function gh(h){const a=h.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(a.join("|"),"u")}const Zu=gh(["Arab","Dupl","Mong","Ougr","Syrc"]);function cl(h){return!Zu.test(String.fromCodePoint(h))}const ou=gh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function au(h){return!(h!==746&&h!==747&&(h<4352||!(Ti["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Ti["CJK Compatibility"](h)||Ti["CJK Strokes"](h)||!(!Ti["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Ti["Enclosed CJK Letters and Months"](h)||Ti["Ideographic Description Characters"](h)||Ti.Kanbun(h)||Ti.Katakana(h)&&h!==12540||!(!Ti["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Ti["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Ti["Vertical Forms"](h)||Ti["Yijing Hexagram Symbols"](h)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(h))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(h))||ou.test(String.fromCodePoint(h)))))}function Fc(h){return!(au(h)||function(a){return!!(Ti["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Ti["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Ti["Letterlike Symbols"](a)||Ti["Number Forms"](a)||Ti["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Ti["Control Pictures"](a)&&a!==9251||Ti["Optical Character Recognition"](a)||Ti["Enclosed Alphanumerics"](a)||Ti["Geometric Shapes"](a)||Ti["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Ti["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Ti["CJK Symbols and Punctuation"](a)||Ti.Katakana(a)||Ti["Private Use Area"](a)||Ti["CJK Compatibility Forms"](a)||Ti["Small Form Variants"](a)||Ti["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(h))}const _h=gh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function hl(h){return _h.test(String.fromCodePoint(h))}function lu(h,a){return!(!a&&hl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Ti.Khmer(h))}function $u(h){for(const a of h)if(hl(a.charCodeAt(0)))return!0;return!1}const Ts=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class br{constructor(a,d){this.zoom=a,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Do,this.transition={})}isSupportedScript(a){return function(d,p){for(const b of d)if(!lu(b.charCodeAt(0),p))return!1;return!0}(a,Ts.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,d=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*d}}}class Jl{constructor(a,d){this.property=a,this.value=d,this.expression=function(p,b){if(Kn(p))return new Ns(p,b);if(go(p)){const x=Ba(p,b);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));return x.value}{let x=p;return b.type==="color"&&typeof p=="string"?x=$i.parse(p):b.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(x=Mr.parse(p)):x=Lr.parse(p),{kind:"constant",evaluate:()=>x}}}(d===void 0?a.specification.default:d,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,d,p){return this.property.possiblyEvaluate(this,a,d,p)}}class yh{constructor(a){this.property=a,this.value=new Jl(a,void 0)}transitioned(a,d){return new Yu(this.property,this.value,d,Mt({},a.transition,this.transition),a.now)}untransitioned(){return new Yu(this.property,this.value,null,{},0)}}class vh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return at(this._values[a].value.value)}setValue(a,d){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new yh(this._values[a].property)),this._values[a].value=new Jl(this._values[a].property,d===null?void 0:at(d))}getTransition(a){return at(this._values[a].transition)}setTransition(a,d){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new yh(this._values[a].property)),this._values[a].transition=at(d)||void 0}serialize(){const a={};for(const d of Object.keys(this._values)){const p=this.getValue(d);p!==void 0&&(a[d]=p);const b=this.getTransition(d);b!==void 0&&(a[`${d}-transition`]=b)}return a}transitioned(a,d){const p=new Dc(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].transitioned(a,d._values[b]);return p}untransitioned(){const a=new Dc(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].untransitioned();return a}}class Yu{constructor(a,d,p,b,x){this.property=a,this.value=d,this.begin=x+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=p)}possiblyEvaluate(a,d,p){const b=a.now||0,x=this.value.possiblyEvaluate(a,d,p),E=this.prior;if(E){if(b>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(b<this.begin)return E.possiblyEvaluate(a,d,p);{const L=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(a,d,p),x,function(R){if(R<=0)return 0;if(R>=1)return 1;const D=R*R,U=D*R;return 4*(R<.5?U:3*(R-D)+U-.75)}(L))}}return x}}class Dc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,d,p){const b=new Fa(this._properties);for(const x of Object.keys(this._values))b._values[x]=this._values[x].possiblyEvaluate(a,d,p);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Oc{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return at(this._values[a].value)}setValue(a,d){this._values[a]=new Jl(this._values[a].property,d===null?void 0:at(d))}serialize(){const a={};for(const d of Object.keys(this._values)){const p=this.getValue(d);p!==void 0&&(a[d]=p)}return a}possiblyEvaluate(a,d,p){const b=new Fa(this._properties);for(const x of Object.keys(this._values))b._values[x]=this._values[x].possiblyEvaluate(a,d,p);return b}}class vo{constructor(a,d,p){this.property=a,this.value=d,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,d,p,b){return this.property.evaluate(this.value,this.parameters,a,d,p,b)}}class Fa{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class Ye{constructor(a){this.specification=a}possiblyEvaluate(a,d){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(d)}interpolate(a,d,p){const b=Pn[this.specification.type];return b?b(a,d,p):a}}class fi{constructor(a,d){this.specification=a,this.overrides=d}possiblyEvaluate(a,d,p,b){return new vo(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(d,null,{},p,b)}:a.expression,d)}interpolate(a,d,p){if(a.value.kind!=="constant"||d.value.kind!=="constant")return a;if(a.value.value===void 0||d.value.value===void 0)return new vo(this,{kind:"constant",value:void 0},a.parameters);const b=Pn[this.specification.type];if(b){const x=b(a.value.value,d.value.value,p);return new vo(this,{kind:"constant",value:x},a.parameters)}return a}evaluate(a,d,p,b,x,E){return a.kind==="constant"?a.value:a.evaluate(d,p,b,x,E)}}class Nc extends fi{possiblyEvaluate(a,d,p,b){if(a.value===void 0)return new vo(this,{kind:"constant",value:void 0},d);if(a.expression.kind==="constant"){const x=a.expression.evaluate(d,null,{},p,b),E=a.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,L=this._calculate(E,E,E,d);return new vo(this,{kind:"constant",value:L},d)}if(a.expression.kind==="camera"){const x=this._calculate(a.expression.evaluate({zoom:d.zoom-1}),a.expression.evaluate({zoom:d.zoom}),a.expression.evaluate({zoom:d.zoom+1}),d);return new vo(this,{kind:"constant",value:x},d)}return new vo(this,a.expression,d)}evaluate(a,d,p,b,x,E){if(a.kind==="source"){const L=a.evaluate(d,p,b,x,E);return this._calculate(L,L,L,d)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(d.zoom)-1},p,b),a.evaluate({zoom:Math.floor(d.zoom)},p,b),a.evaluate({zoom:Math.floor(d.zoom)+1},p,b),d):a.value}_calculate(a,d,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:d}:{from:p,to:d}}interpolate(a){return a}}class w{constructor(a){this.specification=a}possiblyEvaluate(a,d,p,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const x=a.expression.evaluate(d,null,{},p,b);return this._calculate(x,x,x,d)}return this._calculate(a.expression.evaluate(new br(Math.floor(d.zoom-1),d)),a.expression.evaluate(new br(Math.floor(d.zoom),d)),a.expression.evaluate(new br(Math.floor(d.zoom+1),d)),d)}}_calculate(a,d,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:d}:{from:p,to:d}}interpolate(a){return a}}class M{constructor(a){this.specification=a}possiblyEvaluate(a,d,p,b){return!!a.expression.evaluate(d,null,{},p,b)}interpolate(){return!1}}class m{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in a){const p=a[d];p.specification.overridable&&this.overridableProperties.push(d);const b=this.defaultPropertyValues[d]=new Jl(p,void 0),x=this.defaultTransitionablePropertyValues[d]=new yh(p);this.defaultTransitioningPropertyValues[d]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=b.possiblyEvaluate({})}}}Ve("DataDrivenProperty",fi),Ve("DataConstantProperty",Ye),Ve("CrossFadedDataDrivenProperty",Nc),Ve("CrossFadedProperty",w),Ve("ColorRampProperty",M);const s="-transition";class u extends oe{constructor(a,d){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),d.layout&&(this._unevaluatedLayout=new Oc(d.layout)),d.paint)){this._transitionablePaint=new vh(d.paint);for(const p in a.paint)this.setPaintProperty(p,a.paint[p],{validate:!1});for(const p in a.layout)this.setLayoutProperty(p,a.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fa(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d!=null&&this._validate(ru,`layers.${this.id}.layout.${a}`,a,d,p)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,d):this.visibility=d)}getPaintProperty(a){return a.endsWith(s)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d!=null&&this._validate(Xu,`layers.${this.id}.paint.${a}`,a,d,p))return!1;if(a.endsWith(s))return this._transitionablePaint.setTransition(a.slice(0,-11),d||void 0),!1;{const b=this._transitionablePaint._values[a],x=b.property.specification["property-type"]==="cross-faded-data-driven",E=b.value.isDataDriven(),L=b.value;this._transitionablePaint.setValue(a,d),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||E||x||this._handleOverridablePaintPropertyUpdate(a,L,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,d,p){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,d){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,d)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),zt(a,(d,p)=>!(d===void 0||p==="layout"&&!Object.keys(d).length||p==="paint"&&!Object.keys(d).length))}_validate(a,d,p,b){let x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!x||x.validate!==!1)&&nu(this,a.call(na,{key:d,layerType:this.type,objectKey:p,value:b,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const d=this.paint.get(a);if(d instanceof vo&&Mo(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const f={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class g{constructor(a,d){this._structArray=a,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,d){return a._trim(),d&&(a.isTransferred=!0,d.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const d=Object.create(this.prototype);return d.arrayBuffer=a.arrayBuffer,d.length=a.length,d.capacity=a.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function A(h){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=0,p=0;return{members:h.map(b=>{const x=f[b.type].BYTES_PER_ELEMENT,E=d=C(d,Math.max(a,x)),L=b.components||1;return p=Math.max(p,x),d+=x*L,{name:b.name,type:b.type,components:L,offset:E}}),size:C(d,Math.max(p,a)),alignment:a}}function C(h,a){return Math.ceil(h/a)*a}class B extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d){const p=this.length;return this.resize(p+1),this.emplace(p,a,d)}emplace(a,d,p){const b=2*a;return this.int16[b+0]=d,this.int16[b+1]=p,a}}B.prototype.bytesPerElement=4,Ve("StructArrayLayout2i4",B);class F extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p){const b=this.length;return this.resize(b+1),this.emplace(b,a,d,p)}emplace(a,d,p,b){const x=3*a;return this.int16[x+0]=d,this.int16[x+1]=p,this.int16[x+2]=b,a}}F.prototype.bytesPerElement=6,Ve("StructArrayLayout3i6",F);class j extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b){const x=this.length;return this.resize(x+1),this.emplace(x,a,d,p,b)}emplace(a,d,p,b,x){const E=4*a;return this.int16[E+0]=d,this.int16[E+1]=p,this.int16[E+2]=b,this.int16[E+3]=x,a}}j.prototype.bytesPerElement=8,Ve("StructArrayLayout4i8",j);class O extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E){const L=this.length;return this.resize(L+1),this.emplace(L,a,d,p,b,x,E)}emplace(a,d,p,b,x,E,L){const R=6*a;return this.int16[R+0]=d,this.int16[R+1]=p,this.int16[R+2]=b,this.int16[R+3]=x,this.int16[R+4]=E,this.int16[R+5]=L,a}}O.prototype.bytesPerElement=12,Ve("StructArrayLayout2i4i12",O);class W extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E){const L=this.length;return this.resize(L+1),this.emplace(L,a,d,p,b,x,E)}emplace(a,d,p,b,x,E,L){const R=4*a,D=8*a;return this.int16[R+0]=d,this.int16[R+1]=p,this.uint8[D+4]=b,this.uint8[D+5]=x,this.uint8[D+6]=E,this.uint8[D+7]=L,a}}W.prototype.bytesPerElement=8,Ve("StructArrayLayout2i4ub8",W);class $ extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d){const p=this.length;return this.resize(p+1),this.emplace(p,a,d)}emplace(a,d,p){const b=2*a;return this.float32[b+0]=d,this.float32[b+1]=p,a}}$.prototype.bytesPerElement=8,Ve("StructArrayLayout2f8",$);class q extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E,L,R,D,U){const V=this.length;return this.resize(V+1),this.emplace(V,a,d,p,b,x,E,L,R,D,U)}emplace(a,d,p,b,x,E,L,R,D,U,V){const J=10*a;return this.uint16[J+0]=d,this.uint16[J+1]=p,this.uint16[J+2]=b,this.uint16[J+3]=x,this.uint16[J+4]=E,this.uint16[J+5]=L,this.uint16[J+6]=R,this.uint16[J+7]=D,this.uint16[J+8]=U,this.uint16[J+9]=V,a}}q.prototype.bytesPerElement=20,Ve("StructArrayLayout10ui20",q);class Q extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E,L,R,D,U,V,J){const tt=this.length;return this.resize(tt+1),this.emplace(tt,a,d,p,b,x,E,L,R,D,U,V,J)}emplace(a,d,p,b,x,E,L,R,D,U,V,J,tt){const st=12*a;return this.int16[st+0]=d,this.int16[st+1]=p,this.int16[st+2]=b,this.int16[st+3]=x,this.uint16[st+4]=E,this.uint16[st+5]=L,this.uint16[st+6]=R,this.uint16[st+7]=D,this.int16[st+8]=U,this.int16[st+9]=V,this.int16[st+10]=J,this.int16[st+11]=tt,a}}Q.prototype.bytesPerElement=24,Ve("StructArrayLayout4i4ui4i24",Q);class lt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,p){const b=this.length;return this.resize(b+1),this.emplace(b,a,d,p)}emplace(a,d,p,b){const x=3*a;return this.float32[x+0]=d,this.float32[x+1]=p,this.float32[x+2]=b,a}}lt.prototype.bytesPerElement=12,Ve("StructArrayLayout3f12",lt);class ht extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.uint32[1*a+0]=d,a}}ht.prototype.bytesPerElement=4,Ve("StructArrayLayout1ul4",ht);class ft extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E,L,R,D){const U=this.length;return this.resize(U+1),this.emplace(U,a,d,p,b,x,E,L,R,D)}emplace(a,d,p,b,x,E,L,R,D,U){const V=10*a,J=5*a;return this.int16[V+0]=d,this.int16[V+1]=p,this.int16[V+2]=b,this.int16[V+3]=x,this.int16[V+4]=E,this.int16[V+5]=L,this.uint32[J+3]=R,this.uint16[V+8]=D,this.uint16[V+9]=U,a}}ft.prototype.bytesPerElement=20,Ve("StructArrayLayout6i1ul2ui20",ft);class ut extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E){const L=this.length;return this.resize(L+1),this.emplace(L,a,d,p,b,x,E)}emplace(a,d,p,b,x,E,L){const R=6*a;return this.int16[R+0]=d,this.int16[R+1]=p,this.int16[R+2]=b,this.int16[R+3]=x,this.int16[R+4]=E,this.int16[R+5]=L,a}}ut.prototype.bytesPerElement=12,Ve("StructArrayLayout2i2i2i12",ut);class vt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x){const E=this.length;return this.resize(E+1),this.emplace(E,a,d,p,b,x)}emplace(a,d,p,b,x,E){const L=4*a,R=8*a;return this.float32[L+0]=d,this.float32[L+1]=p,this.float32[L+2]=b,this.int16[R+6]=x,this.int16[R+7]=E,a}}vt.prototype.bytesPerElement=16,Ve("StructArrayLayout2f1f2i16",vt);class Bt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E){const L=this.length;return this.resize(L+1),this.emplace(L,a,d,p,b,x,E)}emplace(a,d,p,b,x,E,L){const R=16*a,D=4*a,U=8*a;return this.uint8[R+0]=d,this.uint8[R+1]=p,this.float32[D+1]=b,this.float32[D+2]=x,this.int16[U+6]=E,this.int16[U+7]=L,a}}Bt.prototype.bytesPerElement=16,Ve("StructArrayLayout2ub2f2i16",Bt);class It extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,p){const b=this.length;return this.resize(b+1),this.emplace(b,a,d,p)}emplace(a,d,p,b){const x=3*a;return this.uint16[x+0]=d,this.uint16[x+1]=p,this.uint16[x+2]=b,a}}It.prototype.bytesPerElement=6,Ve("StructArrayLayout3ui6",It);class Qt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt){const Zt=this.length;return this.resize(Zt+1),this.emplace(Zt,a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt)}emplace(a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt,Zt){const Nt=24*a,Vt=12*a,se=48*a;return this.int16[Nt+0]=d,this.int16[Nt+1]=p,this.uint16[Nt+2]=b,this.uint16[Nt+3]=x,this.uint32[Vt+2]=E,this.uint32[Vt+3]=L,this.uint32[Vt+4]=R,this.uint16[Nt+10]=D,this.uint16[Nt+11]=U,this.uint16[Nt+12]=V,this.float32[Vt+7]=J,this.float32[Vt+8]=tt,this.uint8[se+36]=st,this.uint8[se+37]=dt,this.uint8[se+38]=wt,this.uint32[Vt+10]=Pt,this.int16[Nt+22]=Zt,a}}Qt.prototype.bytesPerElement=48,Ve("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qt);class pe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt,Zt,Nt,Vt,se,Te,Ge,mi,je,Oe,ri,Xe){const qe=this.length;return this.resize(qe+1),this.emplace(qe,a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt,Zt,Nt,Vt,se,Te,Ge,mi,je,Oe,ri,Xe)}emplace(a,d,p,b,x,E,L,R,D,U,V,J,tt,st,dt,wt,Pt,Zt,Nt,Vt,se,Te,Ge,mi,je,Oe,ri,Xe,qe){const fe=32*a,ni=16*a;return this.int16[fe+0]=d,this.int16[fe+1]=p,this.int16[fe+2]=b,this.int16[fe+3]=x,this.int16[fe+4]=E,this.int16[fe+5]=L,this.int16[fe+6]=R,this.int16[fe+7]=D,this.uint16[fe+8]=U,this.uint16[fe+9]=V,this.uint16[fe+10]=J,this.uint16[fe+11]=tt,this.uint16[fe+12]=st,this.uint16[fe+13]=dt,this.uint16[fe+14]=wt,this.uint16[fe+15]=Pt,this.uint16[fe+16]=Zt,this.uint16[fe+17]=Nt,this.uint16[fe+18]=Vt,this.uint16[fe+19]=se,this.uint16[fe+20]=Te,this.uint16[fe+21]=Ge,this.uint16[fe+22]=mi,this.uint32[ni+12]=je,this.float32[ni+13]=Oe,this.float32[ni+14]=ri,this.uint16[fe+30]=Xe,this.uint16[fe+31]=qe,a}}pe.prototype.bytesPerElement=64,Ve("StructArrayLayout8i15ui1ul2f2ui64",pe);class _e extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.float32[1*a+0]=d,a}}_e.prototype.bytesPerElement=4,Ve("StructArrayLayout1f4",_e);class xe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,p){const b=this.length;return this.resize(b+1),this.emplace(b,a,d,p)}emplace(a,d,p,b){const x=3*a;return this.uint16[6*a+0]=d,this.float32[x+1]=p,this.float32[x+2]=b,a}}xe.prototype.bytesPerElement=12,Ve("StructArrayLayout1ui2f12",xe);class ve extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d,p){const b=this.length;return this.resize(b+1),this.emplace(b,a,d,p)}emplace(a,d,p,b){const x=4*a;return this.uint32[2*a+0]=d,this.uint16[x+2]=p,this.uint16[x+3]=b,a}}ve.prototype.bytesPerElement=8,Ve("StructArrayLayout1ul2ui8",ve);class ye extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,d){const p=this.length;return this.resize(p+1),this.emplace(p,a,d)}emplace(a,d,p){const b=2*a;return this.uint16[b+0]=d,this.uint16[b+1]=p,a}}ye.prototype.bytesPerElement=4,Ve("StructArrayLayout2ui4",ye);class we extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const d=this.length;return this.resize(d+1),this.emplace(d,a)}emplace(a,d){return this.uint16[1*a+0]=d,a}}we.prototype.bytesPerElement=2,Ve("StructArrayLayout1ui2",we);class $e extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,d,p,b){const x=this.length;return this.resize(x+1),this.emplace(x,a,d,p,b)}emplace(a,d,p,b,x){const E=4*a;return this.float32[E+0]=d,this.float32[E+1]=p,this.float32[E+2]=b,this.float32[E+3]=x,a}}$e.prototype.bytesPerElement=16,Ve("StructArrayLayout4f16",$e);class Ce extends g{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}Ce.prototype.size=20;class Pe extends ft{get(a){return new Ce(this,a)}}Ve("CollisionBoxArray",Pe);class ii extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ii.prototype.size=48;class wi extends Qt{get(a){return new ii(this,a)}}Ve("PlacedSymbolArray",wi);class _i extends g{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_i.prototype.size=64;class Ai extends pe{get(a){return new _i(this,a)}}Ve("SymbolInstanceArray",Ai);class ki extends _e{getoffsetX(a){return this.float32[1*a+0]}}Ve("GlyphOffsetArray",ki);class nr extends F{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Ve("SymbolLineVertexArray",nr);class Rr extends g{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Rr.prototype.size=12;class Ki extends xe{get(a){return new Rr(this,a)}}Ve("TextAnchorOffsetArray",Ki);class Hr extends g{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Hr.prototype.size=8;class sr extends ve{get(a){return new Hr(this,a)}}Ve("FeatureIndexArray",sr);class jr extends B{}class sn extends B{}class es extends B{}class Cs extends O{}class kr extends W{}class Da extends ${}class Ps extends q{}class zc extends Q{}class Kl extends lt{}class zn extends ht{}class is extends ut{}class wn extends Bt{}class jn extends It{}class Yr extends ye{}const Ln=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:Un}=Ln;class qi{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=a}prepareSegment(a,d,p,b){let x=this.segments[this.segments.length-1];return a>qi.MAX_VERTEX_ARRAY_LENGTH&&Lt(`Max vertices per segment is ${qi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!x||x.vertexLength+a>qi.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==b)&&(x={vertexOffset:d.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},b!==void 0&&(x.sortKey=b),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const a of this.segments)for(const d in a.vaos)a.vaos[d].destroy()}static simpleSegment(a,d,p,b){return new qi([{vertexOffset:a,primitiveOffset:d,vertexLength:p,primitiveLength:b,vaos:{},sortKey:0}])}}function Oo(h,a){return 256*(h=Et(Math.floor(h),0,255))+Et(Math.floor(a),0,255)}qi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve("SegmentVector",qi);const Oa=A([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var sa={exports:{}},Ql={exports:{}};Ql.exports=function(h,a){var d,p,b,x,E,L,R,D;for(p=h.length-(d=3&h.length),b=a,E=3432918353,L=461845907,D=0;D<p;)R=255&h.charCodeAt(D)|(255&h.charCodeAt(++D))<<8|(255&h.charCodeAt(++D))<<16|(255&h.charCodeAt(++D))<<24,++D,b=27492+(65535&(x=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(R=0,d){case 3:R^=(255&h.charCodeAt(D+2))<<16;case 2:R^=(255&h.charCodeAt(D+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&h.charCodeAt(D)))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*L+(((R>>>16)*L&65535)<<16)&4294967295}return b^=h.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var hp=Ql.exports,Ju={exports:{}};Ju.exports=function(h,a){for(var d,p=h.length,b=a^p,x=0;p>=4;)d=1540483477*(65535&(d=255&h.charCodeAt(x)|(255&h.charCodeAt(++x))<<8|(255&h.charCodeAt(++x))<<16|(255&h.charCodeAt(++x))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:b^=(255&h.charCodeAt(x+2))<<16;case 2:b^=(255&h.charCodeAt(x+1))<<8;case 1:b=1540483477*(65535&(b^=255&h.charCodeAt(x)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var No=hp,oa=Ju.exports;sa.exports=No,sa.exports.murmur3=No,sa.exports.murmur2=oa;var bh=_(sa.exports);class jc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,d,p,b){this.ids.push(xh(a)),this.positions.push(d,p,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=xh(a);let p=0,b=this.ids.length-1;for(;p<b;){const E=p+b>>1;this.ids[E]>=d?b=E:p=E+1}const x=[];for(;this.ids[p]===d;)x.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return x}static serialize(a,d){const p=new Float64Array(a.ids),b=new Uint32Array(a.positions);return Uc(p,b,0,p.length-1),d&&d.push(p.buffer,b.buffer),{ids:p,positions:b}}static deserialize(a){const d=new jc;return d.ids=a.ids,d.positions=a.positions,d.indexed=!0,d}}function xh(h){const a=+h;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:bh(String(h))}function Uc(h,a,d,p){for(;d<p;){const b=h[d+p>>1];let x=d-1,E=p+1;for(;;){do x++;while(h[x]<b);do E--;while(h[E]>b);if(x>=E)break;aa(h,x,E),aa(a,3*x,3*E),aa(a,3*x+1,3*E+1),aa(a,3*x+2,3*E+2)}E-d<p-E?(Uc(h,a,d,E),d=E+1):(Uc(h,a,E+1,p),p=E)}}function aa(h,a,d){const p=h[a];h[a]=h[d],h[d]=p}Ve("FeaturePositionMap",jc);class tc{constructor(a,d){this.gl=a.gl,this.location=d}}class cu extends tc{constructor(a,d){super(a,d),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class hu extends tc{constructor(a,d){super(a,d),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Ku extends tc{constructor(a,d){super(a,d),this.current=$i.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const uu=new Float32Array(16);function Qu(h){return[Oo(255*h.r,255*h.g),Oo(255*h.b,255*h.a)]}class du{constructor(a,d,p){this.value=a,this.uniformNames=d.map(b=>`u_${b}`),this.type=p}setUniform(a,d,p){a.set(p.constantOr(this.value))}getBinding(a,d,p){return this.type==="color"?new Ku(a,d):new cu(a,d)}}class ul{constructor(a,d){this.uniformNames=d.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=a.tlbr}setUniform(a,d,p,b){const x=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&a.set(x)}getBinding(a,d,p){return p.substr(0,9)==="u_pattern"?new hu(a,d):new cu(a,d)}}class Na{constructor(a,d,p,b){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=d.map(x=>({name:`a_${x}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,d,p,b,x){const E=this.paintVertexArray.length,L=this.expression.evaluate(new br(0),d,{},b,[],x);this.paintVertexArray.resize(a),this._setPaintValue(E,a,L)}updatePaintArray(a,d,p,b){const x=this.expression.evaluate({zoom:0},p,b);this._setPaintValue(a,d,x)}_setPaintValue(a,d,p){if(this.type==="color"){const b=Qu(p);for(let x=a;x<d;x++)this.paintVertexArray.emplace(x,b[0],b[1])}else{for(let b=a;b<d;b++)this.paintVertexArray.emplace(b,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bo{constructor(a,d,p,b,x,E){this.expression=a,this.uniformNames=d.map(L=>`u_${L}_t`),this.type=p,this.useIntegerZoom=b,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=d.map(L=>({name:`a_${L}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(a,d,p,b,x){const E=this.expression.evaluate(new br(this.zoom),d,{},b,[],x),L=this.expression.evaluate(new br(this.zoom+1),d,{},b,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(R,a,E,L)}updatePaintArray(a,d,p,b){const x=this.expression.evaluate({zoom:this.zoom},p,b),E=this.expression.evaluate({zoom:this.zoom+1},p,b);this._setPaintValue(a,d,x,E)}_setPaintValue(a,d,p,b){if(this.type==="color"){const x=Qu(p),E=Qu(b);for(let L=a;L<d;L++)this.paintVertexArray.emplace(L,x[0],x[1],E[0],E[1])}else{for(let x=a;x<d;x++)this.paintVertexArray.emplace(x,p,b);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,d){const p=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,b=Et(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,d,p){return new cu(a,d)}}class Is{constructor(a,d,p,b,x,E){this.expression=a,this.type=d,this.useIntegerZoom=p,this.zoom=b,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(a,d,p){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,d.patterns&&d.patterns[this.layerId],p)}updatePaintArray(a,d,p,b,x){this._setPaintValues(a,d,p.patterns&&p.patterns[this.layerId],x)}_setPaintValues(a,d,p,b){if(!b||!p)return;const{min:x,mid:E,max:L}=p,R=b[x],D=b[E],U=b[L];if(R&&D&&U)for(let V=a;V<d;V++)this.zoomInPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],D.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(V,D.tl[0],D.tl[1],D.br[0],D.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],D.pixelRatio,U.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Oa.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Oa.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class up{constructor(a,d,p){this.binders={},this._buffers=[];const b=[];for(const x in a.paint._values){if(!p(x))continue;const E=a.paint.get(x);if(!(E instanceof vo&&Mo(E.property.specification)))continue;const L=e0(x,a.type),R=E.value,D=E.property.specification.type,U=E.property.useIntegerZoom,V=E.property.specification["property-type"],J=V==="cross-faded"||V==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=J?new ul(R.value,L):new du(R.value,L,D),b.push(`/u_${x}`);else if(R.kind==="source"||J){const tt=dp(x,D,"source");this.binders[x]=J?new Is(R,D,U,d,tt,a.id):new Na(R,L,D,tt),b.push(`/a_${x}`)}else{const tt=dp(x,D,"composite");this.binders[x]=new bo(R,L,D,U,d,tt),b.push(`/z_${x}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const d=this.binders[a];return d instanceof Na||d instanceof bo?d.maxValue:0}populatePaintArrays(a,d,p,b,x){for(const E in this.binders){const L=this.binders[E];(L instanceof Na||L instanceof bo||L instanceof Is)&&L.populatePaintArray(a,d,p,b,x)}}setConstantPatternPositions(a,d){for(const p in this.binders){const b=this.binders[p];b instanceof ul&&b.setConstantPatternPositions(a,d)}}updatePaintArrays(a,d,p,b,x){let E=!1;for(const L in a){const R=d.getPositions(L);for(const D of R){const U=p.feature(D.index);for(const V in this.binders){const J=this.binders[V];if((J instanceof Na||J instanceof bo||J instanceof Is)&&J.expression.isStateDependent===!0){const tt=b.paint.get(V);J.expression=tt.value,J.updatePaintArray(D.start,D.end,U,a[L],x),E=!0}}}}return E}defines(){const a=[];for(const d in this.binders){const p=this.binders[d];(p instanceof du||p instanceof ul)&&a.push(...p.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof Na||p instanceof bo)for(let b=0;b<p.paintVertexAttributes.length;b++)a.push(p.paintVertexAttributes[b].name);else if(p instanceof Is)for(let b=0;b<Oa.members.length;b++)a.push(Oa.members[b].name)}return a}getBinderUniforms(){const a=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof du||p instanceof ul||p instanceof bo)for(const b of p.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,d){const p=[];for(const b in this.binders){const x=this.binders[b];if(x instanceof du||x instanceof ul||x instanceof bo){for(const E of x.uniformNames)if(d[E]){const L=x.getBinding(a,d[E],E);p.push({name:E,property:b,binding:L})}}}return p}setUniforms(a,d,p,b){for(const{name:x,property:E,binding:L}of d)this.binders[E].setUniform(L,b,p.get(E),x)}updatePaintBuffers(a){this._buffers=[];for(const d in this.binders){const p=this.binders[d];if(a&&p instanceof Is){const b=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(p instanceof Na||p instanceof bo)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(a){for(const d in this.binders){const p=this.binders[d];(p instanceof Na||p instanceof bo||p instanceof Is)&&p.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const d=this.binders[a];(d instanceof Na||d instanceof bo||d instanceof Is)&&d.destroy()}}}class ec{constructor(a,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new up(b,d,p);this.needsUpload=!1,this._featureMap=new jc,this._bufferOffset=0}populatePaintArrays(a,d,p,b,x,E){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(a,d,b,x,E);d.id!==void 0&&this._featureMap.add(d.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,d,p,b){for(const x of p)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(a,this._featureMap,d,x,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function e0(h,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${a}-`,"").replace(/-/g,"_")]}function dp(h,a,d){const p={color:{source:$,composite:$e},number:{source:_e,composite:$}},b=function(x){return{"line-pattern":{source:Ps,composite:Ps},"fill-pattern":{source:Ps,composite:Ps},"fill-extrusion-pattern":{source:Ps,composite:Ps}}[x]}(h);return b&&b[d]||p[a][d]}Ve("ConstantBinder",du),Ve("CrossFadedConstantBinder",ul),Ve("SourceExpressionBinder",Na),Ve("CrossFadedCompositeBinder",Is),Ve("CompositeExpressionBinder",bo),Ve("ProgramConfiguration",up,{omit:["_buffers"]}),Ve("ProgramConfigurationSet",ec);const Fr=8192,pp=Math.pow(2,14)-1,fp=-pp-1;function Gc(h){const a=Fr/h.extent,d=h.loadGeometry();for(let p=0;p<d.length;p++){const b=d[p];for(let x=0;x<b.length;x++){const E=b[x],L=Math.round(E.x*a),R=Math.round(E.y*a);E.x=Et(L,fp,pp),E.y=Et(R,fp,pp),(L<E.x||L>E.x+1||R<E.y||R>E.y+1)&&Lt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function ic(h,a){return{type:h.type,id:h.id,properties:h.properties,geometry:a?Gc(h):[]}}function td(h,a,d,p,b){h.emplaceBack(2*a+(p+1)/2,2*d+(b+1)/2)}class Vc{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new sn,this.indexArray=new jn,this.segments=new qi,this.programConfigurations=new ec(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,p){const b=this.layers[0],x=[];let E=null,L=!1;b.type==="circle"&&(E=b.layout.get("circle-sort-key"),L=!E.isConstant());for(const{feature:R,id:D,index:U,sourceLayerIndex:V}of a){const J=this.layers[0]._featureFilter.needGeometry,tt=ic(R,J);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),tt,p))continue;const st=L?E.evaluate(tt,{},p):void 0,dt={id:D,properties:R.properties,type:R.type,sourceLayerIndex:V,index:U,geometry:J?tt.geometry:Gc(R),patterns:{},sortKey:st};x.push(dt)}L&&x.sort((R,D)=>R.sortKey-D.sortKey);for(const R of x){const{geometry:D,index:U,sourceLayerIndex:V}=R,J=a[U].feature;this.addFeature(R,D,U,p),d.featureIndex.insert(J,D,U,V,this.index)}}update(a,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Un),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,d,p,b){for(const x of d)for(const E of x){const L=E.x,R=E.y;if(L<0||L>=Fr||R<0||R>=Fr)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),U=D.vertexLength;td(this.layoutVertexArray,L,R,-1,-1),td(this.layoutVertexArray,L,R,1,-1),td(this.layoutVertexArray,L,R,1,1),td(this.layoutVertexArray,L,R,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},b)}}function ed(h,a){for(let d=0;d<h.length;d++)if(nc(a,h[d]))return!0;for(let d=0;d<a.length;d++)if(nc(h,a[d]))return!0;return!!ja(h,a)}function id(h,a,d){return!!nc(h,a)||!!pu(a,h,d)}function za(h,a){if(h.length===1)return qf(a,h[0]);for(let d=0;d<a.length;d++){const p=a[d];for(let b=0;b<p.length;b++)if(nc(h,p[b]))return!0}for(let d=0;d<h.length;d++)if(qf(a,h[d]))return!0;for(let d=0;d<a.length;d++)if(ja(h,a[d]))return!0;return!1}function rc(h,a,d){if(h.length>1){if(ja(h,a))return!0;for(let p=0;p<a.length;p++)if(pu(a[p],h,d))return!0}for(let p=0;p<h.length;p++)if(pu(h[p],a,d))return!0;return!1}function ja(h,a){if(h.length===0||a.length===0)return!1;for(let d=0;d<h.length-1;d++){const p=h[d],b=h[d+1];for(let x=0;x<a.length-1;x++)if(rd(p,b,a[x],a[x+1]))return!0}return!1}function rd(h,a,d,p){return bt(h,d,p)!==bt(a,d,p)&&bt(h,a,d)!==bt(h,a,p)}function pu(h,a,d){const p=d*d;if(a.length===1)return h.distSqr(a[0])<p;for(let b=1;b<a.length;b++)if(mp(h,a[b-1],a[b])<p)return!0;return!1}function mp(h,a,d){const p=a.distSqr(d);if(p===0)return h.distSqr(a);const b=((h.x-a.x)*(d.x-a.x)+(h.y-a.y)*(d.y-a.y))/p;return h.distSqr(b<0?a:b>1?d:d.sub(a)._mult(b)._add(a))}function qf(h,a){let d,p,b,x=!1;for(let E=0;E<h.length;E++){d=h[E];for(let L=0,R=d.length-1;L<d.length;R=L++)p=d[L],b=d[R],p.y>a.y!=b.y>a.y&&a.x<(b.x-p.x)*(a.y-p.y)/(b.y-p.y)+p.x&&(x=!x)}return x}function nc(h,a){let d=!1;for(let p=0,b=h.length-1;p<h.length;b=p++){const x=h[p],E=h[b];x.y>a.y!=E.y>a.y&&a.x<(E.x-x.x)*(a.y-x.y)/(E.y-x.y)+x.x&&(d=!d)}return d}function gp(h,a,d){const p=d[0],b=d[2];if(h.x<p.x&&a.x<p.x||h.x>b.x&&a.x>b.x||h.y<p.y&&a.y<p.y||h.y>b.y&&a.y>b.y)return!1;const x=bt(h,a,d[0]);return x!==bt(h,a,d[1])||x!==bt(h,a,d[2])||x!==bt(h,a,d[3])}function _p(h,a,d){const p=a.paint.get(h).value;return p.kind==="constant"?p.value:d.programConfigurations.get(a.id).getMaxValue(h)}function Hf(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Wf(h,a,d,p,b){if(!a[0]&&!a[1])return h;const x=T.convert(a)._mult(b);d==="viewport"&&x._rotate(-p);const E=[];for(let L=0;L<h.length;L++)E.push(h[L].sub(x));return E}let Uv,Gv;Ve("CircleBucket",Vc,{omit:["layers"]});var ET={get paint(){return Gv=Gv||new m({"circle-radius":new fi(it.paint_circle["circle-radius"]),"circle-color":new fi(it.paint_circle["circle-color"]),"circle-blur":new fi(it.paint_circle["circle-blur"]),"circle-opacity":new fi(it.paint_circle["circle-opacity"]),"circle-translate":new Ye(it.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fi(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fi(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fi(it.paint_circle["circle-stroke-opacity"])})},get layout(){return Uv=Uv||new m({"circle-sort-key":new fi(it.layout_circle["circle-sort-key"])})}},qs=1e-6,nd=typeof Float32Array<"u"?Float32Array:Array;function i0(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Vv(h,a,d){var p=a[0],b=a[1],x=a[2],E=a[3],L=a[4],R=a[5],D=a[6],U=a[7],V=a[8],J=a[9],tt=a[10],st=a[11],dt=a[12],wt=a[13],Pt=a[14],Zt=a[15],Nt=d[0],Vt=d[1],se=d[2],Te=d[3];return h[0]=Nt*p+Vt*L+se*V+Te*dt,h[1]=Nt*b+Vt*R+se*J+Te*wt,h[2]=Nt*x+Vt*D+se*tt+Te*Pt,h[3]=Nt*E+Vt*U+se*st+Te*Zt,h[4]=(Nt=d[4])*p+(Vt=d[5])*L+(se=d[6])*V+(Te=d[7])*dt,h[5]=Nt*b+Vt*R+se*J+Te*wt,h[6]=Nt*x+Vt*D+se*tt+Te*Pt,h[7]=Nt*E+Vt*U+se*st+Te*Zt,h[8]=(Nt=d[8])*p+(Vt=d[9])*L+(se=d[10])*V+(Te=d[11])*dt,h[9]=Nt*b+Vt*R+se*J+Te*wt,h[10]=Nt*x+Vt*D+se*tt+Te*Pt,h[11]=Nt*E+Vt*U+se*st+Te*Zt,h[12]=(Nt=d[12])*p+(Vt=d[13])*L+(se=d[14])*V+(Te=d[15])*dt,h[13]=Nt*b+Vt*R+se*J+Te*wt,h[14]=Nt*x+Vt*D+se*tt+Te*Pt,h[15]=Nt*E+Vt*U+se*st+Te*Zt,h}Math.hypot||(Math.hypot=function(){for(var h=0,a=arguments.length;a--;)h+=arguments[a]*arguments[a];return Math.sqrt(h)});var yp,TT=Vv;function Xf(h,a,d){var p=a[0],b=a[1],x=a[2],E=a[3];return h[0]=d[0]*p+d[4]*b+d[8]*x+d[12]*E,h[1]=d[1]*p+d[5]*b+d[9]*x+d[13]*E,h[2]=d[2]*p+d[6]*b+d[10]*x+d[14]*E,h[3]=d[3]*p+d[7]*b+d[11]*x+d[15]*E,h}yp=new nd(4),nd!=Float32Array&&(yp[0]=0,yp[1]=0,yp[2]=0,yp[3]=0);class CT extends u{constructor(a){super(a,ET)}createBucket(a){return new Vc(a)}queryRadius(a){const d=a;return _p("circle-radius",this,d)+_p("circle-stroke-width",this,d)+Hf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,d,p,b,x,E,L,R){const D=Wf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,L),U=this.paint.get("circle-radius").evaluate(d,p)+this.paint.get("circle-stroke-width").evaluate(d,p),V=this.paint.get("circle-pitch-alignment")==="map",J=V?D:function(st,dt){return st.map(wt=>qv(wt,dt))}(D,R),tt=V?U*L:U;for(const st of b)for(const dt of st){const wt=V?dt:qv(dt,R);let Pt=tt;const Zt=Xf([],[dt.x,dt.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pt*=Zt[3]/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pt*=E.cameraToCenterDistance/Zt[3]),id(J,wt,Pt))return!0}return!1}}function qv(h,a){const d=Xf([],[h.x,h.y,0,1],a);return new T(d[0]/d[3],d[1]/d[3])}class Hv extends Vc{}let Wv;Ve("HeatmapBucket",Hv,{omit:["layers"]});var PT={get paint(){return Wv=Wv||new m({"heatmap-radius":new fi(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fi(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new M(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(it.paint_heatmap["heatmap-opacity"])})}};function r0(h,a,d,p){let{width:b,height:x}=a;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==b*x*d)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${b*x*d}`)}else p=new Uint8Array(b*x*d);return h.width=b,h.height=x,h.data=p,h}function Xv(h,a,d){let{width:p,height:b}=a;if(p===h.width&&b===h.height)return;const x=r0({},{width:p,height:b},d);n0(h,x,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,p),height:Math.min(h.height,b)},d),h.width=p,h.height=b,h.data=x.data}function n0(h,a,d,p,b,x){if(b.width===0||b.height===0)return a;if(b.width>h.width||b.height>h.height||d.x>h.width-b.width||d.y>h.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||p.x>a.width-b.width||p.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const E=h.data,L=a.data;if(E===L)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<b.height;R++){const D=((d.y+R)*h.width+d.x)*x,U=((p.y+R)*a.width+p.x)*x;for(let V=0;V<b.width*x;V++)L[U+V]=E[D+V]}return a}class vp{constructor(a,d){r0(this,a,1,d)}resize(a){Xv(this,a,1)}clone(){return new vp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,d,p,b,x){n0(a,d,p,b,x,1)}}class la{constructor(a,d){r0(this,a,4,d)}resize(a){Xv(this,a,4)}replace(a,d){d?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,d,p,b,x){n0(a,d,p,b,x,4)}}function Zv(h){const a={},d=h.resolution||256,p=h.clips?h.clips.length:1,b=h.image||new la({width:d,height:p});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const x=(E,L,R)=>{a[h.evaluationKey]=R;const D=h.expression.evaluate(a);b.data[E+L+0]=Math.floor(255*D.r/D.a),b.data[E+L+1]=Math.floor(255*D.g/D.a),b.data[E+L+2]=Math.floor(255*D.b/D.a),b.data[E+L+3]=Math.floor(255*D.a)};if(h.clips)for(let E=0,L=0;E<p;++E,L+=4*d)for(let R=0,D=0;R<d;R++,D+=4){const U=R/(d-1),{start:V,end:J}=h.clips[E];x(L,D,V*(1-U)+J*U)}else for(let E=0,L=0;E<d;E++,L+=4)x(0,L,E/(d-1));return b}Ve("AlphaImage",vp),Ve("RGBAImage",la);const s0="big-fb";class IT extends u{createBucket(a){return new Hv(a)}constructor(a){super(a,PT),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(s0)&&this.heatmapFbos.delete(s0)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let $v;var LT={get paint(){return $v=$v||new m({"hillshade-illumination-direction":new Ye(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(it.paint_hillshade["hillshade-accent-color"])})}};class MT extends u{constructor(a){super(a,LT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const BT=A([{name:"a_pos",components:2,type:"Int16"}],4),{members:RT}=BT;function Yv(h,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:2;const p=a&&a.length,b=p?a[0]*d:h.length;let x=Jv(h,0,b,d,!0);const E=[];if(!x||x.next===x.prev)return E;let L,R,D;if(p&&(x=function(U,V,J,tt){const st=[];for(let dt=0,wt=V.length;dt<wt;dt++){const Pt=Jv(U,V[dt]*tt,dt<wt-1?V[dt+1]*tt:U.length,tt,!1);Pt===Pt.next&&(Pt.steiner=!0),st.push(UT(Pt))}st.sort(NT);for(let dt=0;dt<st.length;dt++)J=zT(st[dt],J);return J}(h,a,x,d)),h.length>80*d){L=1/0,R=1/0;let U=-1/0,V=-1/0;for(let J=d;J<b;J+=d){const tt=h[J],st=h[J+1];tt<L&&(L=tt),st<R&&(R=st),tt>U&&(U=tt),st>V&&(V=st)}D=Math.max(U-L,V-R),D=D!==0?32767/D:0}return bp(x,E,d,L,R,D,0),E}function Jv(h,a,d,p,b){let x;if(b===function(E,L,R,D){let U=0;for(let V=L,J=R-D;V<R;V+=D)U+=(E[J]-E[V])*(E[V+1]+E[J+1]),J=V;return U}(h,a,d,p)>0)for(let E=a;E<d;E+=p)x=tb(E/p|0,h[E],h[E+1],x);else for(let E=d-p;E>=a;E-=p)x=tb(E/p|0,h[E],h[E+1],x);return x&&Zf(x,x.next)&&(wp(x),x=x.next),x}function fu(h,a){if(!h)return h;a||(a=h);let d,p=h;do if(d=!1,p.steiner||!Zf(p,p.next)&&mn(p.prev,p,p.next)!==0)p=p.next;else{if(wp(p),p=a=p.prev,p===p.next)break;d=!0}while(d||p!==a);return a}function bp(h,a,d,p,b,x,E){if(!h)return;!E&&x&&function(R,D,U,V){let J=R;do J.z===0&&(J.z=o0(J.x,J.y,D,U,V)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==R);J.prevZ.nextZ=null,J.prevZ=null,function(tt){let st,dt=1;do{let wt,Pt=tt;tt=null;let Zt=null;for(st=0;Pt;){st++;let Nt=Pt,Vt=0;for(let Te=0;Te<dt&&(Vt++,Nt=Nt.nextZ,Nt);Te++);let se=dt;for(;Vt>0||se>0&&Nt;)Vt!==0&&(se===0||!Nt||Pt.z<=Nt.z)?(wt=Pt,Pt=Pt.nextZ,Vt--):(wt=Nt,Nt=Nt.nextZ,se--),Zt?Zt.nextZ=wt:tt=wt,wt.prevZ=Zt,Zt=wt;Pt=Nt}Zt.nextZ=null,dt*=2}while(st>1)}(J)}(h,p,b,x);let L=h;for(;h.prev!==h.next;){const R=h.prev,D=h.next;if(x?FT(h,p,b,x):kT(h))a.push(R.i,h.i,D.i),wp(h),h=D.next,L=D.next;else if((h=D)===L){E?E===1?bp(h=DT(fu(h),a),a,d,p,b,x,2):E===2&&OT(h,a,d,p,b,x):bp(fu(h),a,d,p,b,x,1);break}}}function kT(h){const a=h.prev,d=h,p=h.next;if(mn(a,d,p)>=0)return!1;const b=a.x,x=d.x,E=p.x,L=a.y,R=d.y,D=p.y,U=b<x?b<E?b:E:x<E?x:E,V=L<R?L<D?L:D:R<D?R:D,J=b>x?b>E?b:E:x>E?x:E,tt=L>R?L>D?L:D:R>D?R:D;let st=p.next;for(;st!==a;){if(st.x>=U&&st.x<=J&&st.y>=V&&st.y<=tt&&sd(b,L,x,R,E,D,st.x,st.y)&&mn(st.prev,st,st.next)>=0)return!1;st=st.next}return!0}function FT(h,a,d,p){const b=h.prev,x=h,E=h.next;if(mn(b,x,E)>=0)return!1;const L=b.x,R=x.x,D=E.x,U=b.y,V=x.y,J=E.y,tt=L<R?L<D?L:D:R<D?R:D,st=U<V?U<J?U:J:V<J?V:J,dt=L>R?L>D?L:D:R>D?R:D,wt=U>V?U>J?U:J:V>J?V:J,Pt=o0(tt,st,a,d,p),Zt=o0(dt,wt,a,d,p);let Nt=h.prevZ,Vt=h.nextZ;for(;Nt&&Nt.z>=Pt&&Vt&&Vt.z<=Zt;){if(Nt.x>=tt&&Nt.x<=dt&&Nt.y>=st&&Nt.y<=wt&&Nt!==b&&Nt!==E&&sd(L,U,R,V,D,J,Nt.x,Nt.y)&&mn(Nt.prev,Nt,Nt.next)>=0||(Nt=Nt.prevZ,Vt.x>=tt&&Vt.x<=dt&&Vt.y>=st&&Vt.y<=wt&&Vt!==b&&Vt!==E&&sd(L,U,R,V,D,J,Vt.x,Vt.y)&&mn(Vt.prev,Vt,Vt.next)>=0))return!1;Vt=Vt.nextZ}for(;Nt&&Nt.z>=Pt;){if(Nt.x>=tt&&Nt.x<=dt&&Nt.y>=st&&Nt.y<=wt&&Nt!==b&&Nt!==E&&sd(L,U,R,V,D,J,Nt.x,Nt.y)&&mn(Nt.prev,Nt,Nt.next)>=0)return!1;Nt=Nt.prevZ}for(;Vt&&Vt.z<=Zt;){if(Vt.x>=tt&&Vt.x<=dt&&Vt.y>=st&&Vt.y<=wt&&Vt!==b&&Vt!==E&&sd(L,U,R,V,D,J,Vt.x,Vt.y)&&mn(Vt.prev,Vt,Vt.next)>=0)return!1;Vt=Vt.nextZ}return!0}function DT(h,a){let d=h;do{const p=d.prev,b=d.next.next;!Zf(p,b)&&Kv(p,d,d.next,b)&&xp(p,b)&&xp(b,p)&&(a.push(p.i,d.i,b.i),wp(d),wp(d.next),d=h=b),d=d.next}while(d!==h);return fu(d)}function OT(h,a,d,p,b,x){let E=h;do{let L=E.next.next;for(;L!==E.prev;){if(E.i!==L.i&&GT(E,L)){let R=Qv(E,L);return E=fu(E,E.next),R=fu(R,R.next),bp(E,a,d,p,b,x,0),void bp(R,a,d,p,b,x,0)}L=L.next}E=E.next}while(E!==h)}function NT(h,a){return h.x-a.x}function zT(h,a){const d=function(b,x){let E=x;const L=b.x,R=b.y;let D,U=-1/0;do{if(R<=E.y&&R>=E.next.y&&E.next.y!==E.y){const dt=E.x+(R-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(dt<=L&&dt>U&&(U=dt,D=E.x<E.next.x?E:E.next,dt===L))return D}E=E.next}while(E!==x);if(!D)return null;const V=D,J=D.x,tt=D.y;let st=1/0;E=D;do{if(L>=E.x&&E.x>=J&&L!==E.x&&sd(R<tt?L:U,R,J,tt,R<tt?U:L,R,E.x,E.y)){const dt=Math.abs(R-E.y)/(L-E.x);xp(E,b)&&(dt<st||dt===st&&(E.x>D.x||E.x===D.x&&jT(D,E)))&&(D=E,st=dt)}E=E.next}while(E!==V);return D}(h,a);if(!d)return a;const p=Qv(d,h);return fu(p,p.next),fu(d,d.next)}function jT(h,a){return mn(h.prev,h,a.prev)<0&&mn(a.next,h,h.next)<0}function o0(h,a,d,p,b){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-d)*b|0)|h<<8))|h<<4))|h<<2))|h<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-p)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function UT(h){let a=h,d=h;do(a.x<d.x||a.x===d.x&&a.y<d.y)&&(d=a),a=a.next;while(a!==h);return d}function sd(h,a,d,p,b,x,E,L){return(b-E)*(a-L)>=(h-E)*(x-L)&&(h-E)*(p-L)>=(d-E)*(a-L)&&(d-E)*(x-L)>=(b-E)*(p-L)}function GT(h,a){return h.next.i!==a.i&&h.prev.i!==a.i&&!function(d,p){let b=d;do{if(b.i!==d.i&&b.next.i!==d.i&&b.i!==p.i&&b.next.i!==p.i&&Kv(b,b.next,d,p))return!0;b=b.next}while(b!==d);return!1}(h,a)&&(xp(h,a)&&xp(a,h)&&function(d,p){let b=d,x=!1;const E=(d.x+p.x)/2,L=(d.y+p.y)/2;do b.y>L!=b.next.y>L&&b.next.y!==b.y&&E<(b.next.x-b.x)*(L-b.y)/(b.next.y-b.y)+b.x&&(x=!x),b=b.next;while(b!==d);return x}(h,a)&&(mn(h.prev,h,a.prev)||mn(h,a.prev,a))||Zf(h,a)&&mn(h.prev,h,h.next)>0&&mn(a.prev,a,a.next)>0)}function mn(h,a,d){return(a.y-h.y)*(d.x-a.x)-(a.x-h.x)*(d.y-a.y)}function Zf(h,a){return h.x===a.x&&h.y===a.y}function Kv(h,a,d,p){const b=Yf(mn(h,a,d)),x=Yf(mn(h,a,p)),E=Yf(mn(d,p,h)),L=Yf(mn(d,p,a));return b!==x&&E!==L||!(b!==0||!$f(h,d,a))||!(x!==0||!$f(h,p,a))||!(E!==0||!$f(d,h,p))||!(L!==0||!$f(d,a,p))}function $f(h,a,d){return a.x<=Math.max(h.x,d.x)&&a.x>=Math.min(h.x,d.x)&&a.y<=Math.max(h.y,d.y)&&a.y>=Math.min(h.y,d.y)}function Yf(h){return h>0?1:h<0?-1:0}function xp(h,a){return mn(h.prev,h,h.next)<0?mn(h,a,h.next)>=0&&mn(h,h.prev,a)>=0:mn(h,a,h.prev)<0||mn(h,h.next,a)<0}function Qv(h,a){const d=a0(h.i,h.x,h.y),p=a0(a.i,a.x,a.y),b=h.next,x=a.prev;return h.next=a,a.prev=h,d.next=b,b.prev=d,p.next=d,d.prev=p,x.next=p,p.prev=x,p}function tb(h,a,d,p){const b=a0(h,a,d);return p?(b.next=p.next,b.prev=p,p.next.prev=b,p.next=b):(b.prev=b,b.next=b),b}function wp(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function a0(h,a,d){return{i:h,x:a,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function l0(h,a,d){const p=d.patternDependencies;let b=!1;for(const x of a){const E=x.paint.get(`${h}-pattern`);E.isConstant()||(b=!0);const L=E.constantOr(null);L&&(b=!0,p[L.to]=!0,p[L.from]=!0)}return b}function c0(h,a,d,p,b){const x=b.patternDependencies;for(const E of a){const L=E.paint.get(`${h}-pattern`).value;if(L.kind!=="constant"){let R=L.evaluate({zoom:p-1},d,{},b.availableImages),D=L.evaluate({zoom:p},d,{},b.availableImages),U=L.evaluate({zoom:p+1},d,{},b.availableImages);R=R&&R.name?R.name:R,D=D&&D.name?D.name:D,U=U&&U.name?U.name:U,x[R]=!0,x[D]=!0,x[U]=!0,d.patterns[E.id]={min:R,mid:D,max:U}}}return d}class h0{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new es,this.indexArray=new jn,this.indexArray2=new Yr,this.programConfigurations=new ec(a.layers,a.zoom),this.segments=new qi,this.segments2=new qi,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,p){this.hasPattern=l0("fill",this.layers,d);const b=this.layers[0].layout.get("fill-sort-key"),x=!b.isConstant(),E=[];for(const{feature:L,id:R,index:D,sourceLayerIndex:U}of a){const V=this.layers[0]._featureFilter.needGeometry,J=ic(L,V);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),J,p))continue;const tt=x?b.evaluate(J,{},p,d.availableImages):void 0,st={id:R,properties:L.properties,type:L.type,sourceLayerIndex:U,index:D,geometry:V?J.geometry:Gc(L),patterns:{},sortKey:tt};E.push(st)}x&&E.sort((L,R)=>L.sortKey-R.sortKey);for(const L of E){const{geometry:R,index:D,sourceLayerIndex:U}=L;if(this.hasPattern){const V=c0("fill",this.layers,L,this.zoom,d);this.patternFeatures.push(V)}else this.addFeature(L,R,D,p,{});d.featureIndex.insert(a[D].feature,R,D,U,this.index)}}update(a,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,p)}addFeatures(a,d,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,RT),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,d,p,b,x){for(const E of Po(d,500)){let L=0;for(const tt of E)L+=tt.length;const R=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),D=R.vertexLength,U=[],V=[];for(const tt of E){if(tt.length===0)continue;tt!==E[0]&&V.push(U.length/2);const st=this.segments2.prepareSegment(tt.length,this.layoutVertexArray,this.indexArray2),dt=st.vertexLength;this.layoutVertexArray.emplaceBack(tt[0].x,tt[0].y),this.indexArray2.emplaceBack(dt+tt.length-1,dt),U.push(tt[0].x),U.push(tt[0].y);for(let wt=1;wt<tt.length;wt++)this.layoutVertexArray.emplaceBack(tt[wt].x,tt[wt].y),this.indexArray2.emplaceBack(dt+wt-1,dt+wt),U.push(tt[wt].x),U.push(tt[wt].y);st.vertexLength+=tt.length,st.primitiveLength+=tt.length}const J=Yv(U,V);for(let tt=0;tt<J.length;tt+=3)this.indexArray.emplaceBack(D+J[tt],D+J[tt+1],D+J[tt+2]);R.vertexLength+=L,R.primitiveLength+=J.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,x,b)}}let eb,ib;Ve("FillBucket",h0,{omit:["layers","patternFeatures"]});var VT={get paint(){return ib=ib||new m({"fill-antialias":new Ye(it.paint_fill["fill-antialias"]),"fill-opacity":new fi(it.paint_fill["fill-opacity"]),"fill-color":new fi(it.paint_fill["fill-color"]),"fill-outline-color":new fi(it.paint_fill["fill-outline-color"]),"fill-translate":new Ye(it.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nc(it.paint_fill["fill-pattern"])})},get layout(){return eb=eb||new m({"fill-sort-key":new fi(it.layout_fill["fill-sort-key"])})}};class qT extends u{constructor(a){super(a,VT)}recalculate(a,d){super.recalculate(a,d);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new h0(a)}queryRadius(){return Hf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,d,p,b,x,E,L){return za(Wf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,L),b)}isTileClipped(){return!0}}const HT=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),WT=A([{name:"a_centroid",components:2,type:"Int16"}],4),{members:XT}=HT;var wh={},ZT=v,rb=od;function od(h,a,d,p,b){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=p,this._values=b,h.readFields($T,this,a)}function $T(h,a,d){h==1?a.id=d.readVarint():h==2?function(p,b){for(var x=p.readVarint()+p.pos;p.pos<x;){var E=b._keys[p.readVarint()],L=b._values[p.readVarint()];b.properties[E]=L}}(d,a):h==3?a.type=d.readVarint():h==4&&(a._geometry=d.pos)}function YT(h){for(var a,d,p=0,b=0,x=h.length,E=x-1;b<x;E=b++)p+=((d=h[E]).x-(a=h[b]).x)*(a.y+d.y);return p}od.types=["Unknown","Point","LineString","Polygon"],od.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var a,d=h.readVarint()+h.pos,p=1,b=0,x=0,E=0,L=[];h.pos<d;){if(b<=0){var R=h.readVarint();p=7&R,b=R>>3}if(b--,p===1||p===2)x+=h.readSVarint(),E+=h.readSVarint(),p===1&&(a&&L.push(a),a=[]),a.push(new ZT(x,E));else{if(p!==7)throw new Error("unknown command "+p);a&&a.push(a[0].clone())}}return a&&L.push(a),L},od.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var a=h.readVarint()+h.pos,d=1,p=0,b=0,x=0,E=1/0,L=-1/0,R=1/0,D=-1/0;h.pos<a;){if(p<=0){var U=h.readVarint();d=7&U,p=U>>3}if(p--,d===1||d===2)(b+=h.readSVarint())<E&&(E=b),b>L&&(L=b),(x+=h.readSVarint())<R&&(R=x),x>D&&(D=x);else if(d!==7)throw new Error("unknown command "+d)}return[E,R,L,D]},od.prototype.toGeoJSON=function(h,a,d){var p,b,x=this.extent*Math.pow(2,d),E=this.extent*h,L=this.extent*a,R=this.loadGeometry(),D=od.types[this.type];function U(tt){for(var st=0;st<tt.length;st++){var dt=tt[st];tt[st]=[360*(dt.x+E)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(dt.y+L)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(p=0;p<R.length;p++)V[p]=R[p][0];U(R=V);break;case 2:for(p=0;p<R.length;p++)U(R[p]);break;case 3:for(R=function(tt){var st=tt.length;if(st<=1)return[tt];for(var dt,wt,Pt=[],Zt=0;Zt<st;Zt++){var Nt=YT(tt[Zt]);Nt!==0&&(wt===void 0&&(wt=Nt<0),wt===Nt<0?(dt&&Pt.push(dt),dt=[tt[Zt]]):dt.push(tt[Zt]))}return dt&&Pt.push(dt),Pt}(R),p=0;p<R.length;p++)for(b=0;b<R[p].length;b++)U(R[p][b])}R.length===1?R=R[0]:D="Multi"+D;var J={type:"Feature",geometry:{type:D,coordinates:R},properties:this.properties};return"id"in this&&(J.id=this.id),J};var JT=rb,nb=sb;function sb(h,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(KT,this,a),this.length=this._features.length}function KT(h,a,d){h===15?a.version=d.readVarint():h===1?a.name=d.readString():h===5?a.extent=d.readVarint():h===2?a._features.push(d.pos):h===3?a._keys.push(d.readString()):h===4&&a._values.push(function(p){for(var b=null,x=p.readVarint()+p.pos;p.pos<x;){var E=p.readVarint()>>3;b=E===1?p.readString():E===2?p.readFloat():E===3?p.readDouble():E===4?p.readVarint64():E===5?p.readVarint():E===6?p.readSVarint():E===7?p.readBoolean():null}return b}(d))}sb.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var a=this._pbf.readVarint()+this._pbf.pos;return new JT(this._pbf,a,this.extent,this._keys,this._values)};var QT=nb;function tC(h,a,d){if(h===3){var p=new QT(d,d.readVarint()+d.pos);p.length&&(a[p.name]=p)}}wh.VectorTile=function(h,a){this.layers=h.readFields(tC,{},a)},wh.VectorTileFeature=rb,wh.VectorTileLayer=nb;const eC=wh.VectorTileFeature.types,u0=Math.pow(2,13);function Sp(h,a,d,p,b,x,E,L){h.emplaceBack(a,d,2*Math.floor(p*u0)+E,b*u0*2,x*u0*2,Math.round(L))}class d0{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Cs,this.centroidVertexArray=new jr,this.indexArray=new jn,this.programConfigurations=new ec(a.layers,a.zoom),this.segments=new qi,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,p){this.features=[],this.hasPattern=l0("fill-extrusion",this.layers,d);for(const{feature:b,id:x,index:E,sourceLayerIndex:L}of a){const R=this.layers[0]._featureFilter.needGeometry,D=ic(b,R);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),D,p))continue;const U={id:x,sourceLayerIndex:L,index:E,geometry:R?D.geometry:Gc(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(c0("fill-extrusion",this.layers,U,this.zoom,d)):this.addFeature(U,U.geometry,E,p,{}),d.featureIndex.insert(b,U.geometry,E,L,this.index,!0)}}addFeatures(a,d,p){for(const b of this.features){const{geometry:x}=b;this.addFeature(b,x,b.index,d,p)}}update(a,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,XT),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,WT.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,d,p,b,x){for(const E of Po(d,500)){const L={x:0,y:0,vertexCount:0};let R=0;for(const st of E)R+=st.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const st of E){if(st.length===0||rC(st))continue;let dt=0;for(let wt=0;wt<st.length;wt++){const Pt=st[wt];if(wt>=1){const Zt=st[wt-1];if(!iC(Pt,Zt)){D.vertexLength+4>qi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Nt=Pt.sub(Zt)._perp()._unit(),Vt=Zt.dist(Pt);dt+Vt>32768&&(dt=0),Sp(this.layoutVertexArray,Pt.x,Pt.y,Nt.x,Nt.y,0,0,dt),Sp(this.layoutVertexArray,Pt.x,Pt.y,Nt.x,Nt.y,0,1,dt),L.x+=2*Pt.x,L.y+=2*Pt.y,L.vertexCount+=2,dt+=Vt,Sp(this.layoutVertexArray,Zt.x,Zt.y,Nt.x,Nt.y,0,0,dt),Sp(this.layoutVertexArray,Zt.x,Zt.y,Nt.x,Nt.y,0,1,dt),L.x+=2*Zt.x,L.y+=2*Zt.y,L.vertexCount+=2;const se=D.vertexLength;this.indexArray.emplaceBack(se,se+2,se+1),this.indexArray.emplaceBack(se+1,se+2,se+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+R>qi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),eC[a.type]!=="Polygon")continue;const U=[],V=[],J=D.vertexLength;for(const st of E)if(st.length!==0){st!==E[0]&&V.push(U.length/2);for(let dt=0;dt<st.length;dt++){const wt=st[dt];Sp(this.layoutVertexArray,wt.x,wt.y,0,0,1,1,0),L.x+=wt.x,L.y+=wt.y,L.vertexCount+=1,U.push(wt.x),U.push(wt.y)}}const tt=Yv(U,V);for(let st=0;st<tt.length;st+=3)this.indexArray.emplaceBack(J+tt[st],J+tt[st+2],J+tt[st+1]);D.primitiveLength+=tt.length/3,D.vertexLength+=R;for(let st=0;st<L.vertexCount;st++){const dt=Math.floor(L.x/L.vertexCount),wt=Math.floor(L.y/L.vertexCount);this.centroidVertexArray.emplaceBack(dt,wt)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,x,b)}}function iC(h,a){return h.x===a.x&&(h.x<0||h.x>Fr)||h.y===a.y&&(h.y<0||h.y>Fr)}function rC(h){return h.every(a=>a.x<0)||h.every(a=>a.x>Fr)||h.every(a=>a.y<0)||h.every(a=>a.y>Fr)}let ob;Ve("FillExtrusionBucket",d0,{omit:["layers","features"]});var nC={get paint(){return ob=ob||new m({"fill-extrusion-opacity":new Ye(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fi(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nc(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fi(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fi(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class sC extends u{constructor(a){super(a,nC)}createBucket(a){return new d0(a)}queryRadius(){return Hf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,d,p,b,x,E,L,R){const D=Wf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,L),U=this.paint.get("fill-extrusion-height").evaluate(d,p),V=this.paint.get("fill-extrusion-base").evaluate(d,p),J=function(st,dt,wt,Pt){const Zt=[];for(const Nt of st){const Vt=[Nt.x,Nt.y,0,1];Xf(Vt,Vt,dt),Zt.push(new T(Vt[0]/Vt[3],Vt[1]/Vt[3]))}return Zt}(D,R),tt=function(st,dt,wt,Pt){const Zt=[],Nt=[],Vt=Pt[8]*dt,se=Pt[9]*dt,Te=Pt[10]*dt,Ge=Pt[11]*dt,mi=Pt[8]*wt,je=Pt[9]*wt,Oe=Pt[10]*wt,ri=Pt[11]*wt;for(const Xe of st){const qe=[],fe=[];for(const ni of Xe){const ti=ni.x,Ei=ni.y,Pr=Pt[0]*ti+Pt[4]*Ei+Pt[12],wr=Pt[1]*ti+Pt[5]*Ei+Pt[13],Gn=Pt[2]*ti+Pt[6]*Ei+Pt[14],Ua=Pt[3]*ti+Pt[7]*Ei+Pt[15],ds=Gn+Te,Vn=Ua+Ge,Hs=Pr+mi,Ws=wr+je,Xs=Gn+Oe,hn=Ua+ri,qn=new T((Pr+Vt)/Vn,(wr+se)/Vn);qn.z=ds/Vn,qe.push(qn);const Ls=new T(Hs/hn,Ws/hn);Ls.z=Xs/hn,fe.push(Ls)}Zt.push(qe),Nt.push(fe)}return[Zt,Nt]}(b,V,U,R);return function(st,dt,wt){let Pt=1/0;za(wt,dt)&&(Pt=ab(wt,dt[0]));for(let Zt=0;Zt<dt.length;Zt++){const Nt=dt[Zt],Vt=st[Zt];for(let se=0;se<Nt.length-1;se++){const Te=Nt[se],Ge=[Te,Nt[se+1],Vt[se+1],Vt[se],Te];ed(wt,Ge)&&(Pt=Math.min(Pt,ab(wt,Ge)))}}return Pt!==1/0&&Pt}(tt[0],tt[1],J)}}function Ap(h,a){return h.x*a.x+h.y*a.y}function ab(h,a){if(h.length===1){let d=0;const p=a[d++];let b;for(;!b||p.equals(b);)if(b=a[d++],!b)return 1/0;for(;d<a.length;d++){const x=a[d],E=h[0],L=b.sub(p),R=x.sub(p),D=E.sub(p),U=Ap(L,L),V=Ap(L,R),J=Ap(R,R),tt=Ap(D,L),st=Ap(D,R),dt=U*J-V*V,wt=(J*tt-V*st)/dt,Pt=(U*st-V*tt)/dt,Zt=p.z*(1-wt-Pt)+b.z*wt+x.z*Pt;if(isFinite(Zt))return Zt}return 1/0}{let d=1/0;for(const p of a)d=Math.min(d,p.z);return d}}const oC=A([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:aC}=oC,lC=A([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:cC}=lC,hC=wh.VectorTileFeature.types,uC=Math.cos(Math.PI/180*37.5),lb=Math.pow(2,14)/.5;class p0{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(d=>d.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new kr,this.layoutVertexArray2=new Da,this.indexArray=new jn,this.programConfigurations=new ec(a.layers,a.zoom),this.segments=new qi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(a,d,p){this.hasPattern=l0("line",this.layers,d);const b=this.layers[0].layout.get("line-sort-key"),x=!b.isConstant(),E=[];for(const{feature:L,id:R,index:D,sourceLayerIndex:U}of a){const V=this.layers[0]._featureFilter.needGeometry,J=ic(L,V);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),J,p))continue;const tt=x?b.evaluate(J,{},p):void 0,st={id:R,properties:L.properties,type:L.type,sourceLayerIndex:U,index:D,geometry:V?J.geometry:Gc(L),patterns:{},sortKey:tt};E.push(st)}x&&E.sort((L,R)=>L.sortKey-R.sortKey);for(const L of E){const{geometry:R,index:D,sourceLayerIndex:U}=L;if(this.hasPattern){const V=c0("line",this.layers,L,this.zoom,d);this.patternFeatures.push(V)}else this.addFeature(L,R,D,p,{});d.featureIndex.insert(a[D].feature,R,D,U,this.index)}}update(a,d,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,d,this.stateDependentLayers,p)}addFeatures(a,d,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,cC)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,aC),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,d,p,b,x){const E=this.layers[0].layout,L=E.get("line-join").evaluate(a,{}),R=E.get("line-cap"),D=E.get("line-miter-limit"),U=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const V of d)this.addLine(V,a,L,R,D,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,x,b)}addLine(a,d,p,b,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pt=0;Pt<a.length-1;Pt++)this.totalDistance+=a[Pt].dist(a[Pt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=hC[d.type]==="Polygon";let R=a.length;for(;R>=2&&a[R-1].equals(a[R-2]);)R--;let D=0;for(;D<R-1&&a[D].equals(a[D+1]);)D++;if(R<(L?3:2))return;p==="bevel"&&(x=1.05);const U=this.overscaling<=16?15*Fr/(512*this.overscaling):0,V=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let J,tt,st,dt,wt;this.e1=this.e2=-1,L&&(J=a[R-2],wt=a[D].sub(J)._unit()._perp());for(let Pt=D;Pt<R;Pt++){if(st=Pt===R-1?L?a[D+1]:void 0:a[Pt+1],st&&a[Pt].equals(st))continue;wt&&(dt=wt),J&&(tt=J),J=a[Pt],wt=st?st.sub(J)._unit()._perp():dt,dt=dt||wt;let Zt=dt.add(wt);Zt.x===0&&Zt.y===0||Zt._unit();const Nt=dt.x*wt.x+dt.y*wt.y,Vt=Zt.x*wt.x+Zt.y*wt.y,se=Vt!==0?1/Vt:1/0,Te=2*Math.sqrt(2-2*Vt),Ge=Vt<uC&&tt&&st,mi=dt.x*wt.y-dt.y*wt.x>0;if(Ge&&Pt>D){const ri=J.dist(tt);if(ri>2*U){const Xe=J.sub(J.sub(tt)._mult(U/ri)._round());this.updateDistance(tt,Xe),this.addCurrentVertex(Xe,dt,0,0,V),tt=Xe}}const je=tt&&st;let Oe=je?p:L?"butt":b;if(je&&Oe==="round"&&(se<E?Oe="miter":se<=2&&(Oe="fakeround")),Oe==="miter"&&se>x&&(Oe="bevel"),Oe==="bevel"&&(se>2&&(Oe="flipbevel"),se<x&&(Oe="miter")),tt&&this.updateDistance(tt,J),Oe==="miter")Zt._mult(se),this.addCurrentVertex(J,Zt,0,0,V);else if(Oe==="flipbevel"){if(se>100)Zt=wt.mult(-1);else{const ri=se*dt.add(wt).mag()/dt.sub(wt).mag();Zt._perp()._mult(ri*(mi?-1:1))}this.addCurrentVertex(J,Zt,0,0,V),this.addCurrentVertex(J,Zt.mult(-1),0,0,V)}else if(Oe==="bevel"||Oe==="fakeround"){const ri=-Math.sqrt(se*se-1),Xe=mi?ri:0,qe=mi?0:ri;if(tt&&this.addCurrentVertex(J,dt,Xe,qe,V),Oe==="fakeround"){const fe=Math.round(180*Te/Math.PI/20);for(let ni=1;ni<fe;ni++){let ti=ni/fe;if(ti!==.5){const Pr=ti-.5;ti+=ti*Pr*(ti-1)*((1.0904+Nt*(Nt*(3.55645-1.43519*Nt)-3.2452))*Pr*Pr+(.848013+Nt*(.215638*Nt-1.06021)))}const Ei=wt.sub(dt)._mult(ti)._add(dt)._unit()._mult(mi?-1:1);this.addHalfVertex(J,Ei.x,Ei.y,!1,mi,0,V)}}st&&this.addCurrentVertex(J,wt,-Xe,-qe,V)}else if(Oe==="butt")this.addCurrentVertex(J,Zt,0,0,V);else if(Oe==="square"){const ri=tt?1:-1;this.addCurrentVertex(J,Zt,ri,ri,V)}else Oe==="round"&&(tt&&(this.addCurrentVertex(J,dt,0,0,V),this.addCurrentVertex(J,dt,1,1,V,!0)),st&&(this.addCurrentVertex(J,wt,-1,-1,V,!0),this.addCurrentVertex(J,wt,0,0,V)));if(Ge&&Pt<R-1){const ri=J.dist(st);if(ri>2*U){const Xe=J.add(st.sub(J)._mult(U/ri)._round());this.updateDistance(J,Xe),this.addCurrentVertex(Xe,wt,0,0,V),J=Xe}}}}addCurrentVertex(a,d,p,b,x){let E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const L=d.y*b-d.x,R=-d.y-d.x*b;this.addHalfVertex(a,d.x+d.y*p,d.y-d.x*p,E,!1,p,x),this.addHalfVertex(a,L,R,E,!0,-b,x),this.distance>lb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,d,p,b,x,E))}addHalfVertex(a,d,p,b,x,E,L){let{x:R,y:D}=a;const U=.5*(this.lineClips?this.scaledDistance*(lb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((R<<1)+(b?1:0),(D<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(E===0?0:E<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),L.primitiveLength++),x?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,d){this.distance+=a.dist(d),this.updateScaledDistance()}}let cb,hb;Ve("LineBucket",p0,{omit:["layers","patternFeatures"]});var ub={get paint(){return hb=hb||new m({"line-opacity":new fi(it.paint_line["line-opacity"]),"line-color":new fi(it.paint_line["line-color"]),"line-translate":new Ye(it.paint_line["line-translate"]),"line-translate-anchor":new Ye(it.paint_line["line-translate-anchor"]),"line-width":new fi(it.paint_line["line-width"]),"line-gap-width":new fi(it.paint_line["line-gap-width"]),"line-offset":new fi(it.paint_line["line-offset"]),"line-blur":new fi(it.paint_line["line-blur"]),"line-dasharray":new w(it.paint_line["line-dasharray"]),"line-pattern":new Nc(it.paint_line["line-pattern"]),"line-gradient":new M(it.paint_line["line-gradient"])})},get layout(){return cb=cb||new m({"line-cap":new Ye(it.layout_line["line-cap"]),"line-join":new fi(it.layout_line["line-join"]),"line-miter-limit":new Ye(it.layout_line["line-miter-limit"]),"line-round-limit":new Ye(it.layout_line["line-round-limit"]),"line-sort-key":new fi(it.layout_line["line-sort-key"])})}};class dC extends fi{possiblyEvaluate(a,d){return d=new br(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(a,d)}evaluate(a,d,p,b){return d=Mt({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(a,d,p,b)}}let Jf;class pC extends u{constructor(a){super(a,ub),this.gradientVersion=0,Jf||(Jf=new dC(ub.paint.properties["line-width"].specification),Jf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof oi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,d){super.recalculate(a,d),this.paint._values["line-floorwidth"]=Jf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new p0(a)}queryRadius(a){const d=a,p=db(_p("line-width",this,d),_p("line-gap-width",this,d)),b=_p("line-offset",this,d);return p/2+Math.abs(b)+Hf(this.paint.get("line-translate"))}queryIntersectsFeature(a,d,p,b,x,E,L){const R=Wf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,L),D=L/2*db(this.paint.get("line-width").evaluate(d,p),this.paint.get("line-gap-width").evaluate(d,p)),U=this.paint.get("line-offset").evaluate(d,p);return U&&(b=function(V,J){const tt=[];for(let st=0;st<V.length;st++){const dt=V[st],wt=[];for(let Pt=0;Pt<dt.length;Pt++){const Zt=dt[Pt-1],Nt=dt[Pt],Vt=dt[Pt+1],se=Pt===0?new T(0,0):Nt.sub(Zt)._unit()._perp(),Te=Pt===dt.length-1?new T(0,0):Vt.sub(Nt)._unit()._perp(),Ge=se._add(Te)._unit(),mi=Ge.x*Te.x+Ge.y*Te.y;mi!==0&&Ge._mult(1/mi),wt.push(Ge._mult(J)._add(Nt))}tt.push(wt)}return tt}(b,U*L)),function(V,J,tt){for(let st=0;st<J.length;st++){const dt=J[st];if(V.length>=3){for(let wt=0;wt<dt.length;wt++)if(nc(V,dt[wt]))return!0}if(rc(V,dt,tt))return!0}return!1}(R,b,D)}isTileClipped(){return!0}}function db(h,a){return a>0?a+2*h:h}const fC=A([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mC=A([{name:"a_projected_pos",components:3,type:"Float32"}],4);A([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gC=A([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);A([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const pb=A([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_C=A([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yC(h,a,d){return h.sections.forEach(p=>{p.text=function(b,x,E){const L=x.layout.get("text-transform").evaluate(E,{});return L==="uppercase"?b=b.toLocaleUpperCase():L==="lowercase"&&(b=b.toLocaleLowerCase()),Ts.applyArabicShaping&&(b=Ts.applyArabicShaping(b)),b}(p.text,a,d)}),h}A([{name:"triangle",components:3,type:"Uint16"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),A([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),A([{type:"Float32",name:"offsetX"}]),A([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),A([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ep={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Mn=24,fb=xr,mb=function(h,a,d,p,b){var x,E,L=8*b-p-1,R=(1<<L)-1,D=R>>1,U=-7,V=b-1,J=-1,tt=h[a+V];for(V+=J,x=tt&(1<<-U)-1,tt>>=-U,U+=L;U>0;x=256*x+h[a+V],V+=J,U-=8);for(E=x&(1<<-U)-1,x>>=-U,U+=p;U>0;E=256*E+h[a+V],V+=J,U-=8);if(x===0)x=1-D;else{if(x===R)return E?NaN:1/0*(tt?-1:1);E+=Math.pow(2,p),x-=D}return(tt?-1:1)*E*Math.pow(2,x-p)},gb=function(h,a,d,p,b,x){var E,L,R,D=8*x-b-1,U=(1<<D)-1,V=U>>1,J=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,tt=0,st=1,dt=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(L=isNaN(a)?1:0,E=U):(E=Math.floor(Math.log(a)/Math.LN2),a*(R=Math.pow(2,-E))<1&&(E--,R*=2),(a+=E+V>=1?J/R:J*Math.pow(2,1-V))*R>=2&&(E++,R/=2),E+V>=U?(L=0,E=U):E+V>=1?(L=(a*R-1)*Math.pow(2,b),E+=V):(L=a*Math.pow(2,V-1)*Math.pow(2,b),E=0));b>=8;h[d+tt]=255&L,tt+=st,L/=256,b-=8);for(E=E<<b|L,D+=b;D>0;h[d+tt]=255&E,tt+=st,E/=256,D-=8);h[d+tt-st]|=128*dt};function xr(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}xr.Varint=0,xr.Fixed64=1,xr.Bytes=2,xr.Fixed32=5;var f0=4294967296,_b=1/f0,yb=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function qc(h){return h.type===xr.Bytes?h.readVarint()+h.pos:h.pos+1}function vC(h,a,d){return d?4294967296*a+(h>>>0):4294967296*(a>>>0)+(h>>>0)}function vb(h,a,d){var p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));d.realloc(p);for(var b=d.pos-1;b>=h;b--)d.buf[b+p]=d.buf[b]}function bC(h,a){for(var d=0;d<h.length;d++)a.writeVarint(h[d])}function xC(h,a){for(var d=0;d<h.length;d++)a.writeSVarint(h[d])}function wC(h,a){for(var d=0;d<h.length;d++)a.writeFloat(h[d])}function SC(h,a){for(var d=0;d<h.length;d++)a.writeDouble(h[d])}function AC(h,a){for(var d=0;d<h.length;d++)a.writeBoolean(h[d])}function EC(h,a){for(var d=0;d<h.length;d++)a.writeFixed32(h[d])}function TC(h,a){for(var d=0;d<h.length;d++)a.writeSFixed32(h[d])}function CC(h,a){for(var d=0;d<h.length;d++)a.writeFixed64(h[d])}function PC(h,a){for(var d=0;d<h.length;d++)a.writeSFixed64(h[d])}function Kf(h,a){return(h[a]|h[a+1]<<8|h[a+2]<<16)+16777216*h[a+3]}function ad(h,a,d){h[d]=a,h[d+1]=a>>>8,h[d+2]=a>>>16,h[d+3]=a>>>24}function bb(h,a){return(h[a]|h[a+1]<<8|h[a+2]<<16)+(h[a+3]<<24)}xr.prototype={destroy:function(){this.buf=null},readFields:function(h,a,d){for(d=d||this.length;this.pos<d;){var p=this.readVarint(),b=p>>3,x=this.pos;this.type=7&p,h(b,a,this),this.pos===x&&this.skip(p)}return a},readMessage:function(h,a){return this.readFields(h,a,this.readVarint()+this.pos)},readFixed32:function(){var h=Kf(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=bb(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Kf(this.buf,this.pos)+Kf(this.buf,this.pos+4)*f0;return this.pos+=8,h},readSFixed64:function(){var h=Kf(this.buf,this.pos)+bb(this.buf,this.pos+4)*f0;return this.pos+=8,h},readFloat:function(){var h=mb(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=mb(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var a,d,p=this.buf;return a=127&(d=p[this.pos++]),d<128?a:(a|=(127&(d=p[this.pos++]))<<7,d<128?a:(a|=(127&(d=p[this.pos++]))<<14,d<128?a:(a|=(127&(d=p[this.pos++]))<<21,d<128?a:function(b,x,E){var L,R,D=E.buf;if(L=(112&(R=D[E.pos++]))>>4,R<128||(L|=(127&(R=D[E.pos++]))<<3,R<128)||(L|=(127&(R=D[E.pos++]))<<10,R<128)||(L|=(127&(R=D[E.pos++]))<<17,R<128)||(L|=(127&(R=D[E.pos++]))<<24,R<128)||(L|=(1&(R=D[E.pos++]))<<31,R<128))return vC(b,L,x);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(d=p[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,a=this.pos;return this.pos=h,h-a>=12&&yb?function(d,p,b){return yb.decode(d.subarray(p,b))}(this.buf,a,h):function(d,p,b){for(var x="",E=p;E<b;){var L,R,D,U=d[E],V=null,J=U>239?4:U>223?3:U>191?2:1;if(E+J>b)break;J===1?U<128&&(V=U):J===2?(192&(L=d[E+1]))==128&&(V=(31&U)<<6|63&L)<=127&&(V=null):J===3?(R=d[E+2],(192&(L=d[E+1]))==128&&(192&R)==128&&((V=(15&U)<<12|(63&L)<<6|63&R)<=2047||V>=55296&&V<=57343)&&(V=null)):J===4&&(R=d[E+2],D=d[E+3],(192&(L=d[E+1]))==128&&(192&R)==128&&(192&D)==128&&((V=(15&U)<<18|(63&L)<<12|(63&R)<<6|63&D)<=65535||V>=1114112)&&(V=null)),V===null?(V=65533,J=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),E+=J}return x}(this.buf,a,h)},readBytes:function(){var h=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,h);return this.pos=h,a},readPackedVarint:function(h,a){if(this.type!==xr.Bytes)return h.push(this.readVarint(a));var d=qc(this);for(h=h||[];this.pos<d;)h.push(this.readVarint(a));return h},readPackedSVarint:function(h){if(this.type!==xr.Bytes)return h.push(this.readSVarint());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==xr.Bytes)return h.push(this.readBoolean());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==xr.Bytes)return h.push(this.readFloat());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==xr.Bytes)return h.push(this.readDouble());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==xr.Bytes)return h.push(this.readFixed32());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==xr.Bytes)return h.push(this.readSFixed32());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==xr.Bytes)return h.push(this.readFixed64());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==xr.Bytes)return h.push(this.readSFixed64());var a=qc(this);for(h=h||[];this.pos<a;)h.push(this.readSFixed64());return h},skip:function(h){var a=7&h;if(a===xr.Varint)for(;this.buf[this.pos++]>127;);else if(a===xr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===xr.Fixed32)this.pos+=4;else{if(a!==xr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(h,a){this.writeVarint(h<<3|a)},realloc:function(h){for(var a=this.length||16;a<this.pos+h;)a*=2;if(a!==this.length){var d=new Uint8Array(a);d.set(this.buf),this.buf=d,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),ad(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),ad(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),ad(this.buf,-1&h,this.pos),ad(this.buf,Math.floor(h*_b),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),ad(this.buf,-1&h,this.pos),ad(this.buf,Math.floor(h*_b),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(a,d){var p,b;if(a>=0?(p=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(p=~(-a%4294967296))?p=p+1|0:(p=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(x,E,L){L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,x>>>=7,L.buf[L.pos++]=127&x|128,L.buf[L.pos]=127&(x>>>=7)}(p,0,d),function(x,E){var L=(7&x)<<4;E.buf[E.pos++]|=L|((x>>>=3)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x)))))}(b,d)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var a=this.pos;this.pos=function(p,b,x){for(var E,L,R=0;R<b.length;R++){if((E=b.charCodeAt(R))>55295&&E<57344){if(!L){E>56319||R+1===b.length?(p[x++]=239,p[x++]=191,p[x++]=189):L=E;continue}if(E<56320){p[x++]=239,p[x++]=191,p[x++]=189,L=E;continue}E=L-55296<<10|E-56320|65536,L=null}else L&&(p[x++]=239,p[x++]=191,p[x++]=189,L=null);E<128?p[x++]=E:(E<2048?p[x++]=E>>6|192:(E<65536?p[x++]=E>>12|224:(p[x++]=E>>18|240,p[x++]=E>>12&63|128),p[x++]=E>>6&63|128),p[x++]=63&E|128)}return x}(this.buf,h,this.pos);var d=this.pos-a;d>=128&&vb(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeFloat:function(h){this.realloc(4),gb(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),gb(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var a=h.length;this.writeVarint(a),this.realloc(a);for(var d=0;d<a;d++)this.buf[this.pos++]=h[d]},writeRawMessage:function(h,a){this.pos++;var d=this.pos;h(a,this);var p=this.pos-d;p>=128&&vb(d,p,this),this.pos=d-1,this.writeVarint(p),this.pos+=p},writeMessage:function(h,a,d){this.writeTag(h,xr.Bytes),this.writeRawMessage(a,d)},writePackedVarint:function(h,a){a.length&&this.writeMessage(h,bC,a)},writePackedSVarint:function(h,a){a.length&&this.writeMessage(h,xC,a)},writePackedBoolean:function(h,a){a.length&&this.writeMessage(h,AC,a)},writePackedFloat:function(h,a){a.length&&this.writeMessage(h,wC,a)},writePackedDouble:function(h,a){a.length&&this.writeMessage(h,SC,a)},writePackedFixed32:function(h,a){a.length&&this.writeMessage(h,EC,a)},writePackedSFixed32:function(h,a){a.length&&this.writeMessage(h,TC,a)},writePackedFixed64:function(h,a){a.length&&this.writeMessage(h,CC,a)},writePackedSFixed64:function(h,a){a.length&&this.writeMessage(h,PC,a)},writeBytesField:function(h,a){this.writeTag(h,xr.Bytes),this.writeBytes(a)},writeFixed32Field:function(h,a){this.writeTag(h,xr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(h,a){this.writeTag(h,xr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(h,a){this.writeTag(h,xr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(h,a){this.writeTag(h,xr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(h,a){this.writeTag(h,xr.Varint),this.writeVarint(a)},writeSVarintField:function(h,a){this.writeTag(h,xr.Varint),this.writeSVarint(a)},writeStringField:function(h,a){this.writeTag(h,xr.Bytes),this.writeString(a)},writeFloatField:function(h,a){this.writeTag(h,xr.Fixed32),this.writeFloat(a)},writeDoubleField:function(h,a){this.writeTag(h,xr.Fixed64),this.writeDouble(a)},writeBooleanField:function(h,a){this.writeVarintField(h,!!a)}};var m0=_(fb);const g0=3;function IC(h,a,d){h===1&&d.readMessage(LC,a)}function LC(h,a,d){if(h===3){const{id:p,bitmap:b,width:x,height:E,left:L,top:R,advance:D}=d.readMessage(MC,{});a.push({id:p,bitmap:new vp({width:x+2*g0,height:E+2*g0},b),metrics:{width:x,height:E,left:L,top:R,advance:D}})}}function MC(h,a,d){h===1?a.id=d.readVarint():h===2?a.bitmap=d.readBytes():h===3?a.width=d.readVarint():h===4?a.height=d.readVarint():h===5?a.left=d.readSVarint():h===6?a.top=d.readSVarint():h===7&&(a.advance=d.readVarint())}const xb=g0;function wb(h){let a=0,d=0;for(const E of h)a+=E.w*E.h,d=Math.max(d,E.w);h.sort((E,L)=>L.h-E.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),d),h:1/0}];let b=0,x=0;for(const E of h)for(let L=p.length-1;L>=0;L--){const R=p[L];if(!(E.w>R.w||E.h>R.h)){if(E.x=R.x,E.y=R.y,x=Math.max(x,E.y+E.h),b=Math.max(b,E.x+E.w),E.w===R.w&&E.h===R.h){const D=p.pop();L<p.length&&(p[L]=D)}else E.h===R.h?(R.x+=E.w,R.w-=E.w):E.w===R.w?(R.y+=E.h,R.h-=E.h):(p.push({x:R.x+E.w,y:R.y,w:R.w-E.w,h:E.h}),R.y+=E.h,R.h-=E.h);break}}return{w:b,h:x,fill:a/(b*x)||0}}const xo=1;class _0{constructor(a,d){let{pixelRatio:p,version:b,stretchX:x,stretchY:E,content:L,textFitWidth:R,textFitHeight:D}=d;this.paddedRect=a,this.pixelRatio=p,this.stretchX=x,this.stretchY=E,this.content=L,this.version=b,this.textFitWidth=R,this.textFitHeight=D}get tl(){return[this.paddedRect.x+xo,this.paddedRect.y+xo]}get br(){return[this.paddedRect.x+this.paddedRect.w-xo,this.paddedRect.y+this.paddedRect.h-xo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*xo)/this.pixelRatio,(this.paddedRect.h-2*xo)/this.pixelRatio]}}class Sb{constructor(a,d){const p={},b={};this.haveRenderCallbacks=[];const x=[];this.addImages(a,p,x),this.addImages(d,b,x);const{w:E,h:L}=wb(x),R=new la({width:E||1,height:L||1});for(const D in a){const U=a[D],V=p[D].paddedRect;la.copy(U.data,R,{x:0,y:0},{x:V.x+xo,y:V.y+xo},U.data)}for(const D in d){const U=d[D],V=b[D].paddedRect,J=V.x+xo,tt=V.y+xo,st=U.data.width,dt=U.data.height;la.copy(U.data,R,{x:0,y:0},{x:J,y:tt},U.data),la.copy(U.data,R,{x:0,y:dt-1},{x:J,y:tt-1},{width:st,height:1}),la.copy(U.data,R,{x:0,y:0},{x:J,y:tt+dt},{width:st,height:1}),la.copy(U.data,R,{x:st-1,y:0},{x:J-1,y:tt},{width:1,height:dt}),la.copy(U.data,R,{x:0,y:0},{x:J+st,y:tt},{width:1,height:dt})}this.image=R,this.iconPositions=p,this.patternPositions=b}addImages(a,d,p){for(const b in a){const x=a[b],E={x:0,y:0,w:x.data.width+2*xo,h:x.data.height+2*xo};p.push(E),d[b]=new _0(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,d){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),d),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),d)}patchUpdatedImage(a,d,p){if(!a||!d||a.version===d.version)return;a.version=d.version;const[b,x]=a.tl;p.update(d.data,void 0,{x:b,y:x})}}var Sh;Ve("ImagePosition",_0),Ve("ImageAtlas",Sb),c.ah=void 0,(Sh=c.ah||(c.ah={}))[Sh.none=0]="none",Sh[Sh.horizontal=1]="horizontal",Sh[Sh.vertical=2]="vertical",Sh[Sh.horizontalOnly=3]="horizontalOnly";const Tp=-17;class Cp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,d){const p=new Cp;return p.scale=a||1,p.fontStack=d,p}static forImage(a){const d=new Cp;return d.imageName=a,d}}class ld{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,d){const p=new ld;for(let b=0;b<a.sections.length;b++){const x=a.sections[b];x.image?p.addImageSection(x):p.addTextSection(x,d)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let d="";for(let p=0;p<a.length;p++){const b=a.charCodeAt(p+1)||null,x=a.charCodeAt(p-1)||null;d+=b&&Fc(b)&&!Ep[a[p+1]]||x&&Fc(x)&&!Ep[a[p-1]]||!Ep[a[p]]?a[p]:Ep[a[p]]}return d}(this.text)}trim(){let a=0;for(let p=0;p<this.text.length&&tm[this.text.charCodeAt(p)];p++)a++;let d=this.text.length;for(let p=this.text.length-1;p>=0&&p>=a&&tm[this.text.charCodeAt(p)];p--)d--;this.text=this.text.substring(a,d),this.sectionIndex=this.sectionIndex.slice(a,d)}substring(a,d){const p=new ld;return p.text=this.text.substring(a,d),p.sectionIndex=this.sectionIndex.slice(a,d),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,d)=>Math.max(a,this.sections[d].scale),0)}addTextSection(a,d){this.text+=a.text,this.sections.push(Cp.forText(a.scale,a.fontStack||d));const p=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(p)}addImageSection(a){const d=a.image?a.image.name:"";if(d.length===0)return void Lt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Cp.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Lt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qf(h,a,d,p,b,x,E,L,R,D,U,V,J,tt,st){const dt=ld.fromFeature(h,b);let wt;V===c.ah.vertical&&dt.verticalizePunctuation();const{processBidirectionalText:Pt,processStyledBidirectionalText:Zt}=Ts;if(Pt&&dt.sections.length===1){wt=[];const se=Pt(dt.toString(),y0(dt,D,x,a,p,tt));for(const Te of se){const Ge=new ld;Ge.text=Te,Ge.sections=dt.sections;for(let mi=0;mi<Te.length;mi++)Ge.sectionIndex.push(0);wt.push(Ge)}}else if(Zt){wt=[];const se=Zt(dt.text,dt.sectionIndex,y0(dt,D,x,a,p,tt));for(const Te of se){const Ge=new ld;Ge.text=Te[0],Ge.sectionIndex=Te[1],Ge.sections=dt.sections,wt.push(Ge)}}else wt=function(se,Te){const Ge=[],mi=se.text;let je=0;for(const Oe of Te)Ge.push(se.substring(je,Oe)),je=Oe;return je<mi.length&&Ge.push(se.substring(je,mi.length)),Ge}(dt,y0(dt,D,x,a,p,tt));const Nt=[],Vt={positionedLines:Nt,text:dt.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:V,iconsInText:!1,verticalizable:!1};return function(se,Te,Ge,mi,je,Oe,ri,Xe,qe,fe,ni,ti){let Ei=0,Pr=Tp,wr=0,Gn=0;const Ua=Xe==="right"?1:Xe==="left"?0:.5;let ds=0;for(const hn of je){hn.trim();const qn=hn.getMaxScale(),Ls=(qn-1)*Mn,ps={positionedGlyphs:[],lineOffset:0};se.positionedLines[ds]=ps;const Zs=ps.positionedGlyphs;let fs=0;if(!hn.length()){Pr+=Oe,++ds;continue}for(let wo=0;wo<hn.length();wo++){const or=hn.getSection(wo),Dr=hn.getSectionIndex(wo),Ur=hn.getCharCode(wo);let zo=0,on=null,dd=null,oc=null,ac=Mn;const Ga=!(qe===c.ah.horizontal||!ni&&!au(Ur)||ni&&(tm[Ur]||(Vn=Ur,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Vn)))));if(or.imageName){const ua=mi[or.imageName];if(!ua)continue;oc=or.imageName,se.iconsInText=se.iconsInText||!0,dd=ua.paddedRect;const rs=ua.displaySize;or.scale=or.scale*Mn/ti,on={width:rs[0],height:rs[1],left:xo,top:-xb,advance:Ga?rs[1]:rs[0]},zo=Ls+(Mn-rs[1]*or.scale),ac=on.advance;const Hc=Ga?rs[0]*or.scale-Mn*qn:rs[1]*or.scale-Mn*qn;Hc>0&&Hc>fs&&(fs=Hc)}else{const ua=Ge[or.fontStack],rs=ua&&ua[Ur];if(rs&&rs.rect)dd=rs.rect,on=rs.metrics;else{const Hc=Te[or.fontStack],Rp=Hc&&Hc[Ur];if(!Rp)continue;on=Rp.metrics}zo=(qn-or.scale)*Mn}Ga?(se.verticalizable=!0,Zs.push({glyph:Ur,imageName:oc,x:Ei,y:Pr+zo,vertical:Ga,scale:or.scale,fontStack:or.fontStack,sectionIndex:Dr,metrics:on,rect:dd}),Ei+=ac*or.scale+fe):(Zs.push({glyph:Ur,imageName:oc,x:Ei,y:Pr+zo,vertical:Ga,scale:or.scale,fontStack:or.fontStack,sectionIndex:Dr,metrics:on,rect:dd}),Ei+=on.advance*or.scale+fe)}Zs.length!==0&&(wr=Math.max(Ei-fe,wr),FC(Zs,0,Zs.length-1,Ua,fs)),Ei=0;const ha=Oe*qn+fs;ps.lineOffset=Math.max(fs,Ls),Pr+=ha,Gn=Math.max(ha,Gn),++ds}var Vn;const Hs=Pr-Tp,{horizontalAlign:Ws,verticalAlign:Xs}=v0(ri);(function(hn,qn,Ls,ps,Zs,fs,ha,wo,or){const Dr=(qn-Ls)*Zs;let Ur=0;Ur=fs!==ha?-wo*ps-Tp:(-ps*or+.5)*ha;for(const zo of hn)for(const on of zo.positionedGlyphs)on.x+=Dr,on.y+=Ur})(se.positionedLines,Ua,Ws,Xs,wr,Gn,Oe,Hs,je.length),se.top+=-Xs*Hs,se.bottom=se.top+Hs,se.left+=-Ws*wr,se.right=se.left+wr}(Vt,a,d,p,wt,E,L,R,V,D,J,st),!function(se){for(const Te of se)if(Te.positionedGlyphs.length!==0)return!1;return!0}(Nt)&&Vt}const tm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},BC={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},RC={40:!0};function Ab(h,a,d,p,b,x){if(a.imageName){const E=p[a.imageName];return E?E.displaySize[0]*a.scale*Mn/x+b:0}{const E=d[a.fontStack],L=E&&E[h];return L?L.metrics.advance*a.scale+b:0}}function Eb(h,a,d,p){const b=Math.pow(h-a,2);return p?h<a?b/2:2*b:b+Math.abs(d)*d}function kC(h,a,d){let p=0;return h===10&&(p-=1e4),d&&(p+=150),h!==40&&h!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function Tb(h,a,d,p,b,x){let E=null,L=Eb(a,d,b,x);for(const R of p){const D=Eb(a-R.x,d,b,x)+R.badness;D<=L&&(E=R,L=D)}return{index:h,x:a,priorBreak:E,badness:L}}function Cb(h){return h?Cb(h.priorBreak).concat(h.index):[]}function y0(h,a,d,p,b,x){if(!h)return[];const E=[],L=function(V,J,tt,st,dt,wt){let Pt=0;for(let Zt=0;Zt<V.length();Zt++){const Nt=V.getSection(Zt);Pt+=Ab(V.getCharCode(Zt),Nt,st,dt,J,wt)}return Pt/Math.max(1,Math.ceil(Pt/tt))}(h,a,d,p,b,x),R=h.text.indexOf("")>=0;let D=0;for(let V=0;V<h.length();V++){const J=h.getSection(V),tt=h.getCharCode(V);if(tm[tt]||(D+=Ab(tt,J,p,b,a,x)),V<h.length()-1){const st=!((U=tt)<11904)&&(!!Ti["CJK Compatibility Forms"](U)||!!Ti["CJK Compatibility"](U)||!!Ti["CJK Strokes"](U)||!!Ti["CJK Symbols and Punctuation"](U)||!!Ti["Enclosed CJK Letters and Months"](U)||!!Ti["Halfwidth and Fullwidth Forms"](U)||!!Ti["Ideographic Description Characters"](U)||!!Ti["Vertical Forms"](U)||ou.test(String.fromCodePoint(U)));(BC[tt]||st||J.imageName||V!==h.length()-2&&RC[h.getCharCode(V+1)])&&E.push(Tb(V+1,D,L,E,kC(tt,h.getCharCode(V+1),st&&R),!1))}}var U;return Cb(Tb(h.length(),D,L,E,0,!0))}function v0(h){let a=.5,d=.5;switch(h){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:a,verticalAlign:d}}function FC(h,a,d,p,b){if(!p&&!b)return;const x=h[d],E=(h[d].x+x.metrics.advance*x.scale)*p;for(let L=a;L<=d;L++)h[L].x-=E,h[L].y+=b}function DC(h,a,d){const{horizontalAlign:p,verticalAlign:b}=v0(d),x=a[0]-h.displaySize[0]*p,E=a[1]-h.displaySize[1]*b;return{image:h,top:E,bottom:E+h.displaySize[1],left:x,right:x+h.displaySize[0]}}function Pb(h){var a,d;let p=h.left,b=h.top,x=h.right-p,E=h.bottom-b;const L=(a=h.image.textFitWidth)!==null&&a!==void 0?a:"stretchOrShrink",R=(d=h.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",D=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(R==="proportional"){if(L==="stretchOnly"&&x/E<D||L==="proportional"){const U=Math.ceil(E*D);p*=U/x,x=U}}else if(L==="proportional"&&R==="stretchOnly"&&D!==0&&x/E>D){const U=Math.ceil(x/D);b*=U/E,E=U}return{x1:p,y1:b,x2:p+x,y2:b+E}}function Ib(h,a,d,p,b,x){const E=h.image;let L;if(E.content){const wt=E.content,Pt=E.pixelRatio||1;L=[wt[0]/Pt,wt[1]/Pt,E.displaySize[0]-wt[2]/Pt,E.displaySize[1]-wt[3]/Pt]}const R=a.left*x,D=a.right*x;let U,V,J,tt;d==="width"||d==="both"?(tt=b[0]+R-p[3],V=b[0]+D+p[1]):(tt=b[0]+(R+D-E.displaySize[0])/2,V=tt+E.displaySize[0]);const st=a.top*x,dt=a.bottom*x;return d==="height"||d==="both"?(U=b[1]+st-p[0],J=b[1]+dt+p[2]):(U=b[1]+(st+dt-E.displaySize[1])/2,J=U+E.displaySize[1]),{image:E,top:U,right:V,bottom:J,left:tt,collisionPadding:L}}const Pp=255,sc=128,Ah=Pp*sc;function Lb(h,a){const{expression:d}=a;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new br(h+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:b}=d;let x=0;for(;x<p.length&&p[x]<=h;)x++;x=Math.max(0,x-1);let E=x;for(;E<p.length&&p[E]<h+1;)E++;E=Math.min(p.length-1,E);const L=p[x],R=p[E];return d.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:R,interpolationType:b}:{kind:"camera",minZoom:L,maxZoom:R,minSize:d.evaluate(new br(L)),maxSize:d.evaluate(new br(R)),interpolationType:b}}}function b0(h,a,d){let p="never";const b=h.get(a);return b?p=b:h.get(d)&&(p="always"),p}const OC=wh.VectorTileFeature.types,NC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function em(h,a,d,p,b,x,E,L,R,D,U,V,J){const tt=L?Math.min(Ah,Math.round(L[0])):0,st=L?Math.min(Ah,Math.round(L[1])):0;h.emplaceBack(a,d,Math.round(32*p),Math.round(32*b),x,E,(tt<<1)+(R?1:0),st,16*D,16*U,256*V,256*J)}function x0(h,a,d){h.emplaceBack(a.x,a.y,d),h.emplaceBack(a.x,a.y,d),h.emplaceBack(a.x,a.y,d),h.emplaceBack(a.x,a.y,d)}function zC(h){for(const a of h.sections)if($u(a.text))return!0;return!1}class w0{constructor(a){this.layoutVertexArray=new zc,this.indexArray=new jn,this.programConfigurations=a,this.segments=new qi,this.dynamicLayoutVertexArray=new Kl,this.opacityVertexArray=new zn,this.hasVisibleVertices=!1,this.placedSymbolArray=new wi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,d,p,b){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,fC.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,mC.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,NC,!0),this.opacityVertexBuffer.itemSize=1),(p||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ve("SymbolBuffers",w0);class S0{constructor(a,d,p){this.layoutVertexArray=new a,this.layoutAttributes=d,this.indexArray=new p,this.segments=new qi,this.collisionVertexArray=new wn}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,gC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ve("CollisionBuffers",S0);class cd{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(E=>E.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=i0([]),this.placementViewportMatrix=i0([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lb(this.zoom,d["text-size"]),this.iconSizeData=Lb(this.zoom,d["icon-size"]);const p=this.layers[0].layout,b=p.get("symbol-sort-key"),x=p.get("symbol-z-order");this.canOverlap=b0(p,"text-overlap","text-allow-overlap")!=="never"||b0(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(E=>c.ah[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=a.sourceID}createArrays(){this.text=new w0(new ec(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new w0(new ec(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new ki,this.lineVertexArray=new nr,this.symbolInstances=new Ai,this.textAnchorOffsets=new Ki}calculateGlyphDependencies(a,d,p,b,x){for(let E=0;E<a.length;E++)if(d[a.charCodeAt(E)]=!0,(p||b)&&x){const L=Ep[a.charAt(E)];L&&(d[L.charCodeAt(0)]=!0)}}populate(a,d,p){const b=this.layers[0],x=b.layout,E=x.get("text-font"),L=x.get("text-field"),R=x.get("icon-image"),D=(L.value.kind!=="constant"||L.value.value instanceof Ir&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),U=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,V=x.get("symbol-sort-key");if(this.features=[],!D&&!U)return;const J=d.iconDependencies,tt=d.glyphDependencies,st=d.availableImages,dt=new br(this.zoom);for(const{feature:wt,id:Pt,index:Zt,sourceLayerIndex:Nt}of a){const Vt=b._featureFilter.needGeometry,se=ic(wt,Vt);if(!b._featureFilter.filter(dt,se,p))continue;let Te,Ge;if(Vt||(se.geometry=Gc(wt)),D){const je=b.getValueAndResolveTokens("text-field",se,p,st),Oe=Ir.factory(je),ri=this.hasRTLText=this.hasRTLText||zC(Oe);(!ri||Ts.getRTLTextPluginStatus()==="unavailable"||ri&&Ts.isParsed())&&(Te=yC(Oe,b,se))}if(U){const je=b.getValueAndResolveTokens("icon-image",se,p,st);Ge=je instanceof Er?je:Er.fromString(je)}if(!Te&&!Ge)continue;const mi=this.sortFeaturesByKey?V.evaluate(se,{},p):void 0;if(this.features.push({id:Pt,text:Te,icon:Ge,index:Zt,sourceLayerIndex:Nt,geometry:se.geometry,properties:wt.properties,type:OC[wt.type],sortKey:mi}),Ge&&(J[Ge.name]=!0),Te){const je=E.evaluate(se,{},p).join(","),Oe=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const ri of Te.sections)if(ri.image)J[ri.image.name]=!0;else{const Xe=su(Te.toString()),qe=ri.fontStack||je,fe=tt[qe]=tt[qe]||{};this.calculateGlyphDependencies(ri.text,fe,Oe,this.allowVerticalPlacement,Xe)}}}x.get("symbol-placement")==="line"&&(this.features=function(wt){const Pt={},Zt={},Nt=[];let Vt=0;function se(je){Nt.push(wt[je]),Vt++}function Te(je,Oe,ri){const Xe=Zt[je];return delete Zt[je],Zt[Oe]=Xe,Nt[Xe].geometry[0].pop(),Nt[Xe].geometry[0]=Nt[Xe].geometry[0].concat(ri[0]),Xe}function Ge(je,Oe,ri){const Xe=Pt[Oe];return delete Pt[Oe],Pt[je]=Xe,Nt[Xe].geometry[0].shift(),Nt[Xe].geometry[0]=ri[0].concat(Nt[Xe].geometry[0]),Xe}function mi(je,Oe,ri){const Xe=ri?Oe[0][Oe[0].length-1]:Oe[0][0];return`${je}:${Xe.x}:${Xe.y}`}for(let je=0;je<wt.length;je++){const Oe=wt[je],ri=Oe.geometry,Xe=Oe.text?Oe.text.toString():null;if(!Xe){se(je);continue}const qe=mi(Xe,ri),fe=mi(Xe,ri,!0);if(qe in Zt&&fe in Pt&&Zt[qe]!==Pt[fe]){const ni=Ge(qe,fe,ri),ti=Te(qe,fe,Nt[ni].geometry);delete Pt[qe],delete Zt[fe],Zt[mi(Xe,Nt[ti].geometry,!0)]=ti,Nt[ni].geometry=null}else qe in Zt?Te(qe,fe,ri):fe in Pt?Ge(qe,fe,ri):(se(je),Pt[qe]=Vt-1,Zt[fe]=Vt-1)}return Nt.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((wt,Pt)=>wt.sortKey-Pt.sortKey)}update(a,d,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,d,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,d,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,d){const p=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(d[a.segment+1]),x=a.dist(d[a.segment]);const E={};for(let L=a.segment+1;L<d.length;L++)E[L]={x:d[L].x,y:d[L].y,tileUnitDistanceFromAnchor:b},L<d.length-1&&(b+=d[L+1].dist(d[L]));for(let L=a.segment||0;L>=0;L--)E[L]={x:d[L].x,y:d[L].y,tileUnitDistanceFromAnchor:x},L>0&&(x+=d[L-1].dist(d[L]));for(let L=0;L<d.length;L++){const R=E[L];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(a,d,p,b,x,E,L,R,D,U,V,J){const tt=a.indexArray,st=a.layoutVertexArray,dt=a.segments.prepareSegment(4*d.length,st,tt,this.canOverlap?E.sortKey:void 0),wt=this.glyphOffsetArray.length,Pt=dt.vertexLength,Zt=this.allowVerticalPlacement&&L===c.ah.vertical?Math.PI/2:0,Nt=E.text&&E.text.sections;for(let Vt=0;Vt<d.length;Vt++){const{tl:se,tr:Te,bl:Ge,br:mi,tex:je,pixelOffsetTL:Oe,pixelOffsetBR:ri,minFontScaleX:Xe,minFontScaleY:qe,glyphOffset:fe,isSDF:ni,sectionIndex:ti}=d[Vt],Ei=dt.vertexLength,Pr=fe[1];em(st,R.x,R.y,se.x,Pr+se.y,je.x,je.y,p,ni,Oe.x,Oe.y,Xe,qe),em(st,R.x,R.y,Te.x,Pr+Te.y,je.x+je.w,je.y,p,ni,ri.x,Oe.y,Xe,qe),em(st,R.x,R.y,Ge.x,Pr+Ge.y,je.x,je.y+je.h,p,ni,Oe.x,ri.y,Xe,qe),em(st,R.x,R.y,mi.x,Pr+mi.y,je.x+je.w,je.y+je.h,p,ni,ri.x,ri.y,Xe,qe),x0(a.dynamicLayoutVertexArray,R,Zt),tt.emplaceBack(Ei,Ei+1,Ei+2),tt.emplaceBack(Ei+1,Ei+2,Ei+3),dt.vertexLength+=4,dt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(fe[0]),Vt!==d.length-1&&ti===d[Vt+1].sectionIndex||a.programConfigurations.populatePaintArrays(st.length,E,E.index,{},J,Nt&&Nt[ti])}a.placedSymbolArray.emplaceBack(R.x,R.y,wt,this.glyphOffsetArray.length-wt,Pt,D,U,R.segment,p?p[0]:0,p?p[1]:0,b[0],b[1],L,0,!1,0,V)}_addCollisionDebugVertex(a,d,p,b,x,E){return d.emplaceBack(0,0),a.emplaceBack(p.x,p.y,b,x,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(a,d,p,b,x,E,L){const R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),D=R.vertexLength,U=x.layoutVertexArray,V=x.collisionVertexArray,J=L.anchorX,tt=L.anchorY;this._addCollisionDebugVertex(U,V,E,J,tt,new T(a,d)),this._addCollisionDebugVertex(U,V,E,J,tt,new T(p,d)),this._addCollisionDebugVertex(U,V,E,J,tt,new T(p,b)),this._addCollisionDebugVertex(U,V,E,J,tt,new T(a,b)),R.vertexLength+=4;const st=x.indexArray;st.emplaceBack(D,D+1),st.emplaceBack(D+1,D+2),st.emplaceBack(D+2,D+3),st.emplaceBack(D+3,D),R.primitiveLength+=4}addDebugCollisionBoxes(a,d,p,b){for(let x=a;x<d;x++){const E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,b?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new S0(is,pb.members,Yr),this.iconCollisionBox=new S0(is,pb.members,Yr);for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(a,d,p,b,x,E,L,R,D){const U={};for(let V=d;V<p;V++){const J=a.get(V);U.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},U.textFeatureIndex=J.featureIndex;break}for(let V=b;V<x;V++){const J=a.get(V);U.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},U.verticalTextFeatureIndex=J.featureIndex;break}for(let V=E;V<L;V++){const J=a.get(V);U.iconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},U.iconFeatureIndex=J.featureIndex;break}for(let V=R;V<D;V++){const J=a.get(V);U.verticalIconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},U.verticalIconFeatureIndex=J.featureIndex;break}return U}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,d){const p=a.placedSymbolArray.get(d),b=p.vertexStartIndex+4*p.numGlyphs;for(let x=p.vertexStartIndex;x<b;x+=4)a.indexArray.emplaceBack(x,x+1,x+2),a.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(a),p=Math.cos(a),b=[],x=[],E=[];for(let L=0;L<this.symbolInstances.length;++L){E.push(L);const R=this.symbolInstances.get(L);b.push(0|Math.round(d*R.anchorX+p*R.anchorY)),x.push(R.featureIndex)}return E.sort((L,R)=>b[L]-b[R]||x[R]-x[L]),E}addToSortKeyRanges(a,d){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===d?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const p=this.symbolInstances.get(d);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((b,x,E)=>{b>=0&&E.indexOf(b)===x&&this.addIndicesForPlacedSymbol(this.text,b)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Mb,Bb;Ve("SymbolBucket",cd,{omit:["layers","collisionBoxArray","features","compareText"]}),cd.MAX_GLYPHS=65535,cd.addDynamicAttributes=x0;var A0={get paint(){return Bb=Bb||new m({"icon-opacity":new fi(it.paint_symbol["icon-opacity"]),"icon-color":new fi(it.paint_symbol["icon-color"]),"icon-halo-color":new fi(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new fi(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fi(it.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new fi(it.paint_symbol["text-opacity"]),"text-color":new fi(it.paint_symbol["text-color"],{runtimeType:Vi,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new fi(it.paint_symbol["text-halo-color"]),"text-halo-width":new fi(it.paint_symbol["text-halo-width"]),"text-halo-blur":new fi(it.paint_symbol["text-halo-blur"]),"text-translate":new Ye(it.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(it.paint_symbol["text-translate-anchor"])})},get layout(){return Mb=Mb||new m({"symbol-placement":new Ye(it.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fi(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(it.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(it.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new fi(it.layout_symbol["icon-size"]),"icon-text-fit":new Ye(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new fi(it.layout_symbol["icon-image"]),"icon-rotate":new fi(it.layout_symbol["icon-rotate"]),"icon-padding":new fi(it.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(it.layout_symbol["icon-keep-upright"]),"icon-offset":new fi(it.layout_symbol["icon-offset"]),"icon-anchor":new fi(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(it.layout_symbol["text-rotation-alignment"]),"text-field":new fi(it.layout_symbol["text-field"]),"text-font":new fi(it.layout_symbol["text-font"]),"text-size":new fi(it.layout_symbol["text-size"]),"text-max-width":new fi(it.layout_symbol["text-max-width"]),"text-line-height":new Ye(it.layout_symbol["text-line-height"]),"text-letter-spacing":new fi(it.layout_symbol["text-letter-spacing"]),"text-justify":new fi(it.layout_symbol["text-justify"]),"text-radial-offset":new fi(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(it.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new fi(it.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new fi(it.layout_symbol["text-anchor"]),"text-max-angle":new Ye(it.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(it.layout_symbol["text-writing-mode"]),"text-rotate":new fi(it.layout_symbol["text-rotate"]),"text-padding":new Ye(it.layout_symbol["text-padding"]),"text-keep-upright":new Ye(it.layout_symbol["text-keep-upright"]),"text-transform":new fi(it.layout_symbol["text-transform"]),"text-offset":new fi(it.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(it.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(it.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(it.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(it.layout_symbol["text-optional"])})}};class Rb{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:_r,this.defaultValue=a}evaluate(a){if(a.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(a.formattedSection))return d.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve("FormatSectionOverride",Rb,{omit:["defaultValue"]});class im extends u{constructor(a){super(a,A0)}recalculate(a,d){if(super.recalculate(a,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const b=[];for(const x of p)b.indexOf(x)<0&&b.push(x);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,d,p,b){const x=this.layout.get(a).evaluate(d,{},p,b),E=this._unevaluatedLayout._values[a];return E.isDataDriven()||go(E.value)||!x?x:function(L,R){return R.replace(/{([^{}]+)}/g,(D,U)=>L&&U in L?String(L[U]):"")}(d.properties,x)}createBucket(a){return new cd(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of A0.paint.overridableProperties){if(!im.hasPaintOverride(this.layout,a))continue;const d=this.paint.get(a),p=new Rb(d),b=new Ma(p,d.property.specification);let x=null;x=d.value.kind==="constant"||d.value.kind==="source"?new cs("source",b):new Os("composite",b,d.value.zoomStops),this.paint._values[a]=new vo(d.property,x,d.parameters)}}_handleOverridablePaintPropertyUpdate(a,d,p){return!(!this.layout||d.isDataDriven()||p.isDataDriven())&&im.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,d){const p=a.get("text-field"),b=A0.paint.properties[d];let x=!1;const E=L=>{for(const R of L)if(b.overrides&&b.overrides.hasOverride(R))return void(x=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Ir)E(p.value.value.sections);else if(p.value.kind==="source"){const L=D=>{x||(D instanceof un&&yr(D.value)===ir?E(D.value.sections):D instanceof Fl?E(D.sections):D.eachChild(L))},R=p.value;R._styleExpression&&L(R._styleExpression.expression)}return x}}let kb;var jC={get paint(){return kb=kb||new m({"background-color":new Ye(it.paint_background["background-color"]),"background-pattern":new w(it.paint_background["background-pattern"]),"background-opacity":new Ye(it.paint_background["background-opacity"])})}};class UC extends u{constructor(a){super(a,jC)}}let Fb;var GC={get paint(){return Fb=Fb||new m({"raster-opacity":new Ye(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(it.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(it.paint_raster["raster-saturation"]),"raster-contrast":new Ye(it.paint_raster["raster-contrast"]),"raster-resampling":new Ye(it.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(it.paint_raster["raster-fade-duration"])})}};class VC extends u{constructor(a){super(a,GC)}}class qC extends u{constructor(a){super(a,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class HC{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const E0=63710088e-1;class Eh{constructor(a,d){if(isNaN(a)||isNaN(d))throw new Error(`Invalid LngLat object: (${a}, ${d})`);if(this.lng=+a,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eh(Ft(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const d=Math.PI/180,p=this.lat*d,b=a.lat*d,x=Math.sin(p)*Math.sin(b)+Math.cos(p)*Math.cos(b)*Math.cos((a.lng-this.lng)*d);return E0*Math.acos(Math.min(x,1))}static convert(a){if(a instanceof Eh)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Eh(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Eh(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Db=2*Math.PI*E0;function Ob(h){return Db*Math.cos(h*Math.PI/180)}function Nb(h){return(180+h)/360}function zb(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function jb(h,a){return h/Ob(a)}function T0(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Ip{constructor(a,d){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+a,this.y=+d,this.z=+p}static fromLngLat(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const p=Eh.convert(a);return new Ip(Nb(p.lng),zb(p.lat),jb(d,p.lat))}toLngLat(){return new Eh(360*this.x-180,T0(this.y))}toAltitude(){return this.z*Ob(T0(this.y))}meterInMercatorCoordinateUnits(){return 1/Db*(a=T0(this.y),1/Math.cos(a*Math.PI/180));var a}}function Ub(h,a,d){var p=2*Math.PI*6378137/256/Math.pow(2,d);return[h*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}class C0{constructor(a,d,p){if(!function(b,x,E){return!(b<0||b>25||E<0||E>=Math.pow(2,b)||x<0||x>=Math.pow(2,b))}(a,d,p))throw new Error(`x=${d}, y=${p}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=d,this.y=p,this.key=Lp(0,a,a,d,p)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,d,p){const b=(E=this.y,L=this.z,R=Ub(256*(x=this.x),256*(E=Math.pow(2,L)-E-1),L),D=Ub(256*(x+1),256*(E+1),L),R[0]+","+R[1]+","+D[0]+","+D[1]);var x,E,L,R,D;const U=function(V,J,tt){let st,dt="";for(let wt=V;wt>0;wt--)st=1<<wt-1,dt+=(J&st?1:0)+(tt&st?2:0);return dt}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const d=this.z-a.z;return d>0&&a.x===this.x>>d&&a.y===this.y>>d}getTilePoint(a){const d=Math.pow(2,this.z);return new T((a.x*d-this.x)*Fr,(a.y*d-this.y)*Fr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gb{constructor(a,d){this.wrap=a,this.canonical=d,this.key=Lp(a,d.z,d.z,d.x,d.y)}}class ca{constructor(a,d,p,b,x){if(a<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${p}`);this.overscaledZ=a,this.wrap=d,this.canonical=new C0(p,+b,+x),this.key=Lp(d,a,p,b,x)}clone(){return new ca(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-a;return a>this.canonical.z?new ca(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ca(a,this.wrap,a,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(a,d){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-a;return a>this.canonical.z?Lp(this.wrap*+d,a,this.canonical.z,this.canonical.x,this.canonical.y):Lp(this.wrap*+d,a,a,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const d=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>d&&a.canonical.y===this.canonical.y>>d}children(a){if(this.overscaledZ>=a)return[new ca(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,p=2*this.canonical.x,b=2*this.canonical.y;return[new ca(d,this.wrap,d,p,b),new ca(d,this.wrap,d,p+1,b),new ca(d,this.wrap,d,p,b+1),new ca(d,this.wrap,d,p+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new ca(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new ca(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new Ip(a.x-this.wrap,a.y))}}function Lp(h,a,d,p,b){(h*=2)<0&&(h=-1*h-1);const x=1<<d;return(x*x*h+x*b+p).toString(36)+d.toString(36)+a.toString(36)}Ve("CanonicalTileID",C0),Ve("OverscaledTileID",ca,{omit:["posMatrix"]});class Vb{constructor(a,d,p){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,E=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,L=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=a,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void Lt(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const R=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=x,this.blueFactor=E,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<R;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(R,D)]=this.data[this._idx(R-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,R)]=this.data[this._idx(D,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<R;D++)for(let U=0;U<R;U++){const V=this.get(D,U);V>this.max&&(this.max=V),V<this.min&&(this.min=V)}}get(a,d){const p=new Uint8Array(this.data.buffer),b=4*this._idx(a,d);return this.unpack(p[b],p[b+1],p[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,d){if(a<-1||a>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(a+1)}unpack(a,d,p){return a*this.redFactor+d*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new la({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,d,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=d*this.dim,x=d*this.dim+this.dim,E=p*this.dim,L=p*this.dim+this.dim;switch(d){case-1:b=x-1;break;case 1:x=b+1}switch(p){case-1:E=L-1;break;case 1:L=E+1}const R=-d*this.dim,D=-p*this.dim;for(let U=E;U<L;U++)for(let V=b;V<x;V++)this.data[this._idx(V,U)]=a.data[this._idx(V+R,U+D)]}}Ve("DEMData",Vb);class qb{constructor(a){this._stringToNumber={},this._numberToString=[];for(let d=0;d<a.length;d++){const p=a[d];this._stringToNumber[p]=d,this._numberToString[d]=p}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class Hb{constructor(a,d,p,b,x){this.type="Feature",this._vectorTileFeature=a,a._z=d,a._x=p,a._y=b,this.properties=a.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(a[d]=this[d]);return a}}class Wb{constructor(a,d){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new $l(Fr,16,0),this.grid3D=new $l(Fr,16,0),this.featureIndexArray=new sr,this.promoteId=d}insert(a,d,p,b,x,E){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,b,x);const R=E?this.grid3D:this.grid;for(let D=0;D<d.length;D++){const U=d[D],V=[1/0,1/0,-1/0,-1/0];for(let J=0;J<U.length;J++){const tt=U[J];V[0]=Math.min(V[0],tt.x),V[1]=Math.min(V[1],tt.y),V[2]=Math.max(V[2],tt.x),V[3]=Math.max(V[3],tt.y)}V[0]<Fr&&V[1]<Fr&&V[2]>=0&&V[3]>=0&&R.insert(L,V[0],V[1],V[2],V[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wh.VectorTile(new m0(this.rawTileData)).layers,this.sourceLayerCoder=new qb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,d,p,b){this.loadVTLayers();const x=a.params||{},E=Fr/a.tileSize/a.scale,L=_o(x.filter),R=a.queryGeometry,D=a.queryPadding*E,U=Zb(R),V=this.grid.query(U.minX-D,U.minY-D,U.maxX+D,U.maxY+D),J=Zb(a.cameraQueryGeometry),tt=this.grid3D.query(J.minX-D,J.minY-D,J.maxX+D,J.maxY+D,(wt,Pt,Zt,Nt)=>function(Vt,se,Te,Ge,mi){for(const Oe of Vt)if(se<=Oe.x&&Te<=Oe.y&&Ge>=Oe.x&&mi>=Oe.y)return!0;const je=[new T(se,Te),new T(se,mi),new T(Ge,mi),new T(Ge,Te)];if(Vt.length>2){for(const Oe of je)if(nc(Vt,Oe))return!0}for(let Oe=0;Oe<Vt.length-1;Oe++)if(gp(Vt[Oe],Vt[Oe+1],je))return!0;return!1}(a.cameraQueryGeometry,wt-D,Pt-D,Zt+D,Nt+D));for(const wt of tt)V.push(wt);V.sort(WC);const st={};let dt;for(let wt=0;wt<V.length;wt++){const Pt=V[wt];if(Pt===dt)continue;dt=Pt;const Zt=this.featureIndexArray.get(Pt);let Nt=null;this.loadMatchingFeature(st,Zt.bucketIndex,Zt.sourceLayerIndex,Zt.featureIndex,L,x.layers,x.availableImages,d,p,b,(Vt,se,Te)=>(Nt||(Nt=Gc(Vt)),se.queryIntersectsFeature(R,Vt,Te,Nt,this.z,a.transform,E,a.pixelPosMatrix)))}return st}loadMatchingFeature(a,d,p,b,x,E,L,R,D,U,V){const J=this.bucketLayerIDs[d];if(E&&!function(wt,Pt){for(let Zt=0;Zt<wt.length;Zt++)if(Pt.indexOf(wt[Zt])>=0)return!0;return!1}(E,J))return;const tt=this.sourceLayerCoder.decode(p),st=this.vtLayers[tt].feature(b);if(x.needGeometry){const wt=ic(st,!0);if(!x.filter(new br(this.tileID.overscaledZ),wt,this.tileID.canonical))return}else if(!x.filter(new br(this.tileID.overscaledZ),st))return;const dt=this.getId(st,tt);for(let wt=0;wt<J.length;wt++){const Pt=J[wt];if(E&&E.indexOf(Pt)<0)continue;const Zt=R[Pt];if(!Zt)continue;let Nt={};dt&&U&&(Nt=U.getState(Zt.sourceLayer||"_geojsonTileLayer",dt));const Vt=Mt({},D[Pt]);Vt.paint=Xb(Vt.paint,Zt.paint,st,Nt,L),Vt.layout=Xb(Vt.layout,Zt.layout,st,Nt,L);const se=!V||V(st,Zt,Nt);if(!se)continue;const Te=new Hb(st,this.z,this.x,this.y,dt);Te.layer=Vt;let Ge=a[Pt];Ge===void 0&&(Ge=a[Pt]=[]),Ge.push({featureIndex:b,feature:Te,intersectionZ:se})}}lookupSymbolFeatures(a,d,p,b,x,E,L,R){const D={};this.loadVTLayers();const U=_o(x);for(const V of a)this.loadMatchingFeature(D,p,b,V,U,E,L,R,d);return D}hasLayer(a){for(const d of this.bucketLayerIDs)for(const p of d)if(a===p)return!0;return!1}getId(a,d){let p=a.id;return this.promoteId&&(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof p=="boolean"&&(p=Number(p))),p}}function Xb(h,a,d,p,b){return Ut(h,(x,E)=>{const L=a instanceof Fa?a.get(E):null;return L&&L.evaluate?L.evaluate(d,p,b):L})}function Zb(h){let a=1/0,d=1/0,p=-1/0,b=-1/0;for(const x of h)a=Math.min(a,x.x),d=Math.min(d,x.y),p=Math.max(p,x.x),b=Math.max(b,x.y);return{minX:a,minY:d,maxX:p,maxY:b}}function WC(h,a){return a-h}function $b(h,a,d,p,b){const x=[];for(let E=0;E<h.length;E++){const L=h[E];let R;for(let D=0;D<L.length-1;D++){let U=L[D],V=L[D+1];U.x<a&&V.x<a||(U.x<a?U=new T(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<a&&(V=new T(a,U.y+(a-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<d&&V.y<d||(U.y<d?U=new T(U.x+(d-U.y)/(V.y-U.y)*(V.x-U.x),d)._round():V.y<d&&(V=new T(U.x+(d-U.y)/(V.y-U.y)*(V.x-U.x),d)._round()),U.x>=p&&V.x>=p||(U.x>=p?U=new T(p,U.y+(p-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=p&&(V=new T(p,U.y+(p-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=b&&V.y>=b||(U.y>=b?U=new T(U.x+(b-U.y)/(V.y-U.y)*(V.x-U.x),b)._round():V.y>=b&&(V=new T(U.x+(b-U.y)/(V.y-U.y)*(V.x-U.x),b)._round()),R&&U.equals(R[R.length-1])||(R=[U],x.push(R)),R.push(V)))))}}return x}Ve("FeatureIndex",Wb,{omit:["rawTileData","sourceLayerCoder"]});class Th extends T{constructor(a,d,p,b){super(a,d),this.angle=p,b!==void 0&&(this.segment=b)}clone(){return new Th(this.x,this.y,this.angle,this.segment)}}function Yb(h,a,d,p,b){if(a.segment===void 0||d===0)return!0;let x=a,E=a.segment+1,L=0;for(;L>-d/2;){if(E--,E<0)return!1;L-=h[E].dist(x),x=h[E]}L+=h[E].dist(h[E+1]),E++;const R=[];let D=0;for(;L<d/2;){const U=h[E],V=h[E+1];if(!V)return!1;let J=h[E-1].angleTo(U)-U.angleTo(V);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:L,angleDelta:J}),D+=J;L-R[0].distance>p;)D-=R.shift().angleDelta;if(D>b)return!1;E++,L+=U.dist(V)}return!0}function Jb(h){let a=0;for(let d=0;d<h.length-1;d++)a+=h[d].dist(h[d+1]);return a}function Kb(h,a,d){return h?.6*a*d:0}function Qb(h,a){return Math.max(h?h.right-h.left:0,a?a.right-a.left:0)}function XC(h,a,d,p,b,x){const E=Kb(d,b,x),L=Qb(d,p)*x;let R=0;const D=Jb(h)/2;for(let U=0;U<h.length-1;U++){const V=h[U],J=h[U+1],tt=V.dist(J);if(R+tt>D){const st=(D-R)/tt,dt=Pn.number(V.x,J.x,st),wt=Pn.number(V.y,J.y,st),Pt=new Th(dt,wt,J.angleTo(V),U);return Pt._round(),!E||Yb(h,Pt,L,E,a)?Pt:void 0}R+=tt}}function ZC(h,a,d,p,b,x,E,L,R){const D=Kb(p,x,E),U=Qb(p,b),V=U*E,J=h[0].x===0||h[0].x===R||h[0].y===0||h[0].y===R;return a-V<a/4&&(a=V+a/4),t2(h,J?a/2*L%a:(U/2+2*x)*E*L%a,a,D,d,V,J,!1,R)}function t2(h,a,d,p,b,x,E,L,R){const D=x/2,U=Jb(h);let V=0,J=a-d,tt=[];for(let st=0;st<h.length-1;st++){const dt=h[st],wt=h[st+1],Pt=dt.dist(wt),Zt=wt.angleTo(dt);for(;J+d<V+Pt;){J+=d;const Nt=(J-V)/Pt,Vt=Pn.number(dt.x,wt.x,Nt),se=Pn.number(dt.y,wt.y,Nt);if(Vt>=0&&Vt<R&&se>=0&&se<R&&J-D>=0&&J+D<=U){const Te=new Th(Vt,se,Zt,st);Te._round(),p&&!Yb(h,Te,x,p,b)||tt.push(Te)}}V+=Pt}return L||tt.length||E||(tt=t2(h,V/2,d,p,b,x,E,!0,R)),tt}Ve("Anchor",Th);const hd=xo;function e2(h,a,d,p){const b=[],x=h.image,E=x.pixelRatio,L=x.paddedRect.w-2*hd,R=x.paddedRect.h-2*hd;let D={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom};const U=x.stretchX||[[0,L]],V=x.stretchY||[[0,R]],J=(fe,ni)=>fe+ni[1]-ni[0],tt=U.reduce(J,0),st=V.reduce(J,0),dt=L-tt,wt=R-st;let Pt=0,Zt=tt,Nt=0,Vt=st,se=0,Te=dt,Ge=0,mi=wt;if(x.content&&p){const fe=x.content,ni=fe[2]-fe[0],ti=fe[3]-fe[1];(x.textFitWidth||x.textFitHeight)&&(D=Pb(h)),Pt=rm(U,0,fe[0]),Nt=rm(V,0,fe[1]),Zt=rm(U,fe[0],fe[2]),Vt=rm(V,fe[1],fe[3]),se=fe[0]-Pt,Ge=fe[1]-Nt,Te=ni-Zt,mi=ti-Vt}const je=D.x1,Oe=D.y1,ri=D.x2-je,Xe=D.y2-Oe,qe=(fe,ni,ti,Ei)=>{const Pr=nm(fe.stretch-Pt,Zt,ri,je),wr=sm(fe.fixed-se,Te,fe.stretch,tt),Gn=nm(ni.stretch-Nt,Vt,Xe,Oe),Ua=sm(ni.fixed-Ge,mi,ni.stretch,st),ds=nm(ti.stretch-Pt,Zt,ri,je),Vn=sm(ti.fixed-se,Te,ti.stretch,tt),Hs=nm(Ei.stretch-Nt,Vt,Xe,Oe),Ws=sm(Ei.fixed-Ge,mi,Ei.stretch,st),Xs=new T(Pr,Gn),hn=new T(ds,Gn),qn=new T(ds,Hs),Ls=new T(Pr,Hs),ps=new T(wr/E,Ua/E),Zs=new T(Vn/E,Ws/E),fs=a*Math.PI/180;if(fs){const or=Math.sin(fs),Dr=Math.cos(fs),Ur=[Dr,-or,or,Dr];Xs._matMult(Ur),hn._matMult(Ur),Ls._matMult(Ur),qn._matMult(Ur)}const ha=fe.stretch+fe.fixed,wo=ni.stretch+ni.fixed;return{tl:Xs,tr:hn,bl:Ls,br:qn,tex:{x:x.paddedRect.x+hd+ha,y:x.paddedRect.y+hd+wo,w:ti.stretch+ti.fixed-ha,h:Ei.stretch+Ei.fixed-wo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ps,pixelOffsetBR:Zs,minFontScaleX:Te/E/ri,minFontScaleY:mi/E/Xe,isSDF:d}};if(p&&(x.stretchX||x.stretchY)){const fe=i2(U,dt,tt),ni=i2(V,wt,st);for(let ti=0;ti<fe.length-1;ti++){const Ei=fe[ti],Pr=fe[ti+1];for(let wr=0;wr<ni.length-1;wr++)b.push(qe(Ei,ni[wr],Pr,ni[wr+1]))}}else b.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:R+1}));return b}function rm(h,a,d){let p=0;for(const b of h)p+=Math.max(a,Math.min(d,b[1]))-Math.max(a,Math.min(d,b[0]));return p}function i2(h,a,d){const p=[{fixed:-hd,stretch:0}];for(const[b,x]of h){const E=p[p.length-1];p.push({fixed:b-E.stretch,stretch:E.stretch}),p.push({fixed:b-E.stretch,stretch:E.stretch+(x-b)})}return p.push({fixed:a+hd,stretch:d}),p}function nm(h,a,d,p){return h/a*d+p}function sm(h,a,d,p){return h-a*d/p}class om{constructor(a,d,p,b,x,E,L,R,D,U){var V;if(this.boxStartIndex=a.length,D){let J=E.top,tt=E.bottom;const st=E.collisionPadding;st&&(J-=st[1],tt+=st[3]);let dt=tt-J;dt>0&&(dt=Math.max(10,dt),this.circleDiameter=dt)}else{const J=!((V=E.image)===null||V===void 0)&&V.content&&(E.image.textFitWidth||E.image.textFitHeight)?Pb(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};J.y1=J.y1*L-R[0],J.y2=J.y2*L+R[2],J.x1=J.x1*L-R[3],J.x2=J.x2*L+R[1];const tt=E.collisionPadding;if(tt&&(J.x1-=tt[0]*L,J.y1-=tt[1]*L,J.x2+=tt[2]*L,J.y2+=tt[3]*L),U){const st=new T(J.x1,J.y1),dt=new T(J.x2,J.y1),wt=new T(J.x1,J.y2),Pt=new T(J.x2,J.y2),Zt=U*Math.PI/180;st._rotate(Zt),dt._rotate(Zt),wt._rotate(Zt),Pt._rotate(Zt),J.x1=Math.min(st.x,dt.x,wt.x,Pt.x),J.x2=Math.max(st.x,dt.x,wt.x,Pt.x),J.y1=Math.min(st.y,dt.y,wt.y,Pt.y),J.y2=Math.max(st.y,dt.y,wt.y,Pt.y)}a.emplaceBack(d.x,d.y,J.x1,J.y1,J.x2,J.y2,p,b,x)}this.boxEndIndex=a.length}}class $C{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(p,b)=>p<b?-1:p>b?1:0;if(this.data=a,this.length=this.data.length,this.compare=d,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:d,compare:p}=this,b=d[a];for(;a>0;){const x=a-1>>1,E=d[x];if(p(b,E)>=0)break;d[a]=E,a=x}d[a]=b}_down(a){const{data:d,compare:p}=this,b=this.length>>1,x=d[a];for(;a<b;){let E=1+(a<<1);const L=E+1;if(L<this.length&&p(d[L],d[E])<0&&(E=L),p(d[E],x)>=0)break;d[a]=d[E],a=E}d[a]=x}}function YC(h){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,p=1/0,b=1/0,x=-1/0,E=-1/0;const L=h[0];for(let tt=0;tt<L.length;tt++){const st=L[tt];(!tt||st.x<p)&&(p=st.x),(!tt||st.y<b)&&(b=st.y),(!tt||st.x>x)&&(x=st.x),(!tt||st.y>E)&&(E=st.y)}const R=Math.min(x-p,E-b);let D=R/2;const U=new $C([],JC);if(R===0)return new T(p,b);for(let tt=p;tt<x;tt+=R)for(let st=b;st<E;st+=R)U.push(new ud(tt+D,st+D,D,h));let V=function(tt){let st=0,dt=0,wt=0;const Pt=tt[0];for(let Zt=0,Nt=Pt.length,Vt=Nt-1;Zt<Nt;Vt=Zt++){const se=Pt[Zt],Te=Pt[Vt],Ge=se.x*Te.y-Te.x*se.y;dt+=(se.x+Te.x)*Ge,wt+=(se.y+Te.y)*Ge,st+=3*Ge}return new ud(dt/st,wt/st,0,tt)}(h),J=U.length;for(;U.length;){const tt=U.pop();(tt.d>V.d||!V.d)&&(V=tt,d&&console.log("found best %d after %d probes",Math.round(1e4*tt.d)/1e4,J)),tt.max-V.d<=a||(D=tt.h/2,U.push(new ud(tt.p.x-D,tt.p.y-D,D,h)),U.push(new ud(tt.p.x+D,tt.p.y-D,D,h)),U.push(new ud(tt.p.x-D,tt.p.y+D,D,h)),U.push(new ud(tt.p.x+D,tt.p.y+D,D,h)),J+=4)}return d&&(console.log(`num probes: ${J}`),console.log(`best distance: ${V.d}`)),V.p}function JC(h,a){return a.max-h.max}function ud(h,a,d,p){this.p=new T(h,a),this.h=d,this.d=function(b,x){let E=!1,L=1/0;for(let R=0;R<x.length;R++){const D=x[R];for(let U=0,V=D.length,J=V-1;U<V;J=U++){const tt=D[U],st=D[J];tt.y>b.y!=st.y>b.y&&b.x<(st.x-tt.x)*(b.y-tt.y)/(st.y-tt.y)+tt.x&&(E=!E),L=Math.min(L,mp(b,tt,st))}}return(E?1:-1)*Math.sqrt(L)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var us;c.aq=void 0,(us=c.aq||(c.aq={}))[us.center=1]="center",us[us.left=2]="left",us[us.right=3]="right",us[us.top=4]="top",us[us.bottom=5]="bottom",us[us["top-left"]=6]="top-left",us[us["top-right"]=7]="top-right",us[us["bottom-left"]=8]="bottom-left",us[us["bottom-right"]=9]="bottom-right";const Ch=7,P0=Number.POSITIVE_INFINITY;function r2(h,a){return a[1]!==P0?function(d,p,b){let x=0,E=0;switch(p=Math.abs(p),b=Math.abs(b),d){case"top-right":case"top-left":case"top":E=b-Ch;break;case"bottom-right":case"bottom-left":case"bottom":E=-b+Ch}switch(d){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,E]}(h,a[0],a[1]):function(d,p){let b=0,x=0;p<0&&(p=0);const E=p/Math.SQRT2;switch(d){case"top-right":case"top-left":x=E-Ch;break;case"bottom-right":case"bottom-left":x=-E+Ch;break;case"bottom":x=-p+Ch;break;case"top":x=p-Ch}switch(d){case"top-right":case"bottom-right":b=-E;break;case"top-left":case"bottom-left":b=E;break;case"left":b=p;break;case"right":b=-p}return[b,x]}(h,a[0])}function n2(h,a,d){var p;const b=h.layout,x=(p=b.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(a,{},d);if(x){const L=x.values,R=[];for(let D=0;D<L.length;D+=2){const U=R[D]=L[D],V=L[D+1].map(J=>J*Mn);U.startsWith("top")?V[1]-=Ch:U.startsWith("bottom")&&(V[1]+=Ch),R[D+1]=V}return new Mr(R)}const E=b.get("text-variable-anchor");if(E){let L;L=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},d)*Mn,P0]:b.get("text-offset").evaluate(a,{},d).map(D=>D*Mn);const R=[];for(const D of E)R.push(D,r2(D,L));return new Mr(R)}return null}function I0(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function KC(h,a,d,p,b,x,E,L,R,D,U){let V=x.textMaxSize.evaluate(a,{});V===void 0&&(V=E);const J=h.layers[0].layout,tt=J.get("icon-offset").evaluate(a,{},U),st=o2(d.horizontal),dt=E/24,wt=h.tilePixelRatio*dt,Pt=h.tilePixelRatio*V/24,Zt=h.tilePixelRatio*L,Nt=h.tilePixelRatio*J.get("symbol-spacing"),Vt=J.get("text-padding")*h.tilePixelRatio,se=function(fe,ni,ti){let Ei=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Pr=fe.get("icon-padding").evaluate(ni,{},ti),wr=Pr&&Pr.values;return[wr[0]*Ei,wr[1]*Ei,wr[2]*Ei,wr[3]*Ei]}(J,a,U,h.tilePixelRatio),Te=J.get("text-max-angle")/180*Math.PI,Ge=J.get("text-rotation-alignment")!=="viewport"&&J.get("symbol-placement")!=="point",mi=J.get("icon-rotation-alignment")==="map"&&J.get("symbol-placement")!=="point",je=J.get("symbol-placement"),Oe=Nt/2,ri=J.get("icon-text-fit");let Xe;p&&ri!=="none"&&(h.allowVerticalPlacement&&d.vertical&&(Xe=Ib(p,d.vertical,ri,J.get("icon-text-fit-padding"),tt,dt)),st&&(p=Ib(p,st,ri,J.get("icon-text-fit-padding"),tt,dt)));const qe=(fe,ni)=>{ni.x<0||ni.x>=Fr||ni.y<0||ni.y>=Fr||function(ti,Ei,Pr,wr,Gn,Ua,ds,Vn,Hs,Ws,Xs,hn,qn,Ls,ps,Zs,fs,ha,wo,or,Dr,Ur,zo,on,dd){const oc=ti.addToLineVertexArray(Ei,Pr);let ac,Ga,ua,rs,Hc=0,Rp=0,h2=0,u2=0,O0=-1,N0=-1;const Wc={};let d2=bh("");if(ti.allowVerticalPlacement&&wr.vertical){const Ms=Vn.layout.get("text-rotate").evaluate(Dr,{},on)+90;ua=new om(Hs,Ei,Ws,Xs,hn,wr.vertical,qn,Ls,ps,Ms),ds&&(rs=new om(Hs,Ei,Ws,Xs,hn,ds,fs,ha,ps,Ms))}if(Gn){const Ms=Vn.layout.get("icon-rotate").evaluate(Dr,{}),da=Vn.layout.get("icon-text-fit")!=="none",mu=e2(Gn,Ms,zo,da),pl=ds?e2(ds,Ms,zo,da):void 0;Ga=new om(Hs,Ei,Ws,Xs,hn,Gn,fs,ha,!1,Ms),Hc=4*mu.length;const gu=ti.iconSizeData;let lc=null;gu.kind==="source"?(lc=[sc*Vn.layout.get("icon-size").evaluate(Dr,{})],lc[0]>Ah&&Lt(`${ti.layerIds[0]}: Value for "icon-size" is >= ${Pp}. Reduce your "icon-size".`)):gu.kind==="composite"&&(lc=[sc*Ur.compositeIconSizes[0].evaluate(Dr,{},on),sc*Ur.compositeIconSizes[1].evaluate(Dr,{},on)],(lc[0]>Ah||lc[1]>Ah)&&Lt(`${ti.layerIds[0]}: Value for "icon-size" is >= ${Pp}. Reduce your "icon-size".`)),ti.addSymbols(ti.icon,mu,lc,or,wo,Dr,c.ah.none,Ei,oc.lineStartIndex,oc.lineLength,-1,on),O0=ti.icon.placedSymbolArray.length-1,pl&&(Rp=4*pl.length,ti.addSymbols(ti.icon,pl,lc,or,wo,Dr,c.ah.vertical,Ei,oc.lineStartIndex,oc.lineLength,-1,on),N0=ti.icon.placedSymbolArray.length-1)}const p2=Object.keys(wr.horizontal);for(const Ms of p2){const da=wr.horizontal[Ms];if(!ac){d2=bh(da.text);const pl=Vn.layout.get("text-rotate").evaluate(Dr,{},on);ac=new om(Hs,Ei,Ws,Xs,hn,da,qn,Ls,ps,pl)}const mu=da.positionedLines.length===1;if(h2+=s2(ti,Ei,da,Ua,Vn,ps,Dr,Zs,oc,wr.vertical?c.ah.horizontal:c.ah.horizontalOnly,mu?p2:[Ms],Wc,O0,Ur,on),mu)break}wr.vertical&&(u2+=s2(ti,Ei,wr.vertical,Ua,Vn,ps,Dr,Zs,oc,c.ah.vertical,["vertical"],Wc,N0,Ur,on));const eP=ac?ac.boxStartIndex:ti.collisionBoxArray.length,iP=ac?ac.boxEndIndex:ti.collisionBoxArray.length,rP=ua?ua.boxStartIndex:ti.collisionBoxArray.length,nP=ua?ua.boxEndIndex:ti.collisionBoxArray.length,sP=Ga?Ga.boxStartIndex:ti.collisionBoxArray.length,oP=Ga?Ga.boxEndIndex:ti.collisionBoxArray.length,aP=rs?rs.boxStartIndex:ti.collisionBoxArray.length,lP=rs?rs.boxEndIndex:ti.collisionBoxArray.length;let dl=-1;const lm=(Ms,da)=>Ms&&Ms.circleDiameter?Math.max(Ms.circleDiameter,da):da;dl=lm(ac,dl),dl=lm(ua,dl),dl=lm(Ga,dl),dl=lm(rs,dl);const f2=dl>-1?1:0;f2&&(dl*=dd/Mn),ti.glyphOffsetArray.length>=cd.MAX_GLYPHS&&Lt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dr.sortKey!==void 0&&ti.addToSortKeyRanges(ti.symbolInstances.length,Dr.sortKey);const cP=n2(Vn,Dr,on),[hP,uP]=function(Ms,da){const mu=Ms.length,pl=da==null?void 0:da.values;if((pl==null?void 0:pl.length)>0)for(let gu=0;gu<pl.length;gu+=2){const lc=pl[gu+1];Ms.emplaceBack(c.aq[pl[gu]],lc[0],lc[1])}return[mu,Ms.length]}(ti.textAnchorOffsets,cP);ti.symbolInstances.emplaceBack(Ei.x,Ei.y,Wc.right>=0?Wc.right:-1,Wc.center>=0?Wc.center:-1,Wc.left>=0?Wc.left:-1,Wc.vertical||-1,O0,N0,d2,eP,iP,rP,nP,sP,oP,aP,lP,Ws,h2,u2,Hc,Rp,f2,0,qn,dl,hP,uP)}(h,ni,fe,d,p,b,Xe,h.layers[0],h.collisionBoxArray,a.index,a.sourceLayerIndex,h.index,wt,[Vt,Vt,Vt,Vt],Ge,R,Zt,se,mi,tt,a,x,D,U,E)};if(je==="line")for(const fe of $b(a.geometry,0,0,Fr,Fr)){const ni=ZC(fe,Nt,Te,d.vertical||st,p,24,Pt,h.overscaling,Fr);for(const ti of ni)st&&QC(h,st.text,Oe,ti)||qe(fe,ti)}else if(je==="line-center"){for(const fe of a.geometry)if(fe.length>1){const ni=XC(fe,Te,d.vertical||st,p,24,Pt);ni&&qe(fe,ni)}}else if(a.type==="Polygon")for(const fe of Po(a.geometry,0)){const ni=YC(fe,16);qe(fe[0],new Th(ni.x,ni.y,0))}else if(a.type==="LineString")for(const fe of a.geometry)qe(fe,new Th(fe[0].x,fe[0].y,0));else if(a.type==="Point")for(const fe of a.geometry)for(const ni of fe)qe([ni],new Th(ni.x,ni.y,0))}function s2(h,a,d,p,b,x,E,L,R,D,U,V,J,tt,st){const dt=function(Zt,Nt,Vt,se,Te,Ge,mi,je){const Oe=se.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,ri=[];for(const Xe of Nt.positionedLines)for(const qe of Xe.positionedGlyphs){if(!qe.rect)continue;const fe=qe.rect||{};let ni=xb+1,ti=!0,Ei=1,Pr=0;const wr=(Te||je)&&qe.vertical,Gn=qe.metrics.advance*qe.scale/2;if(je&&Nt.verticalizable&&(Pr=Xe.lineOffset/2-(qe.imageName?-(Mn-qe.metrics.width*qe.scale)/2:(qe.scale-1)*Mn)),qe.imageName){const or=mi[qe.imageName];ti=or.sdf,Ei=or.pixelRatio,ni=xo/Ei}const Ua=Te?[qe.x+Gn,qe.y]:[0,0];let ds=Te?[0,0]:[qe.x+Gn+Vt[0],qe.y+Vt[1]-Pr],Vn=[0,0];wr&&(Vn=ds,ds=[0,0]);const Hs=qe.metrics.isDoubleResolution?2:1,Ws=(qe.metrics.left-ni)*qe.scale-Gn+ds[0],Xs=(-qe.metrics.top-ni)*qe.scale+ds[1],hn=Ws+fe.w/Hs*qe.scale/Ei,qn=Xs+fe.h/Hs*qe.scale/Ei,Ls=new T(Ws,Xs),ps=new T(hn,Xs),Zs=new T(Ws,qn),fs=new T(hn,qn);if(wr){const or=new T(-Gn,Gn-Tp),Dr=-Math.PI/2,Ur=Mn/2-Gn,zo=new T(5-Tp-Ur,-(qe.imageName?Ur:0)),on=new T(...Vn);Ls._rotateAround(Dr,or)._add(zo)._add(on),ps._rotateAround(Dr,or)._add(zo)._add(on),Zs._rotateAround(Dr,or)._add(zo)._add(on),fs._rotateAround(Dr,or)._add(zo)._add(on)}if(Oe){const or=Math.sin(Oe),Dr=Math.cos(Oe),Ur=[Dr,-or,or,Dr];Ls._matMult(Ur),ps._matMult(Ur),Zs._matMult(Ur),fs._matMult(Ur)}const ha=new T(0,0),wo=new T(0,0);ri.push({tl:Ls,tr:ps,bl:Zs,br:fs,tex:fe,writingMode:Nt.writingMode,glyphOffset:Ua,sectionIndex:qe.sectionIndex,isSDF:ti,pixelOffsetTL:ha,pixelOffsetBR:wo,minFontScaleX:0,minFontScaleY:0})}return ri}(0,d,L,b,x,E,p,h.allowVerticalPlacement),wt=h.textSizeData;let Pt=null;wt.kind==="source"?(Pt=[sc*b.layout.get("text-size").evaluate(E,{})],Pt[0]>Ah&&Lt(`${h.layerIds[0]}: Value for "text-size" is >= ${Pp}. Reduce your "text-size".`)):wt.kind==="composite"&&(Pt=[sc*tt.compositeTextSizes[0].evaluate(E,{},st),sc*tt.compositeTextSizes[1].evaluate(E,{},st)],(Pt[0]>Ah||Pt[1]>Ah)&&Lt(`${h.layerIds[0]}: Value for "text-size" is >= ${Pp}. Reduce your "text-size".`)),h.addSymbols(h.text,dt,Pt,L,x,E,D,a,R.lineStartIndex,R.lineLength,J,st);for(const Zt of U)V[Zt]=h.text.placedSymbolArray.length-1;return 4*dt.length}function o2(h){for(const a in h)return h[a];return null}function QC(h,a,d,p){const b=h.compareText;if(a in b){const x=b[a];for(let E=x.length-1;E>=0;E--)if(p.dist(x[E])<d)return!0}else b[a]=[];return b[a].push(p),!1}const a2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class L0{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,p]=new Uint8Array(a,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=p>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const x=a2[15&p];if(!x)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(a,2,1),[L]=new Uint32Array(a,4,1);return new L0(L,E,x,a)}constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,b=arguments.length>3?arguments[3]:void 0;if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=p,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const x=a2.indexOf(this.ArrayType),E=2*a*this.ArrayType.BYTES_PER_ELEMENT,L=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-L%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${p}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+L+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+E+L+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+L+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=a)}add(a,d){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=a,this.coords[this._pos++]=d,p}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return M0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,d,p,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:E,nodeSize:L}=this,R=[0,x.length-1,0],D=[];for(;R.length;){const U=R.pop()||0,V=R.pop()||0,J=R.pop()||0;if(V-J<=L){for(let wt=J;wt<=V;wt++){const Pt=E[2*wt],Zt=E[2*wt+1];Pt>=a&&Pt<=p&&Zt>=d&&Zt<=b&&D.push(x[wt])}continue}const tt=J+V>>1,st=E[2*tt],dt=E[2*tt+1];st>=a&&st<=p&&dt>=d&&dt<=b&&D.push(x[tt]),(U===0?a<=st:d<=dt)&&(R.push(J),R.push(tt-1),R.push(1-U)),(U===0?p>=st:b>=dt)&&(R.push(tt+1),R.push(V),R.push(1-U))}return D}within(a,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:E}=this,L=[0,b.length-1,0],R=[],D=p*p;for(;L.length;){const U=L.pop()||0,V=L.pop()||0,J=L.pop()||0;if(V-J<=E){for(let wt=J;wt<=V;wt++)c2(x[2*wt],x[2*wt+1],a,d)<=D&&R.push(b[wt]);continue}const tt=J+V>>1,st=x[2*tt],dt=x[2*tt+1];c2(st,dt,a,d)<=D&&R.push(b[tt]),(U===0?a-p<=st:d-p<=dt)&&(L.push(J),L.push(tt-1),L.push(1-U)),(U===0?a+p>=st:d+p>=dt)&&(L.push(tt+1),L.push(V),L.push(1-U))}return R}}function M0(h,a,d,p,b,x){if(b-p<=d)return;const E=p+b>>1;l2(h,a,E,p,b,x),M0(h,a,d,p,E-1,1-x),M0(h,a,d,E+1,b,1-x)}function l2(h,a,d,p,b,x){for(;b>p;){if(b-p>600){const D=b-p+1,U=d-p+1,V=Math.log(D),J=.5*Math.exp(2*V/3),tt=.5*Math.sqrt(V*J*(D-J)/D)*(U-D/2<0?-1:1);l2(h,a,d,Math.max(p,Math.floor(d-U*J/D+tt)),Math.min(b,Math.floor(d+(D-U)*J/D+tt)),x)}const E=a[2*d+x];let L=p,R=b;for(Mp(h,a,p,d),a[2*b+x]>E&&Mp(h,a,p,b);L<R;){for(Mp(h,a,L,R),L++,R--;a[2*L+x]<E;)L++;for(;a[2*R+x]>E;)R--}a[2*p+x]===E?Mp(h,a,p,R):(R++,Mp(h,a,R,b)),R<=d&&(p=R+1),d<=R&&(b=R-1)}}function Mp(h,a,d,p){B0(h,d,p),B0(a,2*d,2*p),B0(a,2*d+1,2*p+1)}function B0(h,a,d){const p=h[a];h[a]=h[d],h[d]=p}function c2(h,a,d,p){const b=h-d,x=a-p;return b*b+x*x}var R0;c.bg=void 0,(R0=c.bg||(c.bg={})).create="create",R0.load="load",R0.fullLoad="fullLoad";let am=null,Bp=[];const k0=1e3/60,F0="loadTime",D0="fullLoadTime",tP={mark(h){performance.mark(h)},frame(h){const a=h;am!=null&&Bp.push(a-am),am=a},clearMetrics(){am=null,Bp=[],performance.clearMeasures(F0),performance.clearMeasures(D0);for(const h in c.bg)performance.clearMarks(c.bg[h])},getPerformanceMetrics(){performance.measure(F0,c.bg.create,c.bg.load),performance.measure(D0,c.bg.create,c.bg.fullLoad);const h=performance.getEntriesByName(F0)[0].duration,a=performance.getEntriesByName(D0)[0].duration,d=Bp.length,p=1/(Bp.reduce((x,E)=>x+E,0)/d/1e3),b=Bp.filter(x=>x>k0).reduce((x,E)=>x+(E-k0)/k0,0);return{loadTime:h,fullLoadTime:a,fps:p,percentDroppedFrames:b/(d+b)*100,totalFrames:d}}};c.$=class extends j{},c.A=nd,c.B=lp,c.C=function(h){if(ie==null){const a=h.navigator?h.navigator.userAgent:null;ie=!!h.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ie},c.D=Ye,c.E=oe,c.F=class{constructor(h,a){this.target=h,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new HC(()=>this.process()),this.subscription=function(d,p,b,x){return d.addEventListener(p,b,!1),{unsubscribe:()=>{d.removeEventListener(p,b,!1)}}}(this.target,"message",d=>this.receive(d)),this.globalScope=ee(self)?h:window}registerMessageHandler(h,a){this.messageHandlers[h]=a}sendAsync(h,a){return new Promise((d,p)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:d,reject:p},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const L={id:b,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const x=[],E=Object.assign(Object.assign({},h),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Yl(h.data,x)});this.target.postMessage(E,{transfer:x})})}receive(h){const a=h.data,d=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!=="resource://android"&&location.origin!=="resource://android"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[d];const p=this.abortControllers[d];return delete this.abortControllers[d],void(p&&p.abort())}if(ee(self)||a.mustQueue)return this.tasks[d]=a,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,a)}}process(){if(this.taskQueue.length===0)return;const h=this.taskQueue.shift(),a=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(h,a)}processTask(h,a){return l(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[h];return delete this.resolveRejects[h],b?void(a.error?b.reject(ll(a.error)):b.resolve(ll(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const d=ll(a.data),p=new AbortController;this.abortControllers[h]=p;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,d,p);this.completeTask(h,null,b)}catch(b){this.completeTask(h,b)}})}completeTask(h,a,d){const p=[];delete this.abortControllers[h];const b={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?Yl(a):null,data:Yl(d,p)};this.target.postMessage(b,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.G=qt,c.H=function(){var h=new nd(16);return nd!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},c.I=_0,c.J=function(h,a,d){var p,b,x,E,L,R,D,U,V,J,tt,st,dt=d[0],wt=d[1],Pt=d[2];return a===h?(h[12]=a[0]*dt+a[4]*wt+a[8]*Pt+a[12],h[13]=a[1]*dt+a[5]*wt+a[9]*Pt+a[13],h[14]=a[2]*dt+a[6]*wt+a[10]*Pt+a[14],h[15]=a[3]*dt+a[7]*wt+a[11]*Pt+a[15]):(b=a[1],x=a[2],E=a[3],L=a[4],R=a[5],D=a[6],U=a[7],V=a[8],J=a[9],tt=a[10],st=a[11],h[0]=p=a[0],h[1]=b,h[2]=x,h[3]=E,h[4]=L,h[5]=R,h[6]=D,h[7]=U,h[8]=V,h[9]=J,h[10]=tt,h[11]=st,h[12]=p*dt+L*wt+V*Pt+a[12],h[13]=b*dt+R*wt+J*Pt+a[13],h[14]=x*dt+D*wt+tt*Pt+a[14],h[15]=E*dt+U*wt+st*Pt+a[15]),h},c.K=function(h,a,d){var p=d[0],b=d[1],x=d[2];return h[0]=a[0]*p,h[1]=a[1]*p,h[2]=a[2]*p,h[3]=a[3]*p,h[4]=a[4]*b,h[5]=a[5]*b,h[6]=a[6]*b,h[7]=a[7]*b,h[8]=a[8]*x,h[9]=a[9]*x,h[10]=a[10]*x,h[11]=a[11]*x,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.L=Vv,c.M=function(h,a){const d={};for(let p=0;p<a.length;p++){const b=a[p];b in h&&(d[b]=h[b])}return d},c.N=Eh,c.O=Nb,c.P=T,c.Q=zb,c.R=la,c.S=ca,c.T=vh,c.U=H,c.V=Z,c.W=ce,c.X=Fr,c.Y=A,c.Z=Ip,c._=l,c.a=Tt,c.a$=function(h,a){var d=h[0],p=h[1],b=h[2],x=h[3],E=h[4],L=h[5],R=h[6],D=h[7],U=h[8],V=h[9],J=h[10],tt=h[11],st=h[12],dt=h[13],wt=h[14],Pt=h[15],Zt=a[0],Nt=a[1],Vt=a[2],se=a[3],Te=a[4],Ge=a[5],mi=a[6],je=a[7],Oe=a[8],ri=a[9],Xe=a[10],qe=a[11],fe=a[12],ni=a[13],ti=a[14],Ei=a[15];return Math.abs(d-Zt)<=qs*Math.max(1,Math.abs(d),Math.abs(Zt))&&Math.abs(p-Nt)<=qs*Math.max(1,Math.abs(p),Math.abs(Nt))&&Math.abs(b-Vt)<=qs*Math.max(1,Math.abs(b),Math.abs(Vt))&&Math.abs(x-se)<=qs*Math.max(1,Math.abs(x),Math.abs(se))&&Math.abs(E-Te)<=qs*Math.max(1,Math.abs(E),Math.abs(Te))&&Math.abs(L-Ge)<=qs*Math.max(1,Math.abs(L),Math.abs(Ge))&&Math.abs(R-mi)<=qs*Math.max(1,Math.abs(R),Math.abs(mi))&&Math.abs(D-je)<=qs*Math.max(1,Math.abs(D),Math.abs(je))&&Math.abs(U-Oe)<=qs*Math.max(1,Math.abs(U),Math.abs(Oe))&&Math.abs(V-ri)<=qs*Math.max(1,Math.abs(V),Math.abs(ri))&&Math.abs(J-Xe)<=qs*Math.max(1,Math.abs(J),Math.abs(Xe))&&Math.abs(tt-qe)<=qs*Math.max(1,Math.abs(tt),Math.abs(qe))&&Math.abs(st-fe)<=qs*Math.max(1,Math.abs(st),Math.abs(fe))&&Math.abs(dt-ni)<=qs*Math.max(1,Math.abs(dt),Math.abs(ni))&&Math.abs(wt-ti)<=qs*Math.max(1,Math.abs(wt),Math.abs(ti))&&Math.abs(Pt-Ei)<=qs*Math.max(1,Math.abs(Pt),Math.abs(Ei))},c.a0=qi,c.a1=C0,c.a2=me,c.a3=h=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(d=>{a.onloadstart=()=>{d(a)};for(const p of h){const b=window.document.createElement("source");Ae(p)||(a.crossOrigin="Anonymous"),b.src=p,a.appendChild(b)}})},c.a4=function(){return yt++},c.a5=Pe,c.a6=cd,c.a7=_o,c.a8=ic,c.a9=Hb,c.aA=function(h){if(h.type==="custom")return new qC(h);switch(h.type){case"background":return new UC(h);case"circle":return new CT(h);case"fill":return new qT(h);case"fill-extrusion":return new sC(h);case"heatmap":return new IT(h);case"hillshade":return new MT(h);case"line":return new pC(h);case"raster":return new VC(h);case"symbol":return new im(h)}},c.aB=at,c.aC=function(h,a){if(!h)return[{command:"setStyle",args:[a]}];let d=[];try{if(!de(h.version,a.version))return[{command:"setStyle",args:[a]}];de(h.center,a.center)||d.push({command:"setCenter",args:[a.center]}),de(h.zoom,a.zoom)||d.push({command:"setZoom",args:[a.zoom]}),de(h.bearing,a.bearing)||d.push({command:"setBearing",args:[a.bearing]}),de(h.pitch,a.pitch)||d.push({command:"setPitch",args:[a.pitch]}),de(h.sprite,a.sprite)||d.push({command:"setSprite",args:[a.sprite]}),de(h.glyphs,a.glyphs)||d.push({command:"setGlyphs",args:[a.glyphs]}),de(h.transition,a.transition)||d.push({command:"setTransition",args:[a.transition]}),de(h.light,a.light)||d.push({command:"setLight",args:[a.light]}),de(h.terrain,a.terrain)||d.push({command:"setTerrain",args:[a.terrain]}),de(h.sky,a.sky)||d.push({command:"setSky",args:[a.sky]}),de(h.projection,a.projection)||d.push({command:"setProjection",args:[a.projection]});const p={},b=[];(function(E,L,R,D){let U;for(U in L=L||{},E=E||{})Object.prototype.hasOwnProperty.call(E,U)&&(Object.prototype.hasOwnProperty.call(L,U)||De(U,R,D));for(U in L)Object.prototype.hasOwnProperty.call(L,U)&&(Object.prototype.hasOwnProperty.call(E,U)?de(E[U],L[U])||(E[U].type==="geojson"&&L[U].type==="geojson"&&Si(E,L,U)?Ee(R,{command:"setGeoJSONSourceData",args:[U,L[U].data]}):ei(U,L,R,D)):Me(U,L,R))})(h.sources,a.sources,b,p);const x=[];h.layers&&h.layers.forEach(E=>{"source"in E&&p[E.source]?d.push({command:"removeLayer",args:[E.id]}):x.push(E)}),d=d.concat(b),function(E,L,R){L=L||[];const D=(E=E||[]).map(Ri),U=L.map(Ri),V=E.reduce(zi,{}),J=L.reduce(zi,{}),tt=D.slice(),st=Object.create(null);let dt,wt,Pt,Zt,Nt;for(let Vt=0,se=0;Vt<D.length;Vt++)dt=D[Vt],Object.prototype.hasOwnProperty.call(J,dt)?se++:(Ee(R,{command:"removeLayer",args:[dt]}),tt.splice(tt.indexOf(dt,se),1));for(let Vt=0,se=0;Vt<U.length;Vt++)dt=U[U.length-1-Vt],tt[tt.length-1-Vt]!==dt&&(Object.prototype.hasOwnProperty.call(V,dt)?(Ee(R,{command:"removeLayer",args:[dt]}),tt.splice(tt.lastIndexOf(dt,tt.length-se),1)):se++,Zt=tt[tt.length-Vt],Ee(R,{command:"addLayer",args:[J[dt],Zt]}),tt.splice(tt.length-Vt,0,dt),st[dt]=!0);for(let Vt=0;Vt<U.length;Vt++)if(dt=U[Vt],wt=V[dt],Pt=J[dt],!st[dt]&&!de(wt,Pt))if(de(wt.source,Pt.source)&&de(wt["source-layer"],Pt["source-layer"])&&de(wt.type,Pt.type)){for(Nt in vi(wt.layout,Pt.layout,R,dt,null,"setLayoutProperty"),vi(wt.paint,Pt.paint,R,dt,null,"setPaintProperty"),de(wt.filter,Pt.filter)||Ee(R,{command:"setFilter",args:[dt,Pt.filter]}),de(wt.minzoom,Pt.minzoom)&&de(wt.maxzoom,Pt.maxzoom)||Ee(R,{command:"setLayerZoomRange",args:[dt,Pt.minzoom,Pt.maxzoom]}),wt)Object.prototype.hasOwnProperty.call(wt,Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?vi(wt[Nt],Pt[Nt],R,dt,Nt.slice(6),"setPaintProperty"):de(wt[Nt],Pt[Nt])||Ee(R,{command:"setLayerProperty",args:[dt,Nt,Pt[Nt]]}));for(Nt in Pt)Object.prototype.hasOwnProperty.call(Pt,Nt)&&!Object.prototype.hasOwnProperty.call(wt,Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?vi(wt[Nt],Pt[Nt],R,dt,Nt.slice(6),"setPaintProperty"):de(wt[Nt],Pt[Nt])||Ee(R,{command:"setLayerProperty",args:[dt,Nt,Pt[Nt]]}))}else Ee(R,{command:"removeLayer",args:[dt]}),Zt=tt[tt.lastIndexOf(dt)+1],Ee(R,{command:"addLayer",args:[Pt,Zt]})}(x,a.layers,d)}catch(p){console.warn("Unable to compute style diff:",p),d=[{command:"setStyle",args:[a]}]}return d},c.aD=function(h){const a=[],d=h.id;return d===void 0&&a.push({message:`layers.${d}: missing required property "id"`}),h.render===void 0&&a.push({message:`layers.${d}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&a.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),a},c.aE=function h(a,d){if(Array.isArray(a)){if(!Array.isArray(d)||a.length!==d.length)return!1;for(let p=0;p<a.length;p++)if(!h(a[p],d[p]))return!1;return!0}if(typeof a=="object"&&a!==null&&d!==null){if(typeof d!="object"||Object.keys(a).length!==Object.keys(d).length)return!1;for(const p in a)if(!h(a[p],d[p]))return!1;return!0}return a===d},c.aF=Ut,c.aG=zt,c.aH=class extends tc{constructor(h,a){super(h,a),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},c.aI=cu,c.aJ=class extends tc{constructor(h,a){super(h,a),this.current=uu}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let a=1;a<16;a++)if(h[a]!==this.current[a]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},c.aK=hu,c.aL=Ku,c.aM=$i,c.aN=class extends tc{constructor(h,a){super(h,a),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},c.aO=class extends tc{constructor(h,a){super(h,a),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},c.aP=function(h,a,d,p,b,x,E){var L=1/(a-d),R=1/(p-b),D=1/(x-E);return h[0]=-2*L,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*R,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*D,h[11]=0,h[12]=(a+d)*L,h[13]=(b+p)*R,h[14]=(E+x)*D,h[15]=1,h},c.aQ=TT,c.aR=class extends vt{},c.aS=_C,c.aT=class extends It{},c.aU=s0,c.aV=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},c.aW=Zv,c.aX=jr,c.aY=jn,c.aZ=class extends we{},c.a_=function(h,a){return h[0]===a[0]&&h[1]===a[1]&&h[2]===a[2]&&h[3]===a[3]&&h[4]===a[4]&&h[5]===a[5]&&h[6]===a[6]&&h[7]===a[7]&&h[8]===a[8]&&h[9]===a[9]&&h[10]===a[10]&&h[11]===a[11]&&h[12]===a[12]&&h[13]===a[13]&&h[14]===a[14]&&h[15]===a[15]},c.aa=function(h){const a={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,p,b,x)=>{const E=b||x;return a[p]=!E||E.toLowerCase(),""}),a["max-age"]){const d=parseInt(a["max-age"],10);isNaN(d)?delete a["max-age"]:a["max-age"]=d}return a},c.ab=function(h,a){const d=[];for(const p in h)p in a||d.push(p);return d},c.ac=Et,c.ad=function(h,a,d){var p=Math.sin(d),b=Math.cos(d),x=a[0],E=a[1],L=a[2],R=a[3],D=a[4],U=a[5],V=a[6],J=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=x*b+D*p,h[1]=E*b+U*p,h[2]=L*b+V*p,h[3]=R*b+J*p,h[4]=D*b-x*p,h[5]=U*b-E*p,h[6]=V*b-L*p,h[7]=J*b-R*p,h},c.ae=function(h){var a=new nd(16);return a[0]=h[0],a[1]=h[1],a[2]=h[2],a[3]=h[3],a[4]=h[4],a[5]=h[5],a[6]=h[6],a[7]=h[7],a[8]=h[8],a[9]=h[9],a[10]=h[10],a[11]=h[11],a[12]=h[12],a[13]=h[13],a[14]=h[14],a[15]=h[15],a},c.af=Xf,c.ag=function(h,a){let d=0,p=0;if(h.kind==="constant")p=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:b,minZoom:x,maxZoom:E}=h,L=b?Et(ui.interpolationFactor(b,a,x,E),0,1):0;h.kind==="camera"?p=Pn.number(h.minSize,h.maxSize,L):d=L}return{uSizeT:d,uSize:p}},c.ai=function(h,a,d){let{uSize:p,uSizeT:b}=a,{lowerSize:x,upperSize:E}=d;return h.kind==="source"?x/sc:h.kind==="composite"?Pn.number(x/sc,E/sc,b):p},c.aj=x0,c.ak=function(h,a,d,p){const b=a.y-h.y,x=a.x-h.x,E=p.y-d.y,L=p.x-d.x,R=E*x-L*b;if(R===0)return null;const D=(L*(h.y-d.y)-E*(h.x-d.x))/R;return new T(h.x+D*x,h.y+D*b)},c.al=$b,c.am=ed,c.an=i0,c.ao=function(h){let a=1/0,d=1/0,p=-1/0,b=-1/0;for(const x of h)a=Math.min(a,x.x),d=Math.min(d,x.y),p=Math.max(p,x.x),b=Math.max(b,x.y);return[a,d,p,b]},c.ap=Mn,c.ar=b0,c.as=function(h,a){var d=a[0],p=a[1],b=a[2],x=a[3],E=a[4],L=a[5],R=a[6],D=a[7],U=a[8],V=a[9],J=a[10],tt=a[11],st=a[12],dt=a[13],wt=a[14],Pt=a[15],Zt=d*L-p*E,Nt=d*R-b*E,Vt=d*D-x*E,se=p*R-b*L,Te=p*D-x*L,Ge=b*D-x*R,mi=U*dt-V*st,je=U*wt-J*st,Oe=U*Pt-tt*st,ri=V*wt-J*dt,Xe=V*Pt-tt*dt,qe=J*Pt-tt*wt,fe=Zt*qe-Nt*Xe+Vt*ri+se*Oe-Te*je+Ge*mi;return fe?(h[0]=(L*qe-R*Xe+D*ri)*(fe=1/fe),h[1]=(b*Xe-p*qe-x*ri)*fe,h[2]=(dt*Ge-wt*Te+Pt*se)*fe,h[3]=(J*Te-V*Ge-tt*se)*fe,h[4]=(R*Oe-E*qe-D*je)*fe,h[5]=(d*qe-b*Oe+x*je)*fe,h[6]=(wt*Vt-st*Ge-Pt*Nt)*fe,h[7]=(U*Ge-J*Vt+tt*Nt)*fe,h[8]=(E*Xe-L*Oe+D*mi)*fe,h[9]=(p*Oe-d*Xe-x*mi)*fe,h[10]=(st*Te-dt*Vt+Pt*Zt)*fe,h[11]=(V*Vt-U*Te-tt*Zt)*fe,h[12]=(L*je-E*ri-R*mi)*fe,h[13]=(d*ri-p*je+b*mi)*fe,h[14]=(dt*Nt-st*se-wt*Zt)*fe,h[15]=(U*se-V*Nt+J*Zt)*fe,h):null},c.at=I0,c.au=v0,c.av=L0,c.aw=function(){const h={},a=it.$version;for(const d in it.$root){const p=it.$root[d];if(p.required){let b=null;b=d==="version"?a:p.type==="array"?[]:{},b!=null&&(h[d]=b)}}return h},c.ax=Do,c.ay=Jt,c.az=function(h){h=h.slice();const a=Object.create(null);for(let d=0;d<h.length;d++)a[h[d].id]=h[d];for(let d=0;d<h.length;d++)"ref"in h[d]&&(h[d]=Ke(h[d],a[h[d].ref]));return h},c.b=re,c.b0=function(h,a){return h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h},c.b1=function(h,a,d){return h[0]=a[0]*d[0],h[1]=a[1]*d[1],h[2]=a[2]*d[2],h[3]=a[3]*d[3],h},c.b2=function(h,a){return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]*a[3]},c.b3=Ft,c.b4=Gb,c.b5=jb,c.b6=function(h,a,d,p,b){var x,E=1/Math.tan(a/2);return h[0]=E/d,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=E,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,b!=null&&b!==1/0?(h[10]=(b+p)*(x=1/(p-b)),h[14]=2*b*p*x):(h[10]=-1,h[14]=-2*p),h},c.b7=function(h,a,d){var p=Math.sin(d),b=Math.cos(d),x=a[4],E=a[5],L=a[6],R=a[7],D=a[8],U=a[9],V=a[10],J=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=x*b+D*p,h[5]=E*b+U*p,h[6]=L*b+V*p,h[7]=R*b+J*p,h[8]=D*b-x*p,h[9]=U*b-E*p,h[10]=V*b-L*p,h[11]=J*b-R*p,h},c.b8=ot,c.b9=gt,c.bA=fb,c.bB=function(h){return h.message===nt},c.bC=Nn,c.bD=Ts,c.ba=function(h){return h*Math.PI/180},c.bb=function(h,a){const{x:d,y:p}=Ip.fromLngLat(a);return!(h<0||h>25||p<0||p>=1||d<0||d>=1)},c.bc=function(h,a){return h[0]=a[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=a[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=a[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},c.bd=class extends F{},c.be=E0,c.bf=tP,c.bh=Ht,c.bi=function(h,a){Tt.REGISTERED_PROTOCOLS[h]=a},c.bj=function(h){delete Tt.REGISTERED_PROTOCOLS[h]},c.bk=function(h,a){const d={};for(let b=0;b<h.length;b++){const x=a&&a[h[b].id]||Kh(h[b]);a&&(a[h[b].id]=x);let E=d[x];E||(E=d[x]=[]),E.push(h[b])}const p=[];for(const b in d)p.push(d[b]);return p},c.bl=Ve,c.bm=qb,c.bn=Wb,c.bo=Sb,c.bp=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Fr/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const a=h.bucket.layers[0],d=a.layout,p=a._unevaluatedLayout._values,b={layoutIconSize:p["icon-size"].possiblyEvaluate(new br(h.bucket.zoom+1),h.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new br(h.bucket.zoom+1),h.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new br(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:U}=h.bucket.textSizeData;b.compositeTextSizes=[p["text-size"].possiblyEvaluate(new br(D),h.canonical),p["text-size"].possiblyEvaluate(new br(U),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:U}=h.bucket.iconSizeData;b.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new br(D),h.canonical),p["icon-size"].possiblyEvaluate(new br(U),h.canonical)]}const x=d.get("text-line-height")*Mn,E=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",L=d.get("text-keep-upright"),R=d.get("text-size");for(const D of h.bucket.features){const U=d.get("text-font").evaluate(D,{},h.canonical).join(","),V=R.evaluate(D,{},h.canonical),J=b.layoutTextSize.evaluate(D,{},h.canonical),tt=b.layoutIconSize.evaluate(D,{},h.canonical),st={horizontal:{},vertical:void 0},dt=D.text;let wt,Pt=[0,0];if(dt){const Vt=dt.toString(),se=d.get("text-letter-spacing").evaluate(D,{},h.canonical)*Mn,Te=cp(Vt)?se:0,Ge=d.get("text-anchor").evaluate(D,{},h.canonical),mi=n2(a,D,h.canonical);if(!mi){const Xe=d.get("text-radial-offset").evaluate(D,{},h.canonical);Pt=Xe?r2(Ge,[Xe*Mn,P0]):d.get("text-offset").evaluate(D,{},h.canonical).map(qe=>qe*Mn)}let je=E?"center":d.get("text-justify").evaluate(D,{},h.canonical);const Oe=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(D,{},h.canonical)*Mn:1/0,ri=()=>{h.bucket.allowVerticalPlacement&&su(Vt)&&(st.vertical=Qf(dt,h.glyphMap,h.glyphPositions,h.imagePositions,U,Oe,x,Ge,"left",Te,Pt,c.ah.vertical,!0,J,V))};if(!E&&mi){const Xe=new Set;if(je==="auto")for(let fe=0;fe<mi.values.length;fe+=2)Xe.add(I0(mi.values[fe]));else Xe.add(je);let qe=!1;for(const fe of Xe)if(!st.horizontal[fe])if(qe)st.horizontal[fe]=st.horizontal[0];else{const ni=Qf(dt,h.glyphMap,h.glyphPositions,h.imagePositions,U,Oe,x,"center",fe,Te,Pt,c.ah.horizontal,!1,J,V);ni&&(st.horizontal[fe]=ni,qe=ni.positionedLines.length===1)}ri()}else{je==="auto"&&(je=I0(Ge));const Xe=Qf(dt,h.glyphMap,h.glyphPositions,h.imagePositions,U,Oe,x,Ge,je,Te,Pt,c.ah.horizontal,!1,J,V);Xe&&(st.horizontal[je]=Xe),ri(),su(Vt)&&E&&L&&(st.vertical=Qf(dt,h.glyphMap,h.glyphPositions,h.imagePositions,U,Oe,x,Ge,je,Te,Pt,c.ah.vertical,!1,J,V))}}let Zt=!1;if(D.icon&&D.icon.name){const Vt=h.imageMap[D.icon.name];Vt&&(wt=DC(h.imagePositions[D.icon.name],d.get("icon-offset").evaluate(D,{},h.canonical),d.get("icon-anchor").evaluate(D,{},h.canonical)),Zt=!!Vt.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=Zt:h.bucket.sdfIcons!==Zt&&Lt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Vt.pixelRatio!==h.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Nt=o2(st.horizontal)||st.vertical;h.bucket.iconsInText=!!Nt&&Nt.iconsInText,(Nt||wt)&&KC(h.bucket,D,st,wt,h.imageMap,b,J,tt,Pt,Zt,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},c.bq=p0,c.br=h0,c.bs=d0,c.bt=wh,c.bu=m0,c.bv=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},c.bw=function(h,a,d,p,b){return l(this,void 0,void 0,function*(){if(Z())try{return yield ce(h,a,d,p,b)}catch{}return function(x,E,L,R,D){const U=x.width,V=x.height;le&&Be||(le=new OffscreenCanvas(U,V),Be=le.getContext("2d",{willReadFrequently:!0})),le.width=U,le.height=V,Be.drawImage(x,0,0,U,V);const J=Be.getImageData(E,L,R,D);return Be.clearRect(0,0,U,V),J.data}(h,a,d,p,b)})},c.bx=Vb,c.by=_,c.bz=v,c.c=St,c.d=h=>l(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(a)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=Mt,c.f=h=>new Promise((a,d)=>{const p=new Image;p.onload=()=>{a(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Yt})},p.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(h)],{type:"image/png"});p.src=h.byteLength?URL.createObjectURL(b):Yt}),c.g=jt,c.h=(h,a)=>$t(Mt(h,{type:"json"}),a),c.i=ee,c.j=si,c.k=Ne,c.l=(h,a)=>$t(Mt(h,{type:"arrayBuffer"}),a),c.m=$t,c.n=function(h){return new m0(h).readFields(IC,[])},c.o=vp,c.p=wb,c.q=m,c.r=kc,c.s=Ae,c.t=nu,c.u=na,c.v=it,c.w=Lt,c.x=function(h){let[a,d,p]=h;return d+=90,d*=Math.PI/180,p*=Math.PI/180,{x:a*Math.cos(d)*Math.sin(p),y:a*Math.sin(d)*Math.sin(p),z:a*Math.cos(p)}},c.y=Pn,c.z=br}),n("worker",["./shared"],function(c){class l{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,K){for(const _t of Y){this._layerConfigs[_t.id]=_t;const kt=this._layers[_t.id]=c.aA(_t);kt._featureFilter=c.a7(kt.filter),this.keyCache[_t.id]&&delete this.keyCache[_t.id]}for(const _t of K)delete this.keyCache[_t],delete this._layerConfigs[_t],delete this._layers[_t];this.familiesBySource={};const ct=c.bk(Object.values(this._layerConfigs),this.keyCache);for(const _t of ct){const kt=_t.map(Wt=>this._layers[Wt.id]),Gt=kt[0];if(Gt.visibility==="none")continue;const Rt=Gt.source||"";let Ct=this.familiesBySource[Rt];Ct||(Ct=this.familiesBySource[Rt]={});const te=Gt.sourceLayer||"_geojsonTileLayer";let he=Ct[te];he||(he=Ct[te]=[]),he.push(kt)}}}class _{constructor(Y){const K={},ct=[];for(const Rt in Y){const Ct=Y[Rt],te=K[Rt]={};for(const he in Ct){const Wt=Ct[+he];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const be={x:0,y:0,w:Wt.bitmap.width+2,h:Wt.bitmap.height+2};ct.push(be),te[he]={rect:be,metrics:Wt.metrics}}}const{w:_t,h:kt}=c.p(ct),Gt=new c.o({width:_t||1,height:kt||1});for(const Rt in Y){const Ct=Y[Rt];for(const te in Ct){const he=Ct[+te];if(!he||he.bitmap.width===0||he.bitmap.height===0)continue;const Wt=K[Rt][te].rect;c.o.copy(he.bitmap,Gt,{x:0,y:0},{x:Wt.x+1,y:Wt.y+1},he.bitmap)}}this.image=Gt,this.positions=K}}c.bl("GlyphAtlas",_);class v{constructor(Y){this.tileID=new c.S(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,K,ct,_t){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new c.a5;const kt=new c.bm(Object.keys(Y.layers).sort()),Gt=new c.bn(this.tileID,this.promoteId);Gt.bucketLayerIDs=[];const Rt={},Ct={featureIndex:Gt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ct},te=K.familiesBySource[this.source];for(const hi in te){const Fi=Y.layers[hi];if(!Fi)continue;Fi.version===1&&c.w(`Vector tile source "${this.source}" layer "${hi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qi=kt.encode(hi),pr=[];for(let Ar=0;Ar<Fi.length;Ar++){const $r=Fi.feature(Ar),so=Gt.getId($r,hi);pr.push({feature:$r,id:so,index:Ar,sourceLayerIndex:Qi})}for(const Ar of te[hi]){const $r=Ar[0];$r.source!==this.source&&c.w(`layer.source = ${$r.source} does not equal this.source = ${this.source}`),$r.minzoom&&this.zoom<Math.floor($r.minzoom)||$r.maxzoom&&this.zoom>=$r.maxzoom||$r.visibility!=="none"&&(S(Ar,this.zoom,ct),(Rt[$r.id]=$r.createBucket({index:Gt.bucketLayerIDs.length,layers:Ar,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qi,sourceID:this.source})).populate(pr,Ct,this.tileID.canonical),Gt.bucketLayerIDs.push(Ar.map(so=>so.id)))}}const he=c.aF(Ct.glyphDependencies,hi=>Object.keys(hi).map(Number));this.inFlightDependencies.forEach(hi=>hi==null?void 0:hi.abort()),this.inFlightDependencies=[];let Wt=Promise.resolve({});if(Object.keys(he).length){const hi=new AbortController;this.inFlightDependencies.push(hi),Wt=_t.sendAsync({type:"GG",data:{stacks:he,source:this.source,tileID:this.tileID,type:"glyphs"}},hi)}const be=Object.keys(Ct.iconDependencies);let We=Promise.resolve({});if(be.length){const hi=new AbortController;this.inFlightDependencies.push(hi),We=_t.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},hi)}const Je=Object.keys(Ct.patternDependencies);let Li=Promise.resolve({});if(Je.length){const hi=new AbortController;this.inFlightDependencies.push(hi),Li=_t.sendAsync({type:"GI",data:{icons:Je,source:this.source,tileID:this.tileID,type:"patterns"}},hi)}const[Qe,Ci,xi]=yield Promise.all([Wt,We,Li]),rr=new _(Qe),Hi=new c.bo(Ci,xi);for(const hi in Rt){const Fi=Rt[hi];Fi instanceof c.a6?(S(Fi.layers,this.zoom,ct),c.bp({bucket:Fi,glyphMap:Qe,glyphPositions:rr.positions,imageMap:Ci,imagePositions:Hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Fi.hasPattern&&(Fi instanceof c.bq||Fi instanceof c.br||Fi instanceof c.bs)&&(S(Fi.layers,this.zoom,ct),Fi.addFeatures(Ct,this.tileID.canonical,Hi.patternPositions))}return this.status="done",{buckets:Object.values(Rt).filter(hi=>!hi.isEmpty()),featureIndex:Gt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rr.image,imageAtlas:Hi,glyphMap:this.returnDependencies?Qe:null,iconMap:this.returnDependencies?Ci:null,glyphPositions:this.returnDependencies?rr.positions:null}})}}function S(xt,Y,K){const ct=new c.z(Y);for(const _t of xt)_t.recalculate(ct,K)}class T{constructor(Y,K,ct){this.actor=Y,this.layerIndex=K,this.availableImages=ct,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,K){return c._(this,void 0,void 0,function*(){const ct=yield c.l(Y.request,K);try{return{vectorTile:new c.bt.VectorTile(new c.bu(ct.data)),rawData:ct.data,cacheControl:ct.cacheControl,expires:ct.expires}}catch(_t){const kt=new Uint8Array(ct.data);let Gt=`Unable to parse the tile at ${Y.request.url}, `;throw Gt+=kt[0]===31&&kt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_t.message}`,new Error(Gt)}})}loadTile(Y){return c._(this,void 0,void 0,function*(){const K=Y.uid,ct=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new c.bv(Y.request),_t=new v(Y);this.loading[K]=_t;const kt=new AbortController;_t.abort=kt;try{const Gt=yield this.loadVectorTile(Y,kt);if(delete this.loading[K],!Gt)return null;const Rt=Gt.rawData,Ct={};Gt.expires&&(Ct.expires=Gt.expires),Gt.cacheControl&&(Ct.cacheControl=Gt.cacheControl);const te={};if(ct){const Wt=ct.finish();Wt&&(te.resourceTiming=JSON.parse(JSON.stringify(Wt)))}_t.vectorTile=Gt.vectorTile;const he=_t.parse(Gt.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[K]=_t,this.fetching[K]={rawTileData:Rt,cacheControl:Ct,resourceTiming:te};try{const Wt=yield he;return c.e({rawTileData:Rt.slice(0)},Wt,Ct,te)}finally{delete this.fetching[K]}}catch(Gt){throw delete this.loading[K],_t.status="done",this.loaded[K]=_t,Gt}})}reloadTile(Y){return c._(this,void 0,void 0,function*(){const K=Y.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ct=this.loaded[K];if(ct.showCollisionBoxes=Y.showCollisionBoxes,ct.status==="parsing"){const _t=yield ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor);let kt;if(this.fetching[K]){const{rawTileData:Gt,cacheControl:Rt,resourceTiming:Ct}=this.fetching[K];delete this.fetching[K],kt=c.e({rawTileData:Gt.slice(0)},_t,Rt,Ct)}else kt=_t;return kt}if(ct.status==="done"&&ct.vectorTile)return ct.parse(ct.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Y){return c._(this,void 0,void 0,function*(){const K=this.loading,ct=Y.uid;K&&K[ct]&&K[ct].abort&&(K[ct].abort.abort(),delete K[ct])})}removeTile(Y){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]})}}class P{constructor(){this.loaded={}}loadTile(Y){return c._(this,void 0,void 0,function*(){const{uid:K,encoding:ct,rawImageData:_t,redFactor:kt,greenFactor:Gt,blueFactor:Rt,baseShift:Ct}=Y,te=_t.width+2,he=_t.height+2,Wt=c.b(_t)?new c.R({width:te,height:he},yield c.bw(_t,-1,-1,te,he)):_t,be=new c.bx(K,Wt,ct,kt,Gt,Rt,Ct);return this.loaded=this.loaded||{},this.loaded[K]=be,be})}removeTile(Y){const K=this.loaded,ct=Y.uid;K&&K[ct]&&delete K[ct]}}function I(xt,Y){if(xt.length!==0){z(xt[0],Y);for(var K=1;K<xt.length;K++)z(xt[K],!Y)}}function z(xt,Y){for(var K=0,ct=0,_t=0,kt=xt.length,Gt=kt-1;_t<kt;Gt=_t++){var Rt=(xt[_t][0]-xt[Gt][0])*(xt[Gt][1]+xt[_t][1]),Ct=K+Rt;ct+=Math.abs(K)>=Math.abs(Rt)?K-Ct+Rt:Rt-Ct+K,K=Ct}K+ct>=0!=!!Y&&xt.reverse()}var N=c.by(function xt(Y,K){var ct,_t=Y&&Y.type;if(_t==="FeatureCollection")for(ct=0;ct<Y.features.length;ct++)xt(Y.features[ct],K);else if(_t==="GeometryCollection")for(ct=0;ct<Y.geometries.length;ct++)xt(Y.geometries[ct],K);else if(_t==="Feature")xt(Y.geometry,K);else if(_t==="Polygon")I(Y.coordinates,K);else if(_t==="MultiPolygon")for(ct=0;ct<Y.coordinates.length;ct++)I(Y.coordinates[ct],K);return Y});const X=c.bt.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},Z=c.bz,ot=c.bt.VectorTileFeature,gt=Et;function Et(xt,Y){this.options=Y||{},this.features=xt,this.length=xt.length}function Ft(xt,Y){this.id=typeof xt.id=="number"?xt.id:void 0,this.type=xt.type,this.rawGeometry=xt.type===1?[xt.geometry]:xt.geometry,this.properties=xt.tags,this.extent=Y||4096}Et.prototype.feature=function(xt){return new Ft(this.features[xt],this.options.extent)},Ft.prototype.loadGeometry=function(){var xt=this.rawGeometry;this.geometry=[];for(var Y=0;Y<xt.length;Y++){for(var K=xt[Y],ct=[],_t=0;_t<K.length;_t++)ct.push(new Z(K[_t][0],K[_t][1]));this.geometry.push(ct)}return this.geometry},Ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var xt=this.geometry,Y=1/0,K=-1/0,ct=1/0,_t=-1/0,kt=0;kt<xt.length;kt++)for(var Gt=xt[kt],Rt=0;Rt<Gt.length;Rt++){var Ct=Gt[Rt];Y=Math.min(Y,Ct.x),K=Math.max(K,Ct.x),ct=Math.min(ct,Ct.y),_t=Math.max(_t,Ct.y)}return[Y,ct,K,_t]},Ft.prototype.toGeoJSON=ot.prototype.toGeoJSON;var Mt=c.bA,yt=gt;function Ut(xt){var Y=new Mt;return function(K,ct){for(var _t in K.layers)ct.writeMessage(3,zt,K.layers[_t])}(xt,Y),Y.finish()}function zt(xt,Y){var K;Y.writeVarintField(15,xt.version||1),Y.writeStringField(1,xt.name||""),Y.writeVarintField(5,xt.extent||4096);var ct={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<xt.length;K++)ct.feature=xt.feature(K),Y.writeMessage(2,at,ct);var _t=ct.keys;for(K=0;K<_t.length;K++)Y.writeStringField(3,_t[K]);var kt=ct.values;for(K=0;K<kt.length;K++)Y.writeMessage(4,ie,kt[K])}function at(xt,Y){var K=xt.feature;K.id!==void 0&&Y.writeVarintField(1,K.id),Y.writeMessage(2,pt,xt),Y.writeVarintField(3,K.type),Y.writeMessage(4,ee,K)}function pt(xt,Y){var K=xt.feature,ct=xt.keys,_t=xt.values,kt=xt.keycache,Gt=xt.valuecache;for(var Rt in K.properties){var Ct=K.properties[Rt],te=kt[Rt];if(Ct!==null){te===void 0&&(ct.push(Rt),kt[Rt]=te=ct.length-1),Y.writeVarint(te);var he=typeof Ct;he!=="string"&&he!=="boolean"&&he!=="number"&&(Ct=JSON.stringify(Ct));var Wt=he+":"+Ct,be=Gt[Wt];be===void 0&&(_t.push(Ct),Gt[Wt]=be=_t.length-1),Y.writeVarint(be)}}}function Lt(xt,Y){return(Y<<3)+(7&xt)}function bt(xt){return xt<<1^xt>>31}function ee(xt,Y){for(var K=xt.loadGeometry(),ct=xt.type,_t=0,kt=0,Gt=K.length,Rt=0;Rt<Gt;Rt++){var Ct=K[Rt],te=1;ct===1&&(te=Ct.length),Y.writeVarint(Lt(1,te));for(var he=ct===3?Ct.length-1:Ct.length,Wt=0;Wt<he;Wt++){Wt===1&&ct!==1&&Y.writeVarint(Lt(2,he-1));var be=Ct[Wt].x-_t,We=Ct[Wt].y-kt;Y.writeVarint(bt(be)),Y.writeVarint(bt(We)),_t+=be,kt+=We}ct===3&&Y.writeVarint(Lt(7,1))}}function ie(xt,Y){var K=typeof xt;K==="string"?Y.writeStringField(1,xt):K==="boolean"?Y.writeBooleanField(7,xt):K==="number"&&(xt%1!=0?Y.writeDoubleField(3,xt):xt<0?Y.writeSVarintField(6,xt):Y.writeVarintField(5,xt))}H.exports=Ut,H.exports.fromVectorTileJs=Ut,H.exports.fromGeojsonVt=function(xt,Y){Y=Y||{};var K={};for(var ct in xt)K[ct]=new yt(xt[ct].features,Y),K[ct].name=ct,K[ct].version=Y.version,K[ct].extent=Y.extent;return Ut({layers:K})},H.exports.GeoJSONWrapper=yt;var re=c.by(H.exports);const Yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xt=>xt},ce=Math.fround||(le=new Float32Array(1),xt=>(le[0]=+xt,le[0]));var le;const Be=3,nt=5,St=6;class Tt{constructor(Y){this.options=Object.assign(Object.create(Yt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:K,minZoom:ct,maxZoom:_t}=this.options;K&&console.time("total time");const kt=`prepare ${Y.length} points`;K&&console.time(kt),this.points=Y;const Gt=[];for(let Ct=0;Ct<Y.length;Ct++){const te=Y[Ct];if(!te.geometry)continue;const[he,Wt]=te.geometry.coordinates,be=ce(Ht(he)),We=ce(Jt(Wt));Gt.push(be,We,1/0,Ct,-1,1),this.options.reduce&&Gt.push(0)}let Rt=this.trees[_t+1]=this._createTree(Gt);K&&console.timeEnd(kt);for(let Ct=_t;Ct>=ct;Ct--){const te=+Date.now();Rt=this.trees[Ct]=this._createTree(this._cluster(Rt,Ct)),K&&console.log("z%d: %d clusters in %dms",Ct,Rt.numItems,+Date.now()-te)}return K&&console.timeEnd("total time"),this}getClusters(Y,K){let ct=((Y[0]+180)%360+360)%360-180;const _t=Math.max(-90,Math.min(90,Y[1]));let kt=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Gt=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ct=-180,kt=180;else if(ct>kt){const Wt=this.getClusters([ct,_t,180,Gt],K),be=this.getClusters([-180,_t,kt,Gt],K);return Wt.concat(be)}const Rt=this.trees[this._limitZoom(K)],Ct=Rt.range(Ht(ct),Jt(Gt),Ht(kt),Jt(_t)),te=Rt.data,he=[];for(const Wt of Ct){const be=this.stride*Wt;he.push(te[be+nt]>1?jt(te,be,this.clusterProps):this.points[te[be+Be]])}return he}getChildren(Y){const K=this._getOriginId(Y),ct=this._getOriginZoom(Y),_t="No cluster with the specified id.",kt=this.trees[ct];if(!kt)throw new Error(_t);const Gt=kt.data;if(K*this.stride>=Gt.length)throw new Error(_t);const Rt=this.options.radius/(this.options.extent*Math.pow(2,ct-1)),Ct=kt.within(Gt[K*this.stride],Gt[K*this.stride+1],Rt),te=[];for(const he of Ct){const Wt=he*this.stride;Gt[Wt+4]===Y&&te.push(Gt[Wt+nt]>1?jt(Gt,Wt,this.clusterProps):this.points[Gt[Wt+Be]])}if(te.length===0)throw new Error(_t);return te}getLeaves(Y,K,ct){const _t=[];return this._appendLeaves(_t,Y,K=K||10,ct=ct||0,0),_t}getTile(Y,K,ct){const _t=this.trees[this._limitZoom(Y)],kt=Math.pow(2,Y),{extent:Gt,radius:Rt}=this.options,Ct=Rt/Gt,te=(ct-Ct)/kt,he=(ct+1+Ct)/kt,Wt={features:[]};return this._addTileFeatures(_t.range((K-Ct)/kt,te,(K+1+Ct)/kt,he),_t.data,K,ct,kt,Wt),K===0&&this._addTileFeatures(_t.range(1-Ct/kt,te,1,he),_t.data,kt,ct,kt,Wt),K===kt-1&&this._addTileFeatures(_t.range(0,te,Ct/kt,he),_t.data,-1,ct,kt,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(Y){let K=this._getOriginZoom(Y)-1;for(;K<=this.options.maxZoom;){const ct=this.getChildren(Y);if(K++,ct.length!==1)break;Y=ct[0].properties.cluster_id}return K}_appendLeaves(Y,K,ct,_t,kt){const Gt=this.getChildren(K);for(const Rt of Gt){const Ct=Rt.properties;if(Ct&&Ct.cluster?kt+Ct.point_count<=_t?kt+=Ct.point_count:kt=this._appendLeaves(Y,Ct.cluster_id,ct,_t,kt):kt<_t?kt++:Y.push(Rt),Y.length===ct)break}return kt}_createTree(Y){const K=new c.av(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ct=0;ct<Y.length;ct+=this.stride)K.add(Y[ct],Y[ct+1]);return K.finish(),K.data=Y,K}_addTileFeatures(Y,K,ct,_t,kt,Gt){for(const Rt of Y){const Ct=Rt*this.stride,te=K[Ct+nt]>1;let he,Wt,be;if(te)he=qt(K,Ct,this.clusterProps),Wt=K[Ct],be=K[Ct+1];else{const Li=this.points[K[Ct+Be]];he=Li.properties;const[Qe,Ci]=Li.geometry.coordinates;Wt=Ht(Qe),be=Jt(Ci)}const We={type:1,geometry:[[Math.round(this.options.extent*(Wt*kt-ct)),Math.round(this.options.extent*(be*kt-_t))]],tags:he};let Je;Je=te||this.options.generateId?K[Ct+Be]:this.points[K[Ct+Be]].id,Je!==void 0&&(We.id=Je),Gt.features.push(We)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,K){const{radius:ct,extent:_t,reduce:kt,minPoints:Gt}=this.options,Rt=ct/(_t*Math.pow(2,K)),Ct=Y.data,te=[],he=this.stride;for(let Wt=0;Wt<Ct.length;Wt+=he){if(Ct[Wt+2]<=K)continue;Ct[Wt+2]=K;const be=Ct[Wt],We=Ct[Wt+1],Je=Y.within(Ct[Wt],Ct[Wt+1],Rt),Li=Ct[Wt+nt];let Qe=Li;for(const Ci of Je){const xi=Ci*he;Ct[xi+2]>K&&(Qe+=Ct[xi+nt])}if(Qe>Li&&Qe>=Gt){let Ci,xi=be*Li,rr=We*Li,Hi=-1;const hi=((Wt/he|0)<<5)+(K+1)+this.points.length;for(const Fi of Je){const Qi=Fi*he;if(Ct[Qi+2]<=K)continue;Ct[Qi+2]=K;const pr=Ct[Qi+nt];xi+=Ct[Qi]*pr,rr+=Ct[Qi+1]*pr,Ct[Qi+4]=hi,kt&&(Ci||(Ci=this._map(Ct,Wt,!0),Hi=this.clusterProps.length,this.clusterProps.push(Ci)),kt(Ci,this._map(Ct,Qi)))}Ct[Wt+4]=hi,te.push(xi/Qe,rr/Qe,1/0,hi,-1,Qe),kt&&te.push(Hi)}else{for(let Ci=0;Ci<he;Ci++)te.push(Ct[Wt+Ci]);if(Qe>1)for(const Ci of Je){const xi=Ci*he;if(!(Ct[xi+2]<=K)){Ct[xi+2]=K;for(let rr=0;rr<he;rr++)te.push(Ct[xi+rr])}}}}return te}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,K,ct){if(Y[K+nt]>1){const Gt=this.clusterProps[Y[K+St]];return ct?Object.assign({},Gt):Gt}const _t=this.points[Y[K+Be]].properties,kt=this.options.map(_t);return ct&&kt===_t?Object.assign({},kt):kt}}function jt(xt,Y,K){return{type:"Feature",id:xt[Y+Be],properties:qt(xt,Y,K),geometry:{type:"Point",coordinates:[(ct=xt[Y],360*(ct-.5)),$t(xt[Y+1])]}};var ct}function qt(xt,Y,K){const ct=xt[Y+nt],_t=ct>=1e4?`${Math.round(ct/1e3)}k`:ct>=1e3?Math.round(ct/100)/10+"k":ct,kt=xt[Y+St],Gt=kt===-1?{}:Object.assign({},K[kt]);return Object.assign(Gt,{cluster:!0,cluster_id:xt[Y+Be],point_count:ct,point_count_abbreviated:_t})}function Ht(xt){return xt/360+.5}function Jt(xt){const Y=Math.sin(xt*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function $t(xt){const Y=(180-360*xt)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ae(xt,Y,K,ct){let _t=ct;const kt=Y+(K-Y>>1);let Gt,Rt=K-Y;const Ct=xt[Y],te=xt[Y+1],he=xt[K],Wt=xt[K+1];for(let be=Y+3;be<K;be+=3){const We=Le(xt[be],xt[be+1],Ct,te,he,Wt);if(We>_t)Gt=be,_t=We;else if(We===_t){const Je=Math.abs(be-kt);Je<Rt&&(Gt=be,Rt=Je)}}_t>ct&&(Gt-Y>3&&Ae(xt,Y,Gt,ct),xt[Gt+2]=_t,K-Gt>3&&Ae(xt,Gt,K,ct))}function Le(xt,Y,K,ct,_t,kt){let Gt=_t-K,Rt=kt-ct;if(Gt!==0||Rt!==0){const Ct=((xt-K)*Gt+(Y-ct)*Rt)/(Gt*Gt+Rt*Rt);Ct>1?(K=_t,ct=kt):Ct>0&&(K+=Gt*Ct,ct+=Rt*Ct)}return Gt=xt-K,Rt=Y-ct,Gt*Gt+Rt*Rt}function Fe(xt,Y,K,ct){const _t={id:xt??null,type:Y,geometry:K,tags:ct,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Ne(_t,K);else if(Y==="Polygon")Ne(_t,K[0]);else if(Y==="MultiLineString")for(const kt of K)Ne(_t,kt);else if(Y==="MultiPolygon")for(const kt of K)Ne(_t,kt[0]);return _t}function Ne(xt,Y){for(let K=0;K<Y.length;K+=3)xt.minX=Math.min(xt.minX,Y[K]),xt.minY=Math.min(xt.minY,Y[K+1]),xt.maxX=Math.max(xt.maxX,Y[K]),xt.maxY=Math.max(xt.maxY,Y[K+1])}function si(xt,Y,K,ct){if(!Y.geometry)return;const _t=Y.geometry.coordinates;if(_t&&_t.length===0)return;const kt=Y.geometry.type,Gt=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Rt=[],Ct=Y.id;if(K.promoteId?Ct=Y.properties[K.promoteId]:K.generateId&&(Ct=ct||0),kt==="Point")oe(_t,Rt);else if(kt==="MultiPoint")for(const te of _t)oe(te,Rt);else if(kt==="LineString")it(_t,Rt,Gt,!1);else if(kt==="MultiLineString"){if(K.lineMetrics){for(const te of _t)Rt=[],it(te,Rt,Gt,!1),xt.push(Fe(Ct,"LineString",Rt,Y.properties));return}pi(_t,Rt,Gt,!1)}else if(kt==="Polygon")pi(_t,Rt,Gt,!0);else{if(kt!=="MultiPolygon"){if(kt==="GeometryCollection"){for(const te of Y.geometry.geometries)si(xt,{id:Ct,geometry:te,properties:Y.properties},K,ct);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const te of _t){const he=[];pi(te,he,Gt,!0),Rt.push(he)}}xt.push(Fe(Ct,kt,Rt,Y.properties))}function oe(xt,Y){Y.push(Ke(xt[0]),de(xt[1]),0)}function it(xt,Y,K,ct){let _t,kt,Gt=0;for(let Ct=0;Ct<xt.length;Ct++){const te=Ke(xt[Ct][0]),he=de(xt[Ct][1]);Y.push(te,he,0),Ct>0&&(Gt+=ct?(_t*he-te*kt)/2:Math.sqrt(Math.pow(te-_t,2)+Math.pow(he-kt,2))),_t=te,kt=he}const Rt=Y.length-3;Y[2]=1,Ae(Y,0,Rt,K),Y[Rt+2]=1,Y.size=Math.abs(Gt),Y.start=0,Y.end=Y.size}function pi(xt,Y,K,ct){for(let _t=0;_t<xt.length;_t++){const kt=[];it(xt[_t],kt,K,ct),Y.push(kt)}}function Ke(xt){return xt/360+.5}function de(xt){const Y=Math.sin(xt*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Ee(xt,Y,K,ct,_t,kt,Gt,Rt){if(ct/=Y,kt>=(K/=Y)&&Gt<ct)return xt;if(Gt<K||kt>=ct)return null;const Ct=[];for(const te of xt){const he=te.geometry;let Wt=te.type;const be=_t===0?te.minX:te.minY,We=_t===0?te.maxX:te.maxY;if(be>=K&&We<ct){Ct.push(te);continue}if(We<K||be>=ct)continue;let Je=[];if(Wt==="Point"||Wt==="MultiPoint")Me(he,Je,K,ct,_t);else if(Wt==="LineString")De(he,Je,K,ct,_t,!1,Rt.lineMetrics);else if(Wt==="MultiLineString")Si(he,Je,K,ct,_t,!1);else if(Wt==="Polygon")Si(he,Je,K,ct,_t,!0);else if(Wt==="MultiPolygon")for(const Li of he){const Qe=[];Si(Li,Qe,K,ct,_t,!0),Qe.length&&Je.push(Qe)}if(Je.length){if(Rt.lineMetrics&&Wt==="LineString"){for(const Li of Je)Ct.push(Fe(te.id,Wt,Li,te.tags));continue}Wt!=="LineString"&&Wt!=="MultiLineString"||(Je.length===1?(Wt="LineString",Je=Je[0]):Wt="MultiLineString"),Wt!=="Point"&&Wt!=="MultiPoint"||(Wt=Je.length===3?"Point":"MultiPoint"),Ct.push(Fe(te.id,Wt,Je,te.tags))}}return Ct.length?Ct:null}function Me(xt,Y,K,ct,_t){for(let kt=0;kt<xt.length;kt+=3){const Gt=xt[kt+_t];Gt>=K&&Gt<=ct&&vi(Y,xt[kt],xt[kt+1],xt[kt+2])}}function De(xt,Y,K,ct,_t,kt,Gt){let Rt=ei(xt);const Ct=_t===0?Ri:zi;let te,he,Wt=xt.start;for(let Qe=0;Qe<xt.length-3;Qe+=3){const Ci=xt[Qe],xi=xt[Qe+1],rr=xt[Qe+2],Hi=xt[Qe+3],hi=xt[Qe+4],Fi=_t===0?Ci:xi,Qi=_t===0?Hi:hi;let pr=!1;Gt&&(te=Math.sqrt(Math.pow(Ci-Hi,2)+Math.pow(xi-hi,2))),Fi<K?Qi>K&&(he=Ct(Rt,Ci,xi,Hi,hi,K),Gt&&(Rt.start=Wt+te*he)):Fi>ct?Qi<ct&&(he=Ct(Rt,Ci,xi,Hi,hi,ct),Gt&&(Rt.start=Wt+te*he)):vi(Rt,Ci,xi,rr),Qi<K&&Fi>=K&&(he=Ct(Rt,Ci,xi,Hi,hi,K),pr=!0),Qi>ct&&Fi<=ct&&(he=Ct(Rt,Ci,xi,Hi,hi,ct),pr=!0),!kt&&pr&&(Gt&&(Rt.end=Wt+te*he),Y.push(Rt),Rt=ei(xt)),Gt&&(Wt+=te)}let be=xt.length-3;const We=xt[be],Je=xt[be+1],Li=_t===0?We:Je;Li>=K&&Li<=ct&&vi(Rt,We,Je,xt[be+2]),be=Rt.length-3,kt&&be>=3&&(Rt[be]!==Rt[0]||Rt[be+1]!==Rt[1])&&vi(Rt,Rt[0],Rt[1],Rt[2]),Rt.length&&Y.push(Rt)}function ei(xt){const Y=[];return Y.size=xt.size,Y.start=xt.start,Y.end=xt.end,Y}function Si(xt,Y,K,ct,_t,kt){for(const Gt of xt)De(Gt,Y,K,ct,_t,kt,!1)}function vi(xt,Y,K,ct){xt.push(Y,K,ct)}function Ri(xt,Y,K,ct,_t,kt){const Gt=(kt-Y)/(ct-Y);return vi(xt,kt,K+(_t-K)*Gt,1),Gt}function zi(xt,Y,K,ct,_t,kt){const Gt=(kt-K)/(_t-K);return vi(xt,Y+(ct-Y)*Gt,kt,1),Gt}function me(xt,Y){const K=[];for(let ct=0;ct<xt.length;ct++){const _t=xt[ct],kt=_t.type;let Gt;if(kt==="Point"||kt==="MultiPoint"||kt==="LineString")Gt=ci(_t.geometry,Y);else if(kt==="MultiLineString"||kt==="Polygon"){Gt=[];for(const Rt of _t.geometry)Gt.push(ci(Rt,Y))}else if(kt==="MultiPolygon"){Gt=[];for(const Rt of _t.geometry){const Ct=[];for(const te of Rt)Ct.push(ci(te,Y));Gt.push(Ct)}}K.push(Fe(_t.id,kt,Gt,_t.tags))}return K}function ci(xt,Y){const K=[];K.size=xt.size,xt.start!==void 0&&(K.start=xt.start,K.end=xt.end);for(let ct=0;ct<xt.length;ct+=3)K.push(xt[ct]+Y,xt[ct+1],xt[ct+2]);return K}function bi(xt,Y){if(xt.transformed)return xt;const K=1<<xt.z,ct=xt.x,_t=xt.y;for(const kt of xt.features){const Gt=kt.geometry,Rt=kt.type;if(kt.geometry=[],Rt===1)for(let Ct=0;Ct<Gt.length;Ct+=2)kt.geometry.push(ke(Gt[Ct],Gt[Ct+1],Y,K,ct,_t));else for(let Ct=0;Ct<Gt.length;Ct++){const te=[];for(let he=0;he<Gt[Ct].length;he+=2)te.push(ke(Gt[Ct][he],Gt[Ct][he+1],Y,K,ct,_t));kt.geometry.push(te)}}return xt.transformed=!0,xt}function ke(xt,Y,K,ct,_t,kt){return[Math.round(K*(xt*ct-_t)),Math.round(K*(Y*ct-kt))]}function _r(xt,Y,K,ct,_t){const kt=Y===_t.maxZoom?0:_t.tolerance/((1<<Y)*_t.extent),Gt={features:[],numPoints:0,numSimplified:0,numFeatures:xt.length,source:null,x:K,y:ct,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Rt of xt)ge(Gt,Rt,kt,_t);return Gt}function ge(xt,Y,K,ct){const _t=Y.geometry,kt=Y.type,Gt=[];if(xt.minX=Math.min(xt.minX,Y.minX),xt.minY=Math.min(xt.minY,Y.minY),xt.maxX=Math.max(xt.maxX,Y.maxX),xt.maxY=Math.max(xt.maxY,Y.maxY),kt==="Point"||kt==="MultiPoint")for(let Rt=0;Rt<_t.length;Rt+=3)Gt.push(_t[Rt],_t[Rt+1]),xt.numPoints++,xt.numSimplified++;else if(kt==="LineString")yi(Gt,_t,xt,K,!1,!1);else if(kt==="MultiLineString"||kt==="Polygon")for(let Rt=0;Rt<_t.length;Rt++)yi(Gt,_t[Rt],xt,K,kt==="Polygon",Rt===0);else if(kt==="MultiPolygon")for(let Rt=0;Rt<_t.length;Rt++){const Ct=_t[Rt];for(let te=0;te<Ct.length;te++)yi(Gt,Ct[te],xt,K,!0,te===0)}if(Gt.length){let Rt=Y.tags||null;if(kt==="LineString"&&ct.lineMetrics){Rt={};for(const te in Y.tags)Rt[te]=Y.tags[te];Rt.mapbox_clip_start=_t.start/_t.size,Rt.mapbox_clip_end=_t.end/_t.size}const Ct={geometry:Gt,type:kt==="Polygon"||kt==="MultiPolygon"?3:kt==="LineString"||kt==="MultiLineString"?2:1,tags:Rt};Y.id!==null&&(Ct.id=Y.id),xt.features.push(Ct)}}function yi(xt,Y,K,ct,_t,kt){const Gt=ct*ct;if(ct>0&&Y.size<(_t?Gt:ct))return void(K.numPoints+=Y.length/3);const Rt=[];for(let Ct=0;Ct<Y.length;Ct+=3)(ct===0||Y[Ct+2]>Gt)&&(K.numSimplified++,Rt.push(Y[Ct],Y[Ct+1])),K.numPoints++;_t&&function(Ct,te){let he=0;for(let Wt=0,be=Ct.length,We=be-2;Wt<be;We=Wt,Wt+=2)he+=(Ct[Wt]-Ct[We])*(Ct[Wt+1]+Ct[We+1]);if(he>0===te)for(let Wt=0,be=Ct.length;Wt<be/2;Wt+=2){const We=Ct[Wt],Je=Ct[Wt+1];Ct[Wt]=Ct[be-2-Wt],Ct[Wt+1]=Ct[be-1-Wt],Ct[be-2-Wt]=We,Ct[be-1-Wt]=Je}}(Rt,kt),xt.push(Rt)}const Ue={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vi{constructor(Y,K){const ct=(K=this.options=function(kt,Gt){for(const Rt in Gt)kt[Rt]=Gt[Rt];return kt}(Object.create(Ue),K)).debug;if(ct&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let _t=function(kt,Gt){const Rt=[];if(kt.type==="FeatureCollection")for(let Ct=0;Ct<kt.features.length;Ct++)si(Rt,kt.features[Ct],Gt,Ct);else si(Rt,kt.type==="Feature"?kt:{geometry:kt},Gt);return Rt}(Y,K);this.tiles={},this.tileCoords=[],ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_t=function(kt,Gt){const Rt=Gt.buffer/Gt.extent;let Ct=kt;const te=Ee(kt,1,-1-Rt,Rt,0,-1,2,Gt),he=Ee(kt,1,1-Rt,2+Rt,0,-1,2,Gt);return(te||he)&&(Ct=Ee(kt,1,-Rt,1+Rt,0,-1,2,Gt)||[],te&&(Ct=me(te,1).concat(Ct)),he&&(Ct=Ct.concat(me(he,-1)))),Ct}(_t,K),_t.length&&this.splitTile(_t,0,0,0),ct&&(_t.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,K,ct,_t,kt,Gt,Rt){const Ct=[Y,K,ct,_t],te=this.options,he=te.debug;for(;Ct.length;){_t=Ct.pop(),ct=Ct.pop(),K=Ct.pop(),Y=Ct.pop();const Wt=1<<K,be=Zr(K,ct,_t);let We=this.tiles[be];if(!We&&(he>1&&console.time("creation"),We=this.tiles[be]=_r(Y,K,ct,_t,te),this.tileCoords.push({z:K,x:ct,y:_t}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ct,_t,We.numFeatures,We.numPoints,We.numSimplified),console.timeEnd("creation"));const pr=`z${K}`;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(We.source=Y,kt==null){if(K===te.indexMaxZoom||We.numPoints<=te.indexMaxPoints)continue}else{if(K===te.maxZoom||K===kt)continue;if(kt!=null){const pr=kt-K;if(ct!==Gt>>pr||_t!==Rt>>pr)continue}}if(We.source=null,Y.length===0)continue;he>1&&console.time("clipping");const Je=.5*te.buffer/te.extent,Li=.5-Je,Qe=.5+Je,Ci=1+Je;let xi=null,rr=null,Hi=null,hi=null,Fi=Ee(Y,Wt,ct-Je,ct+Qe,0,We.minX,We.maxX,te),Qi=Ee(Y,Wt,ct+Li,ct+Ci,0,We.minX,We.maxX,te);Y=null,Fi&&(xi=Ee(Fi,Wt,_t-Je,_t+Qe,1,We.minY,We.maxY,te),rr=Ee(Fi,Wt,_t+Li,_t+Ci,1,We.minY,We.maxY,te),Fi=null),Qi&&(Hi=Ee(Qi,Wt,_t-Je,_t+Qe,1,We.minY,We.maxY,te),hi=Ee(Qi,Wt,_t+Li,_t+Ci,1,We.minY,We.maxY,te),Qi=null),he>1&&console.timeEnd("clipping"),Ct.push(xi||[],K+1,2*ct,2*_t),Ct.push(rr||[],K+1,2*ct,2*_t+1),Ct.push(Hi||[],K+1,2*ct+1,2*_t),Ct.push(hi||[],K+1,2*ct+1,2*_t+1)}}getTile(Y,K,ct){Y=+Y,K=+K,ct=+ct;const _t=this.options,{extent:kt,debug:Gt}=_t;if(Y<0||Y>24)return null;const Rt=1<<Y,Ct=Zr(Y,K=K+Rt&Rt-1,ct);if(this.tiles[Ct])return bi(this.tiles[Ct],kt);Gt>1&&console.log("drilling down to z%d-%d-%d",Y,K,ct);let te,he=Y,Wt=K,be=ct;for(;!te&&he>0;)he--,Wt>>=1,be>>=1,te=this.tiles[Zr(he,Wt,be)];return te&&te.source?(Gt>1&&(console.log("found parent tile z%d-%d-%d",he,Wt,be),console.time("drilling down")),this.splitTile(te.source,he,Wt,be,Y,K,ct),Gt>1&&console.timeEnd("drilling down"),this.tiles[Ct]?bi(this.tiles[Ct],kt):null):null}}function Zr(xt,Y,K){return 32*((1<<xt)*K+Y)+xt}function ze(xt,Y){return Y?xt.properties[Y]:xt.id}function _n(xt,Y){if(xt==null)return!0;if(xt.type==="Feature")return ze(xt,Y)!=null;if(xt.type==="FeatureCollection"){const K=new Set;for(const ct of xt.features){const _t=ze(ct,Y);if(_t==null||K.has(_t))return!1;K.add(_t)}return!0}return!1}function ir(xt,Y){const K=new Map;if(xt!=null)if(xt.type==="Feature")K.set(ze(xt,Y),xt);else for(const ct of xt.features)K.set(ze(ct,Y),ct);return K}class Qr extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Y,K){return c._(this,void 0,void 0,function*(){const ct=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const _t=this._geoJSONIndex.getTile(ct.z,ct.x,ct.y);if(!_t)return null;const kt=new class{constructor(Rt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.X,this.length=Rt.length,this._features=Rt}feature(Rt){return new class{constructor(Ct){this._feature=Ct,this.extent=c.X,this.type=Ct.type,this.properties=Ct.tags,"id"in Ct&&!isNaN(Ct.id)&&(this.id=parseInt(Ct.id,10))}loadGeometry(){if(this._feature.type===1){const Ct=[];for(const te of this._feature.geometry)Ct.push([new c.P(te[0],te[1])]);return Ct}{const Ct=[];for(const te of this._feature.geometry){const he=[];for(const Wt of te)he.push(new c.P(Wt[0],Wt[1]));Ct.push(he)}return Ct}}toGeoJSON(Ct,te,he){return X.call(this,Ct,te,he)}}(this._features[Rt])}}(_t.features);let Gt=re(kt);return Gt.byteOffset===0&&Gt.byteLength===Gt.buffer.byteLength||(Gt=new Uint8Array(Gt)),{vectorTile:kt,rawData:Gt.buffer}})}loadData(Y){return c._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ct=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new c.bv(Y.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest),this._geoJSONIndex=Y.cluster?new Tt(function(Gt){let{superclusterOptions:Rt,clusterProperties:Ct}=Gt;if(!Ct||!Rt)return Rt;const te={},he={},Wt={accumulated:null,zoom:0},be={properties:null},We=Object.keys(Ct);for(const Je of We){const[Li,Qe]=Ct[Je],Ci=c.bC(Qe),xi=c.bC(typeof Li=="string"?[Li,["accumulated"],["get",Je]]:Li);te[Je]=Ci.value,he[Je]=xi.value}return Rt.map=Je=>{be.properties=Je;const Li={};for(const Qe of We)Li[Qe]=te[Qe].evaluate(Wt,be);return Li},Rt.reduce=(Je,Li)=>{be.properties=Li;for(const Qe of We)Wt.accumulated=Je[Qe],Je[Qe]=he[Qe].evaluate(Wt,be)},Rt}(Y)).load((yield this._pendingData).features):(_t=yield this._pendingData,new Vi(_t,Y.geojsonVtOptions)),this.loaded={};const kt={};if(ct){const Gt=ct.finish();Gt&&(kt.resourceTiming={},kt.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Gt)))}return kt}catch(kt){if(delete this._pendingRequest,c.bB(kt))return{abandoned:!0};throw kt}var _t})}getData(){return c._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Y){const K=this.loaded;return K&&K[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,K){return c._(this,void 0,void 0,function*(){let ct=yield this.loadGeoJSON(Y,K);if(delete this._pendingRequest,typeof ct!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(N(ct,!0),Y.filter){const _t=c.bC(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_t.result==="error")throw new Error(_t.value.map(kt=>`${kt.key}: ${kt.message}`).join(", "));ct={type:"FeatureCollection",features:ct.features.filter(kt=>_t.value.evaluate({zoom:0},kt))}}return ct})}loadGeoJSON(Y,K){return c._(this,void 0,void 0,function*(){const{promoteId:ct}=Y;if(Y.request){const _t=yield c.h(Y.request,K);return this._dataUpdateable=_n(_t.data,ct)?ir(_t.data,ct):void 0,_t.data}if(typeof Y.data=="string")try{const _t=JSON.parse(Y.data);return this._dataUpdateable=_n(_t,ct)?ir(_t,ct):void 0,_t}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return function(_t,kt,Gt){var Rt,Ct,te,he;if(kt.removeAll&&_t.clear(),kt.remove)for(const Wt of kt.remove)_t.delete(Wt);if(kt.add)for(const Wt of kt.add){const be=ze(Wt,Gt);be!=null&&_t.set(be,Wt)}if(kt.update)for(const Wt of kt.update){let be=_t.get(Wt.id);if(be==null)continue;const We=!Wt.removeAllProperties&&(((Rt=Wt.removeProperties)===null||Rt===void 0?void 0:Rt.length)>0||((Ct=Wt.addOrUpdateProperties)===null||Ct===void 0?void 0:Ct.length)>0);if((Wt.newGeometry||Wt.removeAllProperties||We)&&(be=Object.assign({},be),_t.set(Wt.id,be),We&&(be.properties=Object.assign({},be.properties))),Wt.newGeometry&&(be.geometry=Wt.newGeometry),Wt.removeAllProperties)be.properties={};else if(((te=Wt.removeProperties)===null||te===void 0?void 0:te.length)>0)for(const Je of Wt.removeProperties)Object.prototype.hasOwnProperty.call(be.properties,Je)&&delete be.properties[Je];if(((he=Wt.addOrUpdateProperties)===null||he===void 0?void 0:he.length)>0)for(const{key:Je,value:Li}of Wt.addOrUpdateProperties)be.properties[Je]=Li}}(this._dataUpdateable,Y.dataDiff,ct),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Y){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}class tn{constructor(Y){this.self=Y,this.actor=new c.F(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,ct)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ct},this.self.addProtocol=c.bi,this.self.removeProtocol=c.bj,this.self.registerRTLTextPlugin=K=>{if(c.bD.isParsed())throw new Error("RTL text plugin already registered.");c.bD.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,ct)=>this._getDEMWorkerSource(K,ct.source).loadTile(ct)),this.actor.registerMessageHandler("RDT",(K,ct)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,ct.source).removeTile(ct)})),this.actor.registerMessageHandler("GCEZ",(K,ct)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ct.type,ct.source).getClusterExpansionZoom(ct)})),this.actor.registerMessageHandler("GCC",(K,ct)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ct.type,ct.source).getClusterChildren(ct)})),this.actor.registerMessageHandler("GCL",(K,ct)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ct.type,ct.source).getClusterLeaves(ct)})),this.actor.registerMessageHandler("LD",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).loadData(ct)),this.actor.registerMessageHandler("GD",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).getData()),this.actor.registerMessageHandler("LT",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).loadTile(ct)),this.actor.registerMessageHandler("RT",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).reloadTile(ct)),this.actor.registerMessageHandler("AT",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).abortTile(ct)),this.actor.registerMessageHandler("RMT",(K,ct)=>this._getWorkerSource(K,ct.type,ct.source).removeTile(ct)),this.actor.registerMessageHandler("RS",(K,ct)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][ct.type]||!this.workerSources[K][ct.type][ct.source])return;const _t=this.workerSources[K][ct.type][ct.source];delete this.workerSources[K][ct.type][ct.source],_t.removeSource!==void 0&&_t.removeSource(ct)})),this.actor.registerMessageHandler("RM",K=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,ct)=>c._(this,void 0,void 0,function*(){this.referrer=ct})),this.actor.registerMessageHandler("SRPS",(K,ct)=>this._syncRTLPluginState(K,ct)),this.actor.registerMessageHandler("IS",(K,ct)=>c._(this,void 0,void 0,function*(){this.self.importScripts(ct)})),this.actor.registerMessageHandler("SI",(K,ct)=>this._setImages(K,ct)),this.actor.registerMessageHandler("UL",(K,ct)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(ct.layers,ct.removedIds)})),this.actor.registerMessageHandler("SL",(K,ct)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(ct)}))}_setImages(Y,K){return c._(this,void 0,void 0,function*(){this.availableImages[Y]=K;for(const ct in this.workerSources[Y]){const _t=this.workerSources[Y][ct];for(const kt in _t)_t[kt].availableImages=K}})}_syncRTLPluginState(Y,K){return c._(this,void 0,void 0,function*(){if(c.bD.isParsed())return c.bD.getState();if(K.pluginStatus!=="loading")return c.bD.setState(K),K;const ct=K.pluginURL;if(this.self.importScripts(ct),c.bD.isParsed()){const _t={pluginStatus:"loaded",pluginURL:ct};return c.bD.setState(_t),_t}throw c.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ct}`)})}_getAvailableImages(Y){let K=this.availableImages[Y];return K||(K=[]),K}_getLayerIndex(Y){let K=this.layerIndexes[Y];return K||(K=this.layerIndexes[Y]=new l),K}_getWorkerSource(Y,K,ct){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][K]||(this.workerSources[Y][K]={}),!this.workerSources[Y][K][ct]){const _t={sendAsync:(kt,Gt)=>(kt.targetMapId=Y,this.actor.sendAsync(kt,Gt))};switch(K){case"vector":this.workerSources[Y][K][ct]=new T(_t,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][K][ct]=new Qr(_t,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][K][ct]=new this.externalWorkerSourceTypes[K](_t,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][K][ct]}_getDEMWorkerSource(Y,K){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][K]||(this.demWorkerSources[Y][K]=new P),this.demWorkerSources[Y][K]}}return c.i(self)&&(self.worker=new tn(self)),tn}),n("index",["exports","./shared"],function(c,l){var _="4.7.1";let v,S;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((s,u)=>{const f=requestAnimationFrame(s);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(f),u(l.c())})}),getImageData(m){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(m).getImageData(-s,-s,m.width+2*s,m.height+2*s)},getImageCanvasContext(m){const s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=m.width,s.height=m.height,u.drawImage(m,0,0,m.width,m.height),u},resolveURL:m=>(v||(v=document.createElement("a")),v.href=m,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class P{static testProp(s){if(!P.docStyle)return s[0];for(let u=0;u<s.length;u++)if(s[u]in P.docStyle)return s[u];return s[0]}static create(s,u,f){const g=window.document.createElement(s);return u!==void 0&&(g.className=u),f&&f.appendChild(g),g}static createNS(s,u){return window.document.createElementNS(s,u)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(s,u){s.style[P.transformProp]=u}static addEventListener(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};s.addEventListener(u,f,"passive"in g?g:g.capture)}static removeEventListener(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};s.removeEventListener(u,f,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(s){const u=s.getBoundingClientRect();return{x:u.width/s.offsetWidth||1,y:u.height/s.offsetHeight||1,boundingClientRect:u}}static getPoint(s,u,f){const g=u.boundingClientRect;return new l.P((f.clientX-g.left)/u.x-s.clientLeft,(f.clientY-g.top)/u.y-s.clientTop)}static mousePos(s,u){const f=P.getScale(s);return P.getPoint(s,f,u)}static touchPos(s,u){const f=[],g=P.getScale(s);for(let y=0;y<u.length;y++)f.push(P.getPoint(s,g,u[y]));return f}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(m){!X&&N&&(H?Z(m):z=m)}};let z,N,X=!1,H=!1;function Z(m){const s=m.createTexture();m.bindTexture(m.TEXTURE_2D,s);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,N),m.isContextLost())return;I.supported=!0}catch{}m.deleteTexture(s),X=!0}var ot;typeof document<"u"&&(N=document.createElement("img"),N.onload=()=>{z&&Z(z),z=null,H=!0},N.onerror=()=>{X=!0,z=null},N.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let s,u,f,g;m.resetRequestQueue=()=>{s=[],u=0,f=0,g={}},m.addThrottleControl=B=>{const F=f++;return g[F]=B,F},m.removeThrottleControl=B=>{delete g[B],A()},m.getImage=function(B,F){let j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((O,W)=>{I.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),l.e(B,{type:"image"}),s.push({abortController:F,requestParameters:B,supportImageRefresh:j,state:"queued",onError:$=>{W($)},onSuccess:$=>{O($)}}),A()})};const y=B=>l._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:F,supportImageRefresh:j,onError:O,onSuccess:W,abortController:$}=B,q=j===!1&&!l.i(self)&&!l.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((ht,ft)=>ht&&ft==="accept",!0));u++;const Q=q?C(F,$):l.m(F,$);try{const ht=yield Q;delete B.abortController,B.state="completed",ht.data instanceof HTMLImageElement||l.b(ht.data)?W(ht):ht.data&&W({data:yield(lt=ht.data,typeof createImageBitmap=="function"?l.d(lt):l.f(lt)),cacheControl:ht.cacheControl,expires:ht.expires})}catch(ht){delete B.abortController,O(ht)}finally{u--,A()}var lt}),A=()=>{const B=(()=>{for(const F of Object.keys(g))if(g[F]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=u;F<B&&s.length>0;F++){const j=s.shift();j.abortController.signal.aborted?F--:y(j)}},C=(B,F)=>new Promise((j,O)=>{const W=new Image,$=B.url,q=B.credentials;q&&q==="include"?W.crossOrigin="use-credentials":(q&&q==="same-origin"||!l.s($))&&(W.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{W.src="",O(l.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,j({data:W})},W.onerror=()=>{W.onerror=W.onload=null,F.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=$})}(ot||(ot={})),ot.resetRequestQueue();class gt{constructor(s){this._transformRequestFn=s}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function Et(m){var s=new l.A(3);return s[0]=m[0],s[1]=m[1],s[2]=m[2],s}var Ft,Mt=function(m,s,u){return m[0]=s[0]-u[0],m[1]=s[1]-u[1],m[2]=s[2]-u[2],m};Ft=new l.A(3),l.A!=Float32Array&&(Ft[0]=0,Ft[1]=0,Ft[2]=0);var yt=function(m){var s=m[0],u=m[1];return s*s+u*u};function Ut(m){const s=[];if(typeof m=="string")s.push({id:"default",url:m});else if(m&&m.length>0){const u=[];for(const{id:f,url:g}of m){const y=`${f}${g}`;u.indexOf(y)===-1&&(u.push(y),s.push({id:f,url:g}))}}return s}function zt(m,s,u){const f=m.split("?");return f[0]+=`${s}${u}`,f.join("?")}(function(){var m=new l.A(2);l.A!=Float32Array&&(m[0]=0,m[1]=0)})();class at{constructor(s,u,f,g){this.context=s,this.format=f,this.texture=s.gl.createTexture(),this.update(u,g)}update(s,u,f){const{width:g,height:y}=s,A=!(this.size&&this.size[0]===g&&this.size[1]===y||f),{context:C}=this,{gl:B}=C;if(this.useMipmap=!!(u&&u.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!u||u.premultiply!==!1)),A)this.size=[g,y],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,s):B.texImage2D(B.TEXTURE_2D,0,this.format,g,y,0,this.format,B.UNSIGNED_BYTE,s.data);else{const{x:F,y:j}=f||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?B.texSubImage2D(B.TEXTURE_2D,0,F,j,B.RGBA,B.UNSIGNED_BYTE,s):B.texSubImage2D(B.TEXTURE_2D,0,F,j,g,y,B.RGBA,B.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(s,u,f){const{context:g}=this,{gl:y}=g;y.bindTexture(y.TEXTURE_2D,this.texture),f!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=y.LINEAR),s!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,f||s),this.filter=s),u!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,u),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function pt(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class Lt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:u,promiseResolve:f}of this.requestors)f(this._getImagesForIds(u));this.requestors=[]}}getImage(s){const u=this.images[s];if(u&&!u.data&&u.spriteData){const f=u.spriteData;u.data=new l.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),u.spriteData=null}return u}addImage(s,u){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let f=!0;const g=u.data||u.spriteData;return this._validateStretch(u.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchX" value`))),f=!1),this._validateStretch(u.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchY" value`))),f=!1),this._validateContent(u.content,u)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "content" value`))),f=!1),f}_validateStretch(s,u){if(!s)return!0;let f=0;for(const g of s){if(g[0]<f||g[1]<g[0]||u<g[1])return!1;f=g[1]}return!0}_validateContent(s,u){if(!s)return!0;if(s.length!==4)return!1;const f=u.spriteData,g=f&&f.width||u.data.width,y=f&&f.height||u.data.height;return!(s[0]<0||g<s[0]||s[1]<0||y<s[1]||s[2]<0||g<s[2]||s[3]<0||y<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const g=this.getImage(s);if(f&&(g.data.width!==u.data.width||g.data.height!==u.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=g.version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){const u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((u,f)=>{let g=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(g=!1);this.isLoaded()||g?u(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:u})})}_getImagesForIds(s){const u={};for(const f of s){let g=this.getImage(f);g||(this.fire(new l.k("styleimagemissing",{id:f})),g=this.getImage(f)),g?u[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){const u=this.patterns[s],f=this.getImage(s);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new l.I(g,f);this.patterns[s]={bin:g,position:y}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(s,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const y in this.patterns)s.push(this.patterns[y].bin);const{w:u,h:f}=l.p(s),g=this.atlasImage;g.resize({width:u||1,height:f||1});for(const y in this.patterns){const{bin:A}=this.patterns[y],C=A.x+1,B=A.y+1,F=this.getImage(y).data,j=F.width,O=F.height;l.R.copy(F,g,{x:0,y:0},{x:C,y:B},{width:j,height:O}),l.R.copy(F,g,{x:0,y:O-1},{x:C,y:B-1},{width:j,height:1}),l.R.copy(F,g,{x:0,y:0},{x:C,y:B+O},{width:j,height:1}),l.R.copy(F,g,{x:j-1,y:0},{x:C-1,y:B},{width:1,height:O}),l.R.copy(F,g,{x:0,y:0},{x:C+j,y:B},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const f=this.getImage(u);f||l.w(`Image with ID: "${u}" was not found`),pt(f)&&this.updateImage(u,f)}}}const bt=1e20;function ee(m,s,u,f,g,y,A,C,B){for(let F=s;F<s+f;F++)ie(m,u*y+F,y,g,A,C,B);for(let F=u;F<u+g;F++)ie(m,F*y+s,1,f,A,C,B)}function ie(m,s,u,f,g,y,A){y[0]=0,A[0]=-bt,A[1]=bt,g[0]=m[s];for(let C=1,B=0,F=0;C<f;C++){g[C]=m[s+C*u];const j=C*C;do{const O=y[B];F=(g[C]-g[O]+j-O*O)/(C-O)/2}while(F<=A[B]&&--B>-1);B++,y[B]=C,A[B]=F,A[B+1]=bt}for(let C=0,B=0;C<f;C++){for(;A[B+1]<C;)B++;const F=y[B],j=C-F;m[s+C*u]=g[F]+j*j}}class re{constructor(s,u){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return l._(this,void 0,void 0,function*(){const u=[];for(const y in s)for(const A of s[y])u.push(this._getAndCacheGlyphsPromise(y,A));const f=yield Promise.all(u),g={};for(const{stack:y,id:A,glyph:C}of f)g[y]||(g[y]={}),g[y][A]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return g})}_getAndCacheGlyphsPromise(s,u){return l._(this,void 0,void 0,function*(){let f=this.entries[s];f||(f=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=f.glyphs[u];if(g!==void 0)return{stack:s,id:u,glyph:g};if(g=this._tinySDF(f,s,u),g)return f.glyphs[u]=g,{stack:s,id:u,glyph:g};const y=Math.floor(u/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[y])return{stack:s,id:u,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[y]){const C=re.loadGlyphRange(s,y,this.url,this.requestManager);f.requests[y]=C}const A=yield f.requests[y];for(const C in A)this._doesCharSupportLocalGlyph(+C)||(f.glyphs[+C]=A[+C]);return f.ranges[y]=!0,{stack:s,id:u,glyph:A[u]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))}_tinySDF(s,u,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let y=s.tinySDF;if(!y){let C="400";/bold/i.test(u)?C="900":/medium/i.test(u)?C="500":/light/i.test(u)&&(C="200"),y=s.tinySDF=new re.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:C})}const A=y.draw(String.fromCharCode(f));return{id:f,bitmap:new l.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}re.loadGlyphRange=function(m,s,u,f){return l._(this,void 0,void 0,function*(){const g=256*s,y=g+255,A=f.transformRequest(u.replace("{fontstack}",m).replace("{range}",`${g}-${y}`),"Glyphs"),C=yield l.l(A,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${y}`);const B={};for(const F of l.n(C.data))B[F.id]=F;return B})},re.TinySDF=class{constructor(){let{fontSize:m=24,buffer:s=3,radius:u=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:y="normal",fontStyle:A="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=s,this.cutoff=f,this.radius=u;const C=this.size=m+4*s,B=this._createCanvas(C),F=this.ctx=B.getContext("2d",{willReadFrequently:!0});F.font=`${A} ${y} ${m}px ${g}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:y}=this.ctx.measureText(m),A=Math.ceil(u),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-g))),B=Math.min(this.size-this.buffer,A+Math.ceil(f)),F=C+2*this.buffer,j=B+2*this.buffer,O=Math.max(F*j,0),W=new Uint8ClampedArray(O),$={data:W,width:F,height:j,glyphWidth:C,glyphHeight:B,glyphTop:A,glyphLeft:0,glyphAdvance:s};if(C===0||B===0)return $;const{ctx:q,buffer:Q,gridInner:lt,gridOuter:ht}=this;q.clearRect(Q,Q,C,B),q.fillText(m,Q,Q+A);const ft=q.getImageData(Q,Q,C,B);ht.fill(bt,0,O),lt.fill(0,0,O);for(let ut=0;ut<B;ut++)for(let vt=0;vt<C;vt++){const Bt=ft.data[4*(ut*C+vt)+3]/255;if(Bt===0)continue;const It=(ut+Q)*F+vt+Q;if(Bt===1)ht[It]=0,lt[It]=bt;else{const Qt=.5-Bt;ht[It]=Qt>0?Qt*Qt:0,lt[It]=Qt<0?Qt*Qt:0}}ee(ht,0,0,F,j,F,this.f,this.v,this.z),ee(lt,Q,Q,C,B,F,this.f,this.v,this.z);for(let ut=0;ut<O;ut++){const vt=Math.sqrt(ht[ut])-Math.sqrt(lt[ut]);W[ut]=Math.round(255-255*(vt/this.radius+this.cutoff))}return $}};class Yt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(s,u){return l.x(s.expression.evaluate(u))}interpolate(s,u,f){return{x:l.y.number(s.x,u.x,f),y:l.y.number(s.y,u.y,f),z:l.y.number(s.z,u.z,f)}}}let ce;class le extends l.E{constructor(s){super(),ce=ce||new l.q({anchor:new l.D(l.v.light.anchor),position:new Yt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ce),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(l.r,s,u))for(const f in s){const g=s[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,f){return(!f||f.validate!==!1)&&l.t(this,s.call(l.u,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Be=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class nt extends l.E{constructor(s){super(),this._transitionable=new l.T(Be),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(l.B,s,u)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in s){const g=s[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(f==null?void 0:f.validate)!==!1&&l.t(this,s.call(l.u,l.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class St{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,u){const f=s.join(",")+String(u);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(s,u)),this.dashEntry[f]}getDashRanges(s,u,f){const g=[];let y=s.length%2==1?-s[s.length-1]*f:0,A=s[0]*f,C=!0;g.push({left:y,right:A,isDash:C,zeroLength:s[0]===0});let B=s[0];for(let F=1;F<s.length;F++){C=!C;const j=s[F];y=B*f,B+=j,A=B*f,g.push({left:y,right:A,isDash:C,zeroLength:j===0})}return g}addRoundDash(s,u,f){const g=u/2;for(let y=-f;y<=f;y++){const A=this.width*(this.nextRow+f+y);let C=0,B=s[C];for(let F=0;F<this.width;F++){F/B.right>1&&(B=s[++C]);const j=Math.abs(F-B.left),O=Math.abs(F-B.right),W=Math.min(j,O);let $;const q=y/f*(g+1);if(B.isDash){const Q=g-Math.abs(q);$=Math.sqrt(W*W+Q*Q)}else $=g-Math.sqrt(W*W+q*q);this.data[A+F]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(s){for(let C=s.length-1;C>=0;--C){const B=s[C],F=s[C+1];B.zeroLength?s.splice(C,1):F&&F.isDash===B.isDash&&(F.left=B.left,s.splice(C,1))}const u=s[0],f=s[s.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,A=s[y];for(let C=0;C<this.width;C++){C/A.right>1&&(A=s[++y]);const B=Math.abs(C-A.left),F=Math.abs(C-A.right),j=Math.min(B,F);this.data[g+C]=Math.max(0,Math.min(255,(A.isDash?j:-j)+128))}}addDash(s,u){const f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let C=0;C<s.length;C++)y+=s[C];if(y!==0){const C=this.width/y,B=this.getDashRanges(s,this.width,C);u?this.addRoundDash(B,C,f):this.addRegularDash(B)}const A={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:y};return this.nextRow+=g,this.dirty=!0,A}bind(s){const u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const Tt="maplibre_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Tt]}numActive(){return Object.keys(this.active).length}}const qt=Math.floor(T.hardwareConcurrency/2);let Ht,Jt;function $t(){return Ht||(Ht=new jt),Ht}jt.workerCount=l.C(globalThis)?Math.max(Math.min(qt,3),1):1;class Ae{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=u;const f=this.workerPool.acquire(u);for(let g=0;g<f.length;g++){const y=new l.F(f[g],u);y.name=`Worker ${g}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,u){const f=[];for(const g of this.actors)f.push(g.sendAsync({type:s,data:u}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(u=>{u.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,u){for(const f of this.actors)f.registerMessageHandler(s,u)}}function Le(){return Jt||(Jt=new Ae($t(),l.G),Jt.registerMessageHandler("GR",(m,s,u)=>l.m(s,u))),Jt}function Fe(m,s){const u=l.H();return l.J(u,u,[1,1,0]),l.K(u,u,[.5*m.width,.5*m.height,1]),l.L(u,u,m.calculatePosMatrix(s.toUnwrapped()))}function Ne(m,s,u,f,g,y){const A=function(O,W,$){if(O)for(const q of O){const Q=W[q];if(Q&&Q.source===$&&Q.type==="fill-extrusion")return!0}else for(const q in W){const Q=W[q];if(Q.source===$&&Q.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,m.id),C=y.maxPitchScaleFactor(),B=m.tilesIn(f,C,A);B.sort(si);const F=[];for(const O of B)F.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(s,u,m._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,g,y,C,Fe(m.transform,O.tileID))});const j=function(O){const W={},$={};for(const q of O){const Q=q.queryResults,lt=q.wrappedTileID,ht=$[lt]=$[lt]||{};for(const ft in Q){const ut=Q[ft],vt=ht[ft]=ht[ft]||{},Bt=W[ft]=W[ft]||[];for(const It of ut)vt[It.featureIndex]||(vt[It.featureIndex]=!0,Bt.push(It))}}return W}(F);for(const O in j)j[O].forEach(W=>{const $=W.feature,q=m.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=q});return j}function si(m,s){const u=m.tileID,f=s.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}function oe(m,s,u){return l._(this,void 0,void 0,function*(){let f=m;if(m.url?f=(yield l.h(s.transformRequest(m.url,"Source"),u)).data:yield T.frameAsync(u),!f)return null;const g=l.M(l.e(f,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(g.vectorLayerIds=f.vector_layers.map(y=>y.id)),g})}class it{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.N?new l.N(s.lng,s.lat):l.N.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.N?new l.N(s.lng,s.lat):l.N.convert(s),this}extend(s){const u=this._sw,f=this._ne;let g,y;if(s instanceof l.N)g=s,y=s;else{if(!(s instanceof it))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(it.convert(s)):this.extend(l.N.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.N.convert(s)):this;if(g=s._sw,y=s._ne,!g||!y)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new l.N(g.lng,g.lat),this._ne=new l.N(y.lng,y.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:f}=l.N.convert(s);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(s){return s instanceof it?s:s&&new it(s)}static fromLngLat(s){const u=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,f=u/Math.cos(Math.PI/180*s.lat);return new it(new l.N(s.lng-f,s.lat-u),new l.N(s.lng+f,s.lat+u))}adjustAntiMeridian(){const s=new l.N(this._sw.lng,this._sw.lat),u=new l.N(this._ne.lng,this._ne.lat);return new it(s,s.lng>u.lng?new l.N(u.lng+360,u.lat):u)}}class pi{constructor(s,u,f){this.bounds=it.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=f||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const u=Math.pow(2,s.z),f=Math.floor(l.O(this.bounds.getWest())*u),g=Math.floor(l.Q(this.bounds.getNorth())*u),y=Math.ceil(l.O(this.bounds.getEast())*u),A=Math.ceil(l.Q(this.bounds.getSouth())*u);return s.x>=f&&s.x<y&&s.y>=g&&s.y<A}}class Ke extends l.E{constructor(s,u,f,g){if(super(),this.id=s,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(u,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield oe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(l.e(this,s),s.bounds&&(this.tileBounds=new pi(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(s){return l._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(u,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};f.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((y,A)=>{s.reloadPromise={resolve:y,reject:A}})}else s.actor=this.dispatcher.getActor(),g="LT";s.abortController=new AbortController;try{const y=yield s.actor.sendAsync({type:g,data:f},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,y)}catch(y){if(delete s.abortController,s.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,u){if(u&&u.resourceTiming&&(s.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&s.setExpiryData(u),s.loadVectorData(u,this.map.painter),s.reloadPromise){const f=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(f.resolve).catch(f.reject)}}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class de extends l.E{constructor(s,u,f,g){super(),this.id=s,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},u),l.e(this,l.M(u,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield oe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(l.e(this,s),s.bounds&&(this.tileBounds=new pi(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return l._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const f=yield ot.getImage(this.map._requestManager.transformRequest(u,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&s.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const g=this.map.painter.context,y=g.gl,A=f.data;s.texture=this.map.painter.getTileTexture(A.width),s.texture?s.texture.update(A,{useMipmap:!0}):(s.texture=new at(g,A,y.RGBA,{useMipmap:!0}),s.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(f){if(delete s.abortController,s.aborted)s.state="unloaded";else if(f)throw s.state="errored",f}})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class Ee extends de{constructor(s,u,f,g){super(s,u,f,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(s){return l._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(u,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield ot.getImage(f,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const y=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const A=l.b(y)&&l.U()?y:yield this.readImageNow(y),C={type:this.type,uid:s.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const B=yield s.actor.sendAsync({type:"LDT",data:C});s.dem=B,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const u=s.width+2,f=s.height+2;try{return new l.R({width:u,height:f},yield l.W(s,-1,-1,u,f))}catch{}}return T.getImageData(s,1)})}_getNeighboringTiles(s){const u=s.canonical,f=Math.pow(2,u.z),g=(u.x-1+f)%f,y=u.x===0?s.wrap-1:s.wrap,A=(u.x+1+f)%f,C=u.x+1===f?s.wrap+1:s.wrap,B={};return B[new l.S(s.overscaledZ,y,u.z,g,u.y).key]={backfilled:!1},B[new l.S(s.overscaledZ,C,u.z,A,u.y).key]={backfilled:!1},u.y>0&&(B[new l.S(s.overscaledZ,y,u.z,g,u.y-1).key]={backfilled:!1},B[new l.S(s.overscaledZ,s.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},B[new l.S(s.overscaledZ,C,u.z,A,u.y-1).key]={backfilled:!1}),u.y+1<f&&(B[new l.S(s.overscaledZ,y,u.z,g,u.y+1).key]={backfilled:!1},B[new l.S(s.overscaledZ,s.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},B[new l.S(s.overscaledZ,C,u.z,A,u.y+1).key]={backfilled:!1}),B}unloadTile(s){return l._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Me extends l.E{constructor(s,u,f,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=u.data,this._options=l.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const y=l.X/this.tileSize;u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*y,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*y,extent:l.X,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:l.X,radius:(u.clusterRadius||50)*y,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}getData(){return l._(this,void 0,void 0,function*(){const s=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,u,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:u,offset:f}})}_updateWorkerData(s){return l._(this,void 0,void 0,function*(){const u=l.e({type:this.type},this.workerOptions);s?u.dataDiff=s:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(y,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(f))}})}loaded(){return this._pendingLoads===0}loadTile(s){return l._(this,void 0,void 0,function*(){const u=s.actor?"RT":"LT";s.actor=this.actor;const f={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:u,data:f},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,u==="RT")})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var De=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ei extends l.E{constructor(s,u,f,g){super(),this.id=s,this.dispatcher=f,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=u}load(s){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield ot.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,s&&(this.coordinates=s),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new l.j(u))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const u=s.map(l.Z.fromLngLat);this.tileID=function(g){let y=1/0,A=1/0,C=-1/0,B=-1/0;for(const W of g)y=Math.min(y,W.x),A=Math.min(A,W.y),C=Math.max(C,W.x),B=Math.max(B,W.y);const F=Math.max(C-y,B-A),j=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),O=Math.pow(2,j);return new l.a1(j,Math.floor((y+C)/2*O),Math.floor((A+B)/2*O))}(u),this.minzoom=this.maxzoom=this.tileID.z;const f=u.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,l.X,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,l.X),this._boundsArray.emplaceBack(f[2].x,f[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,De.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Si extends ei{constructor(s,u,f,g){super(s,u,f,g),this.roundZoom=!0,this.type="video",this.options=u}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const u of s.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield l.a3(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new l.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const u=this.video.seekable;s<u.start(0)||s>u.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,De.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new at(s,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const y=this.tiles[g];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,f=!0)}f&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vi extends ei{constructor(s,u,f,g){super(s,u,f,g),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(A=>typeof A!="number"))||this.fire(new l.j(new l.a2(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${s}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${s}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,f=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,De.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(u,this.canvas,f.RGBA,{premultiply:!0});let g=!1;for(const y in this.tiles){const A=this.tiles[y];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Ri={},zi=m=>{switch(m){case"geojson":return Me;case"image":return ei;case"raster":return de;case"raster-dem":return Ee;case"vector":return Ke;case"video":return Si;case"canvas":return vi}return Ri[m]},me="RTLPluginLoaded";class ci extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Le()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return l._(this,arguments,void 0,function(u){var f=this;let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(f.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(f.url=T.resolveURL(u),!f.url)throw new Error(`requested url ${u} is invalid`);if(f.status==="unavailable"){if(!g)return f._requestImport();f.status="deferred",f._syncState(f.status)}else if(f.status==="requested")return f._requestImport()}()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(me))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let bi=null;function ke(){return bi||(bi=new ci),bi}class _r{constructor(s,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=l.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const u=s+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,y){const A={};if(!y)return A;for(const C of g){const B=C.layerIds.map(F=>y.getLayer(F)).filter(Boolean);if(B.length!==0){C.layers=B,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(F=>B.filter(j=>j.id===F)[0]));for(const F of B)A[F.id]=C}}return A}(s.buckets,u.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof l.a6){if(this.hasSymbolBuckets=!0,!f)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof l.a6&&y.hasRTLText){this.hasRTLText=!0,ke().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(y))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(s)}const u=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(s,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(s,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,u,f,g,y,A,C,B,F,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:y,scale:A,tileSize:this.tileSize,pixelPosMatrix:j,transform:B,params:C,queryPadding:this.queryPadding*F},s,u,f):{}}querySourceFeatures(s,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),y=u&&u.sourceLayer?u.sourceLayer:"",A=g._geojsonTileLayer||g[y];if(!A)return;const C=l.a7(u&&u.filter),{z:B,x:F,y:j}=this.tileID.canonical,O={z:B,x:F,y:j};for(let W=0;W<A.length;W++){const $=A.feature(W);if(C.needGeometry){const lt=l.a8($,!0);if(!C.filter(new l.z(this.tileID.overscaledZ),lt,this.tileID.canonical))continue}else if(!C.filter(new l.z(this.tileID.overscaledZ),$))continue;const q=f.getId($,y),Q=new l.a9($,B,F,j,q);Q.tile=O,s.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const f=l.aa(s.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{const y=this.expirationTime-u;y?this.expirationTime=f+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!u.style.hasLayer(g))continue;const y=this.buckets[g],A=y.layers[0].sourceLayer||"_geojsonTileLayer",C=f[A],B=s[A];if(!C||!B||Object.keys(B).length===0)continue;y.update(B,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=u&&u.style&&u.style.getLayer(g);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=T.now()+s}setDependencies(s,u){const f={};for(const g of u)f[g]=!0;this.dependencies[s]=f}hasDependency(s,u){for(const f of s){const g=this.dependencies[f];if(g){for(const y of u)if(g[y])return!0}}return!1}}class ge{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(const s in this.data)for(const u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,f){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:u,timeout:void 0};if(f!==void 0&&(y.timeout=setTimeout(()=>{this.remove(s,y)},f)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){const u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;const f=s.wrapped().key,g=u===void 0?0:this.data[f].indexOf(u),y=this.data[f][g];return this.data[f].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(y.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){const u=[];for(const f in this.data)for(const g of this.data[f])s(g.value)||u.push(g);for(const f of u)this.remove(f.value.tileID,f)}}class yi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,f){const g=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},l.e(this.stateChanges[s][g],f),this.deletedStates[s]===null){this.deletedStates[s]={};for(const y in this.state[s])y!==g&&(this.deletedStates[s][y]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const y in this.state[s][g])f[y]||(this.deletedStates[s][g][y]=null)}else for(const y in f)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][y]===null&&delete this.deletedStates[s][g][y]}removeFeatureState(s,u,f){if(this.deletedStates[s]===null)return;const g=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},f&&u!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][f]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(f in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][f]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,u){const f=String(u),g=l.e({},(this.state[s]||{})[f],(this.stateChanges[s]||{})[f]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const y=this.deletedStates[s][u];if(y===null)return{};for(const A in y)delete g[A]}return g}initializeTileState(s,u){s.setFeatureState(this.state,u)}coalesceChanges(s,u){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const A in this.stateChanges[g])this.state[g][A]||(this.state[g][A]={}),l.e(this.state[g][A],this.stateChanges[g][A]),y[A]=this.state[g][A];f[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const A in this.state[g])y[A]={},this.state[g][A]={};else for(const A in this.deletedStates[g]){if(this.deletedStates[g][A]===null)this.state[g][A]={};else for(const C of Object.keys(this.deletedStates[g][A]))delete this.state[g][A][C];y[A]=this.state[g][A]}f[g]=f[g]||{},l.e(f[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in s)s[g].setFeatureState(f,u)}}class Ue extends l.E{constructor(s,u,f){super(),this.id=s,this.dispatcher=f,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,y,A,C)=>{const B=new(zi(y.type))(g,y,A,C);if(B.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${B.id}`);return B})(s,u,f,this),this._tiles={},this._cache=new ge(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yi,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const u=this._tiles[s];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,u,f){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,u,f)}catch(g){s.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new l.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(s),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Vi).map(s=>s.key)}getRenderableIds(s){const u=[];for(const f in this._tiles)this._isIdRenderable(f,s)&&u.push(this._tiles[f]);return s?u.sort((f,g)=>{const y=f.tileID,A=g.tileID,C=new l.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),B=new l.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-A.overscaledZ||B.y-C.y||B.x-C.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(Vi).map(f=>f.key)}hasRenderableParent(s){const u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,u){return l._(this,void 0,void 0,function*(){const f=this._tiles[s];f&&(f.state!=="loading"&&(f.state=u),yield this._loadTile(f,s,u))})}_tileLoaded(s,u,f){s.timeAdded=T.now(),f==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const u=this.getRenderableIds();for(let g=0;g<u.length;g++){const y=u[g];if(s.neighboringTiles&&s.neighboringTiles[y]){const A=this.getTileByID(y);f(s,A),f(A,s)}}function f(g,y){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let A=y.tileID.canonical.x-g.tileID.canonical.x;const C=y.tileID.canonical.y-g.tileID.canonical.y,B=Math.pow(2,g.tileID.canonical.z),F=y.tileID.key;A===0&&C===0||Math.abs(C)>1||(Math.abs(A)>1&&(Math.abs(A+B)===1?A+=B:Math.abs(A-B)===1&&(A-=B)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,A,C),g.neighboringTiles&&g.neighboringTiles[F]&&(g.neighboringTiles[F].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,f,g){for(const y in this._tiles){let A=this._tiles[y];if(g[y]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>f)continue;let C=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){const F=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[F.key],A&&A.hasData()&&(C=F)}let B=C;for(;B.overscaledZ>u;)if(B=B.scaledTo(B.overscaledZ-1),s[B.key]){g[C.key]=C;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){const f=this._loadedParentTiles[s.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=s.overscaledZ-1;f>=u;f--){const g=s.scaledTo(f),y=this._getLoadedTile(g);if(y)return y}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const u=Math.ceil(s.width/this._source.tileSize)+1,f=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(u*f*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(y)}handleWrapJump(s){const u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){const f={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+u),f[y.tileID.key]=y}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(s,u,f,g,y,A){const C={},B={},F=Object.keys(s),j=T.now();for(const O of F){const W=s[O],$=this._tiles[O];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=j)continue;const q=this.findLoadedParent(W,u),Q=this.findLoadedSibling(W),lt=q||Q||null;lt&&(this._addTile(lt.tileID),C[lt.tileID.key]=lt.tileID),B[O]=W}this._retainLoadedChildren(B,g,f,s);for(const O in C)s[O]||(this._coveredTiles[O]=!0,s[O]=C[O]);if(A){const O={},W={};for(const $ of y)this._tiles[$.key].hasData()?O[$.key]=$:W[$.key]=$;for(const $ in W){const q=W[$].children(this._source.maxzoom);this._tiles[q[0].key]&&this._tiles[q[1].key]&&this._tiles[q[2].key]&&this._tiles[q[3].key]&&(O[q[0].key]=s[q[0].key]=q[0],O[q[1].key]=s[q[1].key]=q[1],O[q[2].key]=s[q[2].key]=q[2],O[q[3].key]=s[q[3].key]=q[3],delete W[$])}for(const $ in W){const q=W[$],Q=this.findLoadedParent(q,this._source.minzoom),lt=this.findLoadedSibling(q),ht=Q||lt||null;if(ht){O[ht.tileID.key]=s[ht.tileID.key]=ht.tileID;for(const ft in O)O[ft].isChildOf(ht.tileID)&&delete O[ft]}}for(const $ in this._tiles)O[$]||(this._coveredTiles[$]=!0)}}update(s,u){if(!this._sourceLoaded||this._paused)return;let f;this.transform=s,this.terrain=u,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new l.S(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y)):(f=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(f=f.filter(j=>this._source.hasTile(j)))):f=[];const g=s.coveringZoomLevel(this._source),y=Math.max(g-Ue.maxOverzooming,this._source.minzoom),A=Math.max(g+Ue.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const j={};for(const O of f)if(O.canonical.z>this._source.minzoom){const W=O.scaledTo(O.canonical.z-1);j[W.key]=W;const $=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));j[$.key]=$}f=f.concat(Object.values(j))}const C=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(f,g);Zr(this._source.type)&&this._updateCoveredAndRetainedTiles(B,y,A,g,f,u);for(const j in B)this._tiles[j].clearFadeHold();const F=l.ab(this._tiles,B);for(const j of F){const O=this._tiles[j];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(j)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,u){var f;const g={},y={},A=Math.max(u-Ue.maxOverzooming,this._source.minzoom),C=Math.max(u+Ue.maxUnderzooming,this._source.minzoom),B={};for(const F of s){const j=this._addTile(F);g[F.key]=F,j.hasData()||u<this._source.maxzoom&&(B[F.key]=F)}this._retainLoadedChildren(B,u,C,g);for(const F of s){let j=this._tiles[F.key];if(j.hasData())continue;if(u+1>this._source.maxzoom){const W=F.children(this._source.maxzoom)[0],$=this.getTile(W);if($&&$.hasData()){g[W.key]=W;continue}}else{const W=F.children(this._source.maxzoom);if(g[W[0].key]&&g[W[1].key]&&g[W[2].key]&&g[W[3].key])continue}let O=j.wasRequested();for(let W=F.overscaledZ-1;W>=A;--W){const $=F.scaledTo(W);if(y[$.key])break;if(y[$.key]=!0,j=this.getTile($),!j&&O&&(j=this._addTile($)),j){const q=j.hasData();if((q||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||O)&&(g[$.key]=$),O=j.wasRequested(),q)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const u=[];let f,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}u.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(y),f)break;g=y}for(const y of u)this._loadedParentTiles[y]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const u=this._tiles[s].tileID,f=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=f}}_addTile(s){let u=this._tiles[s.key];if(u)return u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));const f=u;return u||(u=new _r(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(u,s.key,u.state)),u.uses++,this._tiles[s.key]=u,f||this._source.fire(new l.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const f=u.getExpiryTimeout();f&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},f))}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(s){const u=s.sourceDataType;s.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&u==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,u,f){const g=[],y=this.transform;if(!y)return g;const A=f?y.getCameraQueryGeometry(s):s,C=s.map(q=>y.pointCoordinate(q,this.terrain)),B=A.map(q=>y.pointCoordinate(q,this.terrain)),F=this.getIds();let j=1/0,O=1/0,W=-1/0,$=-1/0;for(const q of B)j=Math.min(j,q.x),O=Math.min(O,q.y),W=Math.max(W,q.x),$=Math.max($,q.y);for(let q=0;q<F.length;q++){const Q=this._tiles[F[q]];if(Q.holdingForFade())continue;const lt=Q.tileID,ht=Math.pow(2,y.zoom-Q.tileID.overscaledZ),ft=u*Q.queryPadding*l.X/Q.tileSize/ht,ut=[lt.getTilePoint(new l.Z(j,O)),lt.getTilePoint(new l.Z(W,$))];if(ut[0].x-ft<l.X&&ut[0].y-ft<l.X&&ut[1].x+ft>=0&&ut[1].y+ft>=0){const vt=C.map(It=>lt.getTilePoint(It)),Bt=B.map(It=>lt.getTilePoint(It));g.push({tile:Q,tileID:lt,queryGeometry:vt,cameraQueryGeometry:Bt,scale:ht})}}return g}getVisibleCoordinates(s){const u=this.getRenderableIds(s).map(f=>this._tiles[f].tileID);for(const f of u)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(Zr(this._source.type)){const s=T.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=s)return!0}return!1}setFeatureState(s,u,f){this._state.updateState(s=s||"_geojsonTileLayer",u,f)}removeFeatureState(s,u,f){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,f)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,f){const g=this._tiles[s];g&&g.setDependencies(u,f)}reloadTilesForDependencies(s,u){for(const f in this._tiles)this._tiles[f].hasDependency(s,u)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(s,u))}}function Vi(m,s){const u=Math.abs(2*m.wrap)-+(m.wrap<0),f=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||f-u||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function Zr(m){return m==="raster"||m==="image"||m==="video"}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;class ze{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.ac(s,0,1);let u=1,f=this._distances[u];const g=s*this.paddedLength+this.padding;for(;f<g&&u<this._distances.length;)f=this._distances[++u];const y=u-1,A=this._distances[y],C=f-A,B=C>0?(g-A)/C:0;return this.points[y].mult(1-B).add(this.points[u].mult(B))}}function _n(m,s){let u=!0;return m==="always"||m!=="never"&&s!=="never"||(u=!1),u}class ir{constructor(s,u,f){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(s/f),this.yCellCount=Math.ceil(u/f);for(let A=0;A<this.xCellCount*this.yCellCount;A++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,f,g,y){this._forEachCell(u,f,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(s,u,f,g){this._forEachCell(u-g,f-g,u+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(f),this.circles.push(g)}_insertBoxCell(s,u,f,g,y,A){this.boxCells[y].push(A)}_insertCircleCell(s,u,f,g,y,A){this.circleCells[y].push(A)}_query(s,u,f,g,y,A,C){if(f<0||s>this.width||g<0||u>this.height)return[];const B=[];if(s<=0&&u<=0&&this.width<=f&&this.height<=g){if(y)return[{key:null,x1:s,y1:u,x2:f,y2:g}];for(let F=0;F<this.boxKeys.length;F++)B.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const j=this.circles[3*F],O=this.circles[3*F+1],W=this.circles[3*F+2];B.push({key:this.circleKeys[F],x1:j-W,y1:O-W,x2:j+W,y2:O+W})}}else this._forEachCell(s,u,f,g,this._queryCell,B,{hitTest:y,overlapMode:A,seenUids:{box:{},circle:{}}},C);return B}query(s,u,f,g){return this._query(s,u,f,g,!1,null)}hitTest(s,u,f,g,y,A){return this._query(s,u,f,g,!0,y,A).length>0}hitTestCircle(s,u,f,g,y){const A=s-f,C=s+f,B=u-f,F=u+f;if(C<0||A>this.width||F<0||B>this.height)return!1;const j=[];return this._forEachCell(A,B,C,F,this._queryCellCircle,j,{hitTest:!0,overlapMode:g,circle:{x:s,y:u,radius:f},seenUids:{box:{},circle:{}}},y),j.length>0}_queryCell(s,u,f,g,y,A,C,B){const{seenUids:F,hitTest:j,overlapMode:O}=C,W=this.boxCells[y];if(W!==null){const q=this.bboxes;for(const Q of W)if(!F.box[Q]){F.box[Q]=!0;const lt=4*Q,ht=this.boxKeys[Q];if(s<=q[lt+2]&&u<=q[lt+3]&&f>=q[lt+0]&&g>=q[lt+1]&&(!B||B(ht))&&(!j||!_n(O,ht.overlapMode))&&(A.push({key:ht,x1:q[lt],y1:q[lt+1],x2:q[lt+2],y2:q[lt+3]}),j))return!0}}const $=this.circleCells[y];if($!==null){const q=this.circles;for(const Q of $)if(!F.circle[Q]){F.circle[Q]=!0;const lt=3*Q,ht=this.circleKeys[Q];if(this._circleAndRectCollide(q[lt],q[lt+1],q[lt+2],s,u,f,g)&&(!B||B(ht))&&(!j||!_n(O,ht.overlapMode))){const ft=q[lt],ut=q[lt+1],vt=q[lt+2];if(A.push({key:ht,x1:ft-vt,y1:ut-vt,x2:ft+vt,y2:ut+vt}),j)return!0}}}return!1}_queryCellCircle(s,u,f,g,y,A,C,B){const{circle:F,seenUids:j,overlapMode:O}=C,W=this.boxCells[y];if(W!==null){const q=this.bboxes;for(const Q of W)if(!j.box[Q]){j.box[Q]=!0;const lt=4*Q,ht=this.boxKeys[Q];if(this._circleAndRectCollide(F.x,F.y,F.radius,q[lt+0],q[lt+1],q[lt+2],q[lt+3])&&(!B||B(ht))&&!_n(O,ht.overlapMode))return A.push(!0),!0}}const $=this.circleCells[y];if($!==null){const q=this.circles;for(const Q of $)if(!j.circle[Q]){j.circle[Q]=!0;const lt=3*Q,ht=this.circleKeys[Q];if(this._circlesCollide(q[lt],q[lt+1],q[lt+2],F.x,F.y,F.radius)&&(!B||B(ht))&&!_n(O,ht.overlapMode))return A.push(!0),!0}}}_forEachCell(s,u,f,g,y,A,C,B){const F=this._convertToXCellCoord(s),j=this._convertToYCellCoord(u),O=this._convertToXCellCoord(f),W=this._convertToYCellCoord(g);for(let $=F;$<=O;$++)for(let q=j;q<=W;q++)if(y.call(this,s,u,f,g,this.xCellCount*q+$,A,C,B))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,f,g,y,A){const C=g-s,B=y-u,F=f+A;return F*F>C*C+B*B}_circleAndRectCollide(s,u,f,g,y,A,C){const B=(A-g)/2,F=Math.abs(s-(g+B));if(F>B+f)return!1;const j=(C-y)/2,O=Math.abs(u-(y+j));if(O>j+f)return!1;if(F<=B||O<=j)return!0;const W=F-B,$=O-j;return W*W+$*$<=f*f}}function Qr(m,s,u,f,g){const y=l.H();return s?(l.K(y,y,[1/g,1/g,1]),u||l.ad(y,y,f.angle)):l.L(y,f.labelPlaneMatrix,m),y}function tn(m,s,u,f,g){if(s){const y=l.ae(m);return l.K(y,y,[g,g,1]),u||l.ad(y,y,-f.angle),y}return f.glCoordMatrix}function xt(m,s,u,f){let g;f?(g=[m,s,f(m,s),1],l.af(g,g,u)):(g=[m,s,0,1],Li(g,g,u));const y=g[3];return{point:new l.P(g[0]/y,g[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Y(m,s){return .5+m/s*.5}function K(m,s){return m.x>=-s[0]&&m.x<=s[0]&&m.y>=-s[1]&&m.y<=s[1]}function ct(m,s,u,f,g,y,A,C,B,F,j,O,W,$,q){const Q=f?m.textSizeData:m.iconSizeData,lt=l.ag(Q,u.transform.zoom),ht=[256/u.width*2+1,256/u.height*2+1],ft=f?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ft.clear();const ut=m.lineVertexArray,vt=f?m.text.placedSymbolArray:m.icon.placedSymbolArray,Bt=u.transform.width/u.transform.height;let It=!1;for(let Qt=0;Qt<vt.length;Qt++){const pe=vt.get(Qt);if(pe.hidden||pe.writingMode===l.ah.vertical&&!It){Je(pe.numGlyphs,ft);continue}It=!1;const _e=xt(pe.anchorX,pe.anchorY,s,q);if(!K(_e.point,ht)){Je(pe.numGlyphs,ft);continue}const xe=Y(u.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),ve=l.ai(Q,lt,pe),ye=A?ve/xe:ve*xe,we={getElevation:q,labelPlaneMatrix:g,lineVertexArray:ut,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:F,tileAnchorPoint:new l.P(pe.anchorX,pe.anchorY),unwrappedTileID:j,width:O,height:W,translation:$},$e=Gt(we,pe,ye,!1,C,s,y,m.glyphOffsetArray,ft,Bt,B);It=$e.useVertical,($e.notEnoughRoom||It||$e.needsFlipping&&Gt(we,pe,ye,!0,C,s,y,m.glyphOffsetArray,ft,Bt,B).notEnoughRoom)&&Je(pe.numGlyphs,ft)}f?m.text.dynamicLayoutVertexBuffer.updateData(ft):m.icon.dynamicLayoutVertexBuffer.updateData(ft)}function _t(m,s,u,f,g,y,A,C){const B=y.glyphStartIndex+y.numGlyphs,F=y.lineStartIndex,j=y.lineStartIndex+y.lineLength,O=s.getoffsetX(y.glyphStartIndex),W=s.getoffsetX(B-1),$=be(m*O,u,f,g,y.segment,F,j,C,A);if(!$)return null;const q=be(m*W,u,f,g,y.segment,F,j,C,A);return q?C.projectionCache.anyProjectionOccluded?null:{first:$,last:q}:null}function kt(m,s,u,f){return m===l.ah.horizontal&&Math.abs(u.y-s.y)>Math.abs(u.x-s.x)*f?{useVertical:!0}:(m===l.ah.vertical?s.y<u.y:s.x>u.x)?{needsFlipping:!0}:null}function Gt(m,s,u,f,g,y,A,C,B,F,j){const O=u/24,W=s.lineOffsetX*O,$=s.lineOffsetY*O;let q;if(s.numGlyphs>1){const Q=s.glyphStartIndex+s.numGlyphs,lt=s.lineStartIndex,ht=s.lineStartIndex+s.lineLength,ft=_t(O,C,W,$,f,s,j,m);if(!ft)return{notEnoughRoom:!0};const ut=xt(ft.first.point.x,ft.first.point.y,A,m.getElevation).point,vt=xt(ft.last.point.x,ft.last.point.y,A,m.getElevation).point;if(g&&!f){const Bt=kt(s.writingMode,ut,vt,F);if(Bt)return Bt}q=[ft.first];for(let Bt=s.glyphStartIndex+1;Bt<Q-1;Bt++)q.push(be(O*C.getoffsetX(Bt),W,$,f,s.segment,lt,ht,m,j));q.push(ft.last)}else{if(g&&!f){const lt=xt(m.tileAnchorPoint.x,m.tileAnchorPoint.y,y,m.getElevation).point,ht=s.lineStartIndex+s.segment+1,ft=new l.P(m.lineVertexArray.getx(ht),m.lineVertexArray.gety(ht)),ut=xt(ft.x,ft.y,y,m.getElevation),vt=ut.signedDistanceFromCamera>0?ut.point:function(It,Qt,pe,_e,xe,ve){return Rt(It,Qt,pe,1,xe,ve)}(m.tileAnchorPoint,ft,lt,0,y,m),Bt=kt(s.writingMode,lt,vt,F);if(Bt)return Bt}const Q=be(O*C.getoffsetX(s.glyphStartIndex),W,$,f,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,m,j);if(!Q||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[Q]}for(const Q of q)l.aj(B,Q.point,Q.angle);return{}}function Rt(m,s,u,f,g,y){const A=m.add(m.sub(s)._unit()),C=g!==void 0?xt(A.x,A.y,g,y.getElevation).point:te(A.x,A.y,y).point,B=u.sub(C);return u.add(B._mult(f/B.mag()))}function Ct(m,s,u){const f=s.projectionCache;if(f.projections[m])return f.projections[m];const g=new l.P(s.lineVertexArray.getx(m),s.lineVertexArray.gety(m)),y=te(g.x,g.y,s);if(y.signedDistanceFromCamera>0)return f.projections[m]=y.point,f.anyProjectionOccluded=f.anyProjectionOccluded||y.isOccluded,y.point;const A=m-u.direction;return function(C,B,F,j,O){return Rt(C,B,F,j,void 0,O)}(u.distanceFromAnchor===0?s.tileAnchorPoint:new l.P(s.lineVertexArray.getx(A),s.lineVertexArray.gety(A)),g,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,s)}function te(m,s,u){const f=m+u.translation[0],g=s+u.translation[1];let y;return!u.pitchWithMap&&u.projection.useSpecialProjectionForSymbols?(y=u.projection.projectTileCoordinates(f,g,u.unwrappedTileID,u.getElevation),y.point.x=(.5*y.point.x+.5)*u.width,y.point.y=(.5*-y.point.y+.5)*u.height):(y=xt(f,g,u.labelPlaneMatrix,u.getElevation),y.isOccluded=!1),y}function he(m,s,u){return m._unit()._perp()._mult(s*u)}function Wt(m,s,u,f,g,y,A,C,B){if(C.projectionCache.offsets[m])return C.projectionCache.offsets[m];const F=u.add(s);if(m+B.direction<f||m+B.direction>=g)return C.projectionCache.offsets[m]=F,F;const j=Ct(m+B.direction,C,B),O=he(j.sub(u),A,B.direction),W=u.add(O),$=j.add(O);return C.projectionCache.offsets[m]=l.ak(y,F,W,$)||F,C.projectionCache.offsets[m]}function be(m,s,u,f,g,y,A,C,B){const F=f?m-s:m+s;let j=F>0?1:-1,O=0;f&&(j*=-1,O=Math.PI),j<0&&(O+=Math.PI);let W,$=j>0?y+g:y+g+1;C.projectionCache.cachedAnchorPoint?W=C.projectionCache.cachedAnchorPoint:(W=te(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=W);let q,Q,lt=W,ht=W,ft=0,ut=0;const vt=Math.abs(F),Bt=[];let It;for(;ft+ut<=vt;){if($+=j,$<y||$>=A)return null;ft+=ut,ht=lt,Q=q;const _e={absOffsetX:vt,direction:j,distanceFromAnchor:ft,previousVertex:ht};if(lt=Ct($,C,_e),u===0)Bt.push(ht),It=lt.sub(ht);else{let xe;const ve=lt.sub(ht);xe=ve.mag()===0?he(Ct($+j,C,_e).sub(lt),u,j):he(ve,u,j),Q||(Q=ht.add(xe)),q=Wt($,xe,lt,y,A,Q,u,C,_e),Bt.push(Q),It=q.sub(Q)}ut=It.mag()}const Qt=It._mult((vt-ft)/ut)._add(Q||ht),pe=O+Math.atan2(lt.y-ht.y,lt.x-ht.x);return Bt.push(Qt),{point:Qt,angle:B?pe:0,path:Bt}}const We=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Je(m,s){for(let u=0;u<m;u++){const f=s.length;s.resize(f+4),s.float32.set(We,3*f)}}function Li(m,s,u){const f=s[0],g=s[1];return m[0]=u[0]*f+u[4]*g+u[12],m[1]=u[1]*f+u[5]*g+u[13],m[3]=u[3]*f+u[7]*g+u[15],m}const Qe=100;class Ci{constructor(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ir(s.width+200,s.height+200,25),g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new ir(s.width+200,s.height+200,25);this.transform=s,this.mapProjection=u,this.grid=f,this.ignoredGrid=g,this.pitchFactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Qe,this.screenBottomBoundary=s.height+Qe,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,u,f,g,y,A,C,B,F,j,O){const W=s.anchorPointX+B[0],$=s.anchorPointY+B[1],q=this.projectAndGetPerspectiveRatio(g,W,$,y,j),Q=f*q.perspectiveRatio;let lt;if(A||C)lt=this._projectCollisionBox(s,Q,g,y,A,C,B,q,j,O);else{const Bt=q.point.x+(O?O.x*Q:0),It=q.point.y+(O?O.y*Q:0);lt={allPointsOccluded:!1,box:[Bt+s.x1*Q,It+s.y1*Q,Bt+s.x2*Q,It+s.y2*Q]}}const[ht,ft,ut,vt]=lt.box;return this.mapProjection.useSpecialProjectionForSymbols&&(A?lt.allPointsOccluded:this.mapProjection.isOccluded(W,$,y))||q.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ht,ft,ut,vt)||u!=="always"&&this.grid.hitTest(ht,ft,ut,vt,u,F)?{box:[ht,ft,ut,vt],placeable:!1,offscreen:!1}:{box:[ht,ft,ut,vt],placeable:!0,offscreen:this.isOffscreen(ht,ft,ut,vt)}}placeCollisionCircles(s,u,f,g,y,A,C,B,F,j,O,W,$,q,Q,lt){const ht=[],ft=new l.P(u.anchorX,u.anchorY),ut=this.getPerspectiveRatio(A,ft.x,ft.y,C,lt),vt=(O?y/ut:y*ut)/l.ap,Bt={getElevation:lt,labelPlaneMatrix:B,lineVertexArray:f,pitchWithMap:O,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ft,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:Q},It=_t(vt,g,u.lineOffsetX*vt,u.lineOffsetY*vt,!1,u,!1,Bt);let Qt=!1,pe=!1,_e=!0;if(It){const xe=.5*$*ut+q,ve=new l.P(-100,-100),ye=new l.P(this.screenRightBoundary,this.screenBottomBoundary),we=new ze,$e=It.first,Ce=It.last;let Pe=[];for(let _i=$e.path.length-1;_i>=1;_i--)Pe.push($e.path[_i]);for(let _i=1;_i<Ce.path.length;_i++)Pe.push(Ce.path[_i]);const ii=2.5*xe;if(F){const _i=this.projectPathToScreenSpace(Pe,Bt,F);Pe=_i.some(Ai=>Ai.signedDistanceFromCamera<=0)?[]:_i.map(Ai=>Ai.point)}let wi=[];if(Pe.length>0){const _i=Pe[0].clone(),Ai=Pe[0].clone();for(let ki=1;ki<Pe.length;ki++)_i.x=Math.min(_i.x,Pe[ki].x),_i.y=Math.min(_i.y,Pe[ki].y),Ai.x=Math.max(Ai.x,Pe[ki].x),Ai.y=Math.max(Ai.y,Pe[ki].y);wi=_i.x>=ve.x&&Ai.x<=ye.x&&_i.y>=ve.y&&Ai.y<=ye.y?[Pe]:Ai.x<ve.x||_i.x>ye.x||Ai.y<ve.y||_i.y>ye.y?[]:l.al([Pe],ve.x,ve.y,ye.x,ye.y)}for(const _i of wi){we.reset(_i,.25*xe);let Ai=0;Ai=we.length<=.5*xe?1:Math.ceil(we.paddedLength/ii)+1;for(let ki=0;ki<Ai;ki++){const nr=ki/Math.max(Ai-1,1),Rr=we.lerp(nr),Ki=Rr.x+Qe,Hr=Rr.y+Qe;ht.push(Ki,Hr,xe,0);const sr=Ki-xe,jr=Hr-xe,sn=Ki+xe,es=Hr+xe;if(_e=_e&&this.isOffscreen(sr,jr,sn,es),pe=pe||this.isInsideGrid(sr,jr,sn,es),s!=="always"&&this.grid.hitTestCircle(Ki,Hr,xe,s,W)&&(Qt=!0,!j))return{circles:[],offscreen:!1,collisionDetected:Qt}}}}return{circles:!j&&Qt||!pe||ut<this.perspectiveRatioCutoff?[]:ht,offscreen:_e,collisionDetected:Qt}}projectPathToScreenSpace(s,u,f){return s.map(g=>xt(g.x,g.y,f,u.getElevation))}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let f=1/0,g=1/0,y=-1/0,A=-1/0;for(const j of s){const O=new l.P(j.x+Qe,j.y+Qe);f=Math.min(f,O.x),g=Math.min(g,O.y),y=Math.max(y,O.x),A=Math.max(A,O.y),u.push(O)}const C=this.grid.query(f,g,y,A).concat(this.ignoredGrid.query(f,g,y,A)),B={},F={};for(const j of C){const O=j.key;if(B[O.bucketInstanceId]===void 0&&(B[O.bucketInstanceId]={}),B[O.bucketInstanceId][O.featureIndex])continue;const W=[new l.P(j.x1,j.y1),new l.P(j.x2,j.y1),new l.P(j.x2,j.y2),new l.P(j.x1,j.y2)];l.am(u,W)&&(B[O.bucketInstanceId][O.featureIndex]=!0,F[O.bucketInstanceId]===void 0&&(F[O.bucketInstanceId]=[]),F[O.bucketInstanceId].push(O.featureIndex))}return F}insertCollisionBox(s,u,f,g,y,A){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:y,collisionGroupID:A,overlapMode:u},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,f,g,y,A){const C=f?this.ignoredGrid:this.grid,B={bucketInstanceId:g,featureIndex:y,collisionGroupID:A,overlapMode:u};for(let F=0;F<s.length;F+=4)C.insertCircle(B,s[F],s[F+1],s[F+2])}projectAndGetPerspectiveRatio(s,u,f,g,y){let A;y?(A=[u,f,y(u,f),1],l.af(A,A,s)):(A=[u,f,0,1],Li(A,A,s));const C=A[3];return{point:new l.P((A[0]/C+1)/2*this.transform.width+Qe,(-A[1]/C+1)/2*this.transform.height+Qe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}getPerspectiveRatio(s,u,f,g,y){const A=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(u,f,g,y):xt(u,f,s,y);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(s,u,f,g){return f<Qe||s>=this.screenRightBoundary||g<Qe||u>this.screenBottomBoundary}isInsideGrid(s,u,f,g){return f>=0&&s<this.gridRightBoundary&&g>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=l.an([]);return l.J(s,s,[-100,-100,0]),s}_projectCollisionBox(s,u,f,g,y,A,C,B,F,j){let O=new l.P(1,0),W=new l.P(0,1);const $=new l.P(s.anchorPointX+C[0],s.anchorPointY+C[1]);if(A&&!y){const _e=this.projectAndGetPerspectiveRatio(f,$.x+1,$.y,g,F).point.sub(B.point).unit(),xe=Math.atan(_e.y/_e.x)+(_e.x<0?Math.PI:0),ve=Math.sin(xe),ye=Math.cos(xe);O=new l.P(ye,ve),W=new l.P(-ve,ye)}else if(!A&&y){const _e=-this.transform.angle,xe=Math.sin(_e),ve=Math.cos(_e);O=new l.P(ve,xe),W=new l.P(-xe,ve)}let q=B.point,Q=u;if(y){q=$;const _e=this.transform.zoom-Math.floor(this.transform.zoom);Q=Math.pow(2,-_e),Q*=this.mapProjection.getPitchedTextCorrection(this.transform,$,g),j||(Q*=l.ac(.5+B.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}j&&(q=q.add(O.mult(j.x*Q)).add(W.mult(j.y*Q)));const lt=s.x1*Q,ht=s.x2*Q,ft=(lt+ht)/2,ut=s.y1*Q,vt=s.y2*Q,Bt=(ut+vt)/2,It=[{offsetX:lt,offsetY:ut},{offsetX:ft,offsetY:ut},{offsetX:ht,offsetY:ut},{offsetX:ht,offsetY:Bt},{offsetX:ht,offsetY:vt},{offsetX:ft,offsetY:vt},{offsetX:lt,offsetY:vt},{offsetX:lt,offsetY:Bt}];let Qt=[];for(const{offsetX:_e,offsetY:xe}of It)Qt.push(new l.P(q.x+O.x*_e+W.x*xe,q.y+O.y*_e+W.y*xe));let pe=!1;if(y){const _e=Qt.map(xe=>this.projectAndGetPerspectiveRatio(f,xe.x,xe.y,g,F));pe=_e.some(xe=>!xe.isOccluded),Qt=_e.map(xe=>xe.point)}else pe=!0;return{box:l.ao(Qt),allPointsOccluded:!pe}}}function xi(m,s,u){return s*(l.X/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}class rr{constructor(s,u,f,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Hi{constructor(s,u,f,g,y){this.text=new rr(s?s.text:null,u,f,y),this.icon=new rr(s?s.icon:null,u,g,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(s,u,f){this.text=s,this.icon=u,this.skipFade=f}}class Fi{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class Qi{constructor(s,u,f,g,y){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=y}}class pr{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:f=>f.collisionGroupID===u}}return this.collisionGroups[s]}}function Ar(m,s,u,f,g){const{horizontalAlign:y,verticalAlign:A}=l.au(m);return new l.P(-(y-.5)*s+f[0]*g,-(A-.5)*u+f[1]*g)}class $r{constructor(s,u,f,g,y,A){this.transform=s.clone(),this.terrain=f,this.collisionIndex=new Ci(this.transform,u),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new pr(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const u=this.terrain;return u?(f,g)=>u.getElevation(s,f,g):null}getBucketParts(s,u,f,g){const y=f.getBucket(u),A=f.latestFeatureIndex;if(!y||!A||u.id!==y.layerIds[0])return;const C=f.collisionBoxArray,B=y.layers[0].layout,F=y.layers[0].paint,j=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/l.X,W=f.tileID.toUnwrapped(),$=this.transform.calculatePosMatrix(W),q=B.get("text-pitch-alignment")==="map",Q=B.get("text-rotation-alignment")==="map",lt=xi(f,1,this.transform.zoom),ht=this.collisionIndex.mapProjection.translatePosition(this.transform,f,F.get("text-translate"),F.get("text-translate-anchor")),ft=this.collisionIndex.mapProjection.translatePosition(this.transform,f,F.get("icon-translate"),F.get("icon-translate-anchor")),ut=Qr($,q,Q,this.transform,lt);let vt=null;if(q){const It=tn($,q,Q,this.transform,lt);vt=l.L([],this.transform.labelPlaneMatrix,It)}this.retainedQueryData[y.bucketInstanceId]=new Qi(y.bucketInstanceId,A,y.sourceLayerIndex,y.index,f.tileID);const Bt={bucket:y,layout:B,translationText:ht,translationIcon:ft,posMatrix:$,unwrappedTileID:W,textLabelPlaneMatrix:ut,labelToScreenMatrix:vt,scale:j,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(g)for(const It of y.sortKeyRanges){const{sortKey:Qt,symbolInstanceStart:pe,symbolInstanceEnd:_e}=It;s.push({sortKey:Qt,symbolInstanceStart:pe,symbolInstanceEnd:_e,parameters:Bt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Bt})}attemptAnchorPlacement(s,u,f,g,y,A,C,B,F,j,O,W,$,q,Q,lt,ht,ft,ut){const vt=l.aq[s.textAnchor],Bt=[s.textOffset0,s.textOffset1],It=Ar(vt,f,g,Bt,y),Qt=this.collisionIndex.placeCollisionBox(u,W,B,F,j,C,A,lt,O.predicate,ut,It);if((!ft||this.collisionIndex.placeCollisionBox(ft,W,B,F,j,C,A,ht,O.predicate,ut,It).placeable)&&Qt.placeable){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Bt,width:f,height:g,anchor:vt,textBoxScale:y,prevAnchor:pe},this.markUsedJustification(q,vt,$,Q),q.allowVerticalPlacement&&(this.markUsedOrientation(q,Q,$),this.placedOrientations[$.crossTileID]=Q),{shift:It,placedGlyphBoxes:Qt}}}placeLayerBucketPart(s,u,f){const{bucket:g,layout:y,translationText:A,translationIcon:C,posMatrix:B,unwrappedTileID:F,textLabelPlaneMatrix:j,labelToScreenMatrix:O,textPixelRatio:W,holdingForFade:$,collisionBoxArray:q,partiallyEvaluatedTextSize:Q,collisionGroup:lt}=s.parameters,ht=y.get("text-optional"),ft=y.get("icon-optional"),ut=l.ar(y,"text-overlap","text-allow-overlap"),vt=ut==="always",Bt=l.ar(y,"icon-overlap","icon-allow-overlap"),It=Bt==="always",Qt=y.get("text-rotation-alignment")==="map",pe=y.get("text-pitch-alignment")==="map",_e=y.get("icon-text-fit")!=="none",xe=y.get("symbol-z-order")==="viewport-y",ve=vt&&(It||!g.hasIconData()||ft),ye=It&&(vt||!g.hasTextData()||ht);!g.collisionArrays&&q&&g.deserializeCollisionBoxes(q);const we=this._getTerrainElevationFunc(this.retainedQueryData[g.bucketInstanceId].tileID),$e=(Ce,Pe,ii)=>{var wi,_i;if(u[Ce.crossTileID])return;if($)return void(this.placements[Ce.crossTileID]=new hi(!1,!1,!1));let Ai=!1,ki=!1,nr=!0,Rr=null,Ki={box:null,placeable:!1,offscreen:null},Hr={box:null,placeable:!1,offscreen:null},sr=null,jr=null,sn=null,es=0,Cs=0,kr=0;Pe.textFeatureIndex?es=Pe.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(es=Ce.featureIndex),Pe.verticalTextFeatureIndex&&(Cs=Pe.verticalTextFeatureIndex);const Da=Pe.textBox;if(Da){const zn=Yr=>{let Ln=l.ah.horizontal;if(g.allowVerticalPlacement&&!Yr&&this.prevPlacement){const Un=this.prevPlacement.placedOrientations[Ce.crossTileID];Un&&(this.placedOrientations[Ce.crossTileID]=Un,Ln=Un,this.markUsedOrientation(g,Ln,Ce))}return Ln},is=(Yr,Ln)=>{if(g.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&Pe.verticalTextBox){for(const Un of g.writingModes)if(Un===l.ah.vertical?(Ki=Ln(),Hr=Ki):Ki=Yr(),Ki&&Ki.placeable)break}else Ki=Yr()},wn=Ce.textAnchorOffsetStartIndex,jn=Ce.textAnchorOffsetEndIndex;if(jn===wn){const Yr=(Ln,Un)=>{const qi=this.collisionIndex.placeCollisionBox(Ln,ut,W,B,F,pe,Qt,A,lt.predicate,we);return qi&&qi.placeable&&(this.markUsedOrientation(g,Un,Ce),this.placedOrientations[Ce.crossTileID]=Un),qi};is(()=>Yr(Da,l.ah.horizontal),()=>{const Ln=Pe.verticalTextBox;return g.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&Ln?Yr(Ln,l.ah.vertical):{box:null,offscreen:null}}),zn(Ki&&Ki.placeable)}else{let Yr=l.aq[(_i=(wi=this.prevPlacement)===null||wi===void 0?void 0:wi.variableOffsets[Ce.crossTileID])===null||_i===void 0?void 0:_i.anchor];const Ln=(qi,Oo,Oa)=>{const sa=qi.x2-qi.x1,Ql=qi.y2-qi.y1,hp=Ce.textBoxScale,Ju=_e&&Bt==="never"?Oo:null;let No=null,oa=ut==="never"?1:2,bh="never";Yr&&oa++;for(let jc=0;jc<oa;jc++){for(let xh=wn;xh<jn;xh++){const Uc=g.textAnchorOffsets.get(xh);if(Yr&&Uc.textAnchor!==Yr)continue;const aa=this.attemptAnchorPlacement(Uc,qi,sa,Ql,hp,Qt,pe,W,B,F,lt,bh,Ce,g,Oa,A,C,Ju,we);if(aa&&(No=aa.placedGlyphBoxes,No&&No.placeable))return Ai=!0,Rr=aa.shift,No}Yr?Yr=null:bh=ut}return f&&!No&&(No={box:this.collisionIndex.placeCollisionBox(Da,"always",W,B,F,pe,Qt,A,lt.predicate,we,new l.P(0,0)).box,offscreen:!1,placeable:!1}),No};is(()=>Ln(Da,Pe.iconBox,l.ah.horizontal),()=>{const qi=Pe.verticalTextBox;return g.allowVerticalPlacement&&(!Ki||!Ki.placeable)&&Ce.numVerticalGlyphVertices>0&&qi?Ln(qi,Pe.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ki&&(Ai=Ki.placeable,nr=Ki.offscreen);const Un=zn(Ki&&Ki.placeable);if(!Ai&&this.prevPlacement){const qi=this.prevPlacement.variableOffsets[Ce.crossTileID];qi&&(this.variableOffsets[Ce.crossTileID]=qi,this.markUsedJustification(g,qi.anchor,Ce,Un))}}}if(sr=Ki,Ai=sr&&sr.placeable,nr=sr&&sr.offscreen,Ce.useRuntimeCollisionCircles){const zn=g.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex),is=l.ai(g.textSizeData,Q,zn),wn=y.get("text-padding");jr=this.collisionIndex.placeCollisionCircles(ut,zn,g.lineVertexArray,g.glyphOffsetArray,is,B,F,j,O,f,pe,lt.predicate,Ce.collisionCircleDiameter,wn,A,we),jr.circles.length&&jr.collisionDetected&&!f&&l.w("Collisions detected, but collision boxes are not shown"),Ai=vt||jr.circles.length>0&&!jr.collisionDetected,nr=nr&&jr.offscreen}if(Pe.iconFeatureIndex&&(kr=Pe.iconFeatureIndex),Pe.iconBox){const zn=is=>this.collisionIndex.placeCollisionBox(is,Bt,W,B,F,pe,Qt,C,lt.predicate,we,_e&&Rr?Rr:void 0);Hr&&Hr.placeable&&Pe.verticalIconBox?(sn=zn(Pe.verticalIconBox),ki=sn.placeable):(sn=zn(Pe.iconBox),ki=sn.placeable),nr=nr&&sn.offscreen}const Ps=ht||Ce.numHorizontalGlyphVertices===0&&Ce.numVerticalGlyphVertices===0,zc=ft||Ce.numIconVertices===0;Ps||zc?zc?Ps||(ki=ki&&Ai):Ai=ki&&Ai:ki=Ai=ki&&Ai;const Kl=ki&&sn.placeable;if(Ai&&sr.placeable&&this.collisionIndex.insertCollisionBox(sr.box,ut,y.get("text-ignore-placement"),g.bucketInstanceId,Hr&&Hr.placeable&&Cs?Cs:es,lt.ID),Kl&&this.collisionIndex.insertCollisionBox(sn.box,Bt,y.get("icon-ignore-placement"),g.bucketInstanceId,kr,lt.ID),jr&&Ai&&this.collisionIndex.insertCollisionCircles(jr.circles,ut,y.get("text-ignore-placement"),g.bucketInstanceId,es,lt.ID),f&&this.storeCollisionData(g.bucketInstanceId,ii,Pe,sr,sn,jr),Ce.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ce.crossTileID]=new hi(Ai||ve,ki||ye,nr||g.justReloaded),u[Ce.crossTileID]=!0};if(xe){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ce=g.getSortedSymbolIndexes(this.transform.angle);for(let Pe=Ce.length-1;Pe>=0;--Pe){const ii=Ce[Pe];$e(g.symbolInstances.get(ii),g.collisionArrays[ii],ii)}}else for(let Ce=s.symbolInstanceStart;Ce<s.symbolInstanceEnd;Ce++)$e(g.symbolInstances.get(Ce),g.collisionArrays[Ce],Ce);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[g.bucketInstanceId];l.as(Ce.invProjMatrix,B),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}storeCollisionData(s,u,f,g,y,A){if(f.textBox||f.iconBox){let C,B;this.collisionBoxArrays.has(s)?C=this.collisionBoxArrays.get(s):(C=new Map,this.collisionBoxArrays.set(s,C)),C.has(u)?B=C.get(u):(B={text:null,icon:null},C.set(u,B)),f.textBox&&(B.text=g.box),f.iconBox&&(B.icon=y.box)}if(A){let C=this.collisionCircleArrays[s];C===void 0&&(C=this.collisionCircleArrays[s]=new Fi);for(let B=0;B<A.circles.length;B+=4)C.circles.push(A.circles[B+0]),C.circles.push(A.circles[B+1]),C.circles.push(A.circles[B+2]),C.circles.push(A.collisionDetected?1:0)}}markUsedJustification(s,u,f,g){let y;y=g===l.ah.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[l.at(u)];const A=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const C of A)C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=y>=0&&C!==y?0:f.crossTileID)}markUsedOrientation(s,u,f){const g=u===l.ah.horizontal||u===l.ah.horizontalOnly?u:0,y=u===l.ah.vertical?u:0,A=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const C of A)s.text.placedSymbolArray.get(C).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let f=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const g=u?u.symbolFadeChange(s):1,y=u?u.opacities:{},A=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const B in this.placements){const F=this.placements[B],j=y[B];j?(this.opacities[B]=new Hi(j,g,F.text,F.icon),f=f||F.text!==j.text.placed||F.icon!==j.icon.placed):(this.opacities[B]=new Hi(null,g,F.text,F.icon,F.skipFade),f=f||F.text||F.icon)}for(const B in y){const F=y[B];if(!this.opacities[B]){const j=new Hi(F,g,!1,!1);j.isHidden()||(this.opacities[B]=j,f=f||F.text.placed||F.icon.placed)}}for(const B in A)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=A[B]);for(const B in C)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=C[B]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){const f={};for(const g of u){const y=g.getBucket(s);y&&g.latestFeatureIndex&&s.id===y.layerIds[0]&&this.updateBucketOpacities(y,g.tileID,f,g.collisionBoxArray)}}updateBucketOpacities(s,u,f,g){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0],A=y.layout,C=new Hi(null,0,!1,!1,!0),B=A.get("text-allow-overlap"),F=A.get("icon-allow-overlap"),j=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=A.get("text-rotation-alignment")==="map",W=A.get("text-pitch-alignment")==="map",$=A.get("icon-text-fit")!=="none",q=new Hi(null,0,B&&(F||!s.hasIconData()||A.get("icon-optional")),F&&(B||!s.hasTextData()||A.get("text-optional")),!0);!s.collisionArrays&&g&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(g);const Q=(ht,ft,ut)=>{for(let vt=0;vt<ft/4;vt++)ht.opacityVertexArray.emplaceBack(ut);ht.hasVisibleVertices=ht.hasVisibleVertices||ut!==ao},lt=this.collisionBoxArrays.get(s.bucketInstanceId);for(let ht=0;ht<s.symbolInstances.length;ht++){const ft=s.symbolInstances.get(ht),{numHorizontalGlyphVertices:ut,numVerticalGlyphVertices:vt,crossTileID:Bt}=ft;let It=this.opacities[Bt];f[Bt]?It=C:It||(It=q,this.opacities[Bt]=It),f[Bt]=!0;const Qt=ft.numIconVertices>0,pe=this.placedOrientations[ft.crossTileID],_e=pe===l.ah.vertical,xe=pe===l.ah.horizontal||pe===l.ah.horizontalOnly;if(ut>0||vt>0){const ye=Er(It.text);Q(s.text,ut,_e?ao:ye),Q(s.text,vt,xe?ao:ye);const we=It.text.isHidden();[ft.rightJustifiedTextSymbolIndex,ft.centerJustifiedTextSymbolIndex,ft.leftJustifiedTextSymbolIndex].forEach(Pe=>{Pe>=0&&(s.text.placedSymbolArray.get(Pe).hidden=we||_e?1:0)}),ft.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ft.verticalPlacedTextSymbolIndex).hidden=we||xe?1:0);const $e=this.variableOffsets[ft.crossTileID];$e&&this.markUsedJustification(s,$e.anchor,ft,pe);const Ce=this.placedOrientations[ft.crossTileID];Ce&&(this.markUsedJustification(s,"left",ft,Ce),this.markUsedOrientation(s,Ce,ft))}if(Qt){const ye=Er(It.icon),we=!($&&ft.verticalPlacedIconSymbolIndex&&_e);ft.placedIconSymbolIndex>=0&&(Q(s.icon,ft.numIconVertices,we?ye:ao),s.icon.placedSymbolArray.get(ft.placedIconSymbolIndex).hidden=It.icon.isHidden()),ft.verticalPlacedIconSymbolIndex>=0&&(Q(s.icon,ft.numVerticalIconVertices,we?ao:ye),s.icon.placedSymbolArray.get(ft.verticalPlacedIconSymbolIndex).hidden=It.icon.isHidden())}const ve=lt&&lt.has(ht)?lt.get(ht):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const ye=s.collisionArrays[ht];if(ye){let we=new l.P(0,0);if(ye.textBox||ye.verticalTextBox){let $e=!0;if(j){const Ce=this.variableOffsets[Bt];Ce?(we=Ar(Ce.anchor,Ce.width,Ce.height,Ce.textOffset,Ce.textBoxScale),O&&we._rotate(W?this.transform.angle:-this.transform.angle)):$e=!1}if(ye.textBox||ye.verticalTextBox){let Ce;ye.textBox&&(Ce=_e),ye.verticalTextBox&&(Ce=xe),so(s.textCollisionBox.collisionVertexArray,It.text.placed,!$e||Ce,ve.text,we.x,we.y)}}if(ye.iconBox||ye.verticalIconBox){const $e=!!(!xe&&ye.verticalIconBox);let Ce;ye.iconBox&&(Ce=$e),ye.verticalIconBox&&(Ce=!$e),so(s.iconCollisionBox.collisionVertexArray,It.icon.placed,Ce,ve.icon,$?we.x:0,$?we.y:0)}}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ht=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ht.invProjMatrix,s.placementViewportMatrix=ht.viewportMatrix,s.collisionCircleArray=ht.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const f=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*f>s}setStale(){this.stale=!0}}function so(m,s,u,f,g,y){f&&f.length!==0||(f=[0,0,0,0]);const A=f[0]-Qe,C=f[1]-Qe,B=f[2]-Qe,F=f[3]-Qe;m.emplaceBack(s?1:0,u?1:0,g||0,y||0,A,C),m.emplaceBack(s?1:0,u?1:0,g||0,y||0,B,C),m.emplaceBack(s?1:0,u?1:0,g||0,y||0,B,F),m.emplaceBack(s?1:0,u?1:0,g||0,y||0,A,F)}const $i=Math.pow(2,25),yn=Math.pow(2,24),Xn=Math.pow(2,17),Ir=Math.pow(2,16),Lr=Math.pow(2,9),oo=Math.pow(2,8),Mr=Math.pow(2,1);function Er(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,u=Math.floor(127*m.opacity);return u*$i+s*yn+u*Xn+s*Ir+u*Lr+s*oo+u*Mr+s}const ao=0;function Zn(){return{isOccluded:(m,s,u)=>!1,getPitchedTextCorrection:(m,s,u)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,s,u,f){throw new Error("Not implemented.")},translatePosition:(m,s,u,f)=>function(g,y,A,C){let B=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(!A[0]&&!A[1])return[0,0];const F=B?C==="map"?g.angle:0:C==="viewport"?-g.angle:0;if(F){const j=Math.sin(F),O=Math.cos(F);A=[A[0]*O-A[1]*j,A[0]*j+A[1]*O]}return[B?A[0]:xi(y,A[0],g.zoom),B?A[1]:xi(y,A[1],g.zoom)]}(m,s,u,f),getCircleRadiusCorrection:m=>1}}class yr{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,u,f,g,y){const A=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(A,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,B)=>C.sortKey-B.sortKey));this._currentPartIndex<A.length;)if(u.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,y())return!0;return!1}}class Yi{constructor(s,u,f,g,y,A,C,B){this.placement=new $r(s,Zn(),u,A,C,B),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,u,f){const g=T.now(),y=()=>!this._forceFullPlacement&&T.now()-g>2;for(;this._currentPlacementIndex>=0;){const A=u[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=C)&&(!A.maxzoom||A.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new yr(A)),this._inProgressLayer.continuePlacement(f[A.source],this.placement,this._showCollisionBoxes,A,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const un=512/l.X/2;class fr{constructor(s,u,f){this.tileID=s,this.bucketInstanceId=f,this._symbolsByKey={};const g=new Map;for(let y=0;y<u.length;y++){const A=u.get(y),C=A.key,B=g.get(C);B?B.push(A):g.set(C,[A])}for(const[y,A]of g){const C={positions:A.map(B=>({x:Math.floor(B.anchorX*un),y:Math.floor(B.anchorY*un)})),crossTileIDs:A.map(B=>B.crossTileID)};if(C.positions.length>128){const B=new l.av(C.positions.length,16,Uint16Array);for(const{x:F,y:j}of C.positions)B.add(F,j);B.finish(),delete C.positions,C.index=B}this._symbolsByKey[y]=C}}getScaledCoordinates(s,u){const{x:f,y:g,z:y}=this.tileID.canonical,{x:A,y:C,z:B}=u.canonical,F=un/Math.pow(2,B-y),j=(C*l.X+s.anchorY)*F,O=g*l.X*un;return{x:Math.floor((A*l.X+s.anchorX)*F-f*l.X*un),y:Math.floor(j-O)}}findMatches(s,u,f){const g=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let y=0;y<s.length;y++){const A=s.get(y);if(A.crossTileID)continue;const C=this._symbolsByKey[A.key];if(!C)continue;const B=this.getScaledCoordinates(A,u);if(C.index){const F=C.index.range(B.x-g,B.y-g,B.x+g,B.y+g).sort();for(const j of F){const O=C.crossTileIDs[j];if(!f[O]){f[O]=!0,A.crossTileID=O;break}}}else if(C.positions)for(let F=0;F<C.positions.length;F++){const j=C.positions[F],O=C.crossTileIDs[F];if(Math.abs(j.x-B.x)<=g&&Math.abs(j.y-B.y)<=g&&!f[O]){f[O]=!0,A.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(s=>{let{crossTileIDs:u}=s;return u})}}class lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const f in this.indexes){const g=this.indexes[f],y={};for(const A in g){const C=g[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),y[C.tileID.key]=C}this.indexes[f]=y}this.lng=s}addBucket(s,u,f){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let y=0;y<u.symbolInstances.length;y++)u.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const y in this.indexes){const A=this.indexes[y];if(Number(y)>s.overscaledZ)for(const C in A){const B=A[C];B.tileID.isChildOf(s)&&B.findMatches(u.symbolInstances,s,g)}else{const C=A[s.scaledTo(Number(y)).key];C&&C.findMatches(u.symbolInstances,s,g)}}for(let y=0;y<u.symbolInstances.length;y++){const A=u.symbolInstances.get(y);A.crossTileID||(A.crossTileID=f.generate(),g[A.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new fr(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const f of u.getCrossTileIDsLists())for(const g of f)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let u=!1;for(const f in this.indexes){const g=this.indexes[f];for(const y in g)s[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[y]),delete g[y],u=!0)}return u}}class $o{constructor(){this.layerIndexes={},this.crossTileIDs=new lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,f){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new dn);let y=!1;const A={};g.handleWrapJump(f);for(const C of u){const B=C.getBucket(s);B&&s.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,B,this.crossTileIDs)&&(y=!0),A[B.bucketInstanceId]=!0)}return g.removeStaleBuckets(A)&&(y=!0),y}pruneUnusedLayers(s){const u={};s.forEach(f=>{u[f]=!0});for(const f in this.layerIndexes)u[f]||delete this.layerIndexes[f]}}const Tr=(m,s)=>l.t(m,s&&s.filter(u=>u.identifier!=="source.canvas")),$n=l.aw();class pn extends l.E{constructor(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const g=this.sourceCaches[f].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[f].reload()}},this.map=s,this.dispatcher=new Ae($t(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,g)=>this.getGlyphs(f,g)),this.dispatcher.registerMessageHandler("GI",(f,g)=>this.getImages(f,g)),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new re(s._requestManager,u.localIdeographFontFamily),this.lineAtlas=new St(256,512),this.crossTileSymbolIndex=new $o,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),ke().on(me,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const y=g.getSource();if(y&&y.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===y.id&&this._validateLayer(C)}})}loadURL(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const g=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;l.h(g,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,u,f)}).catch(A=>{this._loadStyleRequest=null,A&&!y.signal.aborted&&this.fire(new l.j(A))})}loadJSON(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(s,u,f)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load($n,{validate:!1})}_load(s,u,f){var g;const y=u.transformStyle?u.transformStyle(f,s):s;if(!u.validate||!Tr(this,l.u(y))){this._loaded=!0,this.stylesheet=y;for(const A in y.sources)this.addSource(A,y.sources[A],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new le(this.stylesheet.light),this.sky=new nt(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const s=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of s){const f=l.aA(u);f.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=f}}_loadSprite(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,A,C,B){return l._(this,void 0,void 0,function*(){const F=Ut(y),j=C>1?"@2x":"",O={},W={};for(const{id:$,url:q}of F){const Q=A.transformRequest(zt(q,j,".json"),"SpriteJSON");O[$]=l.h(Q,B);const lt=A.transformRequest(zt(q,j,".png"),"SpriteImage");W[$]=ot.getImage(lt,B)}return yield Promise.all([...Object.values(O),...Object.values(W)]),function($,q){return l._(this,void 0,void 0,function*(){const Q={};for(const lt in $){Q[lt]={};const ht=T.getImageCanvasContext((yield q[lt]).data),ft=(yield $[lt]).data;for(const ut in ft){const{width:vt,height:Bt,x:It,y:Qt,sdf:pe,pixelRatio:_e,stretchX:xe,stretchY:ve,content:ye,textFitWidth:we,textFitHeight:$e}=ft[ut];Q[lt][ut]={data:null,pixelRatio:_e,sdf:pe,stretchX:xe,stretchY:ve,content:ye,textFitWidth:we,textFitHeight:$e,spriteData:{width:vt,height:Bt,x:It,y:Qt,context:ht}}}}return Q})}(O,W)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const A in y){this._spritesImagesIds[A]=[];const C=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(B=>!(B in y)):[];for(const B of C)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in y[A]){const F=A==="default"?B:`${A}:${B}`;this._spritesImagesIds[A].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,y[A][B],!1):this.imageManager.addImage(F,y[A][B]),u&&(this._changedImages[F]=!0)}}}).catch(y=>{this._spriteRequest=null,g=y,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),f&&f(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(s){const u=this.sourceCaches[s.source];if(!u)return;const f=s.sourceLayer;if(!f)return;const g=u.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new l.j(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const f=this._serializedAllLayers();if(!s||s.length===0)return Object.values(u?l.aB(f):f);const g=[];for(const y of s)if(f[y]){const A=u?l.aB(f[y]):f[y];g.push(A)}return g}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const u=Object.keys(this._layers);for(const f of u){const g=this._layers[f];g.type!=="custom"&&(s[f]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const u=this._changed;if(u){const g=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(g.length||y.length)&&this._updateWorkerLayers(g,y);for(const A in this._updatedSources){const C=this._updatedSources[A];if(C==="reload")this._reloadSource(A);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const y=this.sourceCaches[g];f[g]=y.used,y.used=!1}for(const g of this._order){const y=this._layers[g];y.recalculate(s,this._availableImages),!y.isHidden(s.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const g in f){const y=this.sourceCaches[g];!!f[g]!=!!y.used&&y.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.sky.recalculate(s),this.z=s.zoom,u&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var f;this._checkLoaded();const g=this.serialize();if(s=u.transformStyle?u.transformStyle(g,s):s,((f=u.validate)===null||f===void 0||f)&&Tr(this,l.u(s)))return!1;(s=l.aB(s)).layers=l.az(s.layers);const y=l.aC(g,s),A=this._getOperationsToPerform(y);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const C of A.operations)C();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const u=[],f=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":u.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":u.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,g.args));break;case"setSky":u.push(()=>this.setSky.apply(this,g.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":u.push(()=>{});break;default:f.push(g.command)}return{operations:u,unimplemented:f}}addImage(s,u){if(this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,u),this._afterImageUpdated(s)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(l.u.source,`sources.${s}`,u,null,f))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const g=this.sourceCaches[s]=new Ue(s,u,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===s)return this.fire(new l.j(new Error(`Source "${s}" cannot be removed while layer "${f}" is using it.`)));const u=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],u.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,u){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const f=this.sourceCaches[s].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(u),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let y;if(s.type==="custom"){if(Tr(this,l.aD(s)))return;y=l.aA(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=l.aB(s),s=l.e(s,{source:g})),this._validate(l.u.layer,`layers.${g}`,s,{arrayIndex:-1},f))return;y=l.aA(s),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}const A=u?this._order.indexOf(u):this._order.length;if(u&&A===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${u}".`)));else{if(this._order.splice(A,0,g),this._layerOrderChanged=!0,this._layers[g]=y,this._removedLayers[g]&&y.source&&y.type!=="custom"){const C=this._removedLayers[g];delete this._removedLayers[g],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;const f=this._order.indexOf(s);this._order.splice(f,1);const g=u?this._order.indexOf(u):this._order.length;u&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${s}" before non-existing layer "${u}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const u=this._layers[s];if(!u)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${s}".`)));u.setEventedParent(null);const f=this._order.indexOf(s);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,u,f){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===u&&g.maxzoom===f||(u!=null&&(g.minzoom=u),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const g=this.getLayer(s);if(g){if(!l.aE(g.filter,u))return u==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.u.filter,`layers.${g.id}.filter`,u,null,f)||(g.filter=l.aB(u),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.aB(this.getLayer(s).filter)}setLayoutProperty(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(s);y?l.aE(y.getLayoutProperty(u),f)||(y.setLayoutProperty(u,f,g),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,u){const f=this.getLayer(s);if(f)return f.getLayoutProperty(u);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(s);y?l.aE(y.getPaintProperty(u),f)||(y.setPaintProperty(u,f,g)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,u){return this.getLayer(s).getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();const f=s.source,g=s.sourceLayer,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const A=y.getSource().type;A==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||g?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(g,s.id,u)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,u){this._checkLoaded();const f=s.source,g=this.sourceCaches[f];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const y=g.getSource().type,A=y==="vector"?s.sourceLayer:void 0;y!=="vector"||A?u&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(A,s.id,u):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const u=s.source,f=s.sourceLayer,g=this.sourceCaches[u];if(g!==void 0)return g.getSource().type!=="vector"||f?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,s.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.aF(this.sourceCaches,y=>y.serialize()),u=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aG({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:u,terrain:f},y=>y!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const u=A=>this._layers[A].type==="fill-extrusion",f={},g=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(u(C)){f[C]=A;for(const B of s){const F=B[C];if(F)for(const j of F)g.push(j)}}}g.sort((A,C)=>C.intersectionZ-A.intersectionZ);const y=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(u(C))for(let B=g.length-1;B>=0;B--){const F=g[B].feature;if(f[F.layer.id]<A)break;y.push(F),g.pop()}else for(const B of s){const F=B[C];if(F)for(const j of F)y.push(j.feature)}}return y}queryRenderedFeatures(s,u,f){u&&u.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",u.filter,null,u);const g={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const C of u.layers){const B=this._layers[C];if(!B)return this.fire(new l.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];g[B.source]=!0}}const y=[];u.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const C in this.sourceCaches)u.layers&&!g[C]||y.push(Ne(this.sourceCaches[C],this._layers,A,s,u,f));return this.placement&&y.push(function(C,B,F,j,O,W,$){const q={},Q=W.queryRenderedSymbols(j),lt=[];for(const ht of Object.keys(Q).map(Number))lt.push($[ht]);lt.sort(si);for(const ht of lt){const ft=ht.featureIndex.lookupSymbolFeatures(Q[ht.bucketInstanceId],B,ht.bucketIndex,ht.sourceLayerIndex,O.filter,O.layers,O.availableImages,C);for(const ut in ft){const vt=q[ut]=q[ut]||[],Bt=ft[ut];Bt.sort((It,Qt)=>{const pe=ht.featureSortOrder;if(pe){const _e=pe.indexOf(It.featureIndex);return pe.indexOf(Qt.featureIndex)-_e}return Qt.featureIndex-It.featureIndex});for(const It of Bt)vt.push(It)}}for(const ht in q)q[ht].forEach(ft=>{const ut=ft.feature,vt=F[C[ht].source].getFeatureState(ut.layer["source-layer"],ut.id);ut.source=ut.layer.source,ut.layer["source-layer"]&&(ut.sourceLayer=ut.layer["source-layer"]),ut.state=vt});return q}(this._layers,A,this.sourceCaches,s,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(s,u){u&&u.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",u.filter,null,u);const f=this.sourceCaches[s];return f?function(g,y){const A=g.getRenderableIds().map(F=>g.getTileByID(F)),C=[],B={};for(let F=0;F<A.length;F++){const j=A[F],O=j.tileID.canonical.key;B[O]||(B[O]=!0,j.querySourceFeatures(C,y))}return C}(f,u):[]}getLight(){return this.light.getLight()}setLight(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const f=this.light.getLight();let g=!1;for(const A in s)if(!l.aE(s[A],f[A])){g=!0;break}if(!g)return;const y={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,u),this.light.updateTransitions(y)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const f=this.getSky();let g=!1;if(!s&&!f)return;if(s&&!f)g=!0;else if(!s&&f)g=!0;else for(const A in s)if(!l.aE(s[A],f[A])){g=!0;break}if(!g)return;const y={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,u),this.sky.updateTransitions(y)}_validate(s,u,f,g){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!y||y.validate!==!1)&&Tr(this,s.call(l.u,l.e({key:u,style:this.serialize(),value:f,styleSpec:l.v},g)))}_remove(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ke().off(me,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const f=this.sourceCaches[u];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const u in this.sourceCaches)this.sourceCaches[u].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,u,f,g){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,A=!1,C=!1;const B={};for(const F of this._order){const j=this._layers[F];if(j.type!=="symbol")continue;if(!B[j.source]){const W=this.sourceCaches[j.source];B[j.source]=W.getRenderableIds(!0).map($=>W.getTileByID($)).sort(($,q)=>q.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(q.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(j,B[j.source],s.center.lng);A=A||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),s.zoom))&&(this.pauseablePlacement=new Yi(s,this.map.terrain,this._order,y,u,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),C=!0),A&&this.pauseablePlacement.placement.setStale()),C||A)for(const F of this._order){const j=this._layers[F];j.type==="symbol"&&this.placement.updateLayerOpacities(j,B[j.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,u){return l._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[u.source];return g&&g.setDependencies(u.tileID.key,u.type,u.icons),f})}getGlyphs(s,u){return l._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(u.stacks),g=this.sourceCaches[u.source];return g&&g.setDependencies(u.tileID.key,u.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),s&&this._validate(l.u.glyphs,"glyphs",s,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},g=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const y=[{id:s,url:u}],A=[...Ut(this.stylesheet.sprite),...y];this._validate(l.u.sprite,"sprite",A,null,f)||(this.stylesheet.sprite=A,this._loadSprite(y,!0,g))}removeSprite(s){this._checkLoaded();const u=Ut(this.stylesheet.sprite);if(u.find(f=>f.id===s)){if(this._spritesImagesIds[s])for(const f of this._spritesImagesIds[s])this.imageManager.removeImage(f),this._changedImages[f]=!0;u.splice(u.findIndex(f=>f.id===s),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Ut(this.stylesheet.sprite)}setSprite(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),s&&this._validate(l.u.sprite,"sprite",s,null,u)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,f):(this._unloadSprite(),f&&f(null)))}}var as=l.Y([{name:"a_pos",type:"Int16",components:2}]);const Yn={prelude:Wi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Wi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Wi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Wi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Wi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Wi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Wi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Wi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Wi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Wi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Wi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Wi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Wi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Wi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Wi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Wi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Wi(m,s){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=s.match(/attribute ([\w]+) ([\w]+)/g),g=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=y?y.concat(g):g,C={};return{fragmentSource:m=m.replace(u,(B,F,j,O,W)=>(C[W]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${j} ${O} ${W};
#else
uniform ${j} ${O} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${j} ${O} ${W} = u_${W};
#endif
`)),vertexSource:s=s.replace(u,(B,F,j,O,W)=>{const $=O==="float"?"vec2":"vec4",q=W.match(/color/)?"color":$;return C[W]?F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${j} ${$} a_${W};
varying ${j} ${O} ${W};
#else
uniform ${j} ${O} u_${W};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${j} ${O} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${q}(a_${W}, u_${W}_t);
#else
    ${j} ${O} ${W} = u_${W};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${j} ${$} a_${W};
#else
uniform ${j} ${O} u_${W};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${j} ${O} ${W} = a_${W};
#else
    ${j} ${O} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${j} ${O} ${W} = unpack_mix_${q}(a_${W}, u_${W}_t);
#else
    ${j} ${O} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:A}}class Aa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,u,f,g,y,A,C,B,F){this.context=s;let j=this.boundPaintVertexBuffers.length!==g.length;for(let O=0;!j&&O<g.length;O++)this.boundPaintVertexBuffers[O]!==g[O]&&(j=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==f||j||this.boundIndexBuffer!==y||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==F?this.freshBind(u,f,g,y,A,C,B,F):(s.bindVertexArray.set(this.vao),C&&C.bind(),y&&y.dynamicDraw&&y.bind(),B&&B.bind(),F&&F.bind())}freshBind(s,u,f,g,y,A,C,B){const F=s.numAttributes,j=this.context,O=j.gl;this.vao&&this.destroy(),this.vao=j.createVertexArray(),j.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=B,u.enableAttributes(O,s);for(const W of f)W.enableAttributes(O,s);A&&A.enableAttributes(O,s),C&&C.enableAttributes(O,s),B&&B.enableAttributes(O,s),u.bind(),u.setVertexAttribPointers(O,s,y);for(const W of f)W.bind(),W.setVertexAttribPointers(O,s,y);A&&(A.bind(),A.setVertexAttribPointers(O,s,y)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(O,s,y)),B&&(B.bind(),B.setVertexAttribPointers(O,s,y)),j.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ja=(m,s,u,f,g)=>({u_matrix:m,u_texture:0,u_ele_delta:s,u_fog_matrix:u,u_fog_color:f?f.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?f.calculateFogBlendOpacity(g):0,u_horizon_color:f?f.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1});function rt(m){const s=[];for(let u=0;u<m.length;u++){if(m[u]===null)continue;const f=m[u].split(" ");s.push(f.pop())}return s}class mt{constructor(s,u,f,g,y,A){const C=s.gl;this.program=C.createProgram();const B=rt(u.staticAttributes),F=f?f.getBinderAttributes():[],j=B.concat(F),O=Yn.prelude.staticUniforms?rt(Yn.prelude.staticUniforms):[],W=u.staticUniforms?rt(u.staticUniforms):[],$=f?f.getBinderUniforms():[],q=O.concat(W).concat($),Q=[];for(const It of q)Q.indexOf(It)<0&&Q.push(It);const lt=f?f.defines():[];y&&lt.push("#define OVERDRAW_INSPECTOR;"),A&&lt.push("#define TERRAIN3D;");const ht=lt.concat(Yn.prelude.fragmentSource,u.fragmentSource).join(`
`),ft=lt.concat(Yn.prelude.vertexSource,u.vertexSource).join(`
`),ut=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ut,ht),C.compileShader(ut),!C.getShaderParameter(ut,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ut)}`);C.attachShader(this.program,ut);const vt=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(vt,ft),C.compileShader(vt),!C.getShaderParameter(vt,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(vt)}`);C.attachShader(this.program,vt),this.attributes={};const Bt={};this.numAttributes=j.length;for(let It=0;It<this.numAttributes;It++)j[It]&&(C.bindAttribLocation(this.program,It,j[It]),this.attributes[j[It]]=It);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(vt),C.deleteShader(ut);for(let It=0;It<Q.length;It++){const Qt=Q[It];if(Qt&&!Bt[Qt]){const pe=C.getUniformLocation(this.program,Qt);pe&&(Bt[Qt]=pe)}}this.fixedUniforms=g(s,Bt),this.terrainUniforms=((It,Qt)=>({u_depth:new l.aH(It,Qt.u_depth),u_terrain:new l.aH(It,Qt.u_terrain),u_terrain_dim:new l.aI(It,Qt.u_terrain_dim),u_terrain_matrix:new l.aJ(It,Qt.u_terrain_matrix),u_terrain_unpack:new l.aK(It,Qt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(It,Qt.u_terrain_exaggeration)}))(s,Bt),this.binderUniforms=f?f.getUniforms(s,Bt):[]}draw(s,u,f,g,y,A,C,B,F,j,O,W,$,q,Q,lt,ht,ft){const ut=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(f),s.setStencilMode(g),s.setColorMode(y),s.setCullFace(A),B){s.activeTexture.set(ut.TEXTURE2),ut.bindTexture(ut.TEXTURE_2D,B.depthTexture),s.activeTexture.set(ut.TEXTURE3),ut.bindTexture(ut.TEXTURE_2D,B.texture);for(const Bt in this.terrainUniforms)this.terrainUniforms[Bt].set(B[Bt])}for(const Bt in this.fixedUniforms)this.fixedUniforms[Bt].set(C[Bt]);Q&&Q.setUniforms(s,this.binderUniforms,$,{zoom:q});let vt=0;switch(u){case ut.LINES:vt=2;break;case ut.TRIANGLES:vt=3;break;case ut.LINE_STRIP:vt=1}for(const Bt of W.get()){const It=Bt.vaos||(Bt.vaos={});(It[F]||(It[F]=new Aa)).bind(s,this,j,Q?Q.getPaintVertexBuffers():[],O,Bt.vertexOffset,lt,ht,ft),ut.drawElements(u,Bt.primitiveLength*vt,ut.UNSIGNED_SHORT,Bt.primitiveOffset*vt*2)}}}function Dt(m,s,u){const f=1/xi(u,1,s.transform.tileZoom),g=Math.pow(2,u.tileID.overscaledZ),y=u.tileSize*Math.pow(2,s.transform.tileZoom)/g,A=y*(u.tileID.canonical.x+u.tileID.wrap*g),C=y*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[A>>16,C>>16],u_pixel_coord_lower:[65535&A,65535&C]}}const ne=(m,s,u,f)=>{const g=s.style.light,y=g.properties.get("position"),A=[y.x,y.y,y.z],C=function(){var F=new l.A(9);return l.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();g.properties.get("anchor")==="viewport"&&function(F,j){var O=Math.sin(j),W=Math.cos(j);F[0]=W,F[1]=O,F[2]=0,F[3]=-O,F[4]=W,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(C,-s.transform.angle),function(F,j,O){var W=j[0],$=j[1],q=j[2];F[0]=W*O[0]+$*O[3]+q*O[6],F[1]=W*O[1]+$*O[4]+q*O[7],F[2]=W*O[2]+$*O[5]+q*O[8]}(A,A,C);const B=g.properties.get("color");return{u_matrix:m,u_lightpos:A,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+u,u_opacity:f}},Se=(m,s,u,f,g,y,A)=>l.e(ne(m,s,u,f),Dt(y,s,A),{u_height_factor:-Math.pow(2,g.overscaledZ)/A.tileSize/8}),oi=m=>({u_matrix:m}),Pi=(m,s,u,f)=>l.e(oi(m),Dt(u,s,f)),cr=(m,s)=>({u_matrix:m,u_world:s}),fn=(m,s,u,f,g)=>l.e(Pi(m,s,u,f),{u_world:g}),vn=(m,s,u,f)=>{const g=m.transform;let y,A;if(f.paint.get("circle-pitch-alignment")==="map"){const C=xi(u,1,g.zoom);y=!0,A=[C,C]}else y=!1,A=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(s.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:A}},er=(m,s,u)=>({u_matrix:m,u_inv_matrix:s,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}),Ka=function(m,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:u}},Pn=m=>({u_matrix:m}),ui=(m,s,u,f)=>({u_matrix:m,u_extrude_scale:xi(s,1,u),u_intensity:f}),Ll=(m,s,u,f)=>{const g=l.H();l.aP(g,0,m.width,m.height,0,0,1);const y=m.context.gl;return{u_matrix:g,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:u,u_color_ramp:f,u_opacity:s.paint.get("heatmap-opacity")}};function Ml(m,s){const u=Math.pow(2,s.canonical.z),f=s.canonical.y;return[new l.Z(0,f/u).toLngLat().lat,new l.Z(0,(f+1)/u).toLngLat().lat]}const xs=(m,s,u,f)=>{const g=m.transform;return{u_matrix:hh(m,s,u,f),u_ratio:1/xi(s,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ac=(m,s,u,f,g)=>l.e(xs(m,s,u,g),{u_image:0,u_image_height:f}),Yo=(m,s,u,f,g)=>{const y=m.transform,A=Rl(s,y);return{u_matrix:hh(m,s,u,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/xi(s,1,y.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[A,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Bl=(m,s,u,f,g,y)=>{const A=m.lineAtlas,C=Rl(s,m.transform),B=u.layout.get("line-cap")==="round",F=A.getDash(f.from,B),j=A.getDash(f.to,B),O=F.width*g.fromScale,W=j.width*g.toScale;return l.e(xs(m,s,u,y),{u_patternscale_a:[C/O,-F.height/2],u_patternscale_b:[C/W,-j.height/2],u_sdfgamma:A.width/(256*Math.min(O,W)*m.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:j.y,u_mix:g.t})};function Rl(m,s){return 1/xi(m,1,s.tileZoom)}function hh(m,s,u,f){return m.translatePosMatrix(f?f.posMatrix:s.tileID.posMatrix,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const $h=(m,s,u,f,g)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(A=g.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(y=g.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Yh(g.paint.get("raster-hue-rotate"))};var y,A};function Yh(m){m*=Math.PI/180;const s=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const kl=(m,s,u,f,g,y,A,C,B,F,j,O,W,$)=>{const q=A.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:q.width/q.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:B,u_coord_matrix:F,u_is_text:+O,u_pitch_with_map:+f,u_is_along_line:g,u_is_variable_anchor:y,u_texsize:W,u_texture:0,u_translation:j,u_pitched_scale:$}},co=(m,s,u,f,g,y,A,C,B,F,j,O,W,$,q)=>{const Q=A.transform;return l.e(kl(m,s,u,f,g,y,A,C,B,F,j,O,W,q),{u_gamma_scale:f?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:A.pixelRatio,u_is_halo:+$})},To=(m,s,u,f,g,y,A,C,B,F,j,O,W,$)=>l.e(co(m,s,u,f,g,y,A,C,B,F,j,!0,O,!0,$),{u_texsize_icon:W,u_texture_icon:1}),Fl=(m,s,u)=>({u_matrix:m,u_opacity:s,u_color:u}),Jo=(m,s,u,f,g,y)=>l.e(function(A,C,B,F){const j=B.imageManager.getPattern(A.from.toString()),O=B.imageManager.getPattern(A.to.toString()),{width:W,height:$}=B.imageManager.getPixelSize(),q=Math.pow(2,F.tileID.overscaledZ),Q=F.tileSize*Math.pow(2,B.transform.tileZoom)/q,lt=Q*(F.tileID.canonical.x+F.tileID.wrap*q),ht=Q*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[W,$],u_mix:C.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/xi(F,1,B.transform.tileZoom),u_pixel_coord_upper:[lt>>16,ht>>16],u_pixel_coord_lower:[65535&lt,65535&ht]}}(f,y,u,g),{u_matrix:m,u_opacity:s}),Qa={fillExtrusion:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_lightpos:new l.aN(m,s.u_lightpos),u_lightintensity:new l.aI(m,s.u_lightintensity),u_lightcolor:new l.aN(m,s.u_lightcolor),u_vertical_gradient:new l.aI(m,s.u_vertical_gradient),u_opacity:new l.aI(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_lightpos:new l.aN(m,s.u_lightpos),u_lightintensity:new l.aI(m,s.u_lightintensity),u_lightcolor:new l.aN(m,s.u_lightcolor),u_vertical_gradient:new l.aI(m,s.u_vertical_gradient),u_height_factor:new l.aI(m,s.u_height_factor),u_image:new l.aH(m,s.u_image),u_texsize:new l.aO(m,s.u_texsize),u_pixel_coord_upper:new l.aO(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(m,s.u_pixel_coord_lower),u_scale:new l.aN(m,s.u_scale),u_fade:new l.aI(m,s.u_fade),u_opacity:new l.aI(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_image:new l.aH(m,s.u_image),u_texsize:new l.aO(m,s.u_texsize),u_pixel_coord_upper:new l.aO(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(m,s.u_pixel_coord_lower),u_scale:new l.aN(m,s.u_scale),u_fade:new l.aI(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_world:new l.aO(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_world:new l.aO(m,s.u_world),u_image:new l.aH(m,s.u_image),u_texsize:new l.aO(m,s.u_texsize),u_pixel_coord_upper:new l.aO(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(m,s.u_pixel_coord_lower),u_scale:new l.aN(m,s.u_scale),u_fade:new l.aI(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new l.aI(m,s.u_camera_to_center_distance),u_scale_with_map:new l.aH(m,s.u_scale_with_map),u_pitch_with_map:new l.aH(m,s.u_pitch_with_map),u_extrude_scale:new l.aO(m,s.u_extrude_scale),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_matrix:new l.aJ(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_pixel_extrude_scale:new l.aO(m,s.u_pixel_extrude_scale)}),collisionCircle:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_inv_matrix:new l.aJ(m,s.u_inv_matrix),u_camera_to_center_distance:new l.aI(m,s.u_camera_to_center_distance),u_viewport_size:new l.aO(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new l.aL(m,s.u_color),u_matrix:new l.aJ(m,s.u_matrix),u_overlay:new l.aH(m,s.u_overlay),u_overlay_scale:new l.aI(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new l.aI(m,s.u_extrude_scale),u_intensity:new l.aI(m,s.u_intensity),u_matrix:new l.aJ(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_world:new l.aO(m,s.u_world),u_image:new l.aH(m,s.u_image),u_color_ramp:new l.aH(m,s.u_color_ramp),u_opacity:new l.aI(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_image:new l.aH(m,s.u_image),u_latrange:new l.aO(m,s.u_latrange),u_light:new l.aO(m,s.u_light),u_shadow:new l.aL(m,s.u_shadow),u_highlight:new l.aL(m,s.u_highlight),u_accent:new l.aL(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_image:new l.aH(m,s.u_image),u_dimension:new l.aO(m,s.u_dimension),u_zoom:new l.aI(m,s.u_zoom),u_unpack:new l.aK(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_ratio:new l.aI(m,s.u_ratio),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_ratio:new l.aI(m,s.u_ratio),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(m,s.u_units_to_pixels),u_image:new l.aH(m,s.u_image),u_image_height:new l.aI(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_texsize:new l.aO(m,s.u_texsize),u_ratio:new l.aI(m,s.u_ratio),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_image:new l.aH(m,s.u_image),u_units_to_pixels:new l.aO(m,s.u_units_to_pixels),u_scale:new l.aN(m,s.u_scale),u_fade:new l.aI(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_ratio:new l.aI(m,s.u_ratio),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(m,s.u_units_to_pixels),u_patternscale_a:new l.aO(m,s.u_patternscale_a),u_patternscale_b:new l.aO(m,s.u_patternscale_b),u_sdfgamma:new l.aI(m,s.u_sdfgamma),u_image:new l.aH(m,s.u_image),u_tex_y_a:new l.aI(m,s.u_tex_y_a),u_tex_y_b:new l.aI(m,s.u_tex_y_b),u_mix:new l.aI(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_tl_parent:new l.aO(m,s.u_tl_parent),u_scale_parent:new l.aI(m,s.u_scale_parent),u_buffer_scale:new l.aI(m,s.u_buffer_scale),u_fade_t:new l.aI(m,s.u_fade_t),u_opacity:new l.aI(m,s.u_opacity),u_image0:new l.aH(m,s.u_image0),u_image1:new l.aH(m,s.u_image1),u_brightness_low:new l.aI(m,s.u_brightness_low),u_brightness_high:new l.aI(m,s.u_brightness_high),u_saturation_factor:new l.aI(m,s.u_saturation_factor),u_contrast_factor:new l.aI(m,s.u_contrast_factor),u_spin_weights:new l.aN(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new l.aH(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(m,s.u_is_size_feature_constant),u_size_t:new l.aI(m,s.u_size_t),u_size:new l.aI(m,s.u_size),u_camera_to_center_distance:new l.aI(m,s.u_camera_to_center_distance),u_pitch:new l.aI(m,s.u_pitch),u_rotate_symbol:new l.aH(m,s.u_rotate_symbol),u_aspect_ratio:new l.aI(m,s.u_aspect_ratio),u_fade_change:new l.aI(m,s.u_fade_change),u_matrix:new l.aJ(m,s.u_matrix),u_label_plane_matrix:new l.aJ(m,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(m,s.u_coord_matrix),u_is_text:new l.aH(m,s.u_is_text),u_pitch_with_map:new l.aH(m,s.u_pitch_with_map),u_is_along_line:new l.aH(m,s.u_is_along_line),u_is_variable_anchor:new l.aH(m,s.u_is_variable_anchor),u_texsize:new l.aO(m,s.u_texsize),u_texture:new l.aH(m,s.u_texture),u_translation:new l.aO(m,s.u_translation),u_pitched_scale:new l.aI(m,s.u_pitched_scale)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new l.aH(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(m,s.u_is_size_feature_constant),u_size_t:new l.aI(m,s.u_size_t),u_size:new l.aI(m,s.u_size),u_camera_to_center_distance:new l.aI(m,s.u_camera_to_center_distance),u_pitch:new l.aI(m,s.u_pitch),u_rotate_symbol:new l.aH(m,s.u_rotate_symbol),u_aspect_ratio:new l.aI(m,s.u_aspect_ratio),u_fade_change:new l.aI(m,s.u_fade_change),u_matrix:new l.aJ(m,s.u_matrix),u_label_plane_matrix:new l.aJ(m,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(m,s.u_coord_matrix),u_is_text:new l.aH(m,s.u_is_text),u_pitch_with_map:new l.aH(m,s.u_pitch_with_map),u_is_along_line:new l.aH(m,s.u_is_along_line),u_is_variable_anchor:new l.aH(m,s.u_is_variable_anchor),u_texsize:new l.aO(m,s.u_texsize),u_texture:new l.aH(m,s.u_texture),u_gamma_scale:new l.aI(m,s.u_gamma_scale),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_is_halo:new l.aH(m,s.u_is_halo),u_translation:new l.aO(m,s.u_translation),u_pitched_scale:new l.aI(m,s.u_pitched_scale)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new l.aH(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(m,s.u_is_size_feature_constant),u_size_t:new l.aI(m,s.u_size_t),u_size:new l.aI(m,s.u_size),u_camera_to_center_distance:new l.aI(m,s.u_camera_to_center_distance),u_pitch:new l.aI(m,s.u_pitch),u_rotate_symbol:new l.aH(m,s.u_rotate_symbol),u_aspect_ratio:new l.aI(m,s.u_aspect_ratio),u_fade_change:new l.aI(m,s.u_fade_change),u_matrix:new l.aJ(m,s.u_matrix),u_label_plane_matrix:new l.aJ(m,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(m,s.u_coord_matrix),u_is_text:new l.aH(m,s.u_is_text),u_pitch_with_map:new l.aH(m,s.u_pitch_with_map),u_is_along_line:new l.aH(m,s.u_is_along_line),u_is_variable_anchor:new l.aH(m,s.u_is_variable_anchor),u_texsize:new l.aO(m,s.u_texsize),u_texsize_icon:new l.aO(m,s.u_texsize_icon),u_texture:new l.aH(m,s.u_texture),u_texture_icon:new l.aH(m,s.u_texture_icon),u_gamma_scale:new l.aI(m,s.u_gamma_scale),u_device_pixel_ratio:new l.aI(m,s.u_device_pixel_ratio),u_is_halo:new l.aH(m,s.u_is_halo),u_translation:new l.aO(m,s.u_translation),u_pitched_scale:new l.aI(m,s.u_pitched_scale)}),background:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_opacity:new l.aI(m,s.u_opacity),u_color:new l.aL(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_opacity:new l.aI(m,s.u_opacity),u_image:new l.aH(m,s.u_image),u_pattern_tl_a:new l.aO(m,s.u_pattern_tl_a),u_pattern_br_a:new l.aO(m,s.u_pattern_br_a),u_pattern_tl_b:new l.aO(m,s.u_pattern_tl_b),u_pattern_br_b:new l.aO(m,s.u_pattern_br_b),u_texsize:new l.aO(m,s.u_texsize),u_mix:new l.aI(m,s.u_mix),u_pattern_size_a:new l.aO(m,s.u_pattern_size_a),u_pattern_size_b:new l.aO(m,s.u_pattern_size_b),u_scale_a:new l.aI(m,s.u_scale_a),u_scale_b:new l.aI(m,s.u_scale_b),u_pixel_coord_upper:new l.aO(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_texture:new l.aH(m,s.u_texture),u_ele_delta:new l.aI(m,s.u_ele_delta),u_fog_matrix:new l.aJ(m,s.u_fog_matrix),u_fog_color:new l.aL(m,s.u_fog_color),u_fog_ground_blend:new l.aI(m,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(m,s.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(m,s.u_horizon_color),u_horizon_fog_blend:new l.aI(m,s.u_horizon_fog_blend)}),terrainDepth:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_ele_delta:new l.aI(m,s.u_ele_delta)}),terrainCoords:(m,s)=>({u_matrix:new l.aJ(m,s.u_matrix),u_texture:new l.aH(m,s.u_texture),u_terrain_coords_id:new l.aI(m,s.u_terrain_coords_id),u_ele_delta:new l.aI(m,s.u_ele_delta)}),sky:(m,s)=>({u_sky_color:new l.aL(m,s.u_sky_color),u_horizon_color:new l.aL(m,s.u_horizon_color),u_horizon:new l.aI(m,s.u_horizon),u_sky_horizon_blend:new l.aI(m,s.u_sky_horizon_blend)})};class Jn{constructor(s,u,f){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const uh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dl{constructor(s,u,f,g){this.length=u.length,this.attributes=f,this.itemSize=u.bytesPerElement,this.dynamicDraw=g,this.context=s;const y=s.gl;this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let f=0;f<this.attributes.length;f++){const g=u.attributes[this.attributes[f].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,u,f){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],A=u.attributes[y.name];A!==void 0&&s.vertexAttribPointer(A,y.components,s[uh[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Co=new WeakMap;function ho(m){var s;if(Co.has(m))return Co.get(m);{const u=(s=m.getParameter(m.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Co.set(m,u),u}}class ji{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class uo extends ji{getDefault(){return l.aM.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Jh extends ji{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class ws extends ji{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class po extends ji{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ol extends ji{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class tl extends ji{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class dh extends ji{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Ea extends ji{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class ph extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nl extends ji{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class zl extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Ec extends ji{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class ks extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class jl extends ji{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Tc extends ji{getDefault(){return l.aM.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Cc extends ji{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class el extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class Ul extends ji{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Po extends ji{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Pc extends ji{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Ta extends ji{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Gl extends ji{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class k extends ji{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class et extends ji{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class At extends ji{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ot extends ji{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Xt extends ji{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ae extends ji{getDefault(){return null}set(s){var u;if(s===this.current&&!this.dirty)return;const f=this.gl;ho(f)?f.bindVertexArray(s):(u=f.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Ie extends ji{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class He extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class gi extends ji{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ii extends ji{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class Di extends Ii{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ui extends Ii{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Br extends Ii{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class en{constructor(s,u,f,g,y){this.context=s,this.width=u,this.height=f;const A=s.gl,C=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new Di(s,C),g)this.depthAttachment=y?new Br(s,C):new Ui(s,C);else if(y)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){const f=this.depthAttachment.get();f&&s.deleteRenderbuffer(f)}s.deleteFramebuffer(this.framebuffer)}}class Oi{constructor(s,u,f){this.blendFunction=s,this.blendColor=u,this.mask=f}}Oi.Replace=[1,0],Oi.disabled=new Oi(Oi.Replace,l.aM.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,l.aM.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Fn{constructor(s){var u,f;if(this.gl=s,this.clearColor=new uo(this),this.clearDepth=new Jh(this),this.clearStencil=new ws(this),this.colorMask=new po(this),this.depthMask=new Ol(this),this.stencilMask=new tl(this),this.stencilFunc=new dh(this),this.stencilOp=new Ea(this),this.stencilTest=new ph(this),this.depthRange=new Nl(this),this.depthTest=new zl(this),this.depthFunc=new Ec(this),this.blend=new ks(this),this.blendFunc=new jl(this),this.blendColor=new Tc(this),this.blendEquation=new Cc(this),this.cullFace=new el(this),this.cullFaceSide=new Ul(this),this.frontFace=new Po(this),this.program=new Pc(this),this.activeTexture=new Ta(this),this.viewport=new Gl(this),this.bindFramebuffer=new k(this),this.bindRenderbuffer=new et(this),this.bindTexture=new At(this),this.bindVertexBuffer=new Ot(this),this.bindElementBuffer=new Xt(this),this.bindVertexArray=new ae(this),this.pixelStoreUnpack=new Ie(this),this.pixelStoreUnpackPremultiplyAlpha=new He(this),this.pixelStoreUnpackFlipY=new gi(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),ho(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=s.RGBA16F)!==null&&u!==void 0?u:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(f=s.RGB16F)!==null&&f!==void 0?f:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new Jn(this,s,u)}createVertexBuffer(s,u,f){return new Dl(this,s,u,f)}createRenderbuffer(s,u,f){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,s,u,f),this.bindRenderbuffer.set(null),y}createFramebuffer(s,u,f,g){return new en(this,s,u,f,g)}clear(s){let{color:u,depth:f,stencil:g}=s;const y=this.gl;let A=0;u&&(A|=y.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(A|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g!==void 0&&(A|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),y.clear(A)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.aE(s.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return ho(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var u;return ho(this.gl)?this.gl.deleteVertexArray(s):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class di{constructor(s,u,f){this.func=s,this.mask=u,this.range=f}}di.ReadOnly=!1,di.ReadWrite=!0,di.disabled=new di(519,di.ReadOnly,[0,1]);const ls=7680;class Xi{constructor(s,u,f,g,y,A){this.test=s,this.ref=u,this.mask=f,this.fail=g,this.depthFail=y,this.pass=A}}Xi.disabled=new Xi({func:519,mask:0},0,0,ls,ls,ls);class Ji{constructor(s,u,f){this.enable=s,this.mode=u,this.frontFace=f}}let Io;function Ko(m,s,u,f,g){const y=m.context,A=y.gl,C=m.useProgram("collisionBox"),B=[];let F=0,j=0;for(let ht=0;ht<f.length;ht++){const ft=f[ht],ut=s.getTile(ft).getBucket(u);if(!ut)continue;const vt=g?ut.textCollisionBox:ut.iconCollisionBox,Bt=ut.collisionCircleArray;if(Bt.length>0){const It=l.H();l.aQ(It,ut.placementInvProjMatrix,m.transform.glCoordMatrix),l.aQ(It,It,ut.placementViewportMatrix),B.push({circleArray:Bt,circleOffset:j,transform:ft.posMatrix,invTransform:It,coord:ft}),F+=Bt.length/4,j=F}vt&&C.draw(y,A.LINES,di.disabled,Xi.disabled,m.colorModeForRenderPass(),Ji.disabled,{u_matrix:ft.posMatrix,u_pixel_extrude_scale:[1/(O=m.transform).width,1/O.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(ft),u.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,null,m.transform.zoom,null,null,vt.collisionVertexBuffer)}var O;if(!g||!B.length)return;const W=m.useProgram("collisionCircle"),$=new l.aR;$.resize(4*F),$._trim();let q=0;for(const ht of B)for(let ft=0;ft<ht.circleArray.length/4;ft++){const ut=4*ft,vt=ht.circleArray[ut+0],Bt=ht.circleArray[ut+1],It=ht.circleArray[ut+2],Qt=ht.circleArray[ut+3];$.emplace(q++,vt,Bt,It,Qt,0),$.emplace(q++,vt,Bt,It,Qt,1),$.emplace(q++,vt,Bt,It,Qt,2),$.emplace(q++,vt,Bt,It,Qt,3)}(!Io||Io.length<2*F)&&(Io=function(ht){const ft=2*ht,ut=new l.aT;ut.resize(ft),ut._trim();for(let vt=0;vt<ft;vt++){const Bt=6*vt;ut.uint16[Bt+0]=4*vt+0,ut.uint16[Bt+1]=4*vt+1,ut.uint16[Bt+2]=4*vt+2,ut.uint16[Bt+3]=4*vt+2,ut.uint16[Bt+4]=4*vt+3,ut.uint16[Bt+5]=4*vt+0}return ut}(F));const Q=y.createIndexBuffer(Io,!0),lt=y.createVertexBuffer($,l.aS.members,!0);for(const ht of B){const ft=er(ht.transform,ht.invTransform,m.transform);W.draw(y,A.TRIANGLES,di.disabled,Xi.disabled,m.colorModeForRenderPass(),Ji.disabled,ft,m.style.map.terrain&&m.style.map.terrain.getTerrainData(ht.coord),u.id,lt,Q,l.a0.simpleSegment(0,2*ht.circleOffset,ht.circleArray.length,ht.circleArray.length/2),null,m.transform.zoom,null,null,null)}lt.destroy(),Q.destroy()}Ji.disabled=new Ji(!1,1029,2305),Ji.backCCW=new Ji(!0,1029,2305);const Qo=l.an(new Float32Array(16));function Ca(m,s,u,f,g,y){const{horizontalAlign:A,verticalAlign:C}=l.au(m);return new l.P((-(A-.5)*s/g+f[0])*y,(-(C-.5)*u/g+f[1])*y)}function fo(m,s,u,f,g,y){const A=s.tileAnchorPoint.add(new l.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let C=f.mult(y);u||(C=C.rotate(-g));const B=A.add(C);return xt(B.x,B.y,s.labelPlaneMatrix,s.getElevation).point}if(u){const C=te(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(m),B=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return m.add(f.rotate(B))}return m.add(f)}function Lo(m,s,u,f,g,y,A,C,B,F,j,O,W,$){const q=m.text.placedSymbolArray,Q=m.text.dynamicLayoutVertexArray,lt=m.icon.dynamicLayoutVertexArray,ht={};Q.clear();for(let ft=0;ft<q.length;ft++){const ut=q.get(ft),vt=ut.hidden||!ut.crossTileID||m.allowVerticalPlacement&&!ut.placedOrientation?null:f[ut.crossTileID];if(vt){const Bt=new l.P(ut.anchorX,ut.anchorY),It={getElevation:$,width:g.width,height:g.height,labelPlaneMatrix:y,lineVertexArray:null,pitchWithMap:u,projection:j,projectionCache:null,tileAnchorPoint:Bt,translation:O,unwrappedTileID:W},Qt=u?xt(Bt.x,Bt.y,A,$):te(Bt.x,Bt.y,It),pe=Y(g.cameraToCenterDistance,Qt.signedDistanceFromCamera);let _e=l.ai(m.textSizeData,B,ut)*pe/l.ap;u&&(_e*=m.tilePixelRatio/C);const{width:xe,height:ve,anchor:ye,textOffset:we,textBoxScale:$e}=vt,Ce=Ca(ye,xe,ve,we,$e,_e),Pe=j.getPitchedTextCorrection(g,Bt.add(new l.P(O[0],O[1])),W),ii=fo(Qt.point,It,s,Ce,g.angle,Pe),wi=m.allowVerticalPlacement&&ut.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let _i=0;_i<ut.numGlyphs;_i++)l.aj(Q,ii,wi);F&&ut.associatedIconIndex>=0&&(ht[ut.associatedIconIndex]={shiftedAnchor:ii,angle:wi})}else Je(ut.numGlyphs,Q)}if(F){lt.clear();const ft=m.icon.placedSymbolArray;for(let ut=0;ut<ft.length;ut++){const vt=ft.get(ut);if(vt.hidden)Je(vt.numGlyphs,lt);else{const Bt=ht[ut];if(Bt)for(let It=0;It<vt.numGlyphs;It++)l.aj(lt,Bt.shiftedAnchor,Bt.angle);else Je(vt.numGlyphs,lt)}}m.icon.dynamicLayoutVertexBuffer.updateData(lt)}m.text.dynamicLayoutVertexBuffer.updateData(Q)}function In(m,s,u){return u.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Dn(m,s,u,f,g,y,A,C,B,F,j,O){const W=m.context,$=W.gl,q=m.transform,Q=Zn(),lt=C==="map",ht=B==="map",ft=C!=="viewport"&&u.layout.get("symbol-placement")!=="point",ut=lt&&!ht&&!ft,vt=!ht&&ft,Bt=!u.layout.get("symbol-sort-key").isConstant();let It=!1;const Qt=m.depthModeForSublayer(0,di.ReadOnly),pe=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],xe=Q.getCircleRadiusCorrection(q);for(const ve of f){const ye=s.getTile(ve),we=ye.getBucket(u);if(!we)continue;const $e=g?we.text:we.icon;if(!$e||!$e.segments.get().length||!$e.hasVisibleVertices)continue;const Ce=$e.programConfigurations.get(u.id),Pe=g||we.sdfIcons,ii=g?we.textSizeData:we.iconSizeData,wi=ht||q.pitch!==0,_i=m.useProgram(In(Pe,g,we),Ce),Ai=l.ag(ii,q.zoom),ki=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ve);let nr,Rr,Ki,Hr,sr=[0,0],jr=null;if(g)Rr=ye.glyphAtlasTexture,Ki=$.LINEAR,nr=ye.glyphAtlasTexture.size,we.iconsInText&&(sr=ye.imageAtlasTexture.size,jr=ye.imageAtlasTexture,Hr=wi||m.options.rotating||m.options.zooming||ii.kind==="composite"||ii.kind==="camera"?$.LINEAR:$.NEAREST);else{const qi=u.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Rr=ye.imageAtlasTexture,Ki=Pe||m.options.rotating||m.options.zooming||qi||wi?$.LINEAR:$.NEAREST,nr=ye.imageAtlasTexture.size}const sn=xi(ye,1,m.transform.zoom),es=vt?ve.posMatrix:Qo,Cs=Qr(es,ht,lt,m.transform,sn),kr=tn(es,ht,lt,m.transform,sn),Da=tn(ve.posMatrix,ht,lt,m.transform,sn),Ps=Q.translatePosition(m.transform,ye,y,A),zc=pe&&we.hasTextData(),Kl=u.layout.get("icon-text-fit")!=="none"&&zc&&we.hasIconData();if(ft){const qi=m.style.map.terrain?(Oa,sa)=>m.style.map.terrain.getElevation(ve,Oa,sa):null,Oo=u.layout.get("text-rotation-alignment")==="map";ct(we,ve.posMatrix,m,g,Cs,Da,ht,F,Oo,Q,ve.toUnwrapped(),q.width,q.height,Ps,qi)}const zn=ve.posMatrix,is=g&&pe||Kl,wn=ft||is?Qo:Cs,jn=kr,Yr=Pe&&u.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ln;Ln=Pe?we.iconsInText?To(ii.kind,Ai,ut,ht,ft,is,m,zn,wn,jn,Ps,nr,sr,xe):co(ii.kind,Ai,ut,ht,ft,is,m,zn,wn,jn,Ps,g,nr,!0,xe):kl(ii.kind,Ai,ut,ht,ft,is,m,zn,wn,jn,Ps,g,nr,xe);const Un={program:_i,buffers:$e,uniformValues:Ln,atlasTexture:Rr,atlasTextureIcon:jr,atlasInterpolation:Ki,atlasInterpolationIcon:Hr,isSDF:Pe,hasHalo:Yr};if(Bt&&we.canOverlap){It=!0;const qi=$e.segments.get();for(const Oo of qi)_e.push({segments:new l.a0([Oo]),sortKey:Oo.sortKey,state:Un,terrainData:ki})}else _e.push({segments:$e.segments,sortKey:0,state:Un,terrainData:ki})}It&&_e.sort((ve,ye)=>ve.sortKey-ye.sortKey);for(const ve of _e){const ye=ve.state;if(W.activeTexture.set($.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,$.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(W.activeTexture.set($.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),ye.isSDF){const we=ye.uniformValues;ye.hasHalo&&(we.u_is_halo=1,Pa(ye.buffers,ve.segments,u,m,ye.program,Qt,j,O,we,ve.terrainData)),we.u_is_halo=0}Pa(ye.buffers,ve.segments,u,m,ye.program,Qt,j,O,ye.uniformValues,ve.terrainData)}}function Pa(m,s,u,f,g,y,A,C,B,F){const j=f.context;g.draw(j,j.gl.TRIANGLES,y,A,C,Ji.disabled,B,F,u.id,m.layoutVertexBuffer,m.indexBuffer,s,u.paint,f.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ia(m,s,u,f){const g=m.context,y=g.gl,A=Xi.disabled,C=new Oi([y.ONE,y.ONE],l.aM.transparent,[!0,!0,!0,!0]),B=s.getBucket(u);if(!B)return;const F=f.key;let j=u.heatmapFbos.get(F);j||(j=ta(g,s.tileSize,s.tileSize),u.heatmapFbos.set(F,j)),g.bindFramebuffer.set(j.framebuffer),g.viewport.set([0,0,s.tileSize,s.tileSize]),g.clear({color:l.aM.transparent});const O=B.programConfigurations.get(u.id),W=m.useProgram("heatmap",O),$=m.style.map.terrain.getTerrainData(f);W.draw(g,y.TRIANGLES,di.disabled,A,C,Ji.disabled,ui(f.posMatrix,s,m.transform.zoom,u.paint.get("heatmap-intensity")),$,u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,m.transform.zoom,O)}function Fs(m,s,u){const f=m.context,g=f.gl;f.setColorMode(m.colorModeForRenderPass());const y=bn(f,s),A=u.key,C=s.heatmapFbos.get(A);C&&(f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,C.colorAttachment.get()),f.activeTexture.set(g.TEXTURE1),y.bind(g.LINEAR,g.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(f,g.TRIANGLES,di.disabled,Xi.disabled,m.colorModeForRenderPass(),Ji.disabled,Ll(m,s,0,1),null,s.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,s.paint,m.transform.zoom),C.destroy(),s.heatmapFbos.delete(A))}function ta(m,s,u){var f,g;const y=m.gl,A=y.createTexture();y.bindTexture(y.TEXTURE_2D,A),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const C=(f=m.HALF_FLOAT)!==null&&f!==void 0?f:y.UNSIGNED_BYTE,B=(g=m.RGBA16F)!==null&&g!==void 0?g:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,B,s,u,0,y.RGBA,C,null);const F=m.createFramebuffer(s,u,!1,!1);return F.colorAttachment.set(A),F}function bn(m,s){return s.colorRampTexture||(s.colorRampTexture=new at(m,s.colorRamp,m.gl.RGBA)),s.colorRampTexture}function La(m,s,u,f,g){if(!u||!f||!f.imageAtlas)return;const y=f.imageAtlas.patternPositions;let A=y[u.to.toString()],C=y[u.from.toString()];if(!A&&C&&(A=C),!C&&A&&(C=A),!A||!C){const B=g.getPaintProperty(s);A=y[B],C=y[B]}A&&C&&m.setConstantPatternPositions(A,C)}function ea(m,s,u,f,g,y,A){const C=m.context.gl,B="fill-pattern",F=u.paint.get(B),j=F&&F.constantOr(1),O=u.getCrossfadeParameters();let W,$,q,Q,lt;A?($=j&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=C.LINES):($=j?"fillPattern":"fill",W=C.TRIANGLES);const ht=F.constantOr(null);for(const ft of f){const ut=s.getTile(ft);if(j&&!ut.patternsLoaded())continue;const vt=ut.getBucket(u);if(!vt)continue;const Bt=vt.programConfigurations.get(u.id),It=m.useProgram($,Bt),Qt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ft);j&&(m.context.activeTexture.set(C.TEXTURE0),ut.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Bt.updatePaintBuffers(O)),La(Bt,B,ht,ut,u);const pe=Qt?ft:null,_e=m.translatePosMatrix(pe?pe.posMatrix:ft.posMatrix,ut,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(A){Q=vt.indexBuffer2,lt=vt.segments2;const xe=[C.drawingBufferWidth,C.drawingBufferHeight];q=$==="fillOutlinePattern"&&j?fn(_e,m,O,ut,xe):cr(_e,xe)}else Q=vt.indexBuffer,lt=vt.segments,q=j?Pi(_e,m,O,ut):oi(_e);It.draw(m.context,W,g,m.stencilModeForClipping(ft),y,Ji.disabled,q,Qt,u.id,vt.layoutVertexBuffer,Q,lt,u.paint,m.transform.zoom,Bt)}}function il(m,s,u,f,g,y,A){const C=m.context,B=C.gl,F="fill-extrusion-pattern",j=u.paint.get(F),O=j.constantOr(1),W=u.getCrossfadeParameters(),$=u.paint.get("fill-extrusion-opacity"),q=j.constantOr(null);for(const Q of f){const lt=s.getTile(Q),ht=lt.getBucket(u);if(!ht)continue;const ft=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),ut=ht.programConfigurations.get(u.id),vt=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ut);O&&(m.context.activeTexture.set(B.TEXTURE0),lt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ut.updatePaintBuffers(W)),La(ut,F,q,lt,u);const Bt=m.translatePosMatrix(Q.posMatrix,lt,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),It=u.paint.get("fill-extrusion-vertical-gradient"),Qt=O?Se(Bt,m,It,$,Q,W,lt):ne(Bt,m,It,$);vt.draw(C,C.gl.TRIANGLES,g,y,A,Ji.backCCW,Qt,ft,u.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,u.paint,m.transform.zoom,ut,m.style.map.terrain&&ht.centroidVertexBuffer)}}function On(m,s,u,f,g,y,A){const C=m.context,B=C.gl,F=u.fbo;if(!F)return;const j=m.useProgram("hillshade"),O=m.style.map.terrain&&m.style.map.terrain.getTerrainData(s);C.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,F.colorAttachment.get()),j.draw(C,B.TRIANGLES,g,y,A,Ji.disabled,((W,$,q,Q)=>{const lt=q.paint.get("hillshade-shadow-color"),ht=q.paint.get("hillshade-highlight-color"),ft=q.paint.get("hillshade-accent-color");let ut=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ut-=W.transform.angle);const vt=!W.options.moving;return{u_matrix:Q?Q.posMatrix:W.transform.calculatePosMatrix($.tileID.toUnwrapped(),vt),u_image:0,u_latrange:Ml(0,$.tileID),u_light:[q.paint.get("hillshade-exaggeration"),ut],u_shadow:lt,u_highlight:ht,u_accent:ft}})(m,u,f,O?s:null),O,f.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Mo(m,s,u,f,g,y){const A=m.context,C=A.gl,B=s.dem;if(B&&B.data){const F=B.dim,j=B.stride,O=B.getPixels();if(A.activeTexture.set(C.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(j),s.demTexture){const $=s.demTexture;$.update(O,{premultiply:!1}),$.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else s.demTexture=new at(A,O,C.RGBA,{premultiply:!1}),s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);A.activeTexture.set(C.TEXTURE0);let W=s.fbo;if(!W){const $=new at(A,{width:F,height:F,data:null},C.RGBA);$.bind(C.LINEAR,C.CLAMP_TO_EDGE),W=s.fbo=A.createFramebuffer(F,F,!0,!1),W.colorAttachment.set($.texture)}A.bindFramebuffer.set(W.framebuffer),A.viewport.set([0,0,F,F]),m.useProgram("hillshadePrepare").draw(A,C.TRIANGLES,f,g,y,Ji.disabled,(($,q)=>{const Q=q.stride,lt=l.H();return l.aP(lt,0,l.X,-l.X,0,0,1),l.J(lt,lt,[0,-l.X,0]),{u_matrix:lt,u_image:1,u_dimension:[Q,Q],u_zoom:$.overscaledZ,u_unpack:q.getUnpackVector()}})(s.tileID,B),null,u.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function fh(m,s,u,f,g,y){const A=f.paint.get("raster-fade-duration");if(!y&&A>0){const C=T.now(),B=(C-m.timeAdded)/A,F=s?(C-s.timeAdded)/A:-1,j=u.getSource(),O=g.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),W=!s||Math.abs(s.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),$=W&&m.refreshedUponExpiration?1:l.ac(W?B:1-F,0,1);return m.refreshedUponExpiration&&B>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const Ic=new l.aM(1,0,0,1),Ni=new l.aM(0,1,0,1),Kn=new l.aM(0,0,1,1),mo=new l.aM(1,0,1,1),ia=new l.aM(0,1,1,1);function Qn(m,s,u,f){ra(m,0,s+u/2,m.transform.width,u,f)}function Bo(m,s,u,f){ra(m,s-u/2,0,u,m.transform.height,f)}function ra(m,s,u,f,g,y){const A=m.context,C=A.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*m.pixelRatio,u*m.pixelRatio,f*m.pixelRatio,g*m.pixelRatio),A.clear({color:y}),C.disable(C.SCISSOR_TEST)}function Ds(m,s,u){const f=m.context,g=f.gl,y=u.posMatrix,A=m.useProgram("debug"),C=di.disabled,B=Xi.disabled,F=m.colorModeForRenderPass(),j="$debug",O=m.style.map.terrain&&m.style.map.terrain.getTerrainData(u);f.activeTexture.set(g.TEXTURE0);const W=s.getTileByID(u.key).latestRawTileData,$=Math.floor((W&&W.byteLength||0)/1024),q=s.getTile(u).tileSize,Q=512/Math.min(q,512)*(u.overscaledZ/m.transform.zoom)*.5;let lt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(lt+=` => ${u.overscaledZ}`),function(ht,ft){ht.initDebugOverlayCanvas();const ut=ht.debugOverlayCanvas,vt=ht.context.gl,Bt=ht.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,ut.width,ut.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(ft,5,5),Bt.strokeText(ft,5,5),ht.debugOverlayTexture.update(ut),ht.debugOverlayTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE)}(m,`${lt} ${$}kB`),A.draw(f,g.TRIANGLES,C,B,Oi.alphaBlended,Ji.disabled,Ka(y,l.aM.transparent,Q),null,j,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),A.draw(f,g.LINE_STRIP,C,B,F,Ji.disabled,Ka(y,l.aM.red),O,j,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function rl(m,s,u){const f=m.context,g=f.gl,y=m.colorModeForRenderPass(),A=new di(g.LEQUAL,di.ReadWrite,m.depthRangeFor3D),C=m.useProgram("terrain"),B=s.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,m.width,m.height]);for(const F of u){const j=m.renderToTexture.getTexture(F),O=s.getTerrainData(F.tileID);f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,j.texture);const W=m.transform.calculatePosMatrix(F.tileID.toUnwrapped()),$=s.getMeshFrameDelta(m.transform.zoom),q=m.transform.calculateFogMatrix(F.tileID.toUnwrapped()),Q=Ja(W,$,q,m.style.sky,m.transform.pitch);C.draw(f,g.TRIANGLES,A,Xi.disabled,y,Ji.backCCW,Q,O,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class Ma{constructor(s,u,f){this.vertexBuffer=s,this.indexBuffer=u,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class go{constructor(s,u){this.context=new Fn(s),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $o}resize(s,u,f){if(this.width=Math.floor(s*f),this.height=Math.floor(u*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,u=new l.aX;u.emplaceBack(0,0),u.emplaceBack(l.X,0),u.emplaceBack(0,l.X),u.emplaceBack(l.X,l.X),this.tileExtentBuffer=s.createVertexBuffer(u,as.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const f=new l.aX;f.emplaceBack(0,0),f.emplaceBack(l.X,0),f.emplaceBack(0,l.X),f.emplaceBack(l.X,l.X),this.debugBuffer=s.createVertexBuffer(f,as.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const g=new l.$;g.emplaceBack(0,0,0,0),g.emplaceBack(l.X,0,l.X,0),g.emplaceBack(0,l.X,0,l.X),g.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=s.createVertexBuffer(g,De.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const y=new l.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,as.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const A=new l.aZ;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(A);const C=new l.aY;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const B=this.context.gl;this.stencilClearMode=new Xi({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=l.H();l.aP(f,0,this.width,this.height,0,0,1),l.K(f,f,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,u.TRIANGLES,di.disabled,this.stencilClearMode,Oi.disabled,Ji.disabled,Pn(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,u){if(this.currentStencilSource===s.source||!s.isTileClipped()||!u||!u.length)return;this.currentStencilSource=s.source;const f=this.context,g=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(Oi.disabled),f.setDepthMode(di.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const C=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);y.draw(f,g.TRIANGLES,di.disabled,new Xi({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),Oi.disabled,Ji.disabled,Pn(A.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new Xi({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){const u=this.context.gl;return new Xi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,f=s.sort((A,C)=>C.overscaledZ-A.overscaledZ),g=f[f.length-1].overscaledZ,y=f[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const A={};for(let C=0;C<y;C++)A[C+g]=new Xi({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=y,[A,f]}return[{[g]:Xi.disabled},f]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Oi([s.CONSTANT_COLOR,s.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oi.unblended:Oi.alphaBlended}depthModeForSublayer(s,u,f){if(!this.opaquePassEnabledForLayer())return di.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new di(f||this.context.gl.LEQUAL,u,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches,y={},A={},C={};for(const B in g){const F=g[B];F.used&&F.prepare(this.context),y[B]=F.getVisibleCoordinates(),A[B]=y[B].slice().reverse(),C[B]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<f.length;B++)if(this.style._layers[f[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of f){const F=this.style._layers[B];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const j=A[F.source];(F.type==="custom"||j.length)&&this.renderLayer(this,g[F.source],F,j)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(B,F){const j=B.context,O=j.gl,W=((ht,ft,ut)=>({u_sky_color:ht.properties.get("sky-color"),u_horizon_color:ht.properties.get("horizon-color"),u_horizon:(ft.height/2+ft.getHorizon())*ut,u_sky_horizon_blend:ht.properties.get("sky-horizon-blend")*ft.height/2*ut}))(F,B.style.map.transform,B.pixelRatio),$=new di(O.LEQUAL,di.ReadWrite,[0,1]),q=Xi.disabled,Q=B.colorModeForRenderPass(),lt=B.useProgram("sky");if(!F.mesh){const ht=new l.aX;ht.emplaceBack(-1,-1),ht.emplaceBack(1,-1),ht.emplaceBack(1,1),ht.emplaceBack(-1,1);const ft=new l.aY;ft.emplaceBack(0,1,2),ft.emplaceBack(0,2,3),F.mesh=new Ma(j.createVertexBuffer(ht,as.members),j.createIndexBuffer(ft),l.a0.simpleSegment(0,0,ht.length,ft.length))}lt.draw(j,O.TRIANGLES,$,q,Q,Ji.disabled,W,void 0,"sky",F.mesh.vertexBuffer,F.mesh.indexBuffer,F.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[f[this.currentLayer]],F=g[B.source],j=y[B.source];this._renderTileClippingMasks(B,j),this.renderLayer(this,F,B,j)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const B=this.style._layers[f[this.currentLayer]],F=g[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const j=(B.type==="symbol"?C:A)[B.source];this._renderTileClippingMasks(B,y[B.source]),this.renderLayer(this,F,B,j)}if(this.options.showTileBoundaries){const B=function(F,j){let O=null;const W=Object.values(F._layers).flatMap(lt=>lt.source&&!lt.isHidden(j)?[F.sourceCaches[lt.source]]:[]),$=W.filter(lt=>lt.getSource().type==="vector"),q=W.filter(lt=>lt.getSource().type!=="vector"),Q=lt=>{(!O||O.getSource().maxzoom<lt.getSource().maxzoom)&&(O=lt)};return $.forEach(lt=>Q(lt)),O||q.forEach(lt=>Q(lt)),O}(this.style,this.transform.zoom);B&&function(F,j,O){for(let W=0;W<O.length;W++)Ds(F,j,O[W])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const F=B.transform.padding;Qn(B,B.transform.height-(F.top||0),3,Ic),Qn(B,F.bottom||0,3,Ni),Bo(B,F.left||0,3,Kn),Bo(B,B.transform.width-(F.right||0),3,mo);const j=B.transform.centerPoint;(function(O,W,$,q){ra(O,W-1,$-10,2,20,q),ra(O,W-10,$-1,20,2,q)})(B,j.x,B.transform.height-j.y,ia)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=s?!l.a_(u,f):!l.a$(u,f)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.b0(u,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,A){const C=y.context,B=C.gl,F=Oi.unblended,j=new di(B.LEQUAL,di.ReadWrite,[0,1]),O=A.getTerrainMesh(),W=A.sourceCache.getRenderableTiles(),$=y.useProgram("terrainDepth");C.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:l.aM.transparent,depth:1});for(const q of W){const Q=A.getTerrainData(q.tileID),lt={u_matrix:y.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(y.transform.zoom)};$.draw(C,B.TRIANGLES,j,Xi.disabled,F,Ji.backCCW,lt,Q,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,A){const C=y.context,B=C.gl,F=Oi.unblended,j=new di(B.LEQUAL,di.ReadWrite,[0,1]),O=A.getTerrainMesh(),W=A.getCoordsTexture(),$=A.sourceCache.getRenderableTiles(),q=y.useProgram("terrainCoords");C.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:l.aM.transparent,depth:1}),A.coordsIndex=[];for(const Q of $){const lt=A.getTerrainData(Q.tileID);C.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,W.texture);const ht={u_matrix:y.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(y.transform.zoom)};q.draw(C,B.TRIANGLES,j,Xi.disabled,F,Ji.backCCW,ht,lt,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),A.coordsIndex.push(Q.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(s,u,f,g){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(g||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(y,A,C,B,F){if(y.renderPass!=="translucent")return;const j=Xi.disabled,O=y.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(W,$,q,Q,lt,ht,ft,ut,vt){const Bt=$.transform,It=Zn(),Qt=lt==="map",pe=ht==="map";for(const _e of W){const xe=Q.getTile(_e),ve=xe.getBucket(q);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const ye=l.ag(ve.textSizeData,Bt.zoom),we=xi(xe,1,$.transform.zoom),$e=Qr(_e.posMatrix,pe,Qt,$.transform,we),Ce=q.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(ye){const Pe=Math.pow(2,Bt.zoom-xe.tileID.overscaledZ),ii=$.style.map.terrain?(_i,Ai)=>$.style.map.terrain.getElevation(_e,_i,Ai):null,wi=It.translatePosition(Bt,xe,ft,ut);Lo(ve,Qt,pe,vt,Bt,$e,_e.posMatrix,Pe,ye,Ce,It,wi,_e.toUnwrapped(),ii)}}}(B,y,C,A,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),F),C.paint.get("icon-opacity").constantOr(1)!==0&&Dn(y,A,C,B,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),j,O),C.paint.get("text-opacity").constantOr(1)!==0&&Dn(y,A,C,B,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),j,O),A.map.showCollisionBoxes&&(Ko(y,A,C,B,!0),Ko(y,A,C,B,!1))})(s,u,f,g,this.style.placement.variableOffsets);break;case"circle":(function(y,A,C,B){if(y.renderPass!=="translucent")return;const F=C.paint.get("circle-opacity"),j=C.paint.get("circle-stroke-width"),O=C.paint.get("circle-stroke-opacity"),W=!C.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(j.constantOr(1)===0||O.constantOr(1)===0))return;const $=y.context,q=$.gl,Q=y.depthModeForSublayer(0,di.ReadOnly),lt=Xi.disabled,ht=y.colorModeForRenderPass(),ft=[];for(let ut=0;ut<B.length;ut++){const vt=B[ut],Bt=A.getTile(vt),It=Bt.getBucket(C);if(!It)continue;const Qt=It.programConfigurations.get(C.id),pe=y.useProgram("circle",Qt),_e=It.layoutVertexBuffer,xe=It.indexBuffer,ve=y.style.map.terrain&&y.style.map.terrain.getTerrainData(vt),ye={programConfiguration:Qt,program:pe,layoutVertexBuffer:_e,indexBuffer:xe,uniformValues:vn(y,vt,Bt,C),terrainData:ve};if(W){const we=It.segments.get();for(const $e of we)ft.push({segments:new l.a0([$e]),sortKey:$e.sortKey,state:ye})}else ft.push({segments:It.segments,sortKey:0,state:ye})}W&&ft.sort((ut,vt)=>ut.sortKey-vt.sortKey);for(const ut of ft){const{programConfiguration:vt,program:Bt,layoutVertexBuffer:It,indexBuffer:Qt,uniformValues:pe,terrainData:_e}=ut.state;Bt.draw($,q.TRIANGLES,Q,lt,ht,Ji.disabled,pe,_e,C.id,It,Qt,ut.segments,C.paint,y.transform.zoom,vt)}})(s,u,f,g);break;case"heatmap":(function(y,A,C,B){if(C.paint.get("heatmap-opacity")===0)return;const F=y.context;if(y.style.map.terrain){for(const j of B){const O=A.getTile(j);A.hasRenderableParent(j)||(y.renderPass==="offscreen"?Ia(y,O,C,j):y.renderPass==="translucent"&&Fs(y,C,j))}F.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(j,O,W,$){const q=j.context,Q=q.gl,lt=Xi.disabled,ht=new Oi([Q.ONE,Q.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(ft,ut,vt){const Bt=ft.gl;ft.activeTexture.set(Bt.TEXTURE1),ft.viewport.set([0,0,ut.width/4,ut.height/4]);let It=vt.heatmapFbos.get(l.aU);It?(Bt.bindTexture(Bt.TEXTURE_2D,It.colorAttachment.get()),ft.bindFramebuffer.set(It.framebuffer)):(It=ta(ft,ut.width/4,ut.height/4),vt.heatmapFbos.set(l.aU,It))})(q,j,W),q.clear({color:l.aM.transparent});for(let ft=0;ft<$.length;ft++){const ut=$[ft];if(O.hasRenderableParent(ut))continue;const vt=O.getTile(ut),Bt=vt.getBucket(W);if(!Bt)continue;const It=Bt.programConfigurations.get(W.id),Qt=j.useProgram("heatmap",It),{zoom:pe}=j.transform;Qt.draw(q,Q.TRIANGLES,di.disabled,lt,ht,Ji.disabled,ui(ut.posMatrix,vt,pe,W.paint.get("heatmap-intensity")),null,W.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,W.paint,j.transform.zoom,It)}q.viewport.set([0,0,j.width,j.height])}(y,A,C,B):y.renderPass==="translucent"&&function(j,O){const W=j.context,$=W.gl;W.setColorMode(j.colorModeForRenderPass());const q=O.heatmapFbos.get(l.aU);q&&(W.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,q.colorAttachment.get()),W.activeTexture.set($.TEXTURE1),bn(W,O).bind($.LINEAR,$.CLAMP_TO_EDGE),j.useProgram("heatmapTexture").draw(W,$.TRIANGLES,di.disabled,Xi.disabled,j.colorModeForRenderPass(),Ji.disabled,Ll(j,O,0,1),null,O.id,j.viewportBuffer,j.quadTriangleIndexBuffer,j.viewportSegments,O.paint,j.transform.zoom))}(y,C)})(s,u,f,g);break;case"line":(function(y,A,C,B){if(y.renderPass!=="translucent")return;const F=C.paint.get("line-opacity"),j=C.paint.get("line-width");if(F.constantOr(1)===0||j.constantOr(1)===0)return;const O=y.depthModeForSublayer(0,di.ReadOnly),W=y.colorModeForRenderPass(),$=C.paint.get("line-dasharray"),q=C.paint.get("line-pattern"),Q=q.constantOr(1),lt=C.paint.get("line-gradient"),ht=C.getCrossfadeParameters(),ft=Q?"linePattern":$?"lineSDF":lt?"lineGradient":"line",ut=y.context,vt=ut.gl;let Bt=!0;for(const It of B){const Qt=A.getTile(It);if(Q&&!Qt.patternsLoaded())continue;const pe=Qt.getBucket(C);if(!pe)continue;const _e=pe.programConfigurations.get(C.id),xe=y.context.program.get(),ve=y.useProgram(ft,_e),ye=Bt||ve.program!==xe,we=y.style.map.terrain&&y.style.map.terrain.getTerrainData(It),$e=q.constantOr(null);if($e&&Qt.imageAtlas){const ii=Qt.imageAtlas,wi=ii.patternPositions[$e.to.toString()],_i=ii.patternPositions[$e.from.toString()];wi&&_i&&_e.setConstantPatternPositions(wi,_i)}const Ce=we?It:null,Pe=Q?Yo(y,Qt,C,ht,Ce):$?Bl(y,Qt,C,$,ht,Ce):lt?Ac(y,Qt,C,pe.lineClipsArray.length,Ce):xs(y,Qt,C,Ce);if(Q)ut.activeTexture.set(vt.TEXTURE0),Qt.imageAtlasTexture.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),_e.updatePaintBuffers(ht);else if($&&(ye||y.lineAtlas.dirty))ut.activeTexture.set(vt.TEXTURE0),y.lineAtlas.bind(ut);else if(lt){const ii=pe.gradients[C.id];let wi=ii.texture;if(C.gradientVersion!==ii.version){let _i=256;if(C.stepInterpolant){const Ai=A.getSource().maxzoom,ki=It.canonical.z===Ai?Math.ceil(1<<y.transform.maxZoom-It.canonical.z):1;_i=l.ac(l.aV(pe.maxLineLength/l.X*1024*ki),256,ut.maxTextureSize)}ii.gradient=l.aW({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:_i,image:ii.gradient||void 0,clips:pe.lineClipsArray}),ii.texture?ii.texture.update(ii.gradient):ii.texture=new at(ut,ii.gradient,vt.RGBA),ii.version=C.gradientVersion,wi=ii.texture}ut.activeTexture.set(vt.TEXTURE0),wi.bind(C.stepInterpolant?vt.NEAREST:vt.LINEAR,vt.CLAMP_TO_EDGE)}ve.draw(ut,vt.TRIANGLES,O,y.stencilModeForClipping(It),W,Ji.disabled,Pe,we,C.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,C.paint,y.transform.zoom,_e,pe.layoutVertexBuffer2),Bt=!1}})(s,u,f,g);break;case"fill":(function(y,A,C,B){const F=C.paint.get("fill-color"),j=C.paint.get("fill-opacity");if(j.constantOr(1)===0)return;const O=y.colorModeForRenderPass(),W=C.paint.get("fill-pattern"),$=y.opaquePassEnabledForLayer()&&!W.constantOr(1)&&F.constantOr(l.aM.transparent).a===1&&j.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===$){const q=y.depthModeForSublayer(1,y.renderPass==="opaque"?di.ReadWrite:di.ReadOnly);ea(y,A,C,B,q,O,!1)}if(y.renderPass==="translucent"&&C.paint.get("fill-antialias")){const q=y.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,di.ReadOnly);ea(y,A,C,B,q,O,!0)}})(s,u,f,g);break;case"fill-extrusion":(function(y,A,C,B){const F=C.paint.get("fill-extrusion-opacity");if(F!==0&&y.renderPass==="translucent"){const j=new di(y.context.gl.LEQUAL,di.ReadWrite,y.depthRangeFor3D);if(F!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))il(y,A,C,B,j,Xi.disabled,Oi.disabled),il(y,A,C,B,j,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const O=y.colorModeForRenderPass();il(y,A,C,B,j,Xi.disabled,O)}}})(s,u,f,g);break;case"hillshade":(function(y,A,C,B){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const F=y.context,j=y.depthModeForSublayer(0,di.ReadOnly),O=y.colorModeForRenderPass(),[W,$]=y.renderPass==="translucent"?y.stencilConfigForOverlap(B):[{},B];for(const q of $){const Q=A.getTile(q);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&y.renderPass==="offscreen"?Mo(y,Q,C,j,Xi.disabled,O):y.renderPass==="translucent"&&On(y,q,Q,C,j,W[q.overscaledZ],O)}F.viewport.set([0,0,y.width,y.height])})(s,u,f,g);break;case"raster":(function(y,A,C,B){if(y.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!B.length)return;const F=y.context,j=F.gl,O=A.getSource(),W=y.useProgram("raster"),$=y.colorModeForRenderPass(),[q,Q]=O instanceof ei?[{},B]:y.stencilConfigForOverlap(B),lt=Q[Q.length-1].overscaledZ,ht=!y.options.moving;for(const ft of Q){const ut=y.depthModeForSublayer(ft.overscaledZ-lt,C.paint.get("raster-opacity")===1?di.ReadWrite:di.ReadOnly,j.LESS),vt=A.getTile(ft);vt.registerFadeDuration(C.paint.get("raster-fade-duration"));const Bt=A.findLoadedParent(ft,0),It=A.findLoadedSibling(ft),Qt=fh(vt,Bt||It||null,A,C,y.transform,y.style.map.terrain);let pe,_e;const xe=C.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;F.activeTexture.set(j.TEXTURE0),vt.texture.bind(xe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(j.TEXTURE1),Bt?(Bt.texture.bind(xe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),pe=Math.pow(2,Bt.tileID.overscaledZ-vt.tileID.overscaledZ),_e=[vt.tileID.canonical.x*pe%1,vt.tileID.canonical.y*pe%1]):vt.texture.bind(xe,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),vt.texture.useMipmap&&F.extTextureFilterAnisotropic&&y.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const ve=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ft),ye=ve?ft:null,we=ye?ye.posMatrix:y.transform.calculatePosMatrix(ft.toUnwrapped(),ht),$e=$h(we,_e||[0,0],pe||1,Qt,C);O instanceof ei?W.draw(F,j.TRIANGLES,ut,Xi.disabled,$,Ji.disabled,$e,ve,C.id,O.boundsBuffer,y.quadTriangleIndexBuffer,O.boundsSegments):W.draw(F,j.TRIANGLES,ut,q[ft.overscaledZ],$,Ji.disabled,$e,ve,C.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(s,u,f,g);break;case"background":(function(y,A,C,B){const F=C.paint.get("background-color"),j=C.paint.get("background-opacity");if(j===0)return;const O=y.context,W=O.gl,$=y.transform,q=$.tileSize,Q=C.paint.get("background-pattern");if(y.isPatternMissing(Q))return;const lt=!Q&&F.a===1&&j===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==lt)return;const ht=Xi.disabled,ft=y.depthModeForSublayer(0,lt==="opaque"?di.ReadWrite:di.ReadOnly),ut=y.colorModeForRenderPass(),vt=y.useProgram(Q?"backgroundPattern":"background"),Bt=B||$.coveringTiles({tileSize:q,terrain:y.style.map.terrain});Q&&(O.activeTexture.set(W.TEXTURE0),y.imageManager.bind(y.context));const It=C.getCrossfadeParameters();for(const Qt of Bt){const pe=B?Qt.posMatrix:y.transform.calculatePosMatrix(Qt.toUnwrapped()),_e=Q?Jo(pe,j,y,Q,{tileID:Qt,tileSize:q},It):Fl(pe,j,F),xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Qt);vt.draw(O,W.TRIANGLES,ft,ht,ut,Ji.disabled,_e,xe,C.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(s,0,f,g);break;case"custom":(function(y,A,C){const B=y.context,F=C.implementation;if(y.renderPass==="offscreen"){const j=F.prerender;j&&(y.setCustomLayerDefaults(),B.setColorMode(y.colorModeForRenderPass()),j.call(F,B.gl,y.transform.customLayerMatrix()),B.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),B.setColorMode(y.colorModeForRenderPass()),B.setStencilMode(Xi.disabled);const j=F.renderingMode==="3d"?new di(y.context.gl.LEQUAL,di.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,di.ReadOnly);B.setDepthMode(j),F.render(B.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),B.setDirty(),y.setBaseState(),B.bindFramebuffer.set(null)}})(s,0,f)}}translatePosMatrix(s,u,f,g,y){if(!f[0]&&!f[1])return s;const A=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(A){const F=Math.sin(A),j=Math.cos(A);f=[f[0]*j-f[1]*F,f[0]*F+f[1]*j]}const C=[y?f[0]:xi(u,f[0],this.transform.zoom),y?f[1]:xi(u,f[1],this.transform.zoom),0],B=new Float32Array(16);return l.J(B,s,C),B}saveTileTexture(s){const u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const u=this.imageManager.getPattern(s.from.toString()),f=this.imageManager.getPattern(s.to.toString());return!u||!f}useProgram(s,u){this.cache=this.cache||{};const f=s+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new mt(this.context,Yn[s],u,Qa[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:u}=this.context.gl;return this.width!==s||this.height!==u}}class Nn{constructor(s,u){this.points=s,this.planes=u}static fromInvProjectionMatrix(s,u,f){const g=Math.pow(2,f),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const B=1/(C=l.af([],C,s))[3]/u*g;return l.b1(C,C,[B,B,1/C[3],B])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const B=function(W,$){var q=$[0],Q=$[1],lt=$[2],ht=q*q+Q*Q+lt*lt;return ht>0&&(ht=1/Math.sqrt(ht)),W[0]=$[0]*ht,W[1]=$[1]*ht,W[2]=$[2]*ht,W}([],function(W,$,q){var Q=$[0],lt=$[1],ht=$[2],ft=q[0],ut=q[1],vt=q[2];return W[0]=lt*vt-ht*ut,W[1]=ht*ft-Q*vt,W[2]=Q*ut-lt*ft,W}([],Mt([],y[C[0]],y[C[1]]),Mt([],y[C[2]],y[C[1]]))),F=-((j=B)[0]*(O=y[C[1]])[0]+j[1]*O[1]+j[2]*O[2]);var j,O;return B.concat(F)});return new Nn(y,A)}}class cs{constructor(s,u){this.min=s,this.max=u,this.center=function(f,g,y){return f[0]=.5*g[0],f[1]=.5*g[1],f[2]=.5*g[2],f}([],function(f,g,y){return f[0]=g[0]+y[0],f[1]=g[1]+y[1],f[2]=g[2]+y[2],f}([],this.min,this.max))}quadrant(s){const u=[s%2==0,s<2],f=Et(this.min),g=Et(this.max);for(let y=0;y<u.length;y++)f[y]=u[y]?this.min[y]:this.center[y],g[y]=u[y]?this.center[y]:this.max[y];return g[2]=this.max[2],new cs(f,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let g=0;g<s.planes.length;g++){const y=s.planes[g];let A=0;for(let C=0;C<u.length;C++)l.b2(y,u[C])>=0&&A++;if(A===0)return 0;A!==u.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let y=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let C=0;C<s.points.length;C++){const B=s.points[C][g]-this.min[g];y=Math.min(y,B),A=Math.max(A,B)}if(A<0||y>this.max[g]-this.min[g])return 0}return 1}}class Os{constructor(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=f,this.right=g}interpolate(s,u,f){return u.top!=null&&s.top!=null&&(this.top=l.y.number(s.top,u.top,f)),u.bottom!=null&&s.bottom!=null&&(this.bottom=l.y.number(s.bottom,u.bottom,f)),u.left!=null&&s.left!=null&&(this.left=l.y.number(s.left,u.left,f)),u.right!=null&&s.right!=null&&(this.right=l.y.number(s.right,u.right,f)),this}getCenter(s,u){const f=l.ac((this.left+s-this.right)/2,0,s),g=l.ac((this.top+u-this.bottom)/2,0,u);return new l.P(f,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Os(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ba=85.051129;class Ns{constructor(s,u,f,g,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Os,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new Ns(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.lngRange=s.lngRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const u=-l.b3(s,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var f=new l.A(4);return l.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,g,y){var A=g[0],C=g[1],B=g[2],F=g[3],j=Math.sin(y),O=Math.cos(y);f[0]=A*O+B*j,f[1]=C*O+F*j,f[2]=A*-j+B*O,f[3]=C*-j+F*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=l.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,f){this._unmodified=!1,this._edgeInsets.interpolate(s,u,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new l.b4(0,s)];if(this._renderWorldCopies){const f=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),y=this.pointCoordinate(new l.P(this.width,this.height)),A=this.pointCoordinate(new l.P(0,this.height)),C=Math.floor(Math.min(f.x,g.x,y.x,A.x)),B=Math.floor(Math.max(f.x,g.x,y.x,A.x)),F=1;for(let j=C-F;j<=B+F;j++)j!==0&&u.push(new l.b4(j,s))}return u}coveringTiles(s){var u,f;let g=this.coveringZoomLevel(s);const y=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),C=l.Z.fromLngLat(this.center),B=Math.pow(2,g),F=[B*A.x,B*A.y,0],j=[B*C.x,B*C.y,0],O=Nn.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,g);let W=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=g);const $=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,q=ut=>({aabb:new cs([ut*B,0,0],[(ut+1)*B,B,0]),zoom:0,x:0,y:0,wrap:ut,fullyVisible:!1}),Q=[],lt=[],ht=g,ft=s.reparseOverscaled?y:g;if(this._renderWorldCopies)for(let ut=1;ut<=3;ut++)Q.push(q(-ut)),Q.push(q(ut));for(Q.push(q(0));Q.length>0;){const ut=Q.pop(),vt=ut.x,Bt=ut.y;let It=ut.fullyVisible;if(!It){const ve=ut.aabb.intersects(O);if(ve===0)continue;It=ve===2}const Qt=s.terrain?F:j,pe=ut.aabb.distanceX(Qt),_e=ut.aabb.distanceY(Qt),xe=Math.max(Math.abs(pe),Math.abs(_e));if(ut.zoom===ht||xe>$+(1<<ht-ut.zoom)-2&&ut.zoom>=W){const ve=ht-ut.zoom,ye=F[0]-.5-(vt<<ve),we=F[1]-.5-(Bt<<ve);lt.push({tileID:new l.S(ut.zoom===ht?ft:ut.zoom,ut.wrap,ut.zoom,vt,Bt),distanceSq:yt([j[0]-.5-vt,j[1]-.5-Bt]),tileDistanceToCamera:Math.sqrt(ye*ye+we*we)})}else for(let ve=0;ve<4;ve++){const ye=(vt<<1)+ve%2,we=(Bt<<1)+(ve>>1),$e=ut.zoom+1;let Ce=ut.aabb.quadrant(ve);if(s.terrain){const Pe=new l.S($e,ut.wrap,$e,ye,we),ii=s.terrain.getMinMaxElevation(Pe),wi=(u=ii.minElevation)!==null&&u!==void 0?u:this.elevation,_i=(f=ii.maxElevation)!==null&&f!==void 0?f:this.elevation;Ce=new cs([Ce.min[0],Ce.min[1],wi],[Ce.max[0],Ce.max[1],_i])}Q.push({aabb:Ce,zoom:$e,x:ye,y:we,wrap:ut.wrap,fullyVisible:It})}}return lt.sort((ut,vt)=>ut.distanceSq-vt.distanceSq).map(ut=>ut.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=l.ac(s.lat,-85.051129,Ba);return new l.P(l.O(s.lng)*this.worldSize,l.Q(u)*this.worldSize)}unproject(s){return new l.Z(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const u=this.elevation,f=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,s),y=s.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-y))return;const A=f+u-y,C=Math.cos(this._pitch)*this.cameraToCenterDistance/A/l.b5(1,g.lat),B=this.scaleZoom(C/this.tileSize);this._elevation=y,this._center=g,this.zoom=B}setLocationAtPoint(s,u){const f=this.pointCoordinate(u),g=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(s),A=new l.Z(y.x-(f.x-g.x),y.y-(f.y-g.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,u){return u?this.coordinatePoint(this.locationCoordinate(s),u.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,u){return this.coordinateLocation(this.pointCoordinate(s,u))}locationCoordinate(s){return l.Z.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,u){if(u){const W=u.pointCoordinate(s);if(W!=null)return W}const f=[s.x,s.y,0,1],g=[s.x,s.y,1,1];l.af(f,f,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const y=f[3],A=g[3],C=f[1]/y,B=g[1]/A,F=f[2]/y,j=g[2]/A,O=F===j?0:(0-F)/(j-F);return new l.Z(l.y.number(f[0]/y,g[0]/A,O)/this.worldSize,l.y.number(C,B,O)/this.worldSize)}coordinatePoint(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const g=[s.x*this.worldSize,s.y*this.worldSize,u,1];return l.af(g,g,f),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new it().extend(this.pointLocation(new l.P(0,s))).extend(this.pointLocation(new l.P(this.width,s))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new it([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ba])}calculateTileMatrix(s){const u=s.canonical,f=this.worldSize/this.zoomScale(u.z),g=u.x+Math.pow(2,u.z)*s.wrap,y=l.an(new Float64Array(16));return l.J(y,y,[g*f,u.y*f,0]),l.K(y,y,[f/l.X,f/l.X,1]),y}calculatePosMatrix(s){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const f=s.key,g=u?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const y=this.calculateTileMatrix(s);return l.L(y,u?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),g[f]=new Float32Array(y),g[f]}calculateFogMatrix(s){const u=s.key,f=this._fogMatrixCache;if(f[u])return f[u];const g=this.calculateTileMatrix(s);return l.L(g,this.fogMatrix,g),f[u]=new Float32Array(g),f[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,u){u=l.ac(+u,this.minZoom,this.maxZoom);const f={center:new l.N(s.lng,s.lat),zoom:u};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const ut=179.9999999999;g=[-ut,ut]}const y=this.tileSize*this.zoomScale(f.zoom);let A=0,C=y,B=0,F=y,j=0,O=0;const{x:W,y:$}=this.size;if(this.latRange){const ut=this.latRange;A=l.Q(ut[1])*y,C=l.Q(ut[0])*y,C-A<$&&(j=$/(C-A))}g&&(B=l.b3(l.O(g[0])*y,0,y),F=l.b3(l.O(g[1])*y,0,y),F<B&&(F+=y),F-B<W&&(O=W/(F-B)));const{x:q,y:Q}=this.project.call({worldSize:y},s);let lt,ht;const ft=Math.max(O||0,j||0);if(ft){const ut=new l.P(O?(F+B)/2:q,j?(C+A)/2:Q);return f.center=this.unproject.call({worldSize:y},ut).wrap(),f.zoom+=this.scaleZoom(ft),f}if(this.latRange){const ut=$/2;Q-ut<A&&(ht=A+ut),Q+ut>C&&(ht=C-ut)}if(g){const ut=(B+F)/2;let vt=q;this._renderWorldCopies&&(vt=l.b3(q,ut-y/2,ut+y/2));const Bt=W/2;vt-Bt<B&&(lt=B+Bt),vt+Bt>F&&(lt=F-Bt)}if(lt!==void 0||ht!==void 0){const ut=new l.P(lt??q,ht??Q);f.center=this.unproject.call({worldSize:y},ut).wrap()}return f}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:u,zoom:f}=this.getConstrained(this.center,this.zoom);this.center=u,this.zoom=f,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.K(g,g,[this.width/2,-this.height/2,1]),l.J(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.K(g,g,[1,-1,1]),l.J(g,g,[-1,-1,0]),l.K(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),C=y-A*this._pixelPerMeter/Math.cos(this._pitch),B=A<0?C:y,F=Math.PI/2+this._pitch,j=this._fov*(.5+s.y/this.height),O=Math.sin(j)*B/Math.sin(l.ac(Math.PI-F-j,.01,Math.PI-.01)),W=this.getHorizon(),$=2*Math.atan(W/this.cameraToCenterDistance)*(.5+s.y/(2*W)),q=Math.sin($)*B/Math.sin(l.ac(Math.PI-F-$,.01,Math.PI-.01)),Q=Math.min(O,q);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+B),this.nearZ=this.height/50,g=new Float64Array(16),l.b6(g,this._fov,this.width/this.height,this.nearZ,this.farZ),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,this.projectionMatrix=l.ae(g),l.K(g,g,[1,-1,1]),l.J(g,g,[0,0,-this.cameraToCenterDistance]),l.b7(g,g,this._pitch),l.ad(g,g,this.angle),l.J(g,g,[-u,-f,0]),this.mercatorMatrix=l.K([],g,[this.worldSize,this.worldSize,this.worldSize]),l.K(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,g),l.J(g,g,[0,0,-this.elevation]),this.modelViewProjectionMatrix=g,this.invModelViewProjectionMatrix=l.as([],g),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-s.x/this.width,this.fogMatrix[9]=2*s.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-u,-f,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,g);const lt=this.width%2/2,ht=this.height%2/2,ft=Math.cos(this.angle),ut=Math.sin(this.angle),vt=u-Math.round(u)+ft*lt+ut*ht,Bt=f-Math.round(f)+ft*ht+ut*lt,It=new Float64Array(g);if(l.J(It,It,[vt>.5?vt-1:vt,Bt>.5?Bt-1:Bt,0]),this.alignedModelViewProjectionMatrix=It,g=l.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.P(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.af(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,s))}getCameraQueryGeometry(s){const u=this.getCameraPoint();if(s.length===1)return[s[0],u];{let f=u.x,g=u.y,y=u.x,A=u.y;for(const C of s)f=Math.min(f,C.x),g=Math.min(g,C.y),y=Math.max(y,C.x),A=Math.max(A,C.y);return[new l.P(f,g),new l.P(y,g),new l.P(y,A),new l.P(f,A),new l.P(f,g)]}}lngLatToCameraDepth(s,u){const f=this.locationCoordinate(s),g=[f.x*this.worldSize,f.y*this.worldSize,u,1];return l.af(g,g,this.modelViewProjectionMatrix),g[2]/g[3]}}function zs(m,s){var u=this;let f,g=!1,y=null,A=null;const C=()=>{y=null,g&&(m.apply(A,f),y=setTimeout(C,s),g=!1)};return function(){for(var B=arguments.length,F=new Array(B),j=0;j<B;j++)F[j]=arguments[j];return g=!0,A=u,f=F,y||C(),y}}class Ra{constructor(s){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let f;return u.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:f,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(u.length===0)return;const f=u.join("/");let g=f;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${f}`);let y=window.location.hash.replace(g,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let A=window.location.href.replace(/(#.+)?$/,y);A=A.replace("&&","&"),window.history.replaceState(window.history.state,null,A)},this._updateHash=zs(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const u=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),A=Math.round(u.lng*y)/y,C=Math.round(u.lat*y)/y,B=this._map.getBearing(),F=this._map.getPitch();let j="";if(j+=s?`/${A}/${C}/${f}`:`${f}/${C}/${A}`,(B||F)&&(j+="/"+Math.round(10*B)/10),F&&(j+=`/${Math.round(F)}`),this._hashName){const O=this._hashName;let W=!1;const $=window.location.hash.slice(1).split("&").map(q=>{const Q=q.split("=")[0];return Q===O?(W=!0,`${Q}=${j}`):q}).filter(q=>q);return W||$.push(`${O}=${j}`),`#${$.join("&")}`}return`#${j}`}}const ts={linearity:.3,easing:l.b8(0,0,.3,1)},_o=l.e({deceleration:2500,maxSpeed:1400},ts),Cr=l.e({deceleration:20,maxSpeed:1400},ts),vr=l.e({deceleration:1e3,maxSpeed:360},ts),zr=l.e({deceleration:1e3,maxSpeed:90},ts);class rn{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=T.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(u.pan.mag()){const y=js(u.pan.mag(),f,l.e({},_o,s||{}));g.offset=u.pan.mult(y.amount/u.pan.mag()),g.center=this._map.transform.center,Ss(g,y)}if(u.zoom){const y=js(u.zoom,f,Cr);g.zoom=this._map.transform.zoom+y.amount,Ss(g,y)}if(u.bearing){const y=js(u.bearing,f,vr);g.bearing=this._map.transform.bearing+l.ac(y.amount,-179,179),Ss(g,y)}if(u.pitch){const y=js(u.pitch,f,zr);g.pitch=this._map.transform.pitch+y.amount,Ss(g,y)}if(g.zoom||g.bearing){const y=u.pinchAround===void 0?u.around:u.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function Ss(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function js(m,s,u){const{maxSpeed:f,linearity:g,deceleration:y}=u,A=l.ac(m*g/(s/1e3),-f,f),C=Math.abs(A)/(y*g);return{easing:u.easing,duration:1e3*C,amount:A*(C/2)}}class nn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const y=P.mousePos(u.getCanvas(),f),A=u.unproject(y);super(s,l.e({point:y,lngLat:A,originalEvent:f},g)),this._defaultPrevented=!1,this.target=u}}class Ro extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,f){const g=s==="touchend"?f.changedTouches:f.touches,y=P.touchPos(u.getCanvasContainer(),g),A=y.map(B=>u.unproject(B)),C=y.reduce((B,F,j,O)=>B.add(F.div(O.length)),new l.P(0,0));super(s,{points:y,point:C,lngLats:A,lngLat:u.unproject(C),originalEvent:f}),this._defaultPrevented=!1}}class Kh extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,f){super(s,{originalEvent:f}),this._defaultPrevented=!1}}class Qh{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Kh(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new nn(s.type,this._map,s))}mouseup(s){this._map.fire(new nn(s.type,this._map,s))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new nn(s.type,this._map,s))}dblclick(s){return this._firePreventable(new nn(s.type,this._map,s))}mouseover(s){this._map.fire(new nn(s.type,this._map,s))}mouseout(s){this._map.fire(new nn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ro(s.type,this._map,s))}touchmove(s){this._map.fire(new Ro(s.type,this._map,s))}touchend(s){this._map.fire(new Ro(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ro(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qr{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new nn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new nn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Us{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(l.P.convert(s),this._map.terrain)}}class hs{constructor(s,u){this._map=s,this._tr=new Us(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(P.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const f=u;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const y=Math.min(g.x,f.x),A=Math.max(g.x,f.x),C=Math.min(g.y,f.y),B=Math.max(g.y,f.y);P.setTransform(this._box,`translate(${y}px,${C}px)`),this._box.style.width=A-y+"px",this._box.style.height=B-C+"px"}mouseupWindow(s,u){if(!this._active||s.button!==0)return;const f=this._startPos,g=u;if(this.reset(),P.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:s})),{cameraAnimation:y=>y.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new l.k(s,{originalEvent:u}))}}function Vl(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const u={};for(let f=0;f<m.length;f++)u[m[f].identifier]=s[f];return u}class Lc{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,u,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const y=new l.P(0,0);for(const A of g)y._add(A);return y.div(g.length)}(u),this.touches=Vl(f,u)))}touchmove(s,u,f){if(this.aborted||!this.centroid)return;const g=Vl(f,u);for(const y in this.touches){const A=g[y];(!A||A.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(s,u,f){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class nl{constructor(s){this.singleTap=new Lc(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,u,f){this.singleTap.touchstart(s,u,f)}touchmove(s,u,f){this.singleTap.touchmove(s,u,f)}touchend(s,u,f){const g=this.singleTap.touchend(s,u,f);if(g){const y=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(g)<30;if(y&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class xn{constructor(s){this._tr=new Us(s),this._zoomIn=new nl({numTouches:1,numTaps:2}),this._zoomOut=new nl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,f){this._zoomIn.touchstart(s,u,f),this._zoomOut.touchstart(s,u,f)}touchmove(s,u,f){this._zoomIn.touchmove(s,u,f),this._zoomOut.touchmove(s,u,f)}touchend(s,u,f){const g=this._zoomIn.touchend(s,u,f),y=this._zoomOut.touchend(s,u,f),A=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(g)},{originalEvent:s})}):y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(y)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cn{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(){const s=this._moveFunction(...arguments);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(s,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,u){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=u.length?u[0]:u;return!this._moved&&g.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(f,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&P.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ql={0:1,2:2};class sl{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const u=P.mouseButton(s);this._eventButton=u}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(u,f){const g=ql[f];return u.buttons===void 0||(u.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return P.mouseButton(s)===this._eventButton}}class mh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const ol=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=s=>{s.preventDefault()}},Hl=m=>{let{enable:s,clickTolerance:u,bearingDegreesPerPixelMoved:f=.8}=m;const g=new sl({checkCorrectEvent:y=>P.mouseButton(y)===0&&y.ctrlKey||P.mouseButton(y)===2});return new cn({clickTolerance:u,move:(y,A)=>({bearingDelta:(A.x-y.x)*f}),moveStateManager:g,enable:s,assignEvents:ol})},Mc=m=>{let{enable:s,clickTolerance:u,pitchDegreesPerPixelMoved:f=-.5}=m;const g=new sl({checkCorrectEvent:y=>P.mouseButton(y)===0&&y.ctrlKey||P.mouseButton(y)===2});return new cn({clickTolerance:u,move:(y,A)=>({pitchDelta:(A.y-y.y)*f}),moveStateManager:g,enable:s,assignEvents:ol})};class ka{constructor(s,u){this._clickTolerance=s.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,u,f){return this._calculateTransform(s,u,f)}touchmove(s,u,f){if(this._active){if(!this._shouldBePrevented(f.length))return s.preventDefault(),this._calculateTransform(s,u,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,u,f){this._calculateTransform(s,u,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,f){f.length>0&&(this._active=!0);const g=Vl(f,u),y=new l.P(0,0),A=new l.P(0,0);let C=0;for(const F in g){const j=g[F],O=this._touches[F];O&&(y._add(j),A._add(j.sub(O)),C++,g[F]=j)}if(this._touches=g,this._shouldBePrevented(C)||!A.mag())return;const B=A.div(C);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,u,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,f){if(!this._firstTwoTouches)return;s.preventDefault();const[g,y]=this._firstTwoTouches,A=al(f,u,g),C=al(f,u,y);if(!A||!C)return;const B=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],B,s)}touchend(s,u,f){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,A=al(f,u,g),C=al(f,u,y);A&&C||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function al(m,s,u){for(let f=0;f<m.length;f++)if(m[f].identifier===u)return s[f]}function Xl(m,s){return Math.log(m/s)/Math.LN2}class Bc extends Wl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const f=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Xl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xl(this._distance,f),pinchAround:u}}}function tu(m,s){return 180*m.angleWith(s)/Math.PI}class eu extends Wl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u,f){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tu(this._vector,g),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,f=tu(s,this._startVector);return Math.abs(f)<u}}function Rc(m){return Math.abs(m.y)>Math.abs(m.x)}class Zl extends Wl{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,u,f){super.touchstart(s,u,f),this._currentTouchCount=f.length}_start(s){this._lastPoints=s,Rc(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),y=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,y,f.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(s,u,f){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,y=u.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const A=s.y>0==u.y>0;return Rc(s)&&Rc(u)&&A}}const Wu={panStep:100,bearingStep:15,pitchStep:10};class Gs{constructor(s){this._tr=new Us(s);const u=Wu;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,f=0,g=0,y=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?f=-1:(s.preventDefault(),y=-1);break;case 39:s.shiftKey?f=1:(s.preventDefault(),y=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:C=>{const B=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:ko,zoom:u?Math.round(B.zoom)+u*(s.shiftKey?2:1):B.zoom,bearing:B.bearing+f*this._bearingStep,pitch:B.pitch+g*this._pitchStep,offset:[-y*this._panStep,-A*this._panStep],center:B.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ko(m){return m*(2-m)}const iu=4.000244140625;class As{constructor(s,u){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=s,this._tr=new Us(s),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const f=T.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,u!==0&&u%iu==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=P.mousePos(this._map.getCanvas(),s),f=this._tr;this._around=u.y>f.transform.height/2-f.transform.getHorizon()?l.N.convert(this._aroundCenter?f.center:f.unproject(u)):l.N.convert(f.center),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>iu?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&F!==0&&(F=1/F);const j=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(j*F))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,f=this._startZoom,g=this._easing;let y,A=!1;const C=T.now()-this._lastWheelEventTime;if(this._type==="wheel"&&f&&g&&C){const B=Math.min(C/200,1),F=g(B);y=l.y.number(f,u,F),B<1?this._frameId||(this._frameId=!0):A=!0}else y=u,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:y-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=l.b9;if(this._prevEase){const f=this._prevEase,g=(T.now()-f.start)/f.duration,y=f.easing(g+.01)-f.easing(g),A=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-A*A);u=l.b8(A,C,.25,1)}return this._prevEase={start:T.now(),duration:s,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class na{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kc{constructor(s){this._tr=new Us(s),this.reset()}reset(){this._active=!1}dblclick(s,u){return s.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lp{constructor(){this._tap=new nl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,u,f){if(!this._swipePoint)if(this._tapTime){const g=u[0],y=s.timeStamp-this._tapTime<500,A=this._tapPoint.dist(g)<30;y&&A?f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(s,u,f)}touchmove(s,u,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=u[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(s,u,f)}touchend(s,u,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const g=this._tap.touchend(s,u,f);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xu{constructor(s,u,f){this._el=s,this._mousePan=u,this._touchPan=f}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ru{constructor(s,u,f){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nu{constructor(s,u,f,g){this._el=s,this._touchZoom=u,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $l{constructor(s,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",s);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=u,this._container.appendChild(g);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=f,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,u){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:s,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Vs=m=>m.zoom||m.drag||m.pitch||m.rotate;class Ve extends l.k{}function yo(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Es{constructor(s,u){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,y)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=g.type==="renderFrame"?void 0:g,C={needsRenderFrame:!1},B={},F={},j=g.touches,O=j?this._getMapTouches(j):void 0,W=O?P.touchPos(this._map.getCanvas(),O):P.mousePos(this._map.getCanvas(),g);for(const{handlerName:Q,handler:lt,allowed:ht}of this._handlers){if(!lt.isEnabled())continue;let ft;this._blockedByActive(F,ht,Q)?lt.reset():lt[y||g.type]&&(ft=lt[y||g.type](g,W,O),this.mergeHandlerResult(C,B,ft,Q,A),ft&&ft.needsRenderFrame&&this._triggerRenderFrame()),(ft||lt.isActive())&&(F[Q]=lt)}const $={};for(const Q in this._previousActiveHandlers)F[Q]||($[Q]=A);this._previousActiveHandlers=F,(Object.keys($).length||yo(C))&&(this._changes.push([C,B,$]),this._triggerRenderFrame()),(Object.keys(F).length||yo(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=C;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rn(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,A]of this._listeners)P.addEventListener(g,y,g===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[s,u,f]of this._listeners)P.removeEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(s){const u=this._map,f=u.getCanvasContainer();this._add("mapEvent",new Qh(u,s));const g=u.boxZoom=new hs(u,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const y=u.cooperativeGestures=new $l(u,s.cooperativeGestures);this._add("cooperativeGestures",y),s.cooperativeGestures&&y.enable();const A=new xn(u),C=new kc(u);u.doubleClickZoom=new na(C,A),this._add("tapZoom",A),this._add("clickZoom",C),s.interactive&&s.doubleClickZoom&&u.doubleClickZoom.enable();const B=new lp;this._add("tapDragZoom",B);const F=u.touchPitch=new Zl(u);this._add("touchPitch",F),s.interactive&&s.touchPitch&&u.touchPitch.enable(s.touchPitch);const j=Hl(s),O=Mc(s);u.dragRotate=new ru(s,j,O),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),s.interactive&&s.dragRotate&&u.dragRotate.enable();const W=(ft=>{let{enable:ut,clickTolerance:vt}=ft;const Bt=new sl({checkCorrectEvent:It=>P.mouseButton(It)===0&&!It.ctrlKey});return new cn({clickTolerance:vt,move:(It,Qt)=>({around:Qt,panDelta:Qt.sub(It)}),activateOnStart:!0,moveStateManager:Bt,enable:ut,assignEvents:ol})})(s),$=new ka(s,u);u.dragPan=new Xu(f,W,$),this._add("mousePan",W),this._add("touchPan",$,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&u.dragPan.enable(s.dragPan);const q=new eu,Q=new Bc;u.touchZoomRotate=new nu(f,Q,q,B),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&u.touchZoomRotate.enable(s.touchZoomRotate);const lt=u.scrollZoom=new As(u,()=>this._triggerRenderFrame());this._add("scrollZoom",lt,["mousePan"]),s.interactive&&s.scrollZoom&&u.scrollZoom.enable(s.scrollZoom);const ht=u.keyboard=new Gs(u);this._add("keyboard",ht),s.interactive&&s.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new qr(u))}_add(s,u,f){this._handlers.push({handlerName:s,handler:u,allowed:f}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vs(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,u,f){for(const g in s)if(g!==f&&(!u||u.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const u=[];for(const f of s)this._el.contains(f.target)&&u.push(f);return u}mergeHandlerResult(s,u,f,g,y){if(!f)return;l.e(s,f);const A={handlerName:g,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(u.zoom=A),f.panDelta!==void 0&&(u.drag=A),f.pitchDelta!==void 0&&(u.pitch=A),f.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){const s={},u={},f={};for(const[g,y,A]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),l.e(u,y),l.e(f,A);this._updateMapTransform(s,u,f),this._changes=[]}_updateMapTransform(s,u,f){const g=this._map,y=g._getTransformForUpdate(),A=g.terrain;if(!(yo(s)||A&&this._terrainMovement))return this._fireEvents(u,f,!0);let{panDelta:C,zoomDelta:B,bearingDelta:F,pitchDelta:j,around:O,pinchAround:W}=s;W!==void 0&&(O=W),g._stop(!0),O=O||g.transform.centerPoint;const $=y.pointLocation(C?O.sub(C):O);F&&(y.bearing+=F),j&&(y.pitch+=j),B&&(y.zoom+=B),A?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(C)):y.setLocationAtPoint($,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint($,O)):y.setLocationAtPoint($,O),g._applyUpdatedTransform(y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,f,!0)}_fireEvents(s,u,f){const g=Vs(this._eventsInProgress),y=Vs(s),A={};for(const O in s){const{originalEvent:W}=s[O];this._eventsInProgress[O]||(A[`${O}start`]=W),this._eventsInProgress[O]=s[O]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const O in A)this._fireEvent(O,A[O]);y&&this._fireEvent("move",y.originalEvent);for(const O in s){const{originalEvent:W}=s[O];this._fireEvent(O,W)}const C={};let B;for(const O in this._eventsInProgress){const{handlerName:W,originalEvent:$}=this._eventsInProgress[O];this._handlersById[W].isActive()||(delete this._eventsInProgress[O],B=u[W]||$,C[`${O}end`]=B)}for(const O in C)this._fireEvent(O,C[O]);const F=Vs(this._eventsInProgress),j=(g||y)&&!F;if(j&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const O=this._map._getTransformForUpdate();O.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(O)}if(f&&j){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!O||!O.essential&&T.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:B})),W(this._map.getBearing())&&this._map.resetNorth()):(W(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new l.k(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Ve("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fo extends l.E{constructor(s,u){super(),this._renderFrameCallback=()=>{const f=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,f){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},u),f)}panTo(s,u,f){return this.easeTo(l.e({center:s},u),f)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,f){return this.easeTo(l.e({zoom:s},u),f)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,f){return this.easeTo(l.e({bearing:s},u),f)}resetNorth(s,u){return this.rotateTo(0,l.e({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=it.convert(s).adjustAntiMeridian();const f=u&&u.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),f,u)}_cameraForBoxAndBearing(s,u,f,g){const y={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const ve=g.padding;g.padding={top:ve,bottom:ve,right:ve,left:ve}}g.padding=l.e(y,g.padding);const A=this.transform,C=A.padding,B=new it(s,u),F=A.project(B.getNorthWest()),j=A.project(B.getNorthEast()),O=A.project(B.getSouthEast()),W=A.project(B.getSouthWest()),$=l.ba(-f),q=F.rotate($),Q=j.rotate($),lt=O.rotate($),ht=W.rotate($),ft=new l.P(Math.max(q.x,Q.x,ht.x,lt.x),Math.max(q.y,Q.y,ht.y,lt.y)),ut=new l.P(Math.min(q.x,Q.x,ht.x,lt.x),Math.min(q.y,Q.y,ht.y,lt.y)),vt=ft.sub(ut),Bt=(A.width-(C.left+C.right+g.padding.left+g.padding.right))/vt.x,It=(A.height-(C.top+C.bottom+g.padding.top+g.padding.bottom))/vt.y;if(It<0||Bt<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Qt=Math.min(A.scaleZoom(A.scale*Math.min(Bt,It)),g.maxZoom),pe=l.P.convert(g.offset),_e=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.ba(f)),xe=pe.add(_e).mult(A.scale/A.zoomScale(Qt));return{center:A.unproject(F.add(O).div(2).sub(xe)),zoom:Qt,bearing:f}}fitBounds(s,u,f){return this._fitInternal(this.cameraForBounds(s,u),u,f)}fitScreenCoordinates(s,u,f,g,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(s)),this.transform.pointLocation(l.P.convert(u)),f,g),g,y)}_fitInternal(s,u,f){return s?(delete(u=l.e(s,u)).padding,u.linear?this.easeTo(u,f):this.flyTo(u,f)):this}jumpTo(s,u){this.stop();const f=this._getTransformForUpdate();let g=!1,y=!1,A=!1;return"zoom"in s&&f.zoom!==+s.zoom&&(g=!0,f.zoom=+s.zoom),s.center!==void 0&&(f.center=l.N.convert(s.center)),"bearing"in s&&f.bearing!==+s.bearing&&(y=!0,f.bearing=+s.bearing),"pitch"in s&&f.pitch!==+s.pitch&&(A=!0,f.pitch=+s.pitch),s.padding==null||f.isPaddingEqual(s.padding)||(f.padding=s.padding),this._applyUpdatedTransform(f),this.fire(new l.k("movestart",u)).fire(new l.k("move",u)),g&&this.fire(new l.k("zoomstart",u)).fire(new l.k("zoom",u)).fire(new l.k("zoomend",u)),y&&this.fire(new l.k("rotatestart",u)).fire(new l.k("rotate",u)).fire(new l.k("rotateend",u)),A&&this.fire(new l.k("pitchstart",u)).fire(new l.k("pitch",u)).fire(new l.k("pitchend",u)),this.fire(new l.k("moveend",u))}calculateCameraOptionsFromTo(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const y=l.Z.fromLngLat(s,u),A=l.Z.fromLngLat(f,g),C=A.x-y.x,B=A.y-y.y,F=A.z-y.z,j=Math.hypot(C,B,F);if(j===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(C,B),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/j/this.transform.tileSize),$=180*Math.atan2(C,-B)/Math.PI;let q=180*Math.acos(O/j)/Math.PI;return q=F<0?90-q:90+q,{center:A.toLngLat(),zoom:W,pitch:q,bearing:$}}easeTo(s,u){var f;this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.b9},s)).animate===!1||!s.essential&&T.prefersReducedMotion)&&(s.duration=0);const g=this._getTransformForUpdate(),y=g.zoom,A=g.bearing,C=g.pitch,B=g.padding,F="bearing"in s?this._normalizeBearing(s.bearing,A):A,j="pitch"in s?+s.pitch:C,O="padding"in s?s.padding:g.padding,W=l.P.convert(s.offset);let $=g.centerPoint.add(W);const q=g.pointLocation($),{center:Q,zoom:lt}=g.getConstrained(l.N.convert(s.center||q),(f=s.zoom)!==null&&f!==void 0?f:y);this._normalizeCenter(Q,g);const ht=g.project(q),ft=g.project(Q).sub(ht),ut=g.zoomScale(lt-y);let vt,Bt;s.around&&(vt=l.N.convert(s.around),Bt=g.locationPoint(vt));const It={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||lt!==y,this._rotating=this._rotating||A!==F,this._pitching=this._pitching||j!==C,this._padding=!g.isPaddingEqual(O),this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,It),this.terrain&&this._prepareElevation(Q),this._ease(Qt=>{if(this._zooming&&(g.zoom=l.y.number(y,lt,Qt)),this._rotating&&(g.bearing=l.y.number(A,F,Qt)),this._pitching&&(g.pitch=l.y.number(C,j,Qt)),this._padding&&(g.interpolatePadding(B,O,Qt),$=g.centerPoint.add(W)),this.terrain&&!s.freezeElevation&&this._updateElevation(Qt),vt)g.setLocationAtPoint(vt,Bt);else{const pe=g.zoomScale(g.zoom-y),_e=lt>y?Math.min(2,ut):Math.max(.5,ut),xe=Math.pow(_e,1-Qt),ve=g.unproject(ht.add(ft.mult(Qt*xe)).mult(pe));g.setLocationAtPoint(g.renderWorldCopies?ve.wrap():ve,$)}this._applyUpdatedTransform(g),this._fireMoveEvents(u)},Qt=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Qt)},s),this}_prepareEase(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,u||f.moving||this.fire(new l.k("movestart",s)),this._zooming&&!f.zooming&&this.fire(new l.k("zoomstart",s)),this._rotating&&!f.rotating&&this.fire(new l.k("rotatestart",s)),this._pitching&&!f.pitching&&this.fire(new l.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&u!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(f-(u-(f*s+this._elevationStart))/(1-s)),this._elevationTarget=u}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){const u=s.getCameraPosition(),f=this.terrain.getElevationForLngLatZoom(u.lngLat,s.zoom);if(u.altitude<f){const g=this.calculateCameraOptionsFromTo(u.lngLat,f,s.center,s.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(s){const u=[];if(this.terrain&&u.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&u.push(g=>this.transformCameraUpdate(g)),!u.length)return;const f=s.clone();for(const g of u){const y=f.clone(),{center:A,zoom:C,pitch:B,bearing:F,elevation:j}=g(y);A&&(y.center=A),C!==void 0&&(y.zoom=C),B!==void 0&&(y.pitch=B),F!==void 0&&(y.bearing=F),j!==void 0&&(y.elevation=j),f.apply(y)}this.transform.apply(f)}_fireMoveEvents(s){this.fire(new l.k("move",s)),this._zooming&&this.fire(new l.k("zoom",s)),this._rotating&&this.fire(new l.k("rotate",s)),this._pitching&&this.fire(new l.k("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const f=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new l.k("zoomend",s)),g&&this.fire(new l.k("rotateend",s)),y&&this.fire(new l.k("pitchend",s)),this.fire(new l.k("moveend",s))}flyTo(s,u){var f;if(!s.essential&&T.prefersReducedMotion){const Pe=l.M(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pe,u)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},s);const g=this._getTransformForUpdate(),y=g.zoom,A=g.bearing,C=g.pitch,B=g.padding,F="bearing"in s?this._normalizeBearing(s.bearing,A):A,j="pitch"in s?+s.pitch:C,O="padding"in s?s.padding:g.padding,W=l.P.convert(s.offset);let $=g.centerPoint.add(W);const q=g.pointLocation($),{center:Q,zoom:lt}=g.getConstrained(l.N.convert(s.center||q),(f=s.zoom)!==null&&f!==void 0?f:y);this._normalizeCenter(Q,g);const ht=g.zoomScale(lt-y),ft=g.project(q),ut=g.project(Q).sub(ft);let vt=s.curve;const Bt=Math.max(g.width,g.height),It=Bt/ht,Qt=ut.mag();if("minZoom"in s){const Pe=l.ac(Math.min(s.minZoom,y,lt),g.minZoom,g.maxZoom),ii=Bt/g.zoomScale(Pe-y);vt=Math.sqrt(ii/Qt*2)}const pe=vt*vt;function _e(Pe){const ii=(It*It-Bt*Bt+(Pe?-1:1)*pe*pe*Qt*Qt)/(2*(Pe?It:Bt)*pe*Qt);return Math.log(Math.sqrt(ii*ii+1)-ii)}function xe(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ve(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const ye=_e(!1);let we=function(Pe){return ve(ye)/ve(ye+vt*Pe)},$e=function(Pe){return Bt*((ve(ye)*(xe(ii=ye+vt*Pe)/ve(ii))-xe(ye))/pe)/Qt;var ii},Ce=(_e(!0)-ye)/vt;if(Math.abs(Qt)<1e-6||!isFinite(Ce)){if(Math.abs(Bt-It)<1e-6)return this.easeTo(s,u);const Pe=It<Bt?-1:1;Ce=Math.abs(Math.log(It/Bt))/vt,$e=()=>0,we=ii=>Math.exp(Pe*vt*ii)}return s.duration="duration"in s?+s.duration:1e3*Ce/("screenSpeed"in s?+s.screenSpeed/vt:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=A!==F,this._pitching=j!==C,this._padding=!g.isPaddingEqual(O),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Q),this._ease(Pe=>{const ii=Pe*Ce,wi=1/we(ii);g.zoom=Pe===1?lt:y+g.scaleZoom(wi),this._rotating&&(g.bearing=l.y.number(A,F,Pe)),this._pitching&&(g.pitch=l.y.number(C,j,Pe)),this._padding&&(g.interpolatePadding(B,O,Pe),$=g.centerPoint.add(W)),this.terrain&&!s.freezeElevation&&this._updateElevation(Pe);const _i=Pe===1?Q:g.unproject(ft.add(ut.mult($e(ii))).mult(wi));g.setLocationAtPoint(g.renderWorldCopies?_i.wrap():_i,$),this._applyUpdatedTransform(g),this._fireMoveEvents(u)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}return s||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(s,u,f){f.animate===!1||f.duration===0?(s(1),u()):(this._easeStart=T.now(),this._easeOptions=f,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,u){s=l.b3(s,-180,180);const f=Math.abs(s-u);return Math.abs(s-360-u)<f&&(s-=360),Math.abs(s+360-u)<f&&(s+=360),s}_normalizeCenter(s,u){if(!u.renderWorldCopies||u.lngRange)return;const f=s.lng-u.center.lng;s.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const Yl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ll{constructor(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yl;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,u){const f=this._map._getUIString(`AttributionControl.${u}`);s.title=f,s.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const u=this._map.style.sourceCaches;for(const g in u){const y=u[g];if(y.used||y.usedForTerrain){const A=y.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,y)=>g.length-y.length),s=s.filter((g,y)=>{for(let A=y+1;A<s.length;A++)if(s[A].indexOf(g)>=0)return!1;return!0});const f=s.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,s.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Do{constructor(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const u=this._container.children;if(u.length){const f=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const u=P.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,f=u?this._queue.concat(u):this._queue;for(const g of f)if(g.id===s)return void(g.cancelled=!0)}run(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const f of u)if(!f.cancelled&&(f.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var su=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class cp extends l.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,u){this.sourceCache.update(s,u),this._renderableTilesKeys=[];const f={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aP(g.posMatrix,0,l.X,0,l.X,0,1),this._tiles[g.key]=new _r(g,this.tileSize));for(const g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(s){for(const u in this._tiles){const f=this._tiles[u];(!s||f.tileID.equals(s)||f.tileID.isChildOf(s)||s.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const u={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(g.canonical.equals(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),u[f]=y}else if(g.canonical.isChildOf(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const A=g.canonical.z-s.canonical.z,C=g.canonical.x-(g.canonical.x>>A<<A),B=g.canonical.y-(g.canonical.y>>A<<A),F=l.X>>A;l.aP(y.posMatrix,0,F,0,F,0,1),l.J(y.posMatrix,y.posMatrix,[-C*F,-B*F,0]),u[f]=y}else if(s.canonical.isChildOf(g.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const A=s.canonical.z-g.canonical.z,C=s.canonical.x-(s.canonical.x>>A<<A),B=s.canonical.y-(s.canonical.y>>A<<A),F=l.X>>A;l.aP(y.posMatrix,0,l.X,0,l.X,0,1),l.J(y.posMatrix,y.posMatrix,[C*F,B*F,0]),l.K(y.posMatrix,y.posMatrix,[1/2**A,1/2**A,0]),u[f]=y}}return u}getSourceTile(s,u){const f=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!y||!y.dem)&&u)for(;g>=f.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(s.scaledTo(g--).key);return y}tilesAfterTime(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(u=>u.timeAdded>=s)}}class gh{constructor(s,u,f){this.painter=s,this.sourceCache=new cp(u),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.X;var y;if(!(u>=0&&u<g&&f>=0&&f<g))return 0;const A=this.getTerrainData(s),C=(y=A.tile)===null||y===void 0?void 0:y.dem;if(!C)return 0;const B=function(q,Q,lt){var ht=Q[0],ft=Q[1];return q[0]=lt[0]*ht+lt[4]*ft+lt[12],q[1]=lt[1]*ht+lt[5]*ft+lt[13],q}([],[u/g*l.X,f/g*l.X],A.u_terrain_matrix),F=[B[0]*C.dim,B[1]*C.dim],j=Math.floor(F[0]),O=Math.floor(F[1]),W=F[0]-j,$=F[1]-O;return C.get(j,O)*(1-W)*(1-$)+C.get(j+1,O)*W*(1-$)+C.get(j,O+1)*(1-W)*$+C.get(j+1,O+1)*W*$}getElevationForLngLatZoom(s,u){if(!l.bb(u,s.wrap()))return 0;const{tileID:f,mercatorX:g,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(s,u);return this.getElevation(f,g%l.X,y%l.X,l.X)}getElevation(s,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:l.X;return this.getDEMElevation(s,u,f,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(g,y,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const u=this.sourceCache.getSourceTile(s,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const g=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new at(g,u.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),u.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const f=u&&u+u.tileID.key+s.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let y=s.canonical.z-u.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?y=s.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=s.canonical.x-(s.canonical.x>>y<<y),C=s.canonical.y-(s.canonical.y>>y<<y),B=l.bc(new Float64Array(16),[1/(l.X<<y),1/(l.X<<y),0]);l.J(B,B,[A*l.X,C*l.X,0]),this._demMatrixCache[s.key]={matrix:B,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(s){const u=this.painter,f=u.width/devicePixelRatio,g=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,A=0;y<this._coordsTextureSize;y++)for(let C=0;C<this._coordsTextureSize;C++,A+=4)u[A+0]=255&C,u[A+1]=255&y,u[A+2]=C>>8<<4|y>>8,u[A+3]=0;const f=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),g=new at(s,f,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),f=this.painter.context,g=f.gl,y=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),A=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(y,C-A-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),f.bindFramebuffer.set(null);const B=u[0]+(u[2]>>4<<8),F=u[1]+((15&u[2])<<8),j=this.coordsIndex[255-u[3]],O=j&&this.sourceCache.getTileByID(j);if(!O)return null;const W=this._coordsTextureSize,$=(1<<O.tileID.canonical.z)*W;return new l.Z((O.tileID.canonical.x*W+B)/$+O.tileID.wrap,(O.tileID.canonical.y*W+F)/$,this.getElevation(O.tileID,B,F,W))}depthAtPoint(s){const u=new Uint8Array(4),f=this.painter.context,g=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),f.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,u=new l.bd,f=new l.aY,g=this.meshSize,y=l.X/g,A=g*g;for(let O=0;O<=g;O++)for(let W=0;W<=g;W++)u.emplaceBack(W*y,O*y,0);for(let O=0;O<A;O+=g+1)for(let W=0;W<g;W++)f.emplaceBack(W+O,g+W+O+1,g+W+O+2),f.emplaceBack(W+O,g+W+O+2,W+O+1);const C=u.length,B=C+2*(g+1);for(const O of[0,1])for(let W=0;W<=g;W++)for(const $ of[0,1])u.emplaceBack(W*y,O*l.X,$);for(let O=0;O<2*g;O+=2)f.emplaceBack(B+O,B+O+1,B+O+3),f.emplaceBack(B+O,B+O+3,B+O+2),f.emplaceBack(C+O,C+O+3,C+O+1),f.emplaceBack(C+O,C+O+2,C+O+3);const F=u.length,j=F+2*(g+1);for(const O of[0,1])for(let W=0;W<=g;W++)for(const $ of[0,1])u.emplaceBack(O*l.X,W*y,$);for(let O=0;O<2*g;O+=2)f.emplaceBack(F+O,F+O+1,F+O+3),f.emplaceBack(F+O,F+O+3,F+O+2),f.emplaceBack(j+O,j+O+3,j+O+1),f.emplaceBack(j+O,j+O+2,j+O+3);return this._mesh=new Ma(s.createVertexBuffer(u,su.members),s.createIndexBuffer(f),l.a0.simpleSegment(0,0,u.length,f.length)),this._mesh}getMeshFrameDelta(s){return 2*Math.PI*l.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,u){var f;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,u);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(s){const u=this.getTerrainData(s).tile,f={minElevation:null,maxElevation:null};return u&&u.dem&&(f.minElevation=u.dem.min*this.exaggeration,f.maxElevation=u.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(s,u){const f=l.Z.fromLngLat(s.wrap()),g=(1<<u)*l.X,y=f.x*g,A=f.y*g,C=Math.floor(y/l.X),B=Math.floor(A/l.X);return{tileID:new l.S(u,0,u,C,B),mercatorX:y,mercatorY:A}}}class Zu{constructor(s,u,f){this._context=s,this._size=u,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(f.texture),{id:s,fbo:u,texture:f,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>s.id!==u),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const cl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ou{constructor(s,u){this.painter=s,this.terrain=u,this.pool=new Zu(s.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(f=>!s._layers[f].isHidden(u)),this._coordsDescendingInv={};for(const f in s.sourceCaches){this._coordsDescendingInv[f]={};const g=s.sourceCaches[f].getVisibleCoordinates();for(const y of g){const A=this.terrain.sourceCache.getTerrainCoords(y);for(const C in A)this._coordsDescendingInv[f][C]||(this._coordsDescendingInv[f][C]=[]),this._coordsDescendingInv[f][C].push(A[C])}}this._coordsDescendingInvStr={};for(const f of s._order){const g=s._layers[f],y=g.source;if(cl[g.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const A in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][A]=this._coordsDescendingInv[y][A].map(C=>C.key).sort().join()}}for(const f of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[g][f.tileID.key];y&&y!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const u=s.type,f=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(cl[u]&&(this._prevType&&cl[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(cl[this._prevType]||cl[u]&&g){this._prevType=u;const y=this._stacks.length-1,A=this._stacks[y]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(rl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[y]){const F=this.pool.getObjectForId(C.rtt[y].id);if(F.stamp===C.rtt[y].stamp){this.pool.useObject(F);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),C.rtt[y]={id:B.id,stamp:B.stamp},f.context.bindFramebuffer.set(B.fbo.framebuffer),f.context.clear({color:l.aM.transparent,stencil:0}),f.currentStencilSource=void 0;for(let F=0;F<A.length;F++){const j=f.style._layers[A[F]],O=j.source?this._coordsDescendingInv[j.source][C.tileID.key]:[C.tileID];f.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),f._renderTileClippingMasks(j,O),f.renderLayer(f,f.style.sourceCaches[j.source],j,O),j.source&&(C.rttCoords[j.source]=this._coordsDescendingInvStr[j.source][C.tileID.key])}}return rl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),cl[u]}return!1}}const au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fc=_,_h={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Yl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},hl=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},lu={showCompass:!0,showZoom:!0,visualizePitch:!1};class $u{constructor(s,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=A=>{this.startMouse(l.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),P.mousePos(this.element,A)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,P.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),y=s.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=Hl({clickTolerance:g,enable:!0}),this.touchRotate=(A=>{let{enable:C,clickTolerance:B,bearingDegreesPerPixelMoved:F=.8}=A;const j=new mh;return new cn({clickTolerance:B,move:(O,W)=>({bearingDelta:(W.x-O.x)*F}),moveStateManager:j,enable:C,assignEvents:hl})})({clickTolerance:g,enable:!0}),this.map=s,f&&(this.mousePitch=Mc({clickTolerance:y,enable:!0}),this.touchPitch=(A=>{let{enable:C,clickTolerance:B,pitchDegreesPerPixelMoved:F=-.5}=A;const j=new mh;return new cn({clickTolerance:B,move:(O,W)=>({pitchDelta:(W.y-O.y)*F}),moveStateManager:j,enable:C,assignEvents:hl})})({clickTolerance:y,enable:!0})),P.addEventListener(u,"mousedown",this.mousedown),P.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(u,"touchcancel",this.reset)}startMouse(s,u){this.mouseRotate.dragStart(s,u),this.mousePitch&&this.mousePitch.dragStart(s,u),P.disableDrag()}startTouch(s,u){this.touchRotate.dragStart(s,u),this.touchPitch&&this.touchPitch.dragStart(s,u),P.disableDrag()}moveMouse(s,u){const f=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,u)||{};if(g&&f.setBearing(f.getBearing()+g),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(s,u)||{};y&&f.setPitch(f.getPitch()+y)}}moveTouch(s,u){const f=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,u)||{};if(g&&f.setBearing(f.getBearing()+g),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(s,u)||{};y&&f.setPitch(f.getPitch()+y)}}off(){const s=this.element;P.removeEventListener(s,"mousedown",this.mousedown),P.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let Ts;function br(m,s,u){const f=new l.N(m.lng,m.lat);if(m=new l.N(m.lng,m.lat),s){const g=new l.N(m.lng-360,m.lat),y=new l.N(m.lng+360,m.lat),A=u.locationPoint(m).distSqr(s);u.locationPoint(g).distSqr(s)<A?m=g:u.locationPoint(y).distSqr(s)<A&&(m=y)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m.lng!==f.lng&&u.locationPoint(m).y>u.height/2-u.getHorizon()?m:f}const Jl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yh(m,s,u){const f=m.classList;for(const g in Jl)f.remove(`maplibregl-${u}-anchor-${g}`);f.add(`maplibregl-${u}-anchor-${s}`)}class vh extends l.E{constructor(s){if(super(),this._onKeyPress=u=>{const f=u.code,g=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=u=>{const f=u.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=u=>{var f;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?br(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${Jl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${y}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div");const u=P.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${f}px`),u.setAttributeNS(null,"width",`${g}px`),u.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const y=P.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const A=P.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const C=P.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ht of B){const ft=P.createNS("http://www.w3.org/2000/svg","ellipse");ft.setAttributeNS(null,"opacity","0.04"),ft.setAttributeNS(null,"cx","10.5"),ft.setAttributeNS(null,"cy","5.80029008"),ft.setAttributeNS(null,"rx",ht.rx),ft.setAttributeNS(null,"ry",ht.ry),C.appendChild(ft)}const F=P.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const j=P.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(j);const O=P.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const W=P.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(W);const $=P.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const q=P.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=P.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const lt=P.createNS("http://www.w3.org/2000/svg","circle");lt.setAttributeNS(null,"fill","#FFFFFF"),lt.setAttributeNS(null,"cx","5.5"),lt.setAttributeNS(null,"cy","5.5"),lt.setAttributeNS(null,"r","5.4999962"),q.appendChild(Q),q.appendChild(lt),A.appendChild(C),A.appendChild(F),A.appendChild(O),A.appendChild($),A.appendChild(q),u.appendChild(A),u.setAttributeNS(null,"height",f*this._scale+"px"),u.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(u),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),yh(this._element,this._anchor,"marker"),s&&s.className)for(const u of s.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.N.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const u=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var u,f;if(!(!((u=this._map)===null||u===void 0)&&u.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,y=g.terrain.depthAtPoint(this._pos),A=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,A)-y<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/g.transform._pixelPerMeter,B=Math.sin(g.getPitch()*Math.PI/180)*C,F=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),j=g.transform.lngLatToCameraDepth(this._lngLat,A+B)-F>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&j&&this._popup.remove(),this._element.style.opacity=j?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,u){return s===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const Yu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Dc=0,Oc=!1;const vo={maxWidth:100,unit:"metric"};function Fa(m,s,u){const f=u&&u.maxWidth||100,g=m._container.clientHeight/2,y=m.unproject([0,g]),A=m.unproject([f,g]),C=y.distanceTo(A);if(u&&u.unit==="imperial"){const B=3.2808*C;B>5280?Ye(s,f,B/5280,m._getUIString("ScaleControl.Miles")):Ye(s,f,B,m._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Ye(s,f,C/1852,m._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Ye(s,f,C/1e3,m._getUIString("ScaleControl.Kilometers")):Ye(s,f,C,m._getUIString("ScaleControl.Meters"))}function Ye(m,s,u,f){const g=function(y){const A=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/A;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(B){const F=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*F)/F}(C),A*C}(u);m.style.width=s*(g/u)+"px",m.innerHTML=`${g}&nbsp;${f}`}const fi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Nc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function w(m){if(m){if(typeof m=="number"){const s=Math.round(Math.abs(m)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,m),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-m),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(m,0),right:new l.P(-m,0)}}if(m instanceof l.P||Array.isArray(m)){const s=l.P.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(m.center||[0,0]),top:l.P.convert(m.top||[0,0]),"top-left":l.P.convert(m["top-left"]||[0,0]),"top-right":l.P.convert(m["top-right"]||[0,0]),bottom:l.P.convert(m.bottom||[0,0]),"bottom-left":l.P.convert(m["bottom-left"]||[0,0]),"bottom-right":l.P.convert(m["bottom-right"]||[0,0]),left:l.P.convert(m.left||[0,0]),right:l.P.convert(m.right||[0,0])}}return w(new l.P(0,0))}const M=_;c.AJAXError=l.bh,c.Evented=l.E,c.LngLat=l.N,c.MercatorCoordinate=l.Z,c.Point=l.P,c.addProtocol=l.bi,c.config=l.a,c.removeProtocol=l.bj,c.AttributionControl=ll,c.BoxZoomHandler=hs,c.CanvasSource=vi,c.CooperativeGesturesHandler=$l,c.DoubleClickZoomHandler=na,c.DragPanHandler=Xu,c.DragRotateHandler=ru,c.EdgeInsets=Os,c.FullscreenControl=class extends l.E{constructor(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var s;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=u==null?void 0:u.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Me,c.GeolocateControl=class extends l.E{constructor(m){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const u=new l.N(s.coords.longitude,s.coords.latitude),f=s.coords.accuracy,g=this._map.getBearing(),y=l.e({bearing:g},this.options.fitBoundsOptions),A=it.fromLngLat(u,f);this._map.fitBounds(A,y,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const u=new l.N(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Oc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new vh({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Yu,m)}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Ts!==void 0&&!s)return Ts;if(window.navigator.permissions===void 0)return Ts=!!window.navigator.geolocation,Ts;try{Ts=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ts=!!window.navigator.geolocation}return Ts}()})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Dc=0,Oc=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),u=m.coords;return s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),s=m.getSouthEast(),u=m.getNorthEast(),f=s.distanceTo(u),g=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Dc--,Oc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Dc++,Dc>1?(m={maximumAge:6e5,timeout:0},Oc=!0):(m=this.options.positionOptions,Oc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=Ra,c.ImageSource=ei,c.KeyboardHandler=Gs,c.LngLatBounds=it,c.LogoControl=Do,c.Map=class extends Fo{constructor(m){l.bf.mark(l.bg.create);const s=Object.assign(Object.assign({},_h),m);if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ns(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies),{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ti,this._controls=[],this._mapId=l.a4(),this._contextLost=u=>{u.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:u}))},this._contextRestored=u=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:u}))},this._onMapScroll=u=>{if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=s.preserveDrawingBuffer===!0,this._antialias=s.antialias===!0,this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},au),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ot.addThrottleControl(()=>this.isMoving()),this._requestManager=new gt(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let u=!1;const f=zs(g=>{this._trackResize&&!this._removed&&(this.resize(g),this.redraw())},50);this._resizeObserver=new ResizeObserver(g=>{u?f(g):u=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Es(this,s),this._hash=s.hash&&new Ra(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,l.e({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new ll(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new Do,s.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new l.k(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new l.k(`${u.dataType}dataloading`,u))}),this.on("dataabort",u=>{this.fire(new l.k("sourcedataabort",u))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const f=this._controlPositions[s];return s.indexOf("bottom")!==-1?f.insertBefore(u,f.firstChild):f.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,u,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,s,u,f)}resize(m){var s;const u=this._containerDimensions(),f=u[0],g=u[1],y=this._getClampedPixelRatio(f,g);if(this._resizeCanvas(f,g,y),this.painter.resize(f,g,y),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const B=this._getClampedPixelRatio(f,g);this._resizeCanvas(f,g,B),this.painter.resize(f,g,B)}this.transform.resize(f,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(f,g);const A=!this._moving;return A&&(this.stop(),this.fire(new l.k("movestart",m)).fire(new l.k("move",m))),this.fire(new l.k("resize",m)),A&&this.fire(new l.k("moveend",m)),this}_getClampedPixelRatio(m,s){const{0:u,1:f}=this._maxCanvasSize,g=this.getPixelRatio(),y=m*g,A=s*g;return Math.min(y>u?u/y:1,A>f?f/A:1)*g}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(it.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(l.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,s,u){if(m==="mouseenter"||m==="mouseover"){let f=!1;return{layers:s,listener:u,delegates:{mousemove:g=>{const y=s.filter(C=>this.getLayer(C)),A=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];A.length?f||(f=!0,u.call(this,new nn(m,this,g.originalEvent,{features:A}))):f=!1},mouseout:()=>{f=!1}}}}if(m==="mouseleave"||m==="mouseout"){let f=!1;return{layers:s,listener:u,delegates:{mousemove:g=>{const y=s.filter(A=>this.getLayer(A));(y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[]).length?f=!0:f&&(f=!1,u.call(this,new nn(m,this,g.originalEvent)))},mouseout:g=>{f&&(f=!1,u.call(this,new nn(m,this,g.originalEvent)))}}}}{const f=g=>{const y=s.filter(C=>this.getLayer(C)),A=y.length!==0?this.queryRenderedFeatures(g.point,{layers:y}):[];A.length&&(g.features=A,u.call(this,g),delete g.features)};return{layers:s,listener:u,delegates:{[m]:f}}}}_saveDelegatedListener(m,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(s)}_removeDelegatedListener(m,s,u){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const f=this._delegatedListeners[m];for(let g=0;g<f.length;g++){const y=f[g];if(y.listener===u&&y.layers.length===s.length&&y.layers.every(A=>s.includes(A))){for(const A in y.delegates)this.off(A,y.delegates[A]);return void f.splice(g,1)}}}on(m,s,u){if(u===void 0)return super.on(m,s);const f=this._createDelegatedListener(m,typeof s=="string"?[s]:s,u);this._saveDelegatedListener(m,f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(m,s,u){var f=this;if(u===void 0)return super.once(m,s);const g=typeof s=="string"?[s]:s,y=this._createDelegatedListener(m,g,u);for(const A in y.delegates){const C=y.delegates[A];y.delegates[A]=function(){f._removeDelegatedListener(m,g,u),C(...arguments)}}this._saveDelegatedListener(m,y);for(const A in y.delegates)this.once(A,y.delegates[A]);return this}off(m,s,u){return u===void 0?super.off(m,s):(this._removeDelegatedListener(m,typeof s=="string"?[s]:s,u),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let u;const f=m instanceof l.P||Array.isArray(m),g=f?m:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(f?{}:m)||{},g instanceof l.P||typeof g[0]=="number")u=[l.P.convert(g)];else{const y=l.P.convert(g[0]),A=l.P.convert(g[1]);u=[y,new l.P(A.x,y.y),A,new l.P(y.x,A.y),y]}return this.style.queryRenderedFeatures(u,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,s));const u=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new pn(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,s,u):this.style.loadJSON(m,s,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new pn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const u=this._requestManager.transformRequest(m,"Style");l.h(u,new AbortController).then(f=>{this._updateDiff(f.data,s)}).catch(f=>{f&&this.fire(new l.j(f))})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m,s)&&this._update(!0)}catch(u){l.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new l.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const s=this.style.sourceCaches[m.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&s.reload();for(const u in this.style._layers){const f=this.style._layers[u];f.type==="hillshade"&&f.source===m.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gh(this.painter,s,m),this.painter.renderToTexture=new ou(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:m})),this}getTerrain(){var m,s;return(s=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const u=m[s]._tiles;for(const f in u){const g=u[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:f=1,sdf:g=!1,stretchX:y,stretchY:A,content:C,textFitWidth:B,textFitHeight:F}=u;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:j,height:O,data:W}=s,$=s;return this.style.addImage(m,{data:new l.R({width:j,height:O},new Uint8Array(W)),pixelRatio:f,stretchX:y,stretchY:A,content:C,textFitWidth:B,textFitHeight:F,sdf:g,version:0,userImage:$}),$.onAdd&&$.onAdd(this,m),this}}{const{width:j,height:O,data:W}=T.getImageData(s);this.style.addImage(m,{data:new l.R({width:j,height:O},W),pixelRatio:f,stretchX:y,stretchY:A,content:C,textFitWidth:B,textFitHeight:F,sdf:g,version:0})}}updateImage(m,s){const u=this.style.getImage(m);if(!u)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=s instanceof HTMLImageElement||l.b(s)?T.getImageData(s):s,{width:g,height:y,data:A}=f;if(g===void 0||y===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==u.data.width||y!==u.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(s instanceof HTMLImageElement||l.b(s));return u.data.replace(A,C),this.style.updateImage(m,u),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ot.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,s,u){return this.style.setLayerZoomRange(m,s,u),this._update(!0)}setFilter(m,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(m,s,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,u){let f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(m,s,u,f),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,u){let f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(m,s,u,f),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setGlyphs(m){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(m,s,u,f=>{f||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(m,s,u=>{u||this._update(!0)}),this}setLight(m){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const s=this._canvasContainer=P.create("div","maplibregl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),f=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],f);const g=this._controlContainer=P.create("div","maplibregl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{y[A]=P.create("div",`maplibregl-ctrl-${A} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s,u){this._canvas.width=Math.floor(u*m),this._canvas.height=Math.floor(u*s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{s={requestedAttributes:m},f&&(s.statusMessage=f.statusMessage,s.type=f.type)},{once:!0});const u=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!u){const f="Failed to initialize WebGL";throw s?(s.message=f,new Error(JSON.stringify(s))):new Error(f)}this.painter=new go(u,this.transform),I.testSupport(u)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,y=T.now();this.style.zoomHistory.update(g,y);const A=new l.z(g,{now:y,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=A.crossFadingFactor();C===1&&C===this._crossFadingFactor||(u=!0,this._crossFadingFactor=C),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ot.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(m=>{l.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Fc}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=nn,c.MapTouchEvent=Ro,c.MapWheelEvent=Kh,c.Marker=vh,c.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const s=this._map.getZoom(),u=s===this._map.getMaxZoom(),f=s===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,u)=>{const f=this._map._getUIString(`NavigationControl.${u}`);s.title=f,s.setAttribute("aria-label",f)},this.options=l.e({},lu,m),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $u(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const u=P.create("button",m,this._container);return u.type="button",u.addEventListener("click",s),u}},c.Popup=class extends l.E{constructor(m){super(),this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?br(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!s)return;const f=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const y=w(this.options.offset);if(!g){const C=this._container.offsetWidth,B=this._container.offsetHeight;let F;F=f.y+y.bottom.y<B?["top"]:f.y>this._map.transform.height-B?["bottom"]:[],f.x<C/2?F.push("left"):f.x>this._map.transform.width-C/2&&F.push("right"),g=F.length===0?"bottom":F.join("-")}let A=f.add(y[g]);this.options.subpixelPositioning||(A=A.round()),P.setTransform(this._container,`${Jl[g]} translate(${A.x}px,${A.y}px)`),yh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(fi),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),u=document.createElement("body");let f;for(u.innerHTML=m;f=u.firstChild,f;)s.appendChild(f);return this.setDOMContent(s)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Nc);m&&m.focus()}},c.RasterDEMTileSource=Ee,c.RasterTileSource=de,c.ScaleControl=class{constructor(m){this._onMove=()=>{Fa(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Fa(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},vo),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=As,c.Style=pn,c.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=Zl,c.TwoFingersTouchRotateHandler=eu,c.TwoFingersTouchZoomHandler=Bc,c.TwoFingersTouchZoomRotateHandler=nu,c.VectorTileSource=Ke,c.VideoSource=Si,c.addSourceType=(m,s)=>l._(void 0,void 0,void 0,function*(){if(zi(m))throw new Error(`A source type called "${m}" already exists.`);((u,f)=>{Ri[u]=f})(m,s)}),c.clearPrewarmedResources=function(){const m=Ht;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Tt),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return ke().getRTLTextPluginStatus()},c.getVersion=function(){return M},c.getWorkerCount=function(){return jt.workerCount},c.getWorkerUrl=function(){return l.a.WORKER_URL},c.importScriptInWorkers=function(m){return Le().broadcast("IS",m)},c.prewarm=function(){$t().acquire(Tt)},c.setMaxParallelImageRequests=function(m){l.a.MAX_PARALLEL_IMAGE_REQUESTS=m},c.setRTLTextPlugin=function(m,s){return ke().setRTLTextPlugin(m,s)},c.setWorkerCount=function(m){jt.workerCount=m},c.setWorkerUrl=function(m){l.a.WORKER_URL=m}});var o=e;return o})})(S3);var E3=S3.exports;const ms=Mg(E3);var vs;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(vs||(vs={}));const kp=4,Fp=4,Tf=4,Nh=new Int32Array(2),g2=new Float32Array(Nh.buffer),_2=new Float64Array(Nh.buffer),cm=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var iy;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(iy||(iy={}));class nh{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new nh(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Nh[0]=this.readInt32(t),g2[0]}readFloat64(t){return Nh[cm?0:1]=this.readInt32(t),Nh[cm?1:0]=this.readInt32(t+4),_2[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){g2[0]=e,this.writeInt32(t,Nh[0])}writeFloat64(t,e){_2[0]=e,this.writeInt32(t,Nh[cm?0:1]),this.writeInt32(t+4,Nh[cm?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+kp+Fp)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<Fp;e++)t+=String.fromCharCode(this.readInt8(this.position_+kp+e));return t}__offset(t,e){const r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const r=this.readInt32(t);t+=kp;const n=this.bytes_.subarray(t,t+r);return e===iy.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+kp}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=Fp)throw new Error("FlatBuffers: file identifier must be length "+Fp);for(let e=0;e<Fp;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+kp+e))return!1;return!0}createScalarList(t,e){const r=[];for(let n=0;n<e;++n){const o=t(n);o!==null&&r.push(o)}return r}createObjList(t,e){const r=[];for(let n=0;n<e;++n){const o=t(n);o!==null&&r.push(o.unpack())}return r}}let mP=class Uo{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometry(t,e){return(e||new Uo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometry(t,e){return t.setPosition(t.position()+Tf),(e||new Uo).__init(t.readInt32(t.position())+t.position(),t)}ends(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+t*4):0}endsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}endsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}xy(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}xyLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}xyArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}z(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}zLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}zArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}m(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}mLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}mArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}t(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}tLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}tArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}tm(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+t*8):BigInt(0)}tmLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):vs.Unknown}parts(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new Uo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}partsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometry(t){t.startObject(8)}static addEnds(t,e){t.addFieldOffset(0,e,0)}static createEndsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addInt32(e[r]);return t.endVector()}static startEndsVector(t,e){t.startVector(4,e,4)}static addXy(t,e){t.addFieldOffset(1,e,0)}static createXyVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startXyVector(t,e){t.startVector(8,e,8)}static addZ(t,e){t.addFieldOffset(2,e,0)}static createZVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startZVector(t,e){t.startVector(8,e,8)}static addM(t,e){t.addFieldOffset(3,e,0)}static createMVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startMVector(t,e){t.startVector(8,e,8)}static addT(t,e){t.addFieldOffset(4,e,0)}static createTVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startTVector(t,e){t.startVector(8,e,8)}static addTm(t,e){t.addFieldOffset(5,e,0)}static createTmVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addInt64(e[r]);return t.endVector()}static startTmVector(t,e){t.startVector(8,e,8)}static addType(t,e){t.addFieldInt8(6,e,vs.Unknown)}static addParts(t,e){t.addFieldOffset(7,e,0)}static createPartsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startPartsVector(t,e){t.startVector(4,e,4)}static endGeometry(t){return t.endObject()}static createGeometry(t,e,r,n,o,c,l,_,v){return Uo.startGeometry(t),Uo.addEnds(t,e),Uo.addXy(t,r),Uo.addZ(t,n),Uo.addM(t,o),Uo.addT(t,c),Uo.addTm(t,l),Uo.addType(t,_),Uo.addParts(t,v),Uo.endGeometry(t)}};function ry(i,t){const e=[];for(let r=0;r<i.length;r+=2){const n=[i[r],i[r+1]];t&&n.push(t[r>>1]),e.push(n)}return e}function y2(i,t,e){if(!e||e.length===0)return[ry(i,t)];let r=0;const n=Array.from(e).map(c=>i.slice(r,r=c<<1));let o;return t&&(r=0,o=Array.from(e).map(c=>t.slice(r,r=c))),n.map((c,l)=>ry(c,o?o[l]:void 0))}function gP(i,t){const e=i.xyArray(),r=i.zArray();switch(t){case vs.Point:{const n=Array.from(e);return r&&n.push(r[0]),n}case vs.MultiPoint:case vs.LineString:return ry(e,r);case vs.MultiLineString:return y2(e,r,i.endsArray());case vs.Polygon:return y2(e,r,i.endsArray())}}function ny(i,t){let e=t;if(e===vs.Unknown&&(e=i.type()),e===vs.GeometryCollection){const n=[];for(let o=0;o<i.partsLength();o++){const c=i.parts(o),l=c.type();n.push(ny(c,l))}return{type:vs[e],geometries:n}}else if(e===vs.MultiPolygon){const n=[];for(let o=0;o<i.partsLength();o++)n.push(ny(i.parts(o),vs.Polygon));return{type:vs[e],coordinates:n.map(o=>o.coordinates)}}const r=gP(i,e);return{type:vs[e],coordinates:r}}var _s;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(_s||(_s={}));class gs{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsColumn(t,e){return(e||new gs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsColumn(t,e){return t.setPosition(t.position()+Tf),(e||new gs).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}type(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):_s.Byte}title(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}width(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1}precision(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1}scale(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1}nullable(){const t=this.bb.__offset(this.bb_pos,18);return t?!!this.bb.readInt8(this.bb_pos+t):!0}unique(){const t=this.bb.__offset(this.bb_pos,20);return t?!!this.bb.readInt8(this.bb_pos+t):!1}primaryKey(){const t=this.bb.__offset(this.bb_pos,22);return t?!!this.bb.readInt8(this.bb_pos+t):!1}metadata(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}static startColumn(t){t.startObject(11)}static addName(t,e){t.addFieldOffset(0,e,0)}static addType(t,e){t.addFieldInt8(1,e,_s.Byte)}static addTitle(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWidth(t,e){t.addFieldInt32(4,e,-1)}static addPrecision(t,e){t.addFieldInt32(5,e,-1)}static addScale(t,e){t.addFieldInt32(6,e,-1)}static addNullable(t,e){t.addFieldInt8(7,+e,1)}static addUnique(t,e){t.addFieldInt8(8,+e,0)}static addPrimaryKey(t,e){t.addFieldInt8(9,+e,0)}static addMetadata(t,e){t.addFieldOffset(10,e,0)}static endColumn(t){const e=t.endObject();return t.requiredField(e,4),e}static createColumn(t,e,r,n,o,c,l,_,v,S,T,P){return gs.startColumn(t),gs.addName(t,e),gs.addType(t,r),gs.addTitle(t,n),gs.addDescription(t,o),gs.addWidth(t,c),gs.addPrecision(t,l),gs.addScale(t,_),gs.addNullable(t,v),gs.addUnique(t,S),gs.addPrimaryKey(t,T),gs.addMetadata(t,P),gs.endColumn(t)}}class yl{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFeature(t,e){return(e||new yl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFeature(t,e){return t.setPosition(t.position()+Tf),(e||new yl).__init(t.readInt32(t.position())+t.position(),t)}geometry(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new mP).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}properties(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0}propertiesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}propertiesArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}columns(t,e){const r=this.bb.__offset(this.bb_pos,8);return r?(e||new gs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFeature(t){t.startObject(3)}static addGeometry(t,e){t.addFieldOffset(0,e,0)}static addProperties(t,e){t.addFieldOffset(1,e,0)}static createPropertiesVector(t,e){t.startVector(1,e.length,1);for(let r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()}static startPropertiesVector(t,e){t.startVector(1,e,1)}static addColumns(t,e){t.addFieldOffset(2,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static endFeature(t){return t.endObject()}static finishFeatureBuffer(t,e){t.finish(e)}static finishSizePrefixedFeatureBuffer(t,e){t.finish(e,void 0,!0)}static createFeature(t,e,r,n){return yl.startFeature(t),yl.addGeometry(t,e),yl.addProperties(t,r),yl.addColumns(t,n),yl.endFeature(t)}}new TextEncoder;const v2=new TextDecoder;function _P(i,t){const e={};if(!t||t.length===0)return e;const r=i.propertiesArray();if(!r)return e;const n=new DataView(r.buffer,r.byteOffset),o=i.propertiesLength();let c=0;for(;c<o;){const l=n.getUint16(c,!0);c+=2;const _=t[l],v=_.name;switch(_.type){case _s.Bool:{e[v]=!!n.getUint8(c),c+=1;break}case _s.Byte:{e[v]=n.getInt8(c),c+=1;break}case _s.UByte:{e[v]=n.getUint8(c),c+=1;break}case _s.Short:{e[v]=n.getInt16(c,!0),c+=2;break}case _s.UShort:{e[v]=n.getUint16(c,!0),c+=2;break}case _s.Int:{e[v]=n.getInt32(c,!0),c+=4;break}case _s.UInt:{e[v]=n.getUint32(c,!0),c+=4;break}case _s.Long:{e[v]=Number(n.getBigInt64(c,!0)),c+=8;break}case _s.ULong:{e[v]=Number(n.getBigUint64(c,!0)),c+=8;break}case _s.Float:{e[v]=n.getFloat32(c,!0),c+=4;break}case _s.Double:{e[v]=n.getFloat64(c,!0),c+=8;break}case _s.DateTime:case _s.String:{const S=n.getUint32(c,!0);c+=4,e[v]=v2.decode(r.subarray(c,c+S)),c+=S;break}case _s.Json:{const S=n.getUint32(c,!0);c+=4;const T=v2.decode(r.subarray(c,c+S));e[v]=JSON.parse(T),c+=S;break}default:throw new Error("Unknown type "+_.type)}}return e}function m1(i,t){const e=t.columns;return{type:"Feature",geometry:ny(i.geometry(),t.geometryType),properties:_P(i,e)}}const g1=new Uint8Array(0);function yP(){return this._source.cancel()}function vP(i,t){if(!i.length)return t;if(!t.length)return i;var e=new Uint8Array(i.length+t.length);return e.set(i),e.set(t,i.length),e}function bP(){var i=this,t=i._array.subarray(i._index);return i._source.read().then(function(e){return i._array=g1,i._index=0,e.done?t.length>0?{done:!1,value:t}:{done:!0,value:void 0}:{done:!1,value:vP(t,e.value)}})}function xP(i){if((i|=0)<0)throw new Error("invalid length");var t=this,e=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function n(){return t._source.read().then(function(o){return o.done?(t._array=g1,t._index=0,e>0?r.subarray(0,e):null):e+o.value.length>=i?(t._array=o.value,t._index=i-e,r.set(o.value.subarray(0,i-e),e),r):(r.set(o.value,e),e+=o.value.length,n())})}()}function wP(i){return typeof i.slice=="function"?i:new Bg(typeof i.read=="function"?i:i.getReader())}function Bg(i){this._source=i,this._array=g1,this._index=0}Bg.prototype.read=bP;Bg.prototype.slice=xP;Bg.prototype.cancel=yP;class Va{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCrs(t,e){return(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCrs(t,e){return t.setPosition(t.position()+Tf),(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}org(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}code(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}name(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null}wkt(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null}codeString(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null}static startCrs(t){t.startObject(6)}static addOrg(t,e){t.addFieldOffset(0,e,0)}static addCode(t,e){t.addFieldInt32(1,e,0)}static addName(t,e){t.addFieldOffset(2,e,0)}static addDescription(t,e){t.addFieldOffset(3,e,0)}static addWkt(t,e){t.addFieldOffset(4,e,0)}static addCodeString(t,e){t.addFieldOffset(5,e,0)}static endCrs(t){return t.endObject()}static createCrs(t,e,r,n,o,c,l){return Va.startCrs(t),Va.addOrg(t,e),Va.addCode(t,r),Va.addName(t,n),Va.addDescription(t,o),Va.addWkt(t,c),Va.addCodeString(t,l),Va.endCrs(t)}}class og{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsHeader(t,e){return(e||new og).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsHeader(t,e){return t.setPosition(t.position()+Tf),(e||new og).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}envelope(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+t*8):0}envelopeLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}envelopeArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}geometryType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):vs.Unknown}hasZ(){const t=this.bb.__offset(this.bb_pos,10);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasM(){const t=this.bb.__offset(this.bb_pos,12);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasT(){const t=this.bb.__offset(this.bb_pos,14);return t?!!this.bb.readInt8(this.bb_pos+t):!1}hasTm(){const t=this.bb.__offset(this.bb_pos,16);return t?!!this.bb.readInt8(this.bb_pos+t):!1}columns(t,e){const r=this.bb.__offset(this.bb_pos,18);return r?(e||new gs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+t*4),this.bb):null}columnsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}featuresCount(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):BigInt("0")}indexNodeSize(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16}crs(t){const e=this.bb.__offset(this.bb_pos,24);return e?(t||new Va).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}title(t){const e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null}description(t){const e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null}metadata(t){const e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null}static startHeader(t){t.startObject(14)}static addName(t,e){t.addFieldOffset(0,e,0)}static addEnvelope(t,e){t.addFieldOffset(1,e,0)}static createEnvelopeVector(t,e){t.startVector(8,e.length,8);for(let r=e.length-1;r>=0;r--)t.addFloat64(e[r]);return t.endVector()}static startEnvelopeVector(t,e){t.startVector(8,e,8)}static addGeometryType(t,e){t.addFieldInt8(2,e,vs.Unknown)}static addHasZ(t,e){t.addFieldInt8(3,+e,0)}static addHasM(t,e){t.addFieldInt8(4,+e,0)}static addHasT(t,e){t.addFieldInt8(5,+e,0)}static addHasTm(t,e){t.addFieldInt8(6,+e,0)}static addColumns(t,e){t.addFieldOffset(7,e,0)}static createColumnsVector(t,e){t.startVector(4,e.length,4);for(let r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()}static startColumnsVector(t,e){t.startVector(4,e,4)}static addFeaturesCount(t,e){t.addFieldInt64(8,e,BigInt("0"))}static addIndexNodeSize(t,e){t.addFieldInt16(9,e,16)}static addCrs(t,e){t.addFieldOffset(10,e,0)}static addTitle(t,e){t.addFieldOffset(11,e,0)}static addDescription(t,e){t.addFieldOffset(12,e,0)}static addMetadata(t,e){t.addFieldOffset(13,e,0)}static endHeader(t){return t.endObject()}static finishHeaderBuffer(t,e){t.finish(e)}static finishSizePrefixedHeaderBuffer(t,e){t.finish(e,void 0,!0)}}function _1(i){const t=og.getRootAsHeader(i),e=t.featuresCount(),r=t.indexNodeSize(),n=[];for(let l=0;l<t.columnsLength();l++){const _=t.columns(l);if(!_)throw new Error("Column unexpectedly missing");if(!_.name())throw new Error("Column name unexpectedly missing");n.push({name:_.name(),type:_.type(),title:_.title(),description:_.description(),width:_.width(),precision:_.precision(),scale:_.scale(),nullable:_.nullable(),unique:_.unique(),primary_key:_.primaryKey()})}const o=t.crs(),c=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:t.geometryType(),columns:n,envelope:null,featuresCount:Number(e),indexNodeSize:r,crs:c,title:t.title(),description:t.description(),metadata:t.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var sy=function(i,t){return sy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},sy(i,t)};function SP(i,t){sy(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function qd(i,t,e,r){function n(o){return o instanceof e?o:new e(function(c){c(o)})}return new(e||(e=Promise))(function(o,c){function l(S){try{v(r.next(S))}catch(T){c(T)}}function _(S){try{v(r.throw(S))}catch(T){c(T)}}function v(S){S.done?o(S.value):n(S.value).then(l,_)}v((r=r.apply(i,[])).next())})}function qh(i,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(v){return function(S){return _([v,S])}}function _(v){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,n&&(o=v[0]&2?n.return:v[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,v[1])).done)return o;switch(n=0,o&&(v=[v[0]&2,o.value]),v[0]){case 0:case 1:o=v;break;case 4:return e.label++,{value:v[1],done:!1};case 5:e.label++,n=v[1],v=[0];continue;case 7:v=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(v[0]===6||v[0]===2)){e=0;continue}if(v[0]===3&&(!o||v[1]>o[0]&&v[1]<o[3])){e.label=v[1];break}if(v[0]===6&&e.label<o[1]){e.label=o[1],o=v;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(v);break}o[2]&&e.ops.pop(),e.trys.pop();continue}v=t.call(i,e)}catch(S){v=[6,S],n=0}finally{r=o=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}function ep(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],r=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function df(i){return this instanceof df?(this.v=i,this):new df(i)}function AP(i,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(i,t||[]),n,o=[];return n={},c("next"),c("throw"),c("return"),n[Symbol.asyncIterator]=function(){return this},n;function c(P){r[P]&&(n[P]=function(I){return new Promise(function(z,N){o.push([P,I,z,N])>1||l(P,I)})})}function l(P,I){try{_(r[P](I))}catch(z){T(o[0][3],z)}}function _(P){P.value instanceof df?Promise.resolve(P.value.v).then(v,S):T(o[0][2],P)}function v(P){l("next",P)}function S(P){l("throw",P)}function T(P,I){P(I),o.shift(),o.length&&l(o[0][0],o[0][1])}}var T3=function(i){SP(t,i);function t(e){var r=i.call(this,e)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return t}(Error);(function(){function i(t){if(t<0)throw new RangeError("Capacity may not be less than 0");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(t){if(this.full)throw new Error("Buffer full");this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){for(;this._q.length>=this._c;)this._q.shift();this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();(function(){function i(t){if(t<1)throw new RangeError("Capacity may not be less than 1");this._c=t,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(t){this._q.length<this._c&&this._q.push(t)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})();function oy(i){i!=null&&typeof i.then=="function"&&i.then(cg,cg)}var z0=0,b2=1,Du=2,ag=3,ay=4,lg=1024,cg=function(){};function kd(i){var t=i.err,e=Promise.resolve(i.execution).then(function(r){if(t!=null)throw t;return r});return i.err=void 0,i.execution=e.then(function(){},function(){}),i.pending===void 0?e:i.pending.then(function(){return e})}function Au(i,t){var e=i.state>=ag;return Promise.resolve(t).then(function(r){return!e&&i.state>=ay?kd(i).then(function(n){return{value:n,done:!0}}):{value:r,done:e}})}function y1(i,t){var e,r;if(!(i.state>=Du))if(i.state=Du,i.onnext(),i.onstop(),i.err==null&&(i.err=t),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))rf(i);else try{for(var n=ep(i.pushes),o=n.next();!o.done;o=n.next()){var c=o.value;c.resolve()}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}}function rf(i){var t,e;if(!(i.state>=ag)){i.state<Du&&y1(i),i.state=ag,i.buffer=void 0;try{for(var r=ep(i.nexts),n=r.next();!n.done;n=r.next()){var o=n.value,c=i.pending===void 0?kd(i):i.pending.then(function(){return kd(i)});o.resolve(Au(i,c))}}catch(l){t={error:l}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}i.pushes=[],i.nexts=[]}}function x2(i){i.state>=ay||(i.state<ag&&rf(i),i.state=ay)}function EP(i,t){if(oy(t),i.pushes.length>=lg)throw new T3("No more than "+lg+" pending calls to push are allowed on a single repeater.");if(i.state>=Du)return Promise.resolve(void 0);var e=i.pending===void 0?Promise.resolve(t):i.pending.then(function(){return t});e=e.catch(function(_){i.state<Du&&(i.err=_),x2(i)});var r;if(i.nexts.length){var n=i.nexts.shift();n.resolve(Au(i,e)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(_){return i.onnext=_})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(e),r=Promise.resolve(void 0)):r=new Promise(function(_){return i.pushes.push({resolve:_,value:e})});var o=!0,c={},l=r.catch(function(_){if(o)throw _});return c.then=function(_,v){return o=!1,Promise.prototype.then.call(r,_,v)},c.catch=function(_){return o=!1,Promise.prototype.catch.call(r,_)},c.finally=r.finally.bind(r),i.pending=e.then(function(){return l}).catch(function(_){i.err=_,x2(i)}),c}function TP(i){var t=y1.bind(null,i),e=new Promise(function(r){return i.onstop=r});return t.then=e.then.bind(e),t.catch=e.catch.bind(e),t.finally=e.finally.bind(e),t}function CP(i){if(!(i.state>=b2)){i.state=b2;var t=EP.bind(null,i),e=TP(i);i.execution=new Promise(function(r){return r(i.executor(t,e))}),i.execution.catch(function(){return y1(i)})}}var hm=new WeakMap,Cf=function(){function i(t,e){hm.set(this,{executor:t,buffer:e,err:void 0,state:z0,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:cg,onstop:cg})}return i.prototype.next=function(t){oy(t);var e=hm.get(this);if(e===void 0)throw new Error("WeakMap error");if(e.nexts.length>=lg)throw new T3("No more than "+lg+" pending calls to next are allowed on a single repeater.");if(e.state<=z0&&CP(e),e.onnext(t),typeof e.buffer<"u"&&!e.buffer.empty){var r=Au(e,e.buffer.remove());if(e.pushes.length){var n=e.pushes.shift();e.buffer.add(n.value),e.onnext=n.resolve}return r}else if(e.pushes.length){var o=e.pushes.shift();return e.onnext=o.resolve,Au(e,o.value)}else if(e.state>=Du)return rf(e),Au(e,kd(e));return new Promise(function(c){return e.nexts.push({resolve:c,value:t})})},i.prototype.return=function(t){oy(t);var e=hm.get(this);if(e===void 0)throw new Error("WeakMap error");return rf(e),e.execution=Promise.resolve(e.execution).then(function(){return t}),Au(e,kd(e))},i.prototype.throw=function(t){var e=hm.get(this);if(e===void 0)throw new Error("WeakMap error");return e.state<=z0||e.state>=Du||typeof e.buffer<"u"&&!e.buffer.empty?(rf(e),e.err==null&&(e.err=t),Au(e,kd(e))):this.next(Promise.reject(t))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=PP,i.merge=IP,i.zip=LP,i.latest=MP,i}();function Rg(i,t){var e,r,n=[],o=function(v){v!=null&&typeof v[Symbol.asyncIterator]=="function"?n.push(v[Symbol.asyncIterator]()):v!=null&&typeof v[Symbol.iterator]=="function"?n.push(v[Symbol.iterator]()):n.push(function(){return AP(this,arguments,function(){return qh(this,function(S){switch(S.label){case 0:return t.yieldValues?[4,df(v)]:[3,3];case 1:return[4,S.sent()];case 2:S.sent(),S.label=3;case 3:return t.returnValues?[4,df(v)]:[3,5];case 4:return[2,S.sent()];case 5:return[2]}})})}())};try{for(var c=ep(i),l=c.next();!l.done;l=c.next()){var _=l.value;o(_)}}catch(v){e={error:v}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}return n}function PP(i){var t=this,e=Rg(i,{returnValues:!0});return new Cf(function(r,n){return qd(t,void 0,void 0,function(){var o,c,l,_,v,S;return qh(this,function(T){switch(T.label){case 0:if(!e.length)return n(),[2];c=!1,n.then(function(){o(),c=!0}),T.label=1;case 1:T.trys.push([1,,5,7]),_=void 0,v=0,S=function(){var P,I,z,N,X,H;return qh(this,function(Z){switch(Z.label){case 0:P=v;try{for(I=(X=void 0,ep(e)),z=I.next();!z.done;z=I.next())N=z.value,Promise.resolve(N.next()).then(function(ot){ot.done?(n(),l===void 0&&(l=ot)):v===P&&(v++,o(ot))},function(ot){return n(ot)})}catch(ot){X={error:ot}}finally{try{z&&!z.done&&(H=I.return)&&H.call(I)}finally{if(X)throw X.error}}return[4,new Promise(function(ot){return o=ot})];case 1:return _=Z.sent(),_===void 0?[3,3]:[4,r(_.value)];case 2:Z.sent(),Z.label=3;case 3:return[2]}})},T.label=2;case 2:return c?[3,4]:[5,S()];case 3:return T.sent(),[3,2];case 4:return[2,l&&l.value];case 5:return n(),[4,Promise.race(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}function IP(i){var t=this,e=Rg(i,{yieldValues:!0});return new Cf(function(r,n){return qd(t,void 0,void 0,function(){var o,c,l,_=this;return qh(this,function(v){switch(v.label){case 0:if(!e.length)return n(),[2];o=[],c=!1,n.then(function(){var S,T;c=!0;try{for(var P=ep(o),I=P.next();!I.done;I=P.next()){var z=I.value;z()}}catch(N){S={error:N}}finally{try{I&&!I.done&&(T=P.return)&&T.call(P)}finally{if(S)throw S.error}}}),v.label=1;case 1:return v.trys.push([1,,3,4]),[4,Promise.all(e.map(function(S,T){return qd(_,void 0,void 0,function(){var P,I;return qh(this,function(z){switch(z.label){case 0:z.trys.push([0,,6,9]),z.label=1;case 1:return c?[3,5]:(Promise.resolve(S.next()).then(function(N){return o[T](N)},function(N){return n(N)}),[4,new Promise(function(N){o[T]=N})]);case 2:return P=z.sent(),P===void 0?[3,4]:P.done?(l=P,[2]):[4,r(P.value)];case 3:z.sent(),z.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return I=S.return,I?[4,S.return()]:[3,8];case 7:I=z.sent(),z.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return v.sent(),[2,l&&l.value];case 3:return n(),[7];case 4:return[2]}})})})}function LP(i){var t=this,e=Rg(i,{returnValues:!0});return new Cf(function(r,n){return qd(t,void 0,void 0,function(){var o,c,l,_;return qh(this,function(v){switch(v.label){case 0:if(!e.length)return n(),[2,[]];c=!1,n.then(function(){o(),c=!0}),v.label=1;case 1:v.trys.push([1,,6,8]),v.label=2;case 2:return c?[3,5]:(Promise.all(e.map(function(S){return S.next()})).then(function(S){return o(S)},function(S){return n(S)}),[4,new Promise(function(S){return o=S})]);case 3:return l=v.sent(),l===void 0?[2]:(_=l.map(function(S){return S.value}),l.some(function(S){return S.done})?[2,_]:[4,r(_)]);case 4:return v.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(e.map(function(S){return S.return&&S.return()}))];case 7:return v.sent(),[7];case 8:return[2]}})})})}function MP(i){var t=this,e=Rg(i,{yieldValues:!0,returnValues:!0});return new Cf(function(r,n){return qd(t,void 0,void 0,function(){var o,c,l,_,v,S=this;return qh(this,function(T){switch(T.label){case 0:if(!e.length)return n(),[2,[]];c=[],l=!1,n.then(function(){var P,I;o();try{for(var z=ep(c),N=z.next();!N.done;N=z.next()){var X=N.value;X()}}catch(H){P={error:H}}finally{try{N&&!N.done&&(I=z.return)&&I.call(z)}finally{if(P)throw P.error}}l=!0}),T.label=1;case 1:return T.trys.push([1,,5,7]),Promise.all(e.map(function(P){return P.next()})).then(function(P){return o(P)},function(P){return n(P)}),[4,new Promise(function(P){return o=P})];case 2:return _=T.sent(),_===void 0?[2]:(v=_.map(function(P){return P.value}),_.every(function(P){return P.done})?[2,v]:[4,r(v.slice())]);case 3:return T.sent(),[4,Promise.all(e.map(function(P,I){return qd(S,void 0,void 0,function(){var z;return qh(this,function(N){switch(N.label){case 0:if(_[I].done)return[2,_[I].value];N.label=1;case 1:return l?[3,4]:(Promise.resolve(P.next()).then(function(X){return c[I](X)},function(X){return n(X)}),[4,new Promise(function(X){return c[I]=X})]);case 2:return z=N.sent(),z===void 0?[2,_[I].value]:z.done?[2,z.value]:(v[I]=z.value,[4,r(v.slice())]);case 3:return N.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,T.sent()];case 5:return n(),[4,Promise.all(e.map(function(P){return P.return&&P.return()}))];case 6:return T.sent(),[7];case 7:return[2]}})})})}let hg=class{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(i){if(i<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=i}};hg.global=new hg;var _l;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(_l||(_l={}));class bs{static debug(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(_l.Debug,...e)}static info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(_l.Info,...e)}static warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(_l.Warn,...e)}static error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.log(_l.Error,...e)}static log(t){if(!(this.logLevel>t)){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];switch(t){case _l.Debug:{console.debug(...r);break}case _l.Info:{console.info(...r);break}case _l.Warn:{console.warn(...r);break}case _l.Error:{console.error(...r);break}}}}}bs.logLevel=_l.Warn;const Eu=8*4+8,BP=16;function v1(i,t){t=Math.min(Math.max(+t,2),65535);let e=i,r=e;do e=Math.ceil(e/t),r+=e;while(e!==1);return r*Eu}function RP(i,t){if(t<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let e=i,r=e;const n=[e];do e=Math.ceil(e/t),r+=e,n.push(e);while(e!==1);const o=[];e=r;for(const l of n)o.push(e-l),e-=l;const c=[];for(let l=0;l<n.length;l++)c.push([o[l],o[l]+n[l]]);return c}async function*kP(i,t,e,r){class n{constructor(I,z){this._level=z,this.nodes=I}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(I){console.assert(I>this.nodes[1]),this.nodes[1]=I}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:o,minY:c,maxX:l,maxY:_}=e;bs.info(`tree items: ${i}, nodeSize: ${t}`);const v=RP(i,t),S=v[0][0],T=[(()=>{const P=[0,1],I=v.length-1;return new n(P,I)})()];for(bs.debug(`starting stream search with queue: ${T}, numItems: ${i}, nodeSize: ${t}, levelBounds: ${v}`);T.length!=0;){const P=T.shift();bs.debug(`popped node: ${P}, queueLength: ${T.length}`);const I=P.startNodeIdx(),z=I>=S,N=(()=>{const[,ot]=v[P.level()],gt=Math.min(P.endNodeIdx()+t,ot);return z&&gt<ot?gt+1:gt})(),X=N-I,H=await r(I*Eu,X*Eu),Z=new DataView(H);for(let ot=I;ot<N;ot++){const gt=ot-I,Et=gt*Eu;if(l<Z.getFloat64(Et+0,!0)||_<Z.getFloat64(Et+8,!0)||o>Z.getFloat64(Et+16,!0)||c>Z.getFloat64(Et+24,!0))continue;const Ft=Z.getBigUint64(Et+32,!0);if(z){const at=Ft,pt=(()=>{if(ot<i-1){const bt=(gt+1)*Eu;return Z.getBigUint64(bt+32,!0)-at}else return null})(),Lt=ot-S;yield[Number(at),Lt,Number(pt)];continue}const Mt=Ft,yt=hg.global.extraRequestThreshold()/Eu,Ut=T[T.length-1];if(Ut!==void 0&&Ut.level()==P.level()-1&&Mt<Ut.endNodeIdx()+yt){bs.debug(`Merging "nodeRange" request into existing range: ${Ut}, newEndNodeIdx: ${Ut.endNodeIdx()} -> ${Mt}`),Ut.extendEndNodeIdx(Number(Mt));continue}const zt=(()=>{const at=P.level()-1,pt=[Number(Mt),Number(Mt)+1];return new n(pt,at)})();Ut!==void 0&&Ut.level()==zt.level()?bs.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Mt} rather than merging with distant ${Ut}`):bs.info(`Pushing new level for ${zt} onto queue with nearestNodeRange: ${Ut} since there's not already a range for this level.`),T.push(zt)}}}const zh=new Uint8Array([102,103,98,3,102,103,98,0]),Kc=4;class b1{constructor(t,e,r,n,o){this.headerClient=t,this.header=e,this.headerLength=r,this.indexLength=n,this.nocache=o}static async open(t,e){const r=new w2(t,e),n=(()=>{const T=BP,P=3;let I=0,z;for(z=0;z<P;z++){const N=T**z*Eu;I+=N}return I})(),o=2024+n;bs.debug(`fetching header. minReqLength: ${o} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const T=new Uint8Array(await r.getRange(0,8,o,"header"));if(!T.subarray(0,3).every((P,I)=>zh[I]===P))throw bs.error(`bytes: ${T} != ${zh}`),new Error("Not a FlatGeobuf file");bs.debug("magic bytes look good")}let c;{const T=await r.getRange(8,4,o,"header");c=new DataView(T).getUint32(0,!0);const P=1048576*10;if(c>P||c<8)throw new Error("Invalid header size");bs.debug(`headerLength: ${c}`)}const l=await r.getRange(12,c,o,"header"),_=new nh(new Uint8Array(l)),v=_1(_),S=v1(v.featuresCount,v.indexNodeSize);return bs.debug("completed: opening http reader"),new b1(r,v,c,S,e)}async*selectBbox(t){const e=this.lengthBeforeTree(),r=this.headerClient,n=async function(_,v){return r.getRange(e+_,v,0,"index")},o=[];let c=[];for await(const _ of kP(this.header.featuresCount,this.header.indexNodeSize,t,n)){const[v,,]=_;let[,,S]=_;if(S||(bs.info("final feature"),S=4),c.length==0){c.push([v,S]);continue}const T=c[c.length-1],P=v-(T[0]+T[1]);P>hg.global.extraRequestThreshold()&&(bs.info(`Pushing new feature batch, since gap ${P} was too large`),o.push(c),c=[]),c.push([v,S])}this.headerClient.logUsage("header+index"),c.length>0&&o.push(c);const l=o.flatMap(_=>this.readFeatureBatch(_,this.nocache));yield*Cf.merge(l)}lengthBeforeTree(){return zh.length+Kc+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(t){return new w2(this.headerClient.httpClient,t)}async*readFeatureBatch(t,e){const[r]=t[0],[n,o]=t[t.length-1],c=r,l=n+o-c,_=this.buildFeatureClient(e);let v=l;for(const[S]of t)yield await this.readFeature(_,S,v),v=0;_.logUsage("feature")}async readFeature(t,e,r){const n=e+this.lengthBeforeFeatures();let o;{const S=await t.getRange(n,4,r,"feature length");o=new DataView(S).getUint32(0,!0)}const c=await t.getRange(n+4,o,r,"feature data"),l=new Uint8Array(c),_=new Uint8Array(o+Kc);_.set(l,Kc);const v=new nh(_);return v.setPosition(Kc),yl.getRootAsFeature(v)}}class w2{constructor(t,e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof t=="string")this.httpClient=new S2(t,e);else if(t instanceof S2)this.httpClient=t;else throw new Error("Unknown source ")}async getRange(t,e,r,n){this.bytesEverUsed+=e;const o=t-this.head,c=o+e;if(o>=0&&c<=this.buffer.byteLength)return this.buffer.slice(o,c);const l=Math.max(e,r);return this.bytesEverFetched+=l,bs.debug(`requesting for new Range: ${t}-${t+l-1}`),this.buffer=await this.httpClient.getRange(t,l,n),this.head=t,this.buffer.slice(0,e)}logUsage(t){const e=t.split(" ")[0],r=this.bytesEverUsed,n=this.bytesEverFetched,o=(100*r/n).toFixed(2);bs.info(`${e} bytes used/requested: ${r} / ${n} = ${o}%`)}}class S2{constructor(t,e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t,this.nocache=e}async getRange(t,e,r){this.requestsEverMade+=1,this.bytesEverRequested+=e;const n=`bytes=${t}-${t+e-1}`;bs.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${e}, ever: ${this.bytesEverRequested}), Range: ${n}`);const o={Range:n};return this.nocache&&(o["Cache-Control"]="no-cache, no-store"),(await fetch(this.url,{headers:o})).arrayBuffer()}}function FP(i,t,e){if(!i.subarray(0,3).every((S,T)=>zh[T]===S))throw new Error("Not a FlatGeobuf file");const r=new nh(i),n=r.readUint32(zh.length);r.setPosition(zh.length+Kc);const o=_1(r);let c=zh.length+Kc+n;const{indexNodeSize:l,featuresCount:_}=o;l>0&&(c+=v1(_,l));const v=[];for(;c<r.capacity();){const S=r.readUint32(c);r.setPosition(c+Kc);const T=yl.getRootAsFeature(r);v.push(t(T,o)),c+=Kc+S}return v}async function*DP(i,t,e){const r=wP(i),n=async P=>await r.slice(P);let o=new Uint8Array(await n(8));if(!o.subarray(0,3).every((P,I)=>zh[I]===P))throw new Error("Not a FlatGeobuf file");o=new Uint8Array(await n(4));let c=new nh(o);const l=c.readUint32(0);o=new Uint8Array(await n(l)),c=new nh(o);const _=_1(c),{indexNodeSize:v,featuresCount:S}=_;if(v>0){const P=v1(S,v);await n(P)}let T;for(;T=await NP(n,_,t);)yield T}function OP(i,t,e,r){try{let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return async function*(){const o=await b1.open(i,n);bs.debug("opened reader");for await(const c of o.selectBbox(t))yield e(c,o.header)}()}catch(n){return Promise.reject(n)}}async function NP(i,t,e){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let n=new nh(r);const o=n.readUint32(0);r=new Uint8Array(await i(o,"feature data"));const c=new Uint8Array(o+4);c.set(r,4),n=new nh(c),n.setPosition(Kc);const l=yl.getRootAsFeature(n);return e(l,t)}function zP(i,t){return{type:"FeatureCollection",features:FP(i,m1)}}function jP(i,t){return DP(i,m1)}function UP(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return OP(i,t,m1,e,r)}function A2(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return i instanceof Uint8Array?zP(i):i instanceof ReadableStream?jP(i):UP(i,t,e,r)}class GP{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(t){this._map=t;let e=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(e._btn.className.indexOf("3d")!=-1){let v={pitch:e._pitch,bearing:e._bearing};e._minpitchzoom&&t.getZoom()>e._minpitchzoom&&(v.zoom=e._minpitchzoom);var r=0,n=38.5,o=6,c=62.33,{longitude:l,latitude:_}=t.getCenter();t.getZoom()<10?t.setTerrain({source:"terrainICGC",exaggeration:1.5}):l>=r&&l<=o&&_>=n&&_<=c?t.setTerrain({source:"terrainICGC",exaggeration:1.2}):t.setTerrain({source:"terrainICGC",exaggeration:1.5}),t.easeTo(v),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else t.setTerrain(null),t.easeTo({pitch:0,bearing:0}),e._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function pf(i){"@babel/helpers - typeof";return pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pf(i)}function VP(i,t){if(pf(i)!="object"||!i)return i;var e=i[Symbol.toPrimitive];if(e!==void 0){var r=e.call(i,t||"default");if(pf(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(i)}function qP(i){var t=VP(i,"string");return pf(t)=="symbol"?t:t+""}function G(i,t,e){return t=qP(t),t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function Xr(i,t){if(!i)throw new Error(t||"loader assertion failed.")}const kg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),E2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);E2&&parseFloat(E2[1]);const HP="3.4.15";function wc(i,t){if(!i)throw new Error(t||"loaders.gl assertion failed.")}const j0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},WP=j0.global||j0.self||j0.window||{},ih=typeof process!="object"||String(process)!=="[object process]"||process.browser,x1=typeof importScripts=="function",XP=typeof window<"u"&&typeof window.orientation<"u",T2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);T2&&parseFloat(T2[1]);class ZP{constructor(t,e){G(this,"name",void 0),G(this,"workerThread",void 0),G(this,"isRunning",!0),G(this,"result",void 0),G(this,"_resolve",()=>{}),G(this,"_reject",()=>{}),this.name=t,this.workerThread=e,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){wc(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){wc(this.isRunning),this.isRunning=!1,this._reject(t)}}let U0=class{terminate(){}};const G0=new Map;function $P(i){wc(i.source&&!i.url||!i.source&&i.url);let t=G0.get(i.source||i.url);return t||(i.url&&(t=YP(i.url),G0.set(i.url,t)),i.source&&(t=C3(i.source),G0.set(i.source,t))),wc(t),t}function YP(i){if(!i.startsWith("http"))return i;const t=JP(i);return C3(t)}function C3(i){const t=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(t)}function JP(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function P3(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const r=e||new Set;if(i){if(C2(i))r.add(i);else if(C2(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)&&t&&typeof i=="object")for(const n in i)P3(i[n],t,r)}return e===void 0?Array.from(r):[]}function C2(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const V0=()=>{};class ly{static isSupported(){return typeof Worker<"u"&&ih||typeof U0<"u"&&!ih}constructor(t){G(this,"name",void 0),G(this,"source",void 0),G(this,"url",void 0),G(this,"terminated",!1),G(this,"worker",void 0),G(this,"onMessage",void 0),G(this,"onError",void 0),G(this,"_loadableURL","");const{name:e,source:r,url:n}=t;wc(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=V0,this.onError=o=>console.log(o),this.worker=ih?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=V0,this.onError=V0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||P3(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=$P({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new U0(e,{eval:!1})}else if(this.source)t=new U0(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class KP{static isSupported(){return ly.isSupported()}constructor(t){G(this,"name","unnamed"),G(this,"source",void 0),G(this,"url",void 0),G(this,"maxConcurrency",1),G(this,"maxMobileConcurrency",1),G(this,"onDebug",()=>{}),G(this,"reuseWorkers",!0),G(this,"props",{}),G(this,"jobQueue",[]),G(this,"idleQueue",[]),G(this,"count",0),G(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,c,l)=>o.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,c)=>o.error(c);const n=new Promise(o=>(this.jobQueue.push({name:t,onMessage:e,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new ZP(e.name,t);t.onMessage=n=>e.onMessage(r,n.type,n.payload),t.onError=n=>e.onError(r,n),e.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ly({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return XP?this.maxMobileConcurrency:this.maxConcurrency}}const QP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Yc{static isSupported(){return ly.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Yc._workerFarm=Yc._workerFarm||new Yc({}),Yc._workerFarm.setProps(t),Yc._workerFarm}constructor(t){G(this,"props",void 0),G(this,"workerPools",new Map),this.props={...QP},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:r,url:n}=t;let o=this.workerPools.get(e);return o||(o=new KP({name:e,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}G(Yc,"_workerFarm",void 0);const tI="latest";function eI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[i.id]||{},r="".concat(i.id,"-worker.js");let n=e.workerUrl;if(!n&&i.id==="compression"&&(n=t.workerUrl),t._workerType==="test"&&(n="modules/".concat(i.module,"/dist/").concat(r)),!n){let o=i.version;o==="latest"&&(o=tI);const c=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(i.module).concat(c,"/dist/").concat(r)}return wc(n),n}function iI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HP;wc(i,"no worker provided");const e=i.version;return!(!t||!e)}const rI=null,nI=null,cy=null,I3=null,sI=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:rI,readFileAsText:nI,requireFromFile:cy,requireFromString:I3},Symbol.toStringTag,{value:"Module"})),oI="3.4.15",q0={};async function Bu(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t&&(i=aI(i,t,e)),q0[i]=q0[i]||lI(i),await q0[i]}function aI(i,t,e){if(i.startsWith("http"))return i;const r=e.modules||{};return r[i]?r[i]:ih?e.CDN?(wc(e.CDN.startsWith("http")),"".concat(e.CDN,"/").concat(t,"@").concat(oI,"/dist/libs/").concat(i)):x1?"../src/libs/".concat(i):"modules/".concat(t,"/src/libs/").concat(i):"modules/".concat(t,"/dist/libs/").concat(i)}async function lI(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!ih)try{return sI&&cy&&await cy(i)}catch{return null}if(x1)return importScripts(i);const t=await(await fetch(i)).text();return cI(t,i)}function cI(i,t){if(!ih)return I3;if(x1)return eval.call(WP,i),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(i))}catch{e.text=i}return document.body.appendChild(e),null}function hI(i,t){return!Yc.isSupported()||!ih&&!(t!=null&&t._nodeWorkers)?!1:i.worker&&(t==null?void 0:t.worker)}async function uI(i,t,e,r,n){const o=i.id,c=eI(i,e),l=Yc.getWorkerFarm(e).getWorkerPool({name:o,url:c});e=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(r||{}));const _=await l.startJob("process-on-worker",dI.bind(null,n));return _.postMessage("process",{input:t,options:e,context:r}),await(await _.result).result}async function dI(i,t,e,r){switch(e){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:n,input:o,options:c}=r;try{const l=await i(o,c);t.postMessage("done",{id:n,result:l})}catch(l){const _=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:n,error:_})}break;default:console.warn("parse-with-worker unknown message ".concat(e))}}function pI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?P2(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?P2(i,0,t):""}function P2(i,t,e){if(i.byteLength<=t+e)return"";const r=new DataView(i);let n="";for(let o=0;o<e;o++)n+=String.fromCharCode(r.getUint8(t+o));return n}function fI(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(pI(i),'"'))}}function mI(i,t,e){if(e=e||i.byteLength,i.byteLength<e||t.byteLength<e)return!1;const r=new Uint8Array(i),n=new Uint8Array(t);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function gI(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];const r=t.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),n=r.reduce((l,_)=>l+_.byteLength,0),o=new Uint8Array(n);let c=0;for(const l of r)o.set(l,c),c+=l.byteLength;return o.buffer}function w1(i,t,e){const r=e!==void 0?new Uint8Array(i).subarray(t,t+e):new Uint8Array(i).subarray(t);return new Uint8Array(r).buffer}function Pf(i,t){return Xr(i>=0),Xr(t>0),i+(t-1)&~(t-1)}function _I(i,t,e){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const n=i.byteOffset,o=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,n,o)}return t.set(r,e),e+Pf(r.byteLength,4)}async function yI(i){const t=[];for await(const e of i)t.push(e);return gI(...t)}function I2(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();i=t[0]*1e3+t[1]/1e6}else i=Date.now();return i}class L2{constructor(t,e){G(this,"name",void 0),G(this,"type",void 0),G(this,"sampleSize",1),G(this,"time",void 0),G(this,"count",void 0),G(this,"samples",void 0),G(this,"lastTiming",void 0),G(this,"lastSampleTime",void 0),G(this,"lastSampleCount",void 0),G(this,"_count",0),G(this,"_time",0),G(this,"_samples",0),G(this,"_startTime",0),G(this,"_timerPending",!1),this.name=t,this.type=e,this.reset()}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=I2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(I2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class If{constructor(t){G(this,"id",void 0),G(this,"stats",{}),this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t in this.stats)this.stats[t].reset();return this}forEach(t){for(const e in this.stats)t(this.stats[e])}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){if(!t||!t.name)return null;const{name:e,type:r}=t;return this.stats[e]||(t instanceof L2?this.stats[e]=t:this.stats[e]=new L2(e,r)),this.stats[e]}}const vI="Queued Requests",bI="Active Requests",xI="Cancelled Requests",wI="Queued Requests Ever",SI="Active Requests Ever",AI={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class EI{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"props",void 0),G(this,"stats",void 0),G(this,"activeRequestCount",0),G(this,"requestQueue",[]),G(this,"requestMap",new Map),G(this,"deferredUpdate",null),this.props={...AI,...t},this.stats=new If({id:this.props.id}),this.stats.get(vI),this.stats.get(bI),this.stats.get(xI),this.stats.get(wI),this.stats.get(SI)}scheduleRequest(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const r={handle:t,priority:0,getPriority:e},n=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(t,n),this._issueNewRequests(),n}_issueRequest(t){const{handle:e,resolve:r}=t;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort((e,r)=>e.priority-r.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let TI="";const M2={};function CI(i){for(const t in M2)if(i.startsWith(t)){const e=M2[t];i=i.replace(t,e)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(TI).concat(i)),i}function PI(i){return i&&typeof i=="object"&&i.isBuffer}function L3(i){if(PI(i)||i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const t=i;return new TextEncoder().encode(t).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function M3(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(t+1):""}function S1(i){const t=i?i.lastIndexOf("/"):-1;return t>=0?i.substr(0,t):""}const II=i=>typeof i=="boolean",nf=i=>typeof i=="function",Lf=i=>i!==null&&typeof i=="object",B2=i=>Lf(i)&&i.constructor==={}.constructor,LI=i=>i&&typeof i[Symbol.iterator]=="function",MI=i=>i&&typeof i[Symbol.asyncIterator]=="function",Uu=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Gu=i=>typeof Blob<"u"&&i instanceof Blob,BI=i=>i&&typeof i=="object"&&i.isBuffer,RI=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||Lf(i)&&nf(i.tee)&&nf(i.cancel)&&nf(i.getReader),kI=i=>Lf(i)&&nf(i.read)&&nf(i.pipe)&&II(i.readable),B3=i=>RI(i)||kI(i),FI=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,DI=/^([-\w.]+\/[-\w.+]+)/;function OI(i){const t=DI.exec(i);return t?t[1]:i}function R2(i){const t=FI.exec(i);return t?t[1]:""}const R3=/\?.*/;function NI(i){const t=i.match(R3);return t&&t[0]}function A1(i){return i.replace(R3,"")}function Fg(i){return Uu(i)?i.url:Gu(i)?i.name||"":typeof i=="string"?i:""}function E1(i){if(Uu(i)){const t=i,e=t.headers.get("content-type")||"",r=A1(t.url);return OI(e)||R2(r)}return Gu(i)?i.type||"":typeof i=="string"?R2(i):""}function zI(i){return Uu(i)?i.headers["content-length"]||-1:Gu(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function k3(i){if(Uu(i))return i;const t={},e=zI(i);e>=0&&(t["content-length"]=String(e));const r=Fg(i),n=E1(i);n&&(t["content-type"]=n);const o=await GI(i);o&&(t["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const c=new Response(i,{headers:t});return Object.defineProperty(c,"url",{value:r}),c}async function jI(i){if(!i.ok){const t=await UI(i);throw new Error(t)}}async function UI(i){let t="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const e=i.headers.get("Content-Type");let r=i.statusText;e.includes("application/json")&&(r+=" ".concat(await i.text())),t+=r,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch{}return t}async function GI(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(e=>{const r=new FileReader;r.onload=n=>{var o;return e(n==null||(o=n.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),e=VI(t);return"data:base64,".concat(e)}return null}function VI(i){let t="";const e=new Uint8Array(i);for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}async function k2(i,t){if(typeof i=="string"){i=CI(i);let e=t;return t!=null&&t.fetch&&typeof(t==null?void 0:t.fetch)!="function"&&(e=t.fetch),await fetch(i,e)}return await k3(i)}function F3(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function lh(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||F3()}const Um={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},H0=Um.window||Um.self||Um.global,um=Um.process||{},D3=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";lh();const W0=globalThis;function O3(i){if(!lh())return"Node";if(F3())return"Electron";const t=(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const e=t.indexOf("MSIE ")!==-1,r=t.indexOf("Trident/")!==-1;return e||r?"IE":W0.chrome?"Chrome":W0.safari?"Safari":W0.mozInnerScreenX?"Firefox":"Unknown"}function qI(i){try{const t=window[i],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class HI{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";G(this,"storage",void 0),G(this,"id",void 0),G(this,"config",void 0),this.storage=qI(r),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function WI(i){let t;return i<10?t="".concat(i.toFixed(2),"ms"):i<100?t="".concat(i.toFixed(1),"ms"):i<1e3?t="".concat(i.toFixed(0),"ms"):t="".concat((i/1e3).toFixed(2),"s"),t}function XI(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const e=Math.max(t-i.length,0);return"".concat(" ".repeat(e)).concat(i)}function X0(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(e=Math.min(e,r/i.width));const o=i.width*e,c=i.height*e,l=["font-size:1px;","padding:".concat(Math.floor(c/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(c,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(c,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),l]}let ug;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(ug||(ug={}));function F2(i){return typeof i=="string"?ug[i.toUpperCase()]||ug.WHITE:i}function ZI(i,t,e){return!lh&&typeof i=="string"&&(t&&(t=F2(t),i="\x1B[".concat(t,"m").concat(i,"\x1B[39m")),e&&(t=F2(e),i="\x1B[".concat(e+10,"m").concat(i,"\x1B[49m"))),i}function $I(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const e=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(e);for(const n of r)typeof i[n]=="function"&&(t.find(o=>n===o)||(i[n]=i[n].bind(i)))}function dg(i,t){if(!i)throw new Error(t||"Assertion failed")}function pd(){let i;if(lh&&"performance"in H0){var t,e;i=H0==null||(t=H0.performance)===null||t===void 0||(e=t.now)===null||e===void 0?void 0:e.call(t)}else if("hrtime"in um){var r;const n=um==null||(r=um.hrtime)===null||r===void 0?void 0:r.call(um);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const fd={debug:lh&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},YI={enabled:!0,level:0};function Wa(){}const D2={},O2={once:!0};class Mf{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};G(this,"id",void 0),G(this,"VERSION",D3),G(this,"_startTs",pd()),G(this,"_deltaTs",pd()),G(this,"_storage",void 0),G(this,"userData",{}),G(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this.userData={},this._storage=new HI("__probe-".concat(this.id,"__"),YI),this.timeStamp("".concat(this.id," started")),$I(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((pd()-this._startTs).toPrecision(10))}getDelta(){return Number((pd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){dg(t,e)}warn(t){return this._getLogFunction(0,t,fd.warn,arguments,O2)}error(t){return this._getLogFunction(0,t,fd.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,fd.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,fd.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(t,e,fd.debug||fd.info,arguments,O2)}table(t,e,r){return e?this._getLogFunction(t,e,console.table||Wa,r&&[r],{tag:tL(e)}):Wa}image(t){let{logLevel:e,priority:r,image:n,message:o="",scale:c=1}=t;return this._shouldLog(e||r)?lh?QI({image:n,message:o,scale:c}):KI():Wa}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Wa)}group(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=N2({logLevel:t,message:e,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Wa)}withGroup(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=N3(t)}_getLogFunction(t,e,r,n,o){if(this._shouldLog(t)){o=N2({logLevel:t,message:e,args:n,opts:o}),r=r||o.method,dg(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=pd();const c=o.tag||o.message;if(o.once)if(!D2[c])D2[c]=pd();else return Wa;return e=JI(this.id,o.message,o),r.bind(console,e,...o.args)}return Wa}}G(Mf,"VERSION",D3);function N3(i){if(!i)return 0;let t;switch(typeof i){case"number":t=i;break;case"object":t=i.logLevel||i.priority||0;break;default:return 0}return dg(Number.isFinite(t)&&t>=0),t}function N2(i){const{logLevel:t,message:e}=i;i.logLevel=N3(t);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&r.unshift(e),i.message=t;break;case"object":Object.assign(i,t);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return dg(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function JI(i,t,e){if(typeof t=="string"){const r=e.time?XI(WI(e.total)):"";t=e.time?"".concat(i,": ").concat(r,"  ").concat(t):"".concat(i,": ").concat(t),t=ZI(t,e.color,e.background)}return t}function KI(i){return console.warn("removed"),Wa}function QI(i){let{image:t,message:e="",scale:r=1}=i;if(typeof t=="string"){const o=new Image;return o.onload=()=>{const c=X0(o,e,r);console.log(...c)},o.src=t,Wa}const n=t.nodeName||"";if(n.toLowerCase()==="img")return console.log(...X0(t,e,r)),Wa;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...X0(o,e,r)),o.src=t.toDataURL(),Wa}return Wa}function tL(i){for(const t in i)for(const e in i[t])return e||"untitled";return"empty"}const z2=new Mf({id:"loaders.gl"});class eL{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class iL{constructor(){G(this,"console",void 0),this.console=console}log(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.console.error.bind(this.console,...e)}}const z3={fetch:null,mimeType:void 0,nothrow:!1,log:new iL,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:kg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},rL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function j3(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const U3=()=>{const i=j3();return i.globalOptions=i.globalOptions||{...z3},i.globalOptions};function nL(i,t,e,r){return e=e||[],e=Array.isArray(e)?e:[e],sL(i,e),aL(t,i,r)}function sL(i,t){j2(i,null,z3,rL,t);for(const e of t){const r=i&&i[e.id]||{},n=e.options&&e.options[e.id]||{},o=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};j2(r,e.id,n,o,t)}}function j2(i,t,e,r,n){const o=t||"Top level",c=t?"".concat(t,"."):"";for(const l in i){const _=!t&&Lf(i[l]),v=l==="baseUri"&&!t,S=l==="workerUrl"&&t;if(!(l in e)&&!v&&!S){if(l in r)z2.warn("".concat(o," loader option '").concat(c).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!_){const T=oL(l,n);z2.warn("".concat(o," loader option '").concat(c).concat(l,"' not recognized. ").concat(T))()}}}}function oL(i,t){const e=i.toLowerCase();let r="";for(const n of t)for(const o in n.options){if(i===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const c=o.toLowerCase();(e.startsWith(c)||c.startsWith(e))&&(r=r||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return r}function aL(i,t,e){const r={...i.options||{}};return lL(r,e),r.log===null&&(r.log=new eL),U2(r,U3()),U2(r,t),r}function U2(i,t){for(const e in t)if(e in t){const r=t[e];B2(r)&&B2(i[e])?i[e]={...i[e],...t[e]}:i[e]=t[e]}}function lL(i,t){t&&!("baseUri"in i)&&(i.baseUri=t)}function T1(i){var t;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((t=i)===null||t===void 0?void 0:t.extensions)):!1}function C1(i){var t,e;Xr(i,"null loader"),Xr(T1(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((t=i)!==null&&t!==void 0&&t.parseTextSync||(e=i)!==null&&e!==void 0&&e.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const G3=()=>{const i=j3();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function cL(i){const t=G3();i=Array.isArray(i)?i:[i];for(const e of i){const r=C1(e);t.find(n=>r===n)||t.unshift(r)}}function hL(){return G3()}const uL=new Mf({id:"loaders.gl"}),dL=/\.([^.]+)$/;async function pL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!V3(i))return null;let n=G2(i,t,{...e,nothrow:!0},r);if(n)return n;if(Gu(i)&&(i=await i.slice(0,10).arrayBuffer(),n=G2(i,t,e,r)),!n&&!(e!=null&&e.nothrow))throw new Error(q3(i));return n}function G2(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!V3(i))return null;if(t&&!Array.isArray(t))return C1(t);let n=[];t&&(n=n.concat(t)),e!=null&&e.ignoreRegisteredLoaders||n.push(...hL()),mL(n);const o=fL(i,n,e,r);if(!o&&!(e!=null&&e.nothrow))throw new Error(q3(i));return o}function fL(i,t,e,r){const n=Fg(i),o=E1(i),c=A1(n)||(r==null?void 0:r.url);let l=null,_="";if(e!=null&&e.mimeType&&(l=Z0(t,e==null?void 0:e.mimeType),_="match forced by supplied MIME type ".concat(e==null?void 0:e.mimeType)),l=l||gL(t,c),_=_||(l?"matched url ".concat(c):""),l=l||Z0(t,o),_=_||(l?"matched MIME type ".concat(o):""),l=l||yL(t,i),_=_||(l?"matched initial data ".concat(H3(i)):""),l=l||Z0(t,e==null?void 0:e.fallbackMimeType),_=_||(l?"matched fallback MIME type ".concat(o):""),_){var v;uL.log(1,"selectLoader selected ".concat((v=l)===null||v===void 0?void 0:v.name,": ").concat(_,"."))}return l}function V3(i){return!(i instanceof Response&&i.status===204)}function q3(i){const t=Fg(i),e=E1(i);let r="No valid loader found (";r+=t?"".concat(M3(t),", "):"no url provided, ",r+="MIME type: ".concat(e?'"'.concat(e,'"'):"not provided",", ");const n=i?H3(i):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")",r}function mL(i){for(const t of i)C1(t)}function gL(i,t){const e=t&&dL.exec(t),r=e&&e[1];return r?_L(i,r):null}function _L(i,t){t=t.toLowerCase();for(const e of i)for(const r of e.extensions)if(r.toLowerCase()===t)return e;return null}function Z0(i,t){for(const e of i)if(e.mimeTypes&&e.mimeTypes.includes(t)||t==="application/x.".concat(e.id))return e;return null}function yL(i,t){if(!t)return null;for(const e of i)if(typeof t=="string"){if(vL(t,e))return e}else if(ArrayBuffer.isView(t)){if(V2(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&V2(t,0,e))return e;return null}function vL(i,t){return t.testText?t.testText(i):(Array.isArray(t.tests)?t.tests:[t.tests]).some(e=>i.startsWith(e))}function V2(i,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>bL(i,t,e,r))}function bL(i,t,e,r){if(r instanceof ArrayBuffer)return mI(r,i,r.byteLength);switch(typeof r){case"function":return r(i,e);case"string":const n=hy(i,t,r.length);return r===n;default:return!1}}function H3(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,t):ArrayBuffer.isView(i)?hy(i.buffer,i.byteOffset,t):i instanceof ArrayBuffer?hy(i,0,t):""}function hy(i,t,e){if(i.byteLength<t+e)return"";const r=new DataView(i);let n="";for(let o=0;o<e;o++)n+=String.fromCharCode(r.getUint8(t+o));return n}const xL=256*1024;function*wL(i,t){const e=(t==null?void 0:t.chunkSize)||xL;let r=0;const n=new TextEncoder;for(;r<i.length;){const o=Math.min(i.length-r,e),c=i.slice(r,r+o);r+=o,yield n.encode(c)}}const SL=256*1024;function AL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=SL}=t;let r=0;for(;r<i.byteLength;){const n=Math.min(i.byteLength-r,e),o=new ArrayBuffer(n),c=new Uint8Array(i,r,n);new Uint8Array(o).set(c),r+=n,yield o}}()}const EL=1024*1024;async function*TL(i,t){const e=(t==null?void 0:t.chunkSize)||EL;let r=0;for(;r<i.size;){const n=r+e,o=await i.slice(r,n).arrayBuffer();r=n,yield o}}function q2(i,t){return kg?CL(i,t):PL(i)}async function*CL(i,t){const e=i.getReader();let r;try{for(;;){const n=r||e.read();t!=null&&t._streamReadAhead&&(r=e.read());const{done:o,value:c}=await n;if(o)return;yield L3(c)}}catch{e.releaseLock()}}async function*PL(i,t){for await(const e of i)yield L3(e)}function IL(i,t){if(typeof i=="string")return wL(i,t);if(i instanceof ArrayBuffer)return AL(i,t);if(Gu(i))return TL(i,t);if(B3(i))return q2(i,t);if(Uu(i))return q2(i.body,t);throw new Error("makeIterator")}const W3="Cannot convert supplied data type";function LL(i,t,e){if(t.text&&typeof i=="string")return i;if(BI(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const n=i.byteLength||i.length;return(i.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+n)),r}throw new Error(W3)}async function ML(i,t,e){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return LL(i,t);if(Gu(i)&&(i=await k3(i)),Uu(i)){const n=i;return await jI(n),t.binary?await n.arrayBuffer():await n.text()}if(B3(i)&&(i=IL(i,e)),LI(i)||MI(i))return yI(i);throw new Error(W3)}function X3(i,t){const e=U3(),r=i||e;return typeof r.fetch=="function"?r.fetch:Lf(r.fetch)?n=>k2(n,r):t!=null&&t.fetch?t==null?void 0:t.fetch:k2}function BL(i,t,e){if(e)return e;const r={fetch:X3(t,i),...i};if(r.url){const n=A1(r.url);r.baseUrl=n,r.queryString=NI(r.url),r.filename=M3(n),r.baseUrl=S1(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function RL(i,t){if(!t&&i&&!Array.isArray(i))return i;let e;if(i&&(e=Array.isArray(i)?i:[i]),t&&t.loaders){const r=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...r]:r}return e&&e.length?e:null}async function P1(i,t,e,r){wc(!r||typeof r=="object"),t&&!Array.isArray(t)&&!T1(t)&&(r=void 0,e=t,t=void 0),i=await i,e=e||{};const n=Fg(i),o=RL(t,r),c=await pL(i,o,e);return c?(e=nL(e,c,o,n),r=BL({url:n,parse:P1,loaders:o},e,r||null),await kL(c,i,e,r)):null}async function kL(i,t,e,r){if(iI(i),Uu(t)){const n=t,{ok:o,redirected:c,status:l,statusText:_,type:v,url:S}=n,T=Object.fromEntries(n.headers.entries());r.response={headers:T,ok:o,redirected:c,status:l,statusText:_,type:v,url:S}}if(t=await ML(t,i,e),i.parseTextSync&&typeof t=="string")return e.dataType="text",i.parseTextSync(t,e,r,i);if(hI(i,e))return await uI(i,t,e,r,P1);if(i.parseText&&typeof t=="string")return await i.parseText(t,e,r,i);if(i.parse)return await i.parse(t,e,r,i);throw wc(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function Hh(i,t,e,r){!Array.isArray(t)&&!T1(t)&&(e=t,t=void 0);const n=X3(e);let o=i;return typeof i=="string"&&(o=await n(i)),Gu(i)&&(o=await n(i)),await P1(o,t,e)}const FL="3.4.15",{_parseImageNode:DL}=globalThis,uy=typeof Image<"u",dy=typeof ImageBitmap<"u",OL=!!DL,py=kg?!0:OL;function NL(i){switch(i){case"auto":return dy||uy||py;case"imagebitmap":return dy;case"image":return uy;case"data":return py;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function zL(){if(dy)return"imagebitmap";if(uy)return"image";if(py)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function jL(i){const t=VL(i);if(!t)throw new Error("Not an image");return t}function UL(i){switch(jL(i)){case"data":return i;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=i.width,t.height=i.height,e.drawImage(i,0,0),e.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function VL(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const qL=/^data:image\/svg\+xml/,HL=/\.svg((\?|#).*)?$/;function I1(i){return i&&(qL.test(i)||HL.test(i))}function WL(i,t){if(I1(t)){let e=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(e=unescape(encodeURIComponent(e)))}catch(r){throw new Error(r.message)}return"data:image/svg+xml;base64,".concat(btoa(e))}return Z3(i,t)}function Z3(i,t){if(I1(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function $3(i,t,e){const r=WL(i,e),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await XL(o||r,t)}finally{o&&n.revokeObjectURL(o)}}async function XL(i,t){const e=new Image;return e.src=i,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((r,n)=>{try{e.onload=()=>r(e),e.onerror=o=>n(new Error("Could not load image ".concat(i,": ").concat(o)))}catch(o){n(o)}})}const ZL={};let H2=!0;async function $L(i,t,e){let r;I1(e)?r=await $3(i,t,e):r=Z3(i,e);const n=t&&t.imagebitmap;return await YL(r,n)}async function YL(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((JL(t)||!H2)&&(t=null),t)try{return await createImageBitmap(i,t)}catch(e){console.warn(e),H2=!1}return await createImageBitmap(i)}function JL(i){for(const t in i||ZL)return!1;return!0}function KL(i){return!i4(i,"ftyp",4)||!(i[8]&96)?null:QL(i)}function QL(i){switch(t4(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function t4(i,t,e){return String.fromCharCode(...i.slice(t,e))}function e4(i){return[...i].map(t=>t.charCodeAt(0))}function i4(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=e4(t);for(let n=0;n<r.length;++n)if(r[n]!==i[n+e])return!1;return!0}const mc=!1,sf=!0;function L1(i){const t=Bf(i);return n4(t)||a4(t)||s4(t)||o4(t)||r4(t)}function r4(i){const t=new Uint8Array(i instanceof DataView?i.buffer:i),e=KL(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function n4(i){const t=Bf(i);return t.byteLength>=24&&t.getUint32(0,mc)===2303741511?{mimeType:"image/png",width:t.getUint32(16,mc),height:t.getUint32(20,mc)}:null}function s4(i){const t=Bf(i);return t.byteLength>=10&&t.getUint32(0,mc)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,sf),height:t.getUint16(8,sf)}:null}function o4(i){const t=Bf(i);return t.byteLength>=14&&t.getUint16(0,mc)===16973&&t.getUint32(2,sf)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,sf),height:t.getUint32(22,sf)}:null}function a4(i){const t=Bf(i);if(!(t.byteLength>=3&&t.getUint16(0,mc)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:e,sofMarkers:r}=l4();let n=2;for(;n+9<t.byteLength;){const o=t.getUint16(n,mc);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(n+5,mc),width:t.getUint16(n+7,mc)};if(!e.has(o))return null;n+=2,n+=t.getUint16(n,mc)}return null}function l4(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bf(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function c4(i,t){const{mimeType:e}=L1(i)||{},r=globalThis._parseImageNode;return Xr(r),await r(i,e)}async function h4(i,t,e){t=t||{};const r=(t.image||{}).type||"auto",{url:n}=e||{},o=u4(r);let c;switch(o){case"imagebitmap":c=await $L(i,t,n);break;case"image":c=await $3(i,t,n);break;case"data":c=await c4(i);break;default:Xr(!1)}return r==="data"&&(c=UL(c)),c}function u4(i){switch(i){case"auto":case"data":return zL();default:return NL(i),i}}const d4=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],p4=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],f4={image:{type:"auto",decode:!0}},Y3={id:"image",module:"images",name:"Images",version:FL,mimeTypes:p4,extensions:d4,parse:h4,tests:[i=>!!L1(new DataView(i))],options:f4},$0={};function m4(i){if($0[i]===void 0){const t=kg?_4(i):g4(i);$0[i]=t}return $0[i]}function g4(i){const t=["image/png","image/jpeg","image/gif"],{_parseImageNode:e,_imageFormatsNode:r=t}=globalThis;return!!e&&r.includes(i)}function _4(i){switch(i){case"image/avif":case"image/webp":return y4(i);default:return!0}}function y4(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}const hr=new Mf({id:"deck"}),Ph={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Y0=1,Dp=2,J0=3,K0=4,v4=2,b4=i=>({"layer.changeFlag":(t,e,r)=>{i.log(J0,"".concat(t.id," ").concat(e,": "),r[e])()},"layer.initialize":t=>{i.log(Y0,"Initializing ".concat(t))()},"layer.update":(t,e)=>{if(e){const r=t.getChangeFlags();i.log(Dp,"Updating ".concat(t," because: ").concat(Object.keys(r).filter(n=>r[n]).join(", ")))()}else i.log(K0,"".concat(t," does not need update"))()},"layer.matched":(t,e)=>{e&&i.log(K0,"Matched ".concat(t,", state transfered"))()},"layer.finalize":t=>{i.log(Y0,"Finalizing ".concat(t))()},"compositeLayer.renderLayers":(t,e,r)=>{e?i.log(Dp,"Composite layer rendered new subLayers ".concat(t),r)():i.log(K0,"Composite layer reused subLayers ".concat(t),r)()},"layerManager.setLayers":(t,e,r)=>{e&&i.log(Dp,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(t,e)=>{i.log(J0,"Viewport changed",e)()},"attributeManager.invalidate":(t,e,r)=>{i.log(Y0,r?"invalidated attributes ".concat(r," (").concat(e,") for ").concat(t.id):"invalidated all attributes for ".concat(t.id))()},"attributeManager.updateStart":t=>{Ph.attributeUpdateMessages.length=0,Ph.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Ph.attributeManagerUpdateStart);i.groupCollapsed(Dp,"Updated attributes for ".concat(e," instances in ").concat(t.id," in ").concat(r,"ms"))();for(const n of Ph.attributeUpdateMessages)i.log(J0,n)();i.groupEnd(Dp)()},"attribute.updateStart":t=>{Ph.attributeUpdateStart=Date.now()},"attribute.allocate":(t,e)=>{const r="".concat(t.id," allocated ").concat(e);Ph.attributeUpdateMessages.push(r)},"attribute.updateEnd":(t,e)=>{const r=Math.round(Date.now()-Ph.attributeUpdateStart),n="".concat(t.id," updated ").concat(e," in ").concat(r,"ms");Ph.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(t,e,r)=>{const{pass:n,redrawReason:o,stats:c}=r;for(const l of e){const{totalCount:_,visibleCount:v,compositeCount:S,pickableCount:T}=l,P=_-S-v;i.log(v4,"RENDER #".concat(t.renderCount,"   ").concat(v," (of ").concat(_," layers) to ").concat(n," because ").concat(o,"   (").concat(P," hidden, ").concat(S," composite ").concat(T," pickable)"))(),c&&c.get("Redraw Layers").add(v)}}});var x4={};let pg={};x4.NODE_ENV!=="production"&&(pg=b4(hr));function w4(i){pg=i}function to(i,t,e,r){hr.level>0&&pg[i]&&pg[i].call(null,t,e,r)}function S4(i){const t=i[0],e=i[i.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const A4={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:S4,parseTextSync:JSON.parse};function E4(){const i="8.9.36",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==i)throw new Error("deck.gl - multiple versions detected: ".concat(t," vs ").concat(i));return t||(hr.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:hr,_registerLoggers:w4},cL([A4,[Y3,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const T4=E4(),lr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(lr,"IDENTITY",{get:()=>(hr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const _c={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},fy={common:0,meters:1,pixels:2},W2={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ai=new Mf({id:"luma.gl"});function So(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}const C4="Invalid WebGLRenderingContext",P4="Requires WebGL2";function Dg(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function tr(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function I4(i){return tr(i)?i:null}function Og(i){return So(Dg(i),C4),i}function Ao(i){return So(tr(i),P4),i}const Kp={};function L4(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function M4(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function B4(i,t){Kp[i]=!0,L4(t)}function R4(i){const t=i.getError;i.getError=function(){let e;do e=t.apply(i),e!==0&&(Kp[e]=!0);while(e!==0);for(e in Kp)if(Kp[e])return delete Kp[e],parseInt(e,10);return 0}}const Rf=function i(t){const e=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const n=new i.VertexAttrib(e);this.attribs[r]=n}this.maxAttrib=0};Rf.VertexAttrib=function(i){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Rf.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Vu=function(i){const t=this;this.gl=i,R4(i);const e=this.original={getParameter:i.getParameter,enableVertexAttribArray:i.enableVertexAttribArray,disableVertexAttribArray:i.disableVertexAttribArray,bindBuffer:i.bindBuffer,getVertexAttrib:i.getVertexAttrib,vertexAttribPointer:i.vertexAttribPointer};i.getParameter=function(r){return r===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:e.getParameter.apply(this,arguments)},i.enableVertexAttribArray=function(r){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,r);const o=n.attribs[r];return o.enabled=!0,e.enableVertexAttribArray.apply(this,arguments)},i.disableVertexAttribArray=function(r){const n=t.currentVertexArrayObject;n.maxAttrib=Math.max(n.maxAttrib,r);const o=n.attribs[r];return o.enabled=!1,e.disableVertexAttribArray.apply(this,arguments)},i.bindBuffer=function(r,n){switch(r){case 34962:t.currentArrayBuffer=n;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=n;break}return e.bindBuffer.apply(this,arguments)},i.getVertexAttrib=function(r,n){const o=t.currentVertexArrayObject.attribs[r];switch(n){case 34975:return o.buffer;case 34338:return o.enabled;case 34339:return o.size;case 34340:return o.stride;case 34341:return o.type;case 34922:return o.normalized;default:return e.getVertexAttrib.apply(this,arguments)}},i.vertexAttribPointer=function(r,n,o,c,l,_){const v=t.currentVertexArrayObject;v.maxAttrib=Math.max(v.maxAttrib,r);const S=v.attribs[r];return S.buffer=t.currentArrayBuffer,S.size=n,S.type=o,S.normalized=c,S.stride=l,S.offset=_,S.recache(),e.vertexAttribPointer.apply(this,arguments)},i.instrumentExtension&&i.instrumentExtension(this,"OES_vertex_array_object"),i.canvas&&i.canvas.addEventListener("webglcontextrestored",()=>{M4("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Vu.prototype.VERTEX_ARRAY_BINDING_OES=34229;Vu.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const i=this.gl;this.maxVertexAttribs=i.getParameter(34921),this.defaultVertexArrayObject=new Rf(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Vu.prototype.createVertexArrayOES=function(){const i=new Rf(this);return this.vertexArrayObjects.push(i),i};Vu.prototype.deleteVertexArrayOES=function(i){i.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(i),1),this.currentVertexArrayObject===i&&this.bindVertexArrayOES(null)};Vu.prototype.isVertexArrayOES=function(i){return!!(i&&i instanceof Rf&&i.hasBeenBound&&i.ext===this)};Vu.prototype.bindVertexArrayOES=function(i){const t=this.gl;if(i&&!i.isAlive){B4(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const e=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=i||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const n=this.currentVertexArrayObject;if(r===n)return;(!r||n.elementArrayBuffer!==r.elementArrayBuffer)&&e.bindBuffer.call(t,34963,n.elementArrayBuffer);let o=this.currentArrayBuffer;const c=Math.max(r?r.maxAttrib:0,n.maxAttrib);for(let l=0;l<=c;l++){const _=n.attribs[l],v=r?r.attribs[l]:null;if((!r||_.enabled!==v.enabled)&&(_.enabled?e.enableVertexAttribArray.call(t,l):e.disableVertexAttribArray.call(t,l)),_.enabled){let S=!1;(!r||_.buffer!==v.buffer)&&(o!==_.buffer&&(e.bindBuffer.call(t,34962,_.buffer),o=_.buffer),S=!0),(S||_.cached!==v.cached)&&e.vertexAttribPointer.call(t,l,_.size,_.type,_.normalized,_.stride,_.offset)}}this.currentArrayBuffer!==o&&e.bindBuffer.call(t,34962,this.currentArrayBuffer)};function k4(i){if(typeof i.createVertexArray=="function")return;const t=i.getSupportedExtensions;i.getSupportedExtensions=function(){const r=t.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const e=i.getExtension;i.getExtension=function(r){return e.call(this,r)||(r!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Vu(this)),this.__OESVertexArrayObject))}}const X2="OES_element_index",Z2="WEBGL_draw_buffers",F4="EXT_disjoint_timer_query",D4="EXT_disjoint_timer_query_webgl2",O4="EXT_texture_filter_anisotropic",$2="WEBGL_debug_renderer_info",N4=35723,z4=4352,j4=36795,U4=34047,G4=37445,V4=37446,Jr=i=>tr(i)?void 0:0,q4={3074:i=>tr(i)?void 0:36064,[N4]:i=>tr(i)?void 0:z4,35977:Jr,32937:Jr,[j4]:(i,t)=>{const e=tr(i)?i.getExtension(D4):i.getExtension(F4);return e&&e.GPU_DISJOINT_EXT?t(e.GPU_DISJOINT_EXT):0},[G4]:(i,t)=>{const e=i.getExtension($2);return t(e&&e.UNMASKED_VENDOR_WEBGL||7936)},[V4]:(i,t)=>{const e=i.getExtension($2);return t(e&&e.UNMASKED_RENDERER_WEBGL||7937)},[U4]:(i,t)=>{const e=i.luma.extensions[O4];return e?t(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Jr,35071:Jr,37447:Jr,36063:(i,t)=>{if(!tr(i)){const e=i.getExtension(Z2);return e?t(e.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Jr,35374:Jr,35377:Jr,34852:i=>{if(!tr(i)){const t=i.getExtension(Z2);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(X2)?2147483647:65535,33001:i=>i.getExtension(X2)?16777216:65535,33e3:i=>16777216,37157:Jr,35373:Jr,35657:Jr,36183:Jr,37137:Jr,34045:Jr,35978:Jr,35979:Jr,35968:Jr,35376:Jr,35375:Jr,35659:Jr,37154:Jr,35371:Jr,35658:Jr,35076:Jr,35077:Jr,35380:Jr};function H4(i,t,e){const r=q4[e],n=typeof r=="function"?r(i,t,e):r;return n!==void 0?n:t(e)}const W4="OES_vertex_array_object",J3="ANGLE_instanced_arrays",X4="WEBGL_draw_buffers",Z4="EXT_disjoint_timer_query",$4="EXT_texture_filter_anisotropic",Y4="VertexArray requires WebGL2 or OES_vertex_array_object extension";function J4(i,t){return{webgl2:tr(i),ext:i.getExtension(t)}}const K3={[W4]:{meta:{suffix:"OES"},createVertexArray:()=>{So(!1,Y4)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[J3]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,t){So(t===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[X4]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{So(!1)}},[Z4]:{meta:{suffix:"EXT"},createQuery:()=>{So(!1)},deleteQuery:()=>{So(!1)},beginQuery:()=>{So(!1)},endQuery:()=>{},getQuery(i,t){return this.getQueryObject(i,t)},getQueryParameter(i,t){return this.getQueryObject(i,t)},getQueryObject:()=>{}}},Q0={readBuffer:(i,t,e)=>{tr(i)&&t(e)},getVertexAttrib:(i,t,e,r)=>{const{webgl2:n,ext:o}=J4(i,J3);let c;switch(r){case 35069:c=n?void 0:!1;break;case 35070:c=!n&&!o?0:void 0;break}return c!==void 0?c:t(e,r)},getProgramParameter:(i,t,e,r)=>{if(!tr(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return t(e,r)},getInternalformatParameter:(i,t,e,r,n)=>{if(!tr(i))switch(n){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(e,r,n)},getTexParameter(i,t,e,r){switch(r){case 34046:const{extensions:n}=i.luma,o=n[$4];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return t(e,r)},getParameter:H4,hint(i,t,e,r){return t(e,r)}};function K4(i){i.luma=i.luma||{};const{luma:t}=i;return t.polyfilled||(k4(i),Q4(i),eM(i,K3),tM(i,{target:t,target2:i}),t.polyfilled=!0),i}globalThis.polyfillContext=K4;function Q4(i){i.luma.extensions={};const t=i.getSupportedExtensions()||[];for(const e of t)i.luma[e]=i.getExtension(e)}function tM(i,t){let{target:e,target2:r}=t;Object.keys(Q0).forEach(n=>{if(typeof Q0[n]=="function"){const o=i[n]?i[n].bind(i):()=>{},c=Q0[n].bind(null,i,o);e[n]=c,r[n]=c}})}function eM(i,t){for(const e of Object.getOwnPropertyNames(t))e!=="overrides"&&iM(i,{extension:e,target:i.luma,target2:i})}function iM(i,t){let{extension:e,target:r,target2:n}=t;const o=K3[e];So(o);const{meta:c={}}=o,{suffix:l=""}=c,_=i.getExtension(e);for(const v of Object.keys(o)){const S="".concat(v).concat(l);let T=null;v==="meta"||typeof i[v]=="function"||(_&&typeof _[S]=="function"?T=function(){return _[S](...arguments)}:typeof o[v]=="function"&&(T=o[v].bind(r))),T&&(r[v]=T,n[v]=T)}}const M1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ih=(i,t,e)=>t?i.enable(e):i.disable(e),Y2=(i,t,e)=>i.hint(e,t),pa=(i,t,e)=>i.pixelStorei(e,t),rM=(i,t)=>{const e=tr(i)?36009:36160;return i.bindFramebuffer(e,t)},nM=(i,t)=>i.bindFramebuffer(36008,t);function Op(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const sM={3042:Ih,32773:(i,t)=>i.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,t)=>i.clearColor(...t),3107:(i,t)=>i.colorMask(...t),2884:Ih,2885:(i,t)=>i.cullFace(t),2929:Ih,2931:(i,t)=>i.clearDepth(t),2932:(i,t)=>i.depthFunc(t),2928:(i,t)=>i.depthRange(...t),2930:(i,t)=>i.depthMask(t),3024:Ih,35723:Y2,36006:rM,2886:(i,t)=>i.frontFace(t),33170:Y2,2849:(i,t)=>i.lineWidth(t),32823:Ih,32824:"polygonOffset",10752:"polygonOffset",35977:Ih,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ih,3088:(i,t)=>i.scissor(...t),2960:Ih,2961:(i,t)=>i.clearStencil(t),2968:(i,t)=>i.stencilMaskSeparate(1028,t),36005:(i,t)=>i.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,t)=>i.viewport(...t),3333:pa,3317:pa,37440:pa,37441:pa,37443:pa,3330:pa,3332:pa,3331:pa,36010:nM,3314:pa,32878:pa,3316:pa,3315:pa,32877:pa,framebuffer:(i,t)=>{const e=t&&"handle"in t?t.handle:t;return i.bindFramebuffer(36160,e)},blend:(i,t)=>t?i.enable(3042):i.disable(3042),blendColor:(i,t)=>i.blendColor(...t),blendEquation:(i,t)=>{t=Op(t)?t:[t,t],i.blendEquationSeparate(...t)},blendFunc:(i,t)=>{t=Op(t)&&t.length===2?[...t,...t]:t,i.blendFuncSeparate(...t)},clearColor:(i,t)=>i.clearColor(...t),clearDepth:(i,t)=>i.clearDepth(t),clearStencil:(i,t)=>i.clearStencil(t),colorMask:(i,t)=>i.colorMask(...t),cull:(i,t)=>t?i.enable(2884):i.disable(2884),cullFace:(i,t)=>i.cullFace(t),depthTest:(i,t)=>t?i.enable(2929):i.disable(2929),depthFunc:(i,t)=>i.depthFunc(t),depthMask:(i,t)=>i.depthMask(t),depthRange:(i,t)=>i.depthRange(...t),dither:(i,t)=>t?i.enable(3024):i.disable(3024),derivativeHint:(i,t)=>{i.hint(35723,t)},frontFace:(i,t)=>i.frontFace(t),mipmapHint:(i,t)=>i.hint(33170,t),lineWidth:(i,t)=>i.lineWidth(t),polygonOffsetFill:(i,t)=>t?i.enable(32823):i.disable(32823),polygonOffset:(i,t)=>i.polygonOffset(...t),sampleCoverage:(i,t)=>i.sampleCoverage(...t),scissorTest:(i,t)=>t?i.enable(3089):i.disable(3089),scissor:(i,t)=>i.scissor(...t),stencilTest:(i,t)=>t?i.enable(2960):i.disable(2960),stencilMask:(i,t)=>{t=Op(t)?t:[t,t];const[e,r]=t;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,t)=>{t=Op(t)&&t.length===3?[...t,...t]:t;const[e,r,n,o,c,l]=t;i.stencilFuncSeparate(1028,e,r,n),i.stencilFuncSeparate(1029,o,c,l)},stencilOp:(i,t)=>{t=Op(t)&&t.length===3?[...t,...t]:t;const[e,r,n,o,c,l]=t;i.stencilOpSeparate(1028,e,r,n),i.stencilOpSeparate(1029,o,c,l)},viewport:(i,t)=>i.viewport(...t)};function Sn(i,t,e){return t[i]!==void 0?t[i]:e[i]}const oM={blendEquation:(i,t,e)=>i.blendEquationSeparate(Sn(32777,t,e),Sn(34877,t,e)),blendFunc:(i,t,e)=>i.blendFuncSeparate(Sn(32969,t,e),Sn(32968,t,e),Sn(32971,t,e),Sn(32970,t,e)),polygonOffset:(i,t,e)=>i.polygonOffset(Sn(32824,t,e),Sn(10752,t,e)),sampleCoverage:(i,t,e)=>i.sampleCoverage(Sn(32938,t,e),Sn(32939,t,e)),stencilFuncFront:(i,t,e)=>i.stencilFuncSeparate(1028,Sn(2962,t,e),Sn(2967,t,e),Sn(2963,t,e)),stencilFuncBack:(i,t,e)=>i.stencilFuncSeparate(1029,Sn(34816,t,e),Sn(36003,t,e),Sn(36004,t,e)),stencilOpFront:(i,t,e)=>i.stencilOpSeparate(1028,Sn(2964,t,e),Sn(2965,t,e),Sn(2966,t,e)),stencilOpBack:(i,t,e)=>i.stencilOpSeparate(1029,Sn(34817,t,e),Sn(34818,t,e),Sn(34819,t,e))},J2={enable:(i,t)=>i({[t]:!0}),disable:(i,t)=>i({[t]:!1}),pixelStorei:(i,t,e)=>i({[t]:e}),hint:(i,t,e)=>i({[t]:e}),bindFramebuffer:(i,t,e)=>{switch(t){case 36160:return i({36006:e,36010:e});case 36009:return i({36006:e});case 36008:return i({36010:e});default:return null}},blendColor:(i,t,e,r,n)=>i({32773:new Float32Array([t,e,r,n])}),blendEquation:(i,t)=>i({32777:t,34877:t}),blendEquationSeparate:(i,t,e)=>i({32777:t,34877:e}),blendFunc:(i,t,e)=>i({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(i,t,e,r,n)=>i({32969:t,32968:e,32971:r,32970:n}),clearColor:(i,t,e,r,n)=>i({3106:new Float32Array([t,e,r,n])}),clearDepth:(i,t)=>i({2931:t}),clearStencil:(i,t)=>i({2961:t}),colorMask:(i,t,e,r,n)=>i({3107:[t,e,r,n]}),cullFace:(i,t)=>i({2885:t}),depthFunc:(i,t)=>i({2932:t}),depthRange:(i,t,e)=>i({2928:new Float32Array([t,e])}),depthMask:(i,t)=>i({2930:t}),frontFace:(i,t)=>i({2886:t}),lineWidth:(i,t)=>i({2849:t}),polygonOffset:(i,t,e)=>i({32824:t,10752:e}),sampleCoverage:(i,t,e)=>i({32938:t,32939:e}),scissor:(i,t,e,r,n)=>i({3088:new Int32Array([t,e,r,n])}),stencilMask:(i,t)=>i({2968:t,36005:t}),stencilMaskSeparate:(i,t,e)=>i({[t===1028?2968:36005]:e}),stencilFunc:(i,t,e,r)=>i({2962:t,2967:e,2963:r,34816:t,36003:e,36004:r}),stencilFuncSeparate:(i,t,e,r,n)=>i({[t===1028?2962:34816]:e,[t===1028?2967:36003]:r,[t===1028?2963:36004]:n}),stencilOp:(i,t,e,r)=>i({2964:t,2965:e,2966:r,34817:t,34818:e,34819:r}),stencilOpSeparate:(i,t,e,r,n)=>i({[t===1028?2964:34817]:e,[t===1028?2965:34818]:r,[t===1028?2966:34819]:n}),viewport:(i,t,e,r,n)=>i({2978:[t,e,r,n]})},cc=(i,t)=>i.isEnabled(t),K2={3042:cc,2884:cc,2929:cc,3024:cc,32823:cc,32926:cc,32928:cc,3089:cc,2960:cc,35977:cc};function Q3(i){for(const t in i)return!1;return!0}function aM(i,t){if(i===t)return!0;const e=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&r&&i.length===t.length){for(let n=0;n<i.length;++n)if(i[n]!==t[n])return!1;return!0}return!1}function Q2(i,t){const e=i[t].bind(i);i[t]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in i.state.cache?i.state.enable?i.state.cache[r]:e(...arguments):e(...arguments)},Object.defineProperty(i[t],"name",{value:"".concat(t,"-from-cache"),configurable:!1})}function lM(i,t,e){const r=i[t].bind(i);i[t]=function(){for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];const{valueChanged:l,oldValue:_}=e(i.state._updateCache,...o);return l&&r(...o),_},Object.defineProperty(i[t],"name",{value:"".concat(t,"-to-cache"),configurable:!1})}function cM(i){const t=i.useProgram.bind(i);i.useProgram=function(e){i.state.program!==e&&(t(e),i.state.program=e)}}class hM{constructor(t){let{copyState:e=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.program=null,this.stateStack=[],this.enable=!0,this.cache=e?dM(t):Object.assign({},M1),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){So(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];sh(this.gl,t),this.stateStack.pop()}_updateCache(t){let e=!1,r;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in t){So(o!==void 0);const c=t[o],l=this.cache[o];aM(c,l)||(e=!0,r=l,n&&!(o in n)&&(n[o]=l),this.cache[o]=c)}return{valueChanged:e,oldValue:r}}}function tS(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:e=!0,copyState:r}=t;if(So(r!==void 0),!i.state){const{polyfillContext:n}=globalThis;n&&n(i),i.state=new hM(i,{copyState:r}),cM(i);for(const o in J2){const c=J2[o];lM(i,o,c)}Q2(i,"getParameter"),Q2(i,"isEnabled")}return i.state.enable=e,i}function uM(i){i.state||tS(i,{copyState:!1}),i.state.push()}function tx(i){So(i.state),i.state.pop()}function sh(i,t){if(So(Dg(i),"setParameters requires a WebGL context"),Q3(t))return;const e={};for(const n in t){const o=Number(n),c=sM[n];c&&(typeof c=="string"?e[c]=!0:c(i,t[n],o))}const r=i.state&&i.state.cache;if(r)for(const n in e){const o=oM[n];o(i,t,r)}}function dM(i,t){if(t=t||M1,typeof t=="number"){const n=t,o=K2[n];return o?o(i,n):i.getParameter(n)}const e=Array.isArray(t)?t:Object.keys(t),r={};for(const n of e){const o=K2[n];r[n]=o?o(i,Number(n)):i.getParameter(Number(n))}return r}function pM(i){sh(i,M1)}function Sl(i,t,e){if(Q3(t))return e(i);const{nocatch:r=!0}=t;uM(i),sh(i,t);let n;if(r)n=e(i),tx(i);else try{n=e(i)}finally{tx(i)}return n}function Hd(i){const{luma:t}=i;if(i.canvas&&t){const e=t.canvasSizeInfo,r="clientWidth"in e?e.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function t_(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Hd(i),n=i.drawingBufferWidth,o=i.drawingBufferHeight;return mM(t,r,n,o,e)}function fM(i){const t=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?t:1}function mM(i,t,e,r,n){const o=ex(i[0],t,e);let c=ix(i[1],t,r,n),l=ex(i[0]+1,t,e);const _=l===e-1?l:l-1;l=ix(i[1]+1,t,r,n);let v;return n?(l=l===0?l:l+1,v=c,c=l):v=l===r-1?l:l-1,{x:o,y:c,width:Math.max(_-o+1,1),height:Math.max(v-c+1,1)}}function ex(i,t,e){return Math.min(Math.round(i*t),e-1)}function ix(i,t,e,r){return r?Math.max(0,e-1-Math.round(i*t)):Math.min(Math.round(i*t),e-1)}const B1=lh(),gM=B1&&typeof document<"u",eS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function iS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};So(B1,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},eS,i);const{width:t,height:e}=i;function r(l){if(i.throwOnError)throw new Error(l);return console.error(l),null}i.onError=r;let n;const{canvas:o}=i,c=bM({canvas:o,width:t,height:e,onError:r});return n=vM(c,i),n?(n=R1(n,i),xM(n),n):null}function R1(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||wM(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},t=Object.assign({},eS,t);const{manageState:e,debug:r}=t;return e&&tS(i,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return ai.log(1,...o)()}}),B1&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,t),ai.level=Math.max(ai.level,1)):ai.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function _M(i){const t=i.getParameter(7936),e=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),n=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||t,renderer:o||e,vendorMasked:t,rendererMasked:e,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function yM(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=fM(t.useDevicePixels);SM(i,r,t);return}const e=i.getExtension("STACKGL_resize_drawingbuffer");e&&"width"in t&&"height"in t&&e.resize(t.width,t.height)}function vM(i,t){const{onError:e}=t;let r=null;const n=_=>r=_.statusMessage||r;i.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:c=!0}=t;let l=null;return c&&(l=l||i.getContext("webgl2",t),l=l||i.getContext("experimental-webgl2",t)),o&&(l=l||i.getContext("webgl",t),l=l||i.getContext("experimental-webgl",t)),i.removeEventListener("webglcontextcreationerror",n,!1),l?(t.onContextLost&&i.addEventListener("webglcontextlost",t.onContextLost,!1),t.onContextRestored&&i.addEventListener("webglcontextrestored",t.onContextRestored,!1),l):e("Failed to create ".concat(c&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function bM(i){let{canvas:t,width:e=800,height:r=600,onError:n}=i,o;return typeof t=="string"?(gM&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(t,"' before page was loaded")),o=document.getElementById(t)):t?o=t:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(e)?"".concat(e,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function xM(i){const t=tr(i)?"WebGL2":"WebGL1",e=_M(i),r=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",n=i.debug?" debug":"";ai.info(1,"".concat(t).concat(n," context ").concat(r))()}function wM(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function SM(i,t,e){let r="width"in e?e.width:i.canvas.clientWidth,n="height"in e?e.height:i.canvas.clientHeight;(!r||!n)&&(ai.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=i.canvas.width||1,n=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const o=i.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==t){let c=t;const l=Math.floor(r*c),_=Math.floor(n*c);i.canvas.width=l,i.canvas.height=_,(i.drawingBufferWidth!==l||i.drawingBufferHeight!==_)&&(ai.warn("Device pixel ratio clamped")(),c=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/n),i.canvas.width=Math.floor(r*c),i.canvas.height=Math.floor(n*c)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:t})}}const of="8.5.21",AM="set luma.log.level=1 (or higher) to trace rendering";class EM{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new If({id:t})),this.stats.get(t)}}const Cu=new EM;if(globalThis.luma&&globalThis.luma.VERSION!==of)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(of));globalThis.luma||(lh()&&ai.log(1,"luma.gl ".concat(of," - ").concat(AM))(),globalThis.luma=globalThis.luma||{VERSION:of,version:of,log:ai,stats:Cu,globals:{modules:{},nodeIO:{}}});function TM(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function CM(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function Ze(i,t){if(!i)throw new Error(t||"luma.gl: assertion failed.")}function e_(i,t){if(typeof t!="string")return t;const e=Number(t);if(!isNaN(e))return e;t=t.replace(/^.*\./,"");const r=i[t];return Ze(r!==void 0,"Accessing undefined constant GL.".concat(t)),r}function Gh(i,t){t=Number(t);for(const e in i)if(i[e]===t)return"GL.".concat(e);return String(t)}const i_={};function oh(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";i_[i]=i_[i]||1;const t=i_[i]++;return"".concat(i,"-").concat(t)}function rx(i){return Ze(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Wd(i){let t=!0;for(const e in i){t=!1;break}return t}function rS(i,t,e,r){const n="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(i);r.forEach(c=>{o.methodName||(o[c]=()=>{throw ai.removed("Calling removed method ".concat(t,".").concat(c,": "),n)(),new Error(c)})})}const md="Resource subclass must define virtual methods";let ch=class{get[Symbol.toStringTag](){return"Resource"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Og(i);const{id:e,userData:r={}}=t;this.gl=i,this.gl2=i,this.id=e||oh(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&i&&t.filter(Boolean).forEach(e=>e.delete()),this}bind(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof i!="function")return this._bindHandle(i),this;let t;return this._bound?t=i():(this._bindHandle(this.handle),this._bound=!0,t=i(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};i=e_(this.gl,i),Ze(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=tr(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension)))){const n=e.webgl1,o="webgl2"in e?e.webgl2:e.webgl1;return r?o:n}}return this._getParameter(i,t)}getParameters(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:e}=i,r=this.constructor.PARAMETERS||{},n=tr(this.gl),o={},c=t||Object.keys(r);for(const l of c){const _=r[l];if(_&&(!("webgl2"in _)||n)&&(!("extension"in _)||this.gl.getExtension(_.extension))){const v=e?Gh(this.gl,l):l;o[v]=this.getParameter(l,i),e&&_.type==="GLenum"&&(o[v]=Gh(this.gl,o[v]))}}return o}setParameter(i,t){i=e_(this.gl,i),Ze(i);const e=(this.constructor.PARAMETERS||{})[i];if(e){const r=tr(this.gl);if(!((!("webgl2"in e)||r)&&(!("extension"in e)||this.gl.getExtension(e.extension))))throw new Error("Parameter not available on this platform");e.type==="GLenum"&&(t=e_(t))}return this._setParameter(i,t),this}setParameters(i){for(const t in i)this.setParameter(t,i[t]);return this}stubRemovedMethods(i,t,e){return rS(this,i,t,e)}initialize(i){}_createHandle(){throw new Error(md)}_deleteHandle(){throw new Error(md)}_bindHandle(i){throw new Error(md)}_getOptsFromHandle(){throw new Error(md)}_getParameter(i,t){throw new Error(md)}_setParameter(i,t){throw new Error(md)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const i=this[Symbol.toStringTag],t=Cu.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(i,"s Created")).incrementCount(),t.get("".concat(i,"s Active")).incrementCount()}_removeStats(){const i=this[Symbol.toStringTag];Cu.get("Resource Counts").get("".concat(i,"s Active")).decrementCount()}_trackAllocatedMemory(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(i,t),this._trackAllocatedMemoryForContext(i,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=i}_trackAllocatedMemoryForContext(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=Cu.get("Memory Usage".concat(e));r.get("GPU Memory").addCount(i),r.get("".concat(t," Memory")).addCount(i)}_trackDeallocatedMemory(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(i),this._trackDeallocatedMemoryForContext(i,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const e=Cu.get("Memory Usage".concat(t));e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(i," Memory")).subtractCount(this.byteLength)}};const PM="Failed to deduce GL constant from typed array";function my(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(PM)}}function ff(i){let{clamped:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function IM(i){let{data:t,width:e,height:r,bytesPerPixel:n=4,temp:o}=i;const c=e*n;o=o||new Uint8Array(c);for(let l=0;l<r/2;++l){const _=l*c,v=(r-l-1)*c;o.set(t.subarray(_,_+c)),t.copyWithin(_,v,v+c),t.set(o,v)}}function LM(i){let{data:t,width:e,height:r}=i;const n=Math.round(e/2),o=Math.round(r/2),c=new Uint8Array(n*o*4);for(let l=0;l<o;l++)for(let _=0;_<n;_++)for(let v=0;v<4;v++)c[(l*n+_)*4+v]=t[(l*2*e+_*2)*4+v];return{data:c,width:n,height:o}}function gy(i,t,e){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=e;for(const l in r)if(l in t){const _=r[l]?"".concat(i,".").concat(r[l]):"N/A";ai.removed("".concat(i,".").concat(l),_)()}for(const l in n)if(l in t){const _=n[l];ai.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(_))()}let c=null;for(const l in o)if(l in t){const _=o[l];ai.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(_))(),c=c||Object.assign({},t),c[_]=t[l],delete c[l]}return c||t}const MM={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},BM={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Go{static getBytesPerElement(t){return ff(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Ze(t.size),ff(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new Go(MM,...e)}constructor(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Go.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Go.getBytesPerVertex(this)}_assign(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t=gy("Accessor",t,BM),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this}}const nx=10,nS={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},RM={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:nS},kM={removedProps:nS};let Gr=class extends ch{get[Symbol.toStringTag](){return"Buffer"}constructor(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(i,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Go.getBytesPerElement(i))}getVertexCount(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Go.getBytesPerVertex(i))}initialize(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(i)&&(i={data:i}),Number.isFinite(i)&&(i={byteLength:i}),i=gy("Buffer",i,RM),this.usage=i.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},i,i.accessor)),i.data?this._setData(i.data,i.offset,i.byteLength):this._setByteLength(i.byteLength||0),this}setProps(i){return i=gy("Buffer",i,kM),"accessor"in i&&this.setAccessor(i.accessor),this}setAccessor(i){return i=Object.assign({},i),delete i.buffer,this.accessor=new Go(i),this}reallocate(i){return i>this.byteLength?(this._setByteLength(i),!0):(this.bytesUsed=i,!1)}setData(i){return this.initialize(i)}subData(i){ArrayBuffer.isView(i)&&(i={data:i});const{data:t,offset:e=0,srcOffset:r=0}=i,n=i.byteLength||i.length;Ze(t);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||n!==void 0?(Ao(this.gl),this.gl.bufferSubData(this.target,e,t,r,n)):this.gl.bufferSubData(o,e,t),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(t),this}copyData(i){let{sourceBuffer:t,readOffset:e=0,writeOffset:r=0,size:n}=i;const{gl:o}=this;return Ao(o),o.bindBuffer(36662,t.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,e,r,n),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:i=null,srcByteOffset:t=0,dstOffset:e=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ao(this.gl);const n=ff(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(t),c=e;let l,_;i?(_=i.length,l=_-c):(l=Math.min(o,r||o),_=c+l);const v=Math.min(o,l);return r=r||v,Ze(r<=v),i=i||new n(_),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,e,r),this.gl.bindBuffer(36662,null),i}bind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index,offset:e=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?r!==void 0?this.gl.bindBufferRange(i,t,this.handle,e,r):(Ze(e===0),this.gl.bindBufferBase(i,t,this.handle)):this.gl.bindBuffer(i,this.handle),this}unbind(){let{target:i=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i===35345||i===35982?this.gl.bindBufferBase(i,t,null):this.gl.bindBuffer(i,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(nx,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i.byteLength+t;Ze(ArrayBuffer.isView(i)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,this.usage),this.gl.bufferSubData(r,t,i),this.gl.bindBuffer(r,null),this.debugData=i.slice(0,nx),this.bytesUsed=e,this._trackAllocatedMemory(e);const n=my(i);return Ze(n),this.setAccessor(new Go(this.accessor,{type:n})),this}_setByteLength(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Ze(i>=0),this._trackDeallocatedMemory();let e=i;i===0&&(e=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,e,t),this.gl.bindBuffer(r,null),this.usage=t,this.debugData=null,this.bytesUsed=i,this._trackAllocatedMemory(i),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(i){const t=ff(this.accessor.type||5126,{clamped:!1}),e=i/t.BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(i){this.accessor.type||this.setAccessor(new Go(this.accessor,{type:my(i)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(i){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,i);return this.gl.bindBuffer(this.target,null),t}get type(){return ai.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return ai.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(i){return ai.deprecated("setByteLength","reallocate")(),this.reallocate(i)}updateAccessor(i){return ai.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Go(this.accessor,i),this}};const k1={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},sS={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},oS={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function FM(i,t){const e=k1[t];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;const r=tr(i)&&e.gl2||e.gl1;return typeof r=="string"?i.getExtension(r):r}function DM(i,t){const e=k1[t];switch(e&&e.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const OM=[9729,9728],sx=globalThis.WebGLBuffer||function(){};class Xd extends ch{get[Symbol.toStringTag](){return"Texture"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:n}=e;let o=!0;return r&&(o=o&&FM(t,r),o=o&&(!n||DM(t,r))),o}constructor(t,e){const{id:r=oh("texture"),handle:n,target:o}=e;super(t,{id:r,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.data;if(e instanceof Promise)return e.then(Z=>this.initialize(Object.assign({},t,{pixels:Z,data:Z}))),this;const r=typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement;if(r&&e.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,e.addEventListener("loadeddata",()=>this.initialize(t)),this;const{pixels:n=null,format:o=6408,border:c=0,recreate:l=!1,parameters:_={},pixelStore:v={},textureUnit:S=void 0}=t;e||(e=n);let{width:T,height:P,dataFormat:I,type:z,compressed:N=!1,mipmaps:X=!0}=t;const{depth:H=0}=t;return{width:T,height:P,compressed:N,dataFormat:I,type:z}=this._deduceParameters({format:o,type:z,dataFormat:I,compressed:N,data:e,width:T,height:P}),this.width=T,this.height=P,this.depth=H,this.format=o,this.type=z,this.dataFormat=I,this.border=c,this.textureUnit=S,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),X&&this._isNPOT()&&(ai.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),X=!1,this._updateForNPOT(_)),this.mipmaps=X,this.setImageData({data:e,width:T,height:P,depth:H,format:o,type:z,dataFormat:I,border:c,mipmaps:X,parameters:v,compressed:N}),X&&this.generateMipmap(),this.setParameters(_),l&&(this.data=e),r&&(this._video={video:e,parameters:_,lastTime:e.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?e.currentTime:-1}),this}update(){if(this._video){const{video:t,parameters:e,lastTime:r}=this._video;if(r===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:e}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}resize(t){let{height:e,width:r,mipmaps:n=!1}=t;return r!==this.width||e!==this.height?this.initialize({width:r,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ai.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Sl(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:r=null,level:n=0,format:o=this.format,border:c=this.border,offset:l=0,parameters:_={}}=t;let{data:v=null,type:S=this.type,width:T=this.width,height:P=this.height,dataFormat:I=this.dataFormat,compressed:z=!1}=t;v||(v=r),{type:S,dataFormat:I,compressed:z,width:T,height:P}=this._deduceParameters({format:o,type:S,dataFormat:I,compressed:z,data:v,width:T,height:P});const{gl:N}=this;N.bindTexture(this.target,this.handle);let X=null;({data:v,dataType:X}=this._getDataType({data:v,compressed:z}));let H,Z=0;if(Sl(this.gl,_,()=>{switch(X){case"null":N.texImage2D(e,n,o,T,P,c,I,S,v);break;case"typed-array":N.texImage2D(e,n,o,T,P,c,I,S,v,l);break;case"buffer":H=Ao(N),H.bindBuffer(35052,v.handle||v),H.texImage2D(e,n,o,T,P,c,I,S,l),H.bindBuffer(35052,null);break;case"browser-object":tr(N)?N.texImage2D(e,n,o,T,P,c,I,S,v):N.texImage2D(e,n,o,I,S,v);break;case"compressed":for(const[ot,gt]of v.entries())N.compressedTexImage2D(e,ot,gt.format,gt.width,gt.height,c,gt.data),Z+=gt.levelSize;break;default:Ze(!1,"Unknown image data type")}}),X==="compressed")this._trackAllocatedMemory(Z,"Texture");else if(v&&v.byteLength)this._trackAllocatedMemory(v.byteLength,"Texture");else{const ot=sS[this.dataFormat]||4,gt=oS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*ot*gt,"Texture")}return this.loaded=!0,this}setSubImageData(t){let{target:e=this.target,pixels:r=null,data:n=null,x:o=0,y:c=0,width:l=this.width,height:_=this.height,level:v=0,format:S=this.format,type:T=this.type,dataFormat:P=this.dataFormat,compressed:I=!1,offset:z=0,border:N=this.border,parameters:X={}}=t;if({type:T,dataFormat:P,compressed:I,width:l,height:_}=this._deduceParameters({format:S,type:T,dataFormat:P,compressed:I,data:n,width:l,height:_}),Ze(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const H=n;n=H.data,l=H.shape[0],_=H.shape[1]}n instanceof Gr&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Sl(this.gl,X,()=>{if(I)this.gl.compressedTexSubImage2D(e,v,o,c,l,_,S,n);else if(n===null)this.gl.texSubImage2D(e,v,o,c,l,_,P,T,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(e,v,o,c,l,_,P,T,n,z);else if(n instanceof sx){const H=Ao(this.gl);H.bindBuffer(35052,n),H.texSubImage2D(e,v,o,c,l,_,P,T,z),H.bindBuffer(35052,null)}else tr(this.gl)?Ao(this.gl).texSubImage2D(e,v,o,c,l,_,P,T,n):this.gl.texSubImage2D(e,v,o,c,P,T,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return ai.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}unbind(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:e}=this;return t!==void 0&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}_getDataType(t){let{data:e,compressed:r=!1}=t;return r?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Gr?{data:e.handle,dataType:"buffer"}:e instanceof sx?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:r}=t;let{width:n,height:o,dataFormat:c,type:l,compressed:_}=t;const v=k1[e];return c=c||v&&v.dataFormat,l=l||v&&v.types[0],_=_||v&&v.compressed,{width:n,height:o}=this._deduceImageSize(r,n,o),{dataFormat:c,type:l,compressed:_,width:n,height:o,format:e,data:r}}_deduceImageSize(t,e,r){let n;return typeof ImageData<"u"&&t instanceof ImageData?n={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?n={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?n={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?n={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?n={width:t.videoWidth,height:t.videoHeight}:t?n={width:e,height:r}:n={width:e>=0?e:1,height:r>=0?r:1},Ze(n,"Could not deduced texture size"),Ze(e===void 0||n.width===e,"Deduced texture width does not match supplied width"),Ze(r===void 0||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Ze(!1);break;default:this.gl.texParameteri(this.target,t,e);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return tr(this.gl)||!this.width||!this.height?!1:!rx(this.width)||!rx(this.height)}_updateForNPOT(t){t[this.gl.TEXTURE_MIN_FILTER]===void 0&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),t[this.gl.TEXTURE_WRAP_S]===void 0&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),t[this.gl.TEXTURE_WRAP_T]===void 0&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case 10241:OM.indexOf(e)===-1&&(e=9729);break;case 10242:case 10243:e!==33071&&(e=33071);break}return e}}let NM="";function zM(i,t){return Ze(typeof i=="string"),i=NM+i,new Promise((e,r)=>{try{const n=new Image;n.onload=()=>e(n),n.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),n.crossOrigin=t&&t.crossOrigin||"anonymous",n.src=i}catch(n){r(n)}})}class Sa extends Xd{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(t,e){return Xd.isSupported(t,e)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Og(t),(e instanceof Promise||typeof e=="string")&&(e={data:e}),typeof e.data=="string"&&(e=Object.assign({},e,{data:zM(e.data)})),super(t,Object.assign({},e,{target:3553})),this.initialize(e),Object.seal(this)}}const _y=[34069,34070,34071,34072,34073,34074];class aS extends Xd{get[Symbol.toStringTag](){return"TextureCube"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Og(t),super(t,Object.assign({},e,{target:34067})),this.initialize(e),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:e=!0,parameters:r={}}=t;return this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(r)}),this}subImage(t){let{face:e,data:r,x:n=0,y:o=0,mipmapLevel:c=0}=t;return this._subImage({target:e,data:r,x:n,y:o,mipmapLevel:c})}async setCubeMapImageData(t){let{width:e,height:r,pixels:n,data:o,border:c=0,format:l=6408,type:_=5121}=t;const{gl:v}=this,S=n||o,T=await Promise.all(_y.map(P=>{const I=S[P];return Promise.all(Array.isArray(I)?I:[I])}));this.bind(),_y.forEach((P,I)=>{T[I].length>1&&this.opts.mipmaps!==!1&&ai.warn("".concat(this.id," has mipmap and multiple LODs."))(),T[I].forEach((z,N)=>{e&&r?v.texImage2D(P,N,l,e,r,c,l,_,z):v.texImage2D(P,N,l,l,_,z)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:r,height:n,pixels:o,data:c,border:l=0,format:_=6408,type:v=5121}=t,{gl:S}=this,T=o||c;return this.bind(),T instanceof Promise?T.then(P=>this.setImageDataForFace(Object.assign({},t,{face:e,data:P,pixels:P}))):this.width||this.height?S.texImage2D(e,0,_,r,n,l,_,v,T):S.texImage2D(e,0,_,_,v,T),this}}aS.FACES=_y;class jM extends Xd{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(t){return tr(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ao(t),e=Object.assign({depth:1},e,{target:32879,unpackFlipY:!1}),super(t,e),this.initialize(e),Object.seal(this)}setImageData(t){let{level:e=0,dataFormat:r=6408,width:n,height:o,depth:c=1,border:l=0,format:_,type:v=5121,offset:S=0,data:T,parameters:P={}}=t;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Sl(this.gl,P,()=>{ArrayBuffer.isView(T)&&this.gl.texImage3D(this.target,e,r,n,o,c,l,_,v,T),T instanceof Gr&&(this.gl.bindBuffer(35052,T.handle),this.gl.texImage3D(this.target,e,r,n,o,c,l,_,v,S))}),T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const I=sS[this.dataFormat]||4,z=oS[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*I*z,"Texture")}return this.loaded=!0,this}}const _u="EXT_color_buffer_float",ox={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:_u,bpp:2},33327:{gl2:_u,bpp:4},34842:{gl2:_u,bpp:8},33326:{gl2:_u,bpp:4},33328:{gl2:_u,bpp:8},34836:{gl2:_u,bpp:16},35898:{gl2:_u,bpp:4}};function UM(i,t,e){const r=e[t];if(!r)return!1;const n=tr(i)&&r.gl2||r.gl1;return typeof n=="string"?i.getExtension(n):n}class Id extends ch{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(t){let{format:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!e||UM(t,e,ox)}static getSamplesForFormat(t,e){let{format:r}=e;return t.getInternalformatParameter(36161,r,32937)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.initialize(e),Object.seal(this)}initialize(t){let{format:e,width:r=1,height:n=1,samples:o=0}=t;return Ze(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&tr(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,e,r,n):this.gl.renderbufferStorage(36161,e,r,n),this.format=e,this.width=r,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*ox[this.format].bpp),this}resize(t){let{width:e,height:r}=t;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(36161,t)}_syncHandle(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}const GM=256,VM=1024,qM=16384,ax=6144,lx=6145,cx=6146,hx=34041,lS="clear: bad arguments";function F1(i){let{framebuffer:t=null,color:e=null,depth:r=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};t&&(o.framebuffer=t);let c=0;e&&(c|=qM,e!==!0&&(o.clearColor=e)),r&&(c|=GM,r!==!0&&(o.clearDepth=r)),n&&(c|=VM,r!==!0&&(o.clearStencil=r)),Ze(c!==0,lS),Sl(i,o,()=>{i.clear(c)})}function HM(i){let{framebuffer:t=null,buffer:e=ax,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ao(i),Sl(i,{framebuffer:t},()=>{switch(e){case ax:switch(n.constructor){case Int32Array:i.clearBufferiv(e,r,n);break;case Uint32Array:i.clearBufferuiv(e,r,n);break;case Float32Array:default:i.clearBufferfv(e,r,n)}break;case lx:i.clearBufferfv(lx,0,[n]);break;case cx:i.clearBufferiv(cx,0,[n]);break;case hx:const[o,c]=n;i.clearBufferfi(hx,0,o,c);break;default:Ze(!1,lS)}})}function WM(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Ze(!1),0}}function Ng(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:e=0,sourceY:r=0,sourceFormat:n=6408}=t;let{sourceAttachment:o=36064,target:c=null,sourceWidth:l,sourceHeight:_,sourceType:v}=t;const{framebuffer:S,deleteFramebuffer:T}=XM(i);Ze(S);const{gl:P,handle:I,attachments:z}=S;l=l||S.width,_=_||S.height,o===36064&&I===null&&(o=1028),Ze(z[o]),v=v||z[o].type,c=ZM(c,v,n,l,_),v=v||my(c);const N=P.bindFramebuffer(36160,I);return P.readPixels(e,r,l,_,n,v,c),P.bindFramebuffer(36160,N||null),T&&S.delete(),c}function ux(i){let{sourceAttachment:t=36064,targetMaxHeight:e=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Ng(i,{sourceAttachment:t}),{width:n,height:o}=i;for(;o>e;)({data:r,width:n,height:o}=LM({data:r,width:n,height:o}));IM({data:r,width:n,height:o});const c=document.createElement("canvas");c.width=n,c.height=o;const l=c.getContext("2d"),_=l.createImageData(n,o);return _.data.set(r),l.putImageData(_,0,0),c.toDataURL()}function XM(i){return i instanceof os?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:rB(i),deleteFramebuffer:!0}}function ZM(i,t,e,r,n){if(i)return i;t=t||5121;const o=ff(t,{clamped:!1}),c=WM(e);return new o(r*n*c)}const Kr={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function $M(i){const t=new Sa(i,{format:6408,type:5126,dataFormat:6408}),e=new os(i,{id:"test-framebuffer",check:!1,attachments:{36064:t}}),r=e.getStatus();return t.delete(),e.delete(),r===36053}const cS={[Kr.WEBGL2]:[!1,!0],[Kr.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Kr.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Kr.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Kr.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Kr.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Kr.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Kr.FLOAT_BLEND]:["EXT_float_blend"],[Kr.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Kr.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Kr.TEXTURE_FLOAT]:["OES_texture_float",!0],[Kr.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Kr.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Kr.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Kr.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Kr.COLOR_ATTACHMENT_RGBA32F]:[$M,"EXT_color_buffer_float"],[Kr.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Kr.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Kr.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Kr.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Kr.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Kr.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},YM=2;function D1(i,t){return hS(i,t)}function hS(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>uS(i,e))}function JM(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const t in cS)i.luma.caps[t]===void 0&&(i.luma.caps[t]=uS(i,t));return i.luma.caps}function uS(i,t){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[t]===void 0&&(i.luma.caps[t]=KM(i,t)),i.luma.caps[t]||ai.log(YM,"Feature: ".concat(t," not supported"))(),i.luma.caps[t]}function KM(i,t){const e=cS[t];Ze(e,t);let r;const n=tr(i)&&e[1]||e[0];if(typeof n=="function")r=n(i);else if(Array.isArray(n)){r=!0;for(const o of n)r=r&&!!i.getExtension(o)}else typeof n=="string"?r=!!i.getExtension(n):typeof n=="boolean"?r=n:Ze(!1);return r}const dx="Multiple render targets not supported";class os extends ch{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:n}=e;let o=!0;return r&&(o=!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),n&&(o=o&&!!(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new os(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const t=Ao(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const t=Ao(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(t){let{width:e=1,height:r=1,attachments:n=null,color:o=!0,depth:c=!0,stencil:l=!1,check:_=!0,readBuffer:v=void 0,drawBuffers:S=void 0}=t;if(Ze(e>=0&&r>=0,"Width and height need to be integers"),this.width=e,this.height=r,n)for(const T in n){const P=n[T];(Array.isArray(P)?P[0]:P).resize({width:e,height:r})}else n=this._createDefaultAttachments(o,c,l,e,r);this.update({clearAttachments:!0,attachments:n,readBuffer:v,drawBuffers:S}),n&&_&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();return super.delete(),this}update(t){let{attachments:e={},readBuffer:r,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:c=!0}=t;this.attach(e,{clearAttachments:o,resizeAttachments:c});const{gl:l}=this,_=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),l.bindFramebuffer(36160,_||null),this}resize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:e,height:r}=t;if(this.handle===null)return Ze(e===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;e===void 0&&(e=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),e!==this.width&&r!==this.height&&ai.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(r))();for(const n in this.attachments)this.attachments[n].resize({width:e,height:r});return this.width=e,this.height=r,this}attach(t){let{clearAttachments:e=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};e&&Object.keys(this.attachments).forEach(c=>{n[c]=null}),Object.assign(n,t);const o=this.gl.bindFramebuffer(36160,this.handle);for(const c in n){Ze(c!==void 0,"Misspelled framebuffer binding point?");const l=Number(c),_=n[l];let v=_;if(!v)this._unattach(l);else if(v instanceof Id)this._attachRenderbuffer({attachment:l,renderbuffer:v});else if(Array.isArray(_)){const[S,T=0,P=0]=_;v=S,this._attachTexture({attachment:l,texture:S,layer:T,level:P})}else this._attachTexture({attachment:l,texture:v,layer:0,level:0});r&&v&&v.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(c=>!this.attachments[c]).forEach(c=>{delete this.attachments[c]})}checkStatus(){const t=this.getStatus();if(t!==36053)throw new Error(tB(t));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),r}clear(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:e,depth:r,stencil:n,drawBuffers:o=[]}=t,c=this.gl.bindFramebuffer(36160,this.handle);return(e||r||n)&&F1(this.gl,{color:e,depth:r,stencil:n}),o.forEach((l,_)=>{HM(this.gl,{drawBuffer:_,value:l})}),this.gl.bindFramebuffer(36160,c||null),this}readPixels(){return ai.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return ai.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return ai.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return ai.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return ai.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return ai.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(t){let{attachments:e=[],x:r=0,y:n=0,width:o,height:c}=t;const l=Ao(this.gl),_=l.bindFramebuffer(36008,this.handle);return r===0&&n===0&&o===void 0&&c===void 0?l.invalidateFramebuffer(36008,e):l.invalidateFramebuffer(36008,e,r,n,o,c),l.bindFramebuffer(36008,_),this}getAttachmentParameter(t,e,r){let n=this._getAttachmentParameterFallback(e);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=Gh(this.gl,n)),n}getAttachmentParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of r){const c=e?Gh(this.gl,o):o;n[c]=this.getAttachmentParameter(t,o,e)}return n}getParameters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const e=Object.keys(this.attachments),r={};for(const n of e){const o=Number(n),c=t?Gh(this.gl,o):o;r[c]=this.getAttachmentParameters(o,t)}return r}show(){return typeof window<"u"&&window.open(ux(this),"luma-debug-texture"),this}log(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(t>ai.level||typeof window>"u")return this;e=e||"Framebuffer ".concat(this.id);const r=ux(this,{targetMaxHeight:100});return ai.image({logLevel:t,message:e,image:r},e)(),this}bind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,this.handle),this}unbind(){let{target:t=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,r,n,o){let c=null;return t&&(c=c||{},c[36064]=new Sa(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(c[36064])),e&&r?(c=c||{},c[33306]=new Id(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(c[33306])):e?(c=c||{},c[36096]=new Id(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(c[36096])):r&&Ze(!1),c}_unattach(t){const e=this.attachments[t];e&&(e instanceof Id?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}_attachRenderbuffer(t){let{attachment:e=36064,renderbuffer:r}=t;const{gl:n}=this;n.framebufferRenderbuffer(36160,e,36161,r.handle),this.attachments[e]=r}_attachTexture(t){let{attachment:e=36064,texture:r,layer:n,level:o}=t;const{gl:c}=this;switch(c.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Ao(c).framebufferTextureLayer(36160,e,r.target,o,n);break;case 34067:const l=QM(n);c.framebufferTexture2D(36160,e,l,r.handle,o);break;case 3553:c.framebufferTexture2D(36160,e,3553,r.handle,o);break;default:Ze(!1,"Illegal texture type")}c.bindTexture(r.target,null),this.attachments[e]=r}_setReadBuffer(t){const e=I4(this.gl);e?e.readBuffer(t):Ze(t===36064||t===1029,dx),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this,r=Ao(e);if(r)r.drawBuffers(t);else{const n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):Ze(t.length===1&&(t[0]===36064||t[0]===1029),dx)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=JM(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return!e.WEBGL2&&!e.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(36160,t)}}function QM(i){return i<34069?i+34069:i}function tB(i){return(os.STATUS||{})[i]||"Framebuffer error ".concat(i)}const eB=[36049,36048,33296,33298,33299,33300,33301,33302,33303];os.ATTACHMENT_PARAMETERS=eB;function iB(i,t){Ze(i instanceof Sa||i instanceof aS||i instanceof jM);const e=i.constructor,{gl:r,width:n,height:o,format:c,type:l,dataFormat:_,border:v,mipmaps:S}=i,T=Object.assign({width:n,height:o,format:c,type:l,dataFormat:_,border:v,mipmaps:S},t);return new e(r,T)}function rB(i,t){const{gl:e,width:r,height:n,id:o}=i;return new os(e,Object.assign({},t,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{36064:i}}))}function Gm(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(e);return r?r[1]:t}const nB=35632,sB=35633;function oB(i){switch(i){case nB:return"fragment";case sB:return"vertex";default:return"unknown type"}}function aB(i,t,e,r){const n=i.split(/\r?\n/),o={},c={},l=r||Gm(t)||"(unnamed)",_="".concat(oB(e)," shader ").concat(l);for(let S=0;S<n.length;S++){const T=n[S];if(T.length<=1)continue;const P=T.split(":"),I=P[0],z=parseInt(P[2],10);if(isNaN(z))throw new Error("GLSL compilation error in ".concat(_,": ").concat(i));I!=="WARNING"?o[z]=T:c[z]=T}const v=lB(t);return{shaderName:_,errors:px(o,v),warnings:px(c,v)}}function px(i,t){let e="";for(let r=0;r<t.length;r++){const n=t[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(e+="".concat(n,`
`),i[r+1])){const o=i[r+1],c=o.split(":",3),l=c[0],_=parseInt(c[1],10)||0,v=o.substring(c.join(":").length+1).trim();e+=dS("^^^ ".concat(l,": ").concat(v,`

`),_)}}return e}function lB(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),n=String(r.length+t-1).length;return r.map((o,c)=>{const l=String(c+t),_=l.length;return dS(l,n-_)+e+o})}function dS(i,t){let e="";for(let r=0;r<t;++r)e+=" ";return"".concat(e).concat(i)}function pS(i){let t=100;const e=i.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){const r=parseInt(e[1],10);Number.isFinite(r)&&(t=r)}return t}const cB="Shader: GLSL source code must be a JavaScript string";class mf extends ch{get[Symbol.toStringTag](){return"Shader"}static getTypeName(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Ze(!1),"unknown"}}constructor(t,e){Og(t),Ze(typeof e.source=="string",cB);const r=Gm(e.source,null)||e.id||oh("unnamed ".concat(mf.getTypeName(e.shaderType)));super(t,{id:r}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize(t){let{source:e}=t;const r=Gm(e,null);r&&(this.id=oh(r)),this._compile(e)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return"".concat(mf.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Gm(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(t.startsWith("#version ")||(t=`#version 100
`.concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:n,warnings:o}=aB(e,this.source,this.shaderType,this.id);throw ai.error("GLSL compilation errors in ".concat(r,`
`).concat(n))(),ai.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class r_ extends mf{get[Symbol.toStringTag](){return"VertexShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class n_ extends mf{get[Symbol.toStringTag](){return"FragmentShader"}constructor(t,e){typeof e=="string"&&(e={source:e}),super(t,Object.assign({},e,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const hB={5126:an.bind(null,"uniform1fv",fa,1,$s),35664:an.bind(null,"uniform2fv",fa,2,$s),35665:an.bind(null,"uniform3fv",fa,3,$s),35666:an.bind(null,"uniform4fv",fa,4,$s),5124:an.bind(null,"uniform1iv",Lh,1,$s),35667:an.bind(null,"uniform2iv",Lh,2,$s),35668:an.bind(null,"uniform3iv",Lh,3,$s),35669:an.bind(null,"uniform4iv",Lh,4,$s),35670:an.bind(null,"uniform1iv",Lh,1,$s),35671:an.bind(null,"uniform2iv",Lh,2,$s),35672:an.bind(null,"uniform3iv",Lh,3,$s),35673:an.bind(null,"uniform4iv",Lh,4,$s),35674:an.bind(null,"uniformMatrix2fv",fa,4,Xc),35675:an.bind(null,"uniformMatrix3fv",fa,9,Xc),35676:an.bind(null,"uniformMatrix4fv",fa,16,Xc),35678:Bs,35680:Bs,5125:an.bind(null,"uniform1uiv",dm,1,$s),36294:an.bind(null,"uniform2uiv",dm,2,$s),36295:an.bind(null,"uniform3uiv",dm,3,$s),36296:an.bind(null,"uniform4uiv",dm,4,$s),35685:an.bind(null,"uniformMatrix2x3fv",fa,6,Xc),35686:an.bind(null,"uniformMatrix2x4fv",fa,8,Xc),35687:an.bind(null,"uniformMatrix3x2fv",fa,6,Xc),35688:an.bind(null,"uniformMatrix3x4fv",fa,12,Xc),35689:an.bind(null,"uniformMatrix4x2fv",fa,8,Xc),35690:an.bind(null,"uniformMatrix4x3fv",fa,12,Xc),35678:Bs,35680:Bs,35679:Bs,35682:Bs,36289:Bs,36292:Bs,36293:Bs,36298:Bs,36299:Bs,36300:Bs,36303:Bs,36306:Bs,36307:Bs,36308:Bs,36311:Bs},uB={},dB={},pB={},fx=[0];function O1(i,t,e,r){t===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(fx[0]=i,i=fx);const n=i.length;if(n%t&&ai.warn("Uniform size should be multiples of ".concat(t),i)(),i instanceof e)return i;let o=r[n];o||(o=new e(n),r[n]=o);for(let c=0;c<n;c++)o[c]=i[c];return o}function fa(i,t){return O1(i,t,Float32Array,uB)}function Lh(i,t){return O1(i,t,Int32Array,dB)}function dm(i,t){return O1(i,t,Uint32Array,pB)}function mx(i,t,e){const r=hB[e.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(e.type));return r().bind(null,i,t)}function fB(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/,e=i.match(t);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:e[1],length:e[2]||1,isArray:!!e[2]}}function mB(i,t,e){for(const r in i){const n=i[r];if((!e||e[r])&&!gB(n))throw t=t?"".concat(t," "):"",console.error("".concat(t," Bad uniform ").concat(r),n),new Error("".concat(t," Bad uniform ").concat(r))}return!0}function gB(i){return Array.isArray(i)||ArrayBuffer.isView(i)?yB(i):isFinite(i)||i===!0||i===!1||i instanceof Xd||i instanceof Id?!0:i instanceof os?!!i.texture:!1}function _B(i,t,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(i[t]){const r=i[t];for(let n=0,o=e.length;n<o;++n)r[n]=e[n]}else i[t]=e.slice();else i[t]=e}function yB(i){if(i.length===0)return!1;const t=Math.min(i.length,16);for(let e=0;e<t;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Bs(){let i=null;return(t,e,r)=>{const n=i!==r;return n&&(t.uniform1i(e,r),i=r),n}}function an(i,t,e,r){let n=null,o=null;return(c,l,_)=>{const v=t(_,e),S=v.length;let T=!1;if(n===null)n=new Float32Array(S),o=S,T=!0;else{Ze(o===S,"Uniform length cannot change.");for(let P=0;P<S;++P)if(v[P]!==n[P]){T=!0;break}}return T&&(r(c,i,l,v),n.set(v)),T}}function $s(i,t,e,r){i[t](e,r)}function Xc(i,t,e,r){i[t](e,!1,r)}const vB=5120,bB=5121,xB=5122,wB=5123,gx=0,pm=1,SB=2,AB=3,fm=4,EB=5,TB=6,ns=5126,CB=35664,PB=35665,IB=35666,Np=5124,LB=35667,MB=35668,BB=35669,zp=5125,RB=36294,kB=36295,FB=36296,DB=35670,OB=35671,NB=35672,zB=35673,jB=35674,UB=35675,GB=35676,VB=35685,qB=35686,HB=35687,WB=35688,XB=35689,ZB=35690,yy={[ns]:[ns,1,"float"],[CB]:[ns,2,"vec2"],[PB]:[ns,3,"vec3"],[IB]:[ns,4,"vec4"],[Np]:[Np,1,"int"],[LB]:[Np,2,"ivec2"],[MB]:[Np,3,"ivec3"],[BB]:[Np,4,"ivec4"],[zp]:[zp,1,"uint"],[RB]:[zp,2,"uvec2"],[kB]:[zp,3,"uvec3"],[FB]:[zp,4,"uvec4"],[DB]:[ns,1,"bool"],[OB]:[ns,2,"bvec2"],[NB]:[ns,3,"bvec3"],[zB]:[ns,4,"bvec4"],[jB]:[ns,8,"mat2"],[VB]:[ns,8,"mat2x3"],[qB]:[ns,8,"mat2x4"],[UB]:[ns,12,"mat3"],[HB]:[ns,12,"mat3x2"],[WB]:[ns,12,"mat3x4"],[GB]:[ns,16,"mat4"],[XB]:[ns,16,"mat4x2"],[ZB]:[ns,16,"mat4x3"]};function $B(i){switch(i){case gx:return gx;case pm:return pm;case AB:return pm;case SB:return pm;case fm:return fm;case EB:return fm;case TB:return fm;default:return Ze(!1),0}}function _x(i){const t=yy[i];if(!t)return null;const[e,r]=t;return{type:e,components:r}}function fS(i,t){switch(i){case vB:case bB:case xB:case wB:i=ns;break}for(const e in yy){const[r,n,o]=yy[e];if(r===i&&n===t)return{glType:e,name:o}}return null}class YB{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,r=e.getProgramParameter(t.handle,35721);for(let n=0;n<r;n++){const{name:o,type:c,size:l}=e.getActiveAttrib(t.handle,n),_=e.getAttribLocation(t.handle,o);_>=0&&this._addAttribute(_,o,c,l)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!tr(e))return;const r=e.getProgramParameter(t.handle,35971);for(let n=0;n<r;n++){const{name:o,type:c,size:l}=e.getTransformFeedbackVarying(t.handle,n);this._addVarying(n,o,c,l)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(t,e,r,n){const{type:o,components:c}=_x(r),l={type:o,size:n*c};this._inferProperties(t,e,l);const _={location:t,name:e,accessor:new Go(l)};this.attributeInfos.push(_),this.attributeInfosByLocation[t]=_,this.attributeInfosByName[_.name]=_}_inferProperties(t,e,r){/instance/i.test(e)&&(r.divisor=1)}_addVarying(t,e,r,n){const{type:o,components:c}=_x(r),l=new Go({type:o,size:n*c}),_={location:t,name:e,accessor:l};this.varyingInfos.push(_),this.varyingInfosByName[_.name]=_}}const yx=4,JB=35981,KB=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class mS extends ch{get[Symbol.toStringTag](){return"Program"}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.stubRemovedMethods("Program","v6.0",KB),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:e,vs:r,fs:n,varyings:o,bufferMode:c=JB}=t;return this.hash=e||"",this.vs=typeof r=="string"?new r_(this.gl,{id:"".concat(t.id,"-vs"),source:r}):r,this.fs=typeof n=="string"?new n_(this.gl,{id:"".concat(t.id,"-fs"),source:n}):n,Ze(this.vs instanceof r_),Ze(this.fs instanceof n_),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(Ao(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new YB(this),this.setProps(t)}delete(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw(t){let{logPriority:e,drawMode:r=4,vertexCount:n,offset:o=0,start:c,end:l,isIndexed:_=!1,indexType:v=5123,instanceCount:S=0,isInstanced:T=S>0,vertexArray:P=null,transformFeedback:I,framebuffer:z,parameters:N={},uniforms:X,samplers:H}=t;if((X||H)&&(ai.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(X||{})),ai.priority>=e){const Z=z?z.id:"default",ot="mode=".concat(Gh(this.gl,r)," verts=").concat(n," ")+"instances=".concat(S," indexType=").concat(Gh(this.gl,v)," ")+"isInstanced=".concat(T," isIndexed=").concat(_," ")+"Framebuffer=".concat(Z);ai.log(e,ot)()}return Ze(P),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||T&&S===0?!1:(P.bindForDraw(n,S,()=>{if(z!==void 0&&(N=Object.assign({},N,{framebuffer:z})),I){const Z=$B(r);I.begin(Z)}this._bindTextures(),Sl(this.gl,N,()=>{_&&T?this.gl2.drawElementsInstanced(r,n,v,o,S):_&&tr(this.gl)&&!isNaN(c)&&!isNaN(l)?this.gl2.drawRangeElements(r,c,l,n,v,o):_?this.gl.drawElements(r,n,v,o):T?this.gl2.drawArraysInstanced(r,o,n,S):this.gl.drawArrays(r,o,n)}),I&&I.end()}),!0)}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ai.priority>=2&&mB(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const e in t){const r=t[e],n=this._uniformSetters[e];if(n){let o=r,c=!1;if(o instanceof os&&(o=o.texture),o instanceof Xd)if(c=this.uniforms[e]!==r,c){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const l=o,{textureIndex:_}=n;l.bind(_),o=_,this._textureUniforms[e]=l}else o=n.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(n(o)||c)&&_B(this.uniforms,e,r)}}return this}_areTexturesRenderable(){let t=!0;for(const e in this._textureUniforms){const r=this._textureUniforms[e];r.update(),t=t&&r.loaded}return t}_bindTextures(){for(const t in this._textureUniforms){const e=this._uniformSetters[t].textureIndex;this._textureUniforms[t].bind(e)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),r={};for(const n of e)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new r_({handle:n});break;case 35632:r.fs=new n_({handle:n});break}return r}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const e=this._getName();this.id=oh(e)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=t.replace(/shader/i,""),t=t?"".concat(t,"-program"):"program",t}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ai.time(yx,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),ai.timeEnd(yx,"linkProgram for ".concat(this._getName()))(),t.debug||ai.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let e=0;e<this._uniformCount;e++){const r=this.gl.getActiveUniform(this.handle,e),{name:n}=fB(r.name);let o=t.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=mx(t,o,r),r.size>1)for(let c=0;c<r.size;c++)o=t.getUniformLocation(this.handle,"".concat(n,"[").concat(c,"]")),this._uniformSetters["".concat(n,"[").concat(c,"]")]=mx(t,o,r)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl2.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}const QB=34918,t6=34919,e6=35007,i6=36795,r6=35976,n6=35887,s6=36202;class fg extends ch{get[Symbol.toStringTag](){return"Query"}static isSupported(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=tr(t),n=hS(t,Kr.TIMER_QUERY);let o=r||n;for(const c of e)switch(c){case"queries":o=o&&r;break;case"timers":o=o&&n;break;default:Ze(!1)}return o}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(e6)}beginOcclusionQuery(){let{conservative:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(t?s6:n6)}beginTransformFeedbackQuery(){return this.begin(r6)}begin(t){return this._queryPending?this:(this.target=t,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl2.getQueryParameter(this.handle,t6);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl2.getParameter(i6)}getResult(){return this.gl2.getQueryParameter(this.handle,QB)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((r,n)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):e++>t?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return fg.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class gS extends ch{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(t){return tr(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ao(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Wd(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const r=this._getVaryingIndex(t),{buffer:n,byteSize:o,byteOffset:c}=this._getBufferParams(e);return r<0?(this.unused[t]=n,ai.warn("".concat(this.id," unused varying buffer ").concat(t))(),this):(this.buffers[r]=e,this.bindOnUse||this._bindBuffer(r,n,c,o),this)}begin(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(t){let e,r,n;return t instanceof Gr?n=t:(n=t.buffer,r=t.byteSize,e=t.byteOffset),(e!==void 0||r!==void 0)&&(e=e||0,r=r||n.byteLength-e),{buffer:n,byteOffset:e,byteSize:r}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=e&&e.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,t,o):this.gl.bindBufferRange(35982,t,o,r,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(36386,this.handle)}}let mm=null;function o6(i){return(!mm||mm.byteLength<i)&&(mm=new ArrayBuffer(i)),mm}function a6(i,t){const e=o6(i.BYTES_PER_ELEMENT*t);return new i(e,0,t)}function l6(i){let{target:t,source:e,start:r=0,count:n=1}=i;const o=e.length,c=n*o;let l=0;for(let _=r;l<o;l++)t[_++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}const c6="elements must be GL.ELEMENT_ARRAY_BUFFER";class ya extends ch{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(t){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?tr(t)||O3()==="Chrome":!0}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new ya(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return ya.MAX_ATTRIBUTES=ya.MAX_ATTRIBUTES||t.getParameter(34921),ya.MAX_ATTRIBUTES}static setConstant(t,e,r){switch(r.constructor){case Float32Array:ya._setConstantFloatArray(t,e,r);break;case Int32Array:ya._setConstantIntArray(t,e,r);break;case Uint32Array:ya._setConstantUintArray(t,e,r);break;default:Ze(!1)}}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=e.isDefaultArray||!1,this.gl2=t,this.initialize(e),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ya.getMaxAttributes(this.gl)}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(t)}setProps(t){return this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Ze(!t||t.target===34963,c6),this.bind(()=>{this.gl.bindBuffer(34963,t?t.handle:null)}),this}setBuffer(t,e,r){if(e.target===34963)return this.setElementBuffer(e,r);const{size:n,type:o,stride:c,offset:l,normalized:_,integer:v,divisor:S}=r,{gl:T,gl2:P}=this;return t=Number(t),this.bind(()=>{T.bindBuffer(34962,e.handle),v?(Ze(tr(T)),P.vertexAttribIPointer(t,n,o,c,l)):T.vertexAttribPointer(t,n,o,_,c,l),T.enableVertexAttribArray(t),P.vertexAttribDivisor(t,S||0)}),this}enable(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!e&&t===0&&!ya.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e){const r=this._normalizeConstantArrayValue(e),n=r.byteLength*t,o=r.length*t;let c=!this.buffer;if(this.buffer=this.buffer||new Gr(this.gl,n),c=c||this.buffer.reallocate(n),c=c||!this._compareConstantArrayValues(r,this.bufferValue),c){const l=a6(e.constructor,o);l6({target:l,source:r,start:0,count:o}),this.buffer.subData(l),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}static _setConstantFloatArray(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:Ze(!1)}}static _setConstantIntArray(t,e,r){switch(Ze(tr(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:Ze(!1)}}static _setConstantUintArray(t,e,r){switch(Ze(tr(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:Ze(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(t){return this.gl2.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.gl2.bindVertexArray(t)}_getParameter(t,e){let{location:r}=e;return Ze(Number.isFinite(r)),this.bind(()=>{switch(t){case 34373:return this.gl.getVertexAttribOffset(r,t);default:return this.gl.getVertexAttrib(r,t)}})}}const h6="VertexArray: attributes must be Buffers or constants (i.e. typed array)",u6=/^(.+)__LOCATION_([0-9]+)$/,d6=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class p6{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=e.id||e.program&&e.program.id;this.id=r,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ya(t),rS(this,"VertexArray","v6.0",d6),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const r=t[e];this._setAttribute(e,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e.target===34963)return this.setElementBuffer(e,r);const{location:n,accessor:o}=this._resolveLocationAndAccessor(t,e,e.accessor,r);return n>=0&&(this.values[n]=e,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,e,o)),this}setConstant(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},r));return n>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[n]=e,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Gr(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof Gr&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(t,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof Gr&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),n=r()}),n}_resolveLocationAndAccessor(t,e,r,n){const o={location:-1,accessor:null},{location:c,name:l}=this._getAttributeIndex(t);if(!Number.isFinite(c)||c<0)return this.unused[t]=e,ai.once(3,()=>"unused value ".concat(t," in ").concat(this.id))(),o;const _=this._getAttributeInfo(l||c);if(!_)return o;const v=this.accessors[c]||{},S=Go.resolve(_.accessor,v,r,n),{size:T,type:P}=S;return Ze(Number.isFinite(T)&&Number.isFinite(P)),{location:c,accessor:S}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const r=u6.exec(t),n=r?r[1]:t,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(t,e){if(e instanceof Gr)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Gr){const r=e[0],n=e[1];this.setBuffer(t,r,n)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const r=e;this.setConstant(t,r)}else if(e.buffer instanceof Gr){const r=e;this.setBuffer(t,r.buffer,r)}else throw new Error(h6)}_setConstantAttributes(t,e){const r=Math.max(t|0,e|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(t,e){if(ya.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,t);return}const r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(t,e){ya.setConstant(this.gl,t,e)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const r=this.values[e],n=this.accessors[e];if(!r)return;const{divisor:o}=n,c=o>0;if(t.isInstanced=t.isInstanced||c,r instanceof Gr){const l=r;if(c){const _=l.getVertexCount(n);t.instanceCount=Math.min(t.instanceCount,_)}else{const _=l.getVertexCount(n);t.vertexCount=Math.min(t.vertexCount,_)}}}setElements(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ai.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}function f6(i,t){const{maxElts:e=16,size:r=1}=t;let n="[";for(let c=0;c<i.length&&c<e;++c)c>0&&(n+=",".concat(c%r===0?" ":"")),n+=gf(i[c],t);const o=i.length>e?"...":"]";return"".concat(n).concat(o)}function gf(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=1e-16,{isInteger:r=!1}=t;if(Array.isArray(i)||ArrayBuffer.isView(i))return f6(i,t);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<e)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const n=i.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function vx(i){let{header:t="Uniforms",program:e,uniforms:r,undefinedOnly:n=!1}=i;Ze(e);const o=".*_.*",c=".*Matrix",l=e._uniformSetters,_={},v=Object.keys(l).sort();let S=0;for(const I of v)!I.match(o)&&!I.match(c)&&s_({table:_,header:t,uniforms:r,uniformName:I,undefinedOnly:n})&&S++;for(const I of v)I.match(c)&&s_({table:_,header:t,uniforms:r,uniformName:I,undefinedOnly:n})&&S++;for(const I of v)_[I]||s_({table:_,header:t,uniforms:r,uniformName:I,undefinedOnly:n})&&S++;let T=0;const P={};if(!n)for(const I in r){const z=r[I];_[I]||(T++,P[I]={Type:"NOT USED: ".concat(z),[t]:gf(z)})}return{table:_,count:S,unusedTable:P,unusedCount:T}}function s_(i){let{table:t,header:e,uniforms:r,uniformName:n,undefinedOnly:o}=i;const c=r[n],l=m6(c);return!o||!l?(t[n]={[e]:l?gf(c):"N/A","Uniform Type":l?c:"NOT PROVIDED"},!0):!1}function m6(i){return i!=null}function g6(i){let{vertexArray:t,header:e="Attributes"}=i;if(!t.configuration)return{};const r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=bx(t,t.elements,null,e));const n=t.values;for(const o in n){const c=t._getAttributeInfo(o);if(c){let l="".concat(o,": ").concat(c.name);const _=t.accessors[c.location];_&&(l="".concat(o,": ").concat(_6(c.name,_))),r[l]=bx(t,n[o],_,e)}}return r}function bx(i,t,e,r){const{gl:n}=i;if(!t)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",c=1,l=0,_=0,v,S,T;if(e&&(o=e.type,c=e.size,o=String(o).replace("Array",""),v=o.indexOf("nt")!==-1),t instanceof Gr){const P=t,{data:I,changed:z}=P.getDebugData();S=z?"*":"",T=I,_=P.byteLength,l=_/I.BYTES_PER_ELEMENT/c;let N;if(e){const X=e.divisor>0;N="".concat(X?"I ":"P "," ").concat(l," (x").concat(c,"=").concat(_," bytes ").concat(Gh(n,o),")")}else v=!0,N="".concat(_," bytes");return{[r]:"".concat(S).concat(gf(T,{size:c,isInteger:v})),"Format ":N}}return T=t,c=t.length,o=String(t.constructor.name).replace("Array",""),v=o.indexOf("nt")!==-1,{[r]:"".concat(gf(T,{size:c,isInteger:v})," (constant)"),"Format ":"".concat(c,"x").concat(o," (constant)")}}function _6(i,t){const{type:e,size:r}=t,n=fS(e,r);return n?"".concat(i," (").concat(n.name,")"):i}function y6(i){const t={},e="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const n=xx(r);t["in ".concat(n)]={[e]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const n=xx(r);t["out ".concat(n)]={[e]:JSON.stringify(r.accessor)}}return t}function xx(i){const{type:t,size:e}=i.accessor,r=fS(t,e);return r?"".concat(r.name," ").concat(i.name):i.name}const wx=lh()&&typeof document<"u";let v6=0;class b6{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:e=X=>iS(X),onAddHTML:r=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:c=()=>{},onError:l,gl:_=null,glOptions:v={},debug:S=!1,createFramebuffer:T=!1,autoResizeViewport:P=!0,autoResizeDrawingBuffer:I=!0,stats:z=Cu.get("animation-loop-".concat(v6++))}=t;let{useDevicePixels:N=!0}=t;"useDevicePixelRatio"in t&&(ai.deprecated("useDevicePixelRatio","useDevicePixels")(),N=t.useDevicePixelRatio),this.props={onCreateContext:e,onAddHTML:r,onInitialize:n,onRender:o,onFinalize:c,onError:l,gl:_,glOptions:v,debug:S,createFramebuffer:T},this.gl=_,this.needsRedraw=null,this.timeline=null,this.stats=z,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:I,useDevicePixels:N}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(t){return Ze(typeof t=="string"),this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const e=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(t),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=fg.isSupported(this.gl,["timers"])?new fg(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&e.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(t);return r?Number(r.value):e}setViewParameters(){return ai.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const t=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(t))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(t)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=wx?new Promise((t,e)=>{if(wx&&document.readyState==="complete"){t(document);return}window.addEventListener("load",()=>{t(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_cancelAnimationFrame(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):CM(t)}_requestAnimationFrame(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):TM(t)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:t,height:e,aspect:r}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(t){typeof t=="object"&&t!==null&&(this.animationProps=Object.assign({},this.animationProps,t))}_createWebGLContext(t){if(this.offScreen=t.canvas&&typeof OffscreenCanvas<"u"&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?R1(this.props.gl,t):this.onCreateContext(t),!Dg(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");pM(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);const r=this.props.onAddHTML(e);r&&(e.innerHTML=r)}}_getSizeAndAspect(){const t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:t>0&&e>0&&(r=t/e),{width:t,height:e,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&yM(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new os(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:t}=this.gl;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}_onMouseleave(t){this.animationProps._mousePosition=null}}const kf="vs",N1="fs";function xa(i,t){if(!i)throw new Error(t||"shadertools: assertion failed.")}const o_={number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},array:{validate(i,t){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function x6(i){const t={};for(const e in i){const r=i[e],n=w6(r);t[e]=n}return t}function w6(i){let t=Sx(i);return t==="object"?i?"type"in i?Object.assign({},i,o_[i.type]):"value"in i?(t=Sx(i.value),Object.assign({type:t},i,o_[t])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:t,value:i},o_[t])}function Sx(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const S6="vs",A6="fs";class Ax{constructor(t){let{name:e,vs:r,fs:n,dependencies:o=[],uniforms:c,getUniforms:l,deprecations:_=[],defines:v={},inject:S={},vertexShader:T,fragmentShader:P}=t;xa(typeof e=="string"),this.name=e,this.vs=r||T,this.fs=n||P,this.getModuleUniforms=l,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(_),this.defines=v,this.injections=E6(S),c&&(this.uniforms=x6(c))}getModuleSource(t){let e;switch(t){case S6:e=this.vs||"";break;case A6:e=this.fs||"";break;default:xa(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(e,"// END MODULE_").concat(this.name,`

`)}getUniforms(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}getDefines(){return this.defines}checkDeprecations(t,e){this.deprecations.forEach(r=>{r.regex.test(t)&&(r.deprecated?e.deprecated(r.old,r.new)():e.removed(r.old,r.new)())})}_parseDeprecationDefinitions(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp("\\b".concat(e.old,"\\("));break;default:e.regex=new RegExp("".concat(e.type," ").concat(e.old,";"))}}),t}_defaultGetUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={},r=this.uniforms;for(const n in r){const o=r[n];n in t&&!o.private?(o.validate&&xa(o.validate(t[n],o),"".concat(this.name,": invalid ").concat(n)),e[n]=t[n]):e[n]=o.value}return e}}function E6(i){const t={vs:{},fs:{}};for(const e in i){let r=i[e];const n=e.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),t[n][e]=r}return t}function T6(i){return C6(yS(i))}function C6(i){const t={},e={};return _S({modules:i,level:0,moduleMap:t,moduleDepth:e}),Object.keys(e).sort((r,n)=>e[n]-e[r]).map(r=>t[r])}function _S(i){let{modules:t,level:e,moduleMap:r,moduleDepth:n}=i;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const o of t)r[o.name]=o,(n[o.name]===void 0||n[o.name]<e)&&(n[o.name]=e);for(const o of t)o.dependencies&&_S({modules:o.dependencies,level:e+1,moduleMap:r,moduleDepth:n})}function yS(i,t){return i.map(e=>(e instanceof Ax||(xa(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),xa(e.name,"shader module has no name"),e=new Ax(e),e.dependencies=yS(e.dependencies)),e))}function P6(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=typeof window<"u"?window.navigator||{}:{},e=i.userAgent||t.userAgent||"",r=e.indexOf("MSIE ")!==-1,n=e.indexOf("Trident/")!==-1;return r||n}const I6=7936,L6=7937,M6=7938,B6=35724,z1={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},wu={};Object.keys(z1).forEach(i=>{wu[i]=i});function R6(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function k6(i){const t=i.getExtension("WEBGL_debug_renderer_info"),e=i.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||I6),r=i.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||L6);return{gpuVendor:F6(e,r),vendor:e,renderer:r,version:i.getParameter(M6),shadingLanguageVersion:i.getParameter(B6)}}function F6(i,t){return i.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||t.match(/AMD/i)||i.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const a_={};function Ex(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=z1[t];if(xa(r,t),!P6(e))return!0;if(t in a_)return a_[t];const n=r[0],o=e.behavior||"enable",c="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),l=i.createShader(35633);i.shaderSource(l,c),i.compileShader(l);const _=i.getShaderParameter(l,35713);return i.deleteShader(l),a_[t]=_,_}function D6(i,t){const e=z1[t];xa(e,t);const r=R6(i)&&e[1]||e[0],n=typeof r=="string"?!!i.getExtension(r):r;return xa(n===!1||n===!0),n}function gm(i,t){return t=Array.isArray(t)?t:[t],t.every(e=>D6(i,e))}function O6(i){switch(k6(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function N6(i,t,e){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return gm(i,wu.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),gm(i,wu.GLSL_DERIVATIVES)&&Ex(i,wu.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),gm(i,wu.GLSL_FRAG_DATA)&&Ex(i,wu.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),gm(i,wu.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const z6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,j6=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,U6={[kf]:z6,[N1]:j6},Vm="__LUMA_INJECT_DECLARATIONS__",Tx=/void\s+main\s*\([^)]*\)\s*\{\n?/,Cx=/}\n?[^{}]*$/,l_=[];function Px(i,t,e){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=t===kf;for(const o in e){const c=e[o];c.sort((_,v)=>_.order-v.order),l_.length=c.length;for(let _=0,v=c.length;_<v;++_)l_[_]=c[_].injection;const l="".concat(l_.join(`
`),`
`);switch(o){case"vs:#decl":n&&(i=i.replace(Vm,l));break;case"vs:#main-start":n&&(i=i.replace(Tx,_=>_+l));break;case"vs:#main-end":n&&(i=i.replace(Cx,_=>l+_));break;case"fs:#decl":n||(i=i.replace(Vm,l));break;case"fs:#main-start":n||(i=i.replace(Tx,_=>_+l));break;case"fs:#main-end":n||(i=i.replace(Cx,_=>l+_));break;default:i=i.replace(o,_=>_+l)}}return i=i.replace(Vm,""),r&&(i=i.replace(/\}\s*$/,o=>o+U6[t])),i}function vy(i){const t={};return xa(Array.isArray(i)&&i.length>1),i.forEach(e=>{for(const r in e)t[r]=t[r]?"".concat(t[r],`
`).concat(e[r]):e[r]}),t}function Zd(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const vS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],G6=[...vS,[Zd("attribute"),"in $1"],[Zd("varying"),"out $1"]],V6=[...vS,[Zd("varying"),"in $1"]],bS=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],q6=[...bS,[Zd("in"),"attribute $1"],[Zd("out"),"varying $1"]],H6=[...bS,[Zd("in"),"varying $1"]],by="gl_FragColor",xy=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,W6=/void\s+main\s*\([^)]*\)\s*\{\n?/;function X6(i,t,e){switch(t){case 300:return e?mg(i,G6):Z6(i);case 100:return e?mg(i,q6):$6(i);default:throw new Error("unknown GLSL version ".concat(t))}}function mg(i,t){for(const[e,r]of t)i=i.replace(e,r);return i}function Z6(i){i=mg(i,V6);const t=i.match(xy);if(t){const e=t[1];i=i.replace(new RegExp("\\b".concat(by,"\\b"),"g"),e)}else{const e="fragmentColor";i=i.replace(W6,r=>"out vec4 ".concat(e,`;
`).concat(r)).replace(new RegExp("\\b".concat(by,"\\b"),"g"),e)}return i}function $6(i){i=mg(i,H6);const t=i.match(xy);if(t){const e=t[1];i=i.replace(xy,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),by)}return i}const Y6=`

`.concat(Vm,`

`),xS={[kf]:"vertex",[N1]:"fragment"},J6=`precision highp float;

`;function K6(i,t){const{vs:e,fs:r}=t,n=T6(t.modules||[]);return{gl:i,vs:Ix(i,Object.assign({},t,{source:e,type:kf,modules:n})),fs:Ix(i,Object.assign({},t,{source:r,type:N1,modules:n})),getUniforms:Q6(n)}}function Ix(i,t){let{id:e,source:r,type:n,modules:o,defines:c={},hookFunctions:l=[],inject:_={},transpileToGLSL100:v=!1,prologue:S=!0,log:T}=t;xa(typeof r=="string","shader source must be a string");const P=n===kf,I=r.split(`
`);let z=100,N="",X=r;I[0].indexOf("#version ")===0?(z=300,N=I[0],X=I.slice(1).join(`
`)):N="#version ".concat(z);const H={};o.forEach(Mt=>{Object.assign(H,Mt.getDefines())}),Object.assign(H,c);let Z=S?"".concat(N,`
`).concat(eR({id:e,source:r,type:n}),`
`).concat(tR({type:n}),`
`).concat(O6(i),`
`).concat(N6(i),`
`).concat(iR(H),`
`).concat(P?"":J6,`
`):"".concat(N,`
`);const ot=nR(l),gt={},Et={},Ft={};for(const Mt in _){const yt=typeof _[Mt]=="string"?{injection:_[Mt],order:0}:_[Mt],Ut=Mt.match(/^(v|f)s:(#)?([\w-]+)$/);if(Ut){const zt=Ut[2],at=Ut[3];zt?at==="decl"?Et[Mt]=[yt]:Ft[Mt]=[yt]:gt[Mt]=[yt]}else Ft[Mt]=[yt]}for(const Mt of o){T&&Mt.checkDeprecations(X,T);const yt=Mt.getModuleSource(n,z);Z+=yt;const Ut=Mt.injections[n];for(const zt in Ut){const at=zt.match(/^(v|f)s:#([\w-]+)$/);if(at){const pt=at[2]==="decl"?Et:Ft;pt[zt]=pt[zt]||[],pt[zt].push(Ut[zt])}else gt[zt]=gt[zt]||[],gt[zt].push(Ut[zt])}}return Z+=Y6,Z=Px(Z,n,Et),Z+=rR(ot[n],gt),Z+=X,Z=Px(Z,n,Ft),Z=X6(Z,v?100:z,P),Z}function Q6(i){return function(t){const e={};for(const r of i){const n=r.getUniforms(t,e);Object.assign(e,n)}return e}}function tR(i){let{type:t}=i;return`
#define SHADER_TYPE_`.concat(xS[t].toUpperCase(),`
`)}function eR(i){let{id:t,source:e,type:r}=i;return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(t,"_").concat(xS[r],`

`):""}function iR(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=0,e="";for(const r in i){t===0&&(e+=`
// APPLICATION DEFINES
`),t++;const n=i[r];(n||Number.isFinite(n))&&(e+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return t===0&&(e+=`
`),e}function rR(i,t){let e="";for(const r in i){const n=i[r];if(e+="void ".concat(n.signature,` {
`),n.header&&(e+="  ".concat(n.header)),t[r]){const o=t[r];o.sort((c,l)=>c.order-l.order);for(const c of o)e+="  ".concat(c.injection,`
`)}n.footer&&(e+="  ".concat(n.footer)),e+=`}
`}return e}function nR(i){const t={vs:{},fs:{}};return i.forEach(e=>{let r;typeof e!="string"?(r=e,e=r.hook):r={},e=e.trim();const[n,o]=e.split(":"),c=e.replace(/\(.+/,"");t[n][c]=Object.assign(r,{signature:o})}),t}const sR="void main() {gl_FragColor = vec4(0);}",wS=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,oR=`#version 300 es
`.concat(wS);function SS(i,t){t=Array.isArray(t)?t:[t];const e=i.replace(/^\s+/,"").split(/\s+/),[r,n,o]=e;if(!t.includes(r)||!n||!o)return null;const c=o.split(";")[0];return{qualifier:r,type:n,name:c}}function AS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:t=100,input:e,inputType:r,output:n}=i;if(!e)return t===300?oR:t>300?"#version ".concat(t,`
`).concat(wS):sR;const o=cR(e,r);return t>=300?"#version ".concat(t," ").concat(t===300?"es":"",`
in `).concat(r," ").concat(e,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(e,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function aR(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return xa(!1),null}}function lR(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return xa(!1),null}}function cR(i,t){switch(t){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return xa(!1),null}}const hR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,uR={name:"fp32",vs:hR,fs:null};function bl(i,t){if(!i)throw new Error("math.gl assertion ".concat(t))}const dR=1/Math.PI*180,pR=1/180*Math.PI,ss={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function fR(i){let{precision:t=ss.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=yR(i),"".concat(parseFloat(i.toPrecision(t)))}function Wh(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function mR(i){return _R(i)}function gR(i){return Qc(i)}function _R(i,t){return j1(i,e=>e*pR,t)}function Qc(i,t){return j1(i,e=>e*dR,t)}function th(i,t,e){return j1(i,r=>Math.max(t,Math.min(e,r)))}function gg(i,t,e){return Wh(i)?i.map((r,n)=>gg(r,t[n],e)):e*t+(1-e)*i}function Al(i,t,e){const r=ss.EPSILON;e&&(ss.EPSILON=e);try{if(i===t)return!0;if(Wh(i)&&Wh(t)){if(i.length!==t.length)return!1;for(let n=0;n<i.length;++n)if(!Al(i[n],t[n]))return!1;return!0}return i&&i.equals?i.equals(t):t&&t.equals?t.equals(i):typeof i=="number"&&typeof t=="number"?Math.abs(i-t)<=ss.EPSILON*Math.max(1,Math.abs(i),Math.abs(t)):!1}finally{ss.EPSILON=r}}function yR(i){return Math.round(i/ss.EPSILON)*ss.EPSILON}function vR(i){return i.clone?i.clone():new Array(i.length)}function j1(i,t,e){if(Wh(i)){const r=i;e=e||vR(r);for(let n=0;n<e.length&&n<r.length;++n)e[n]=t(i[n],n,e);return e}return t(i)}function bR(i){function t(){var e=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i,t}class U1 extends bR(Array){clone(){return new this.constructor().copy(this)}fromArray(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}toArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Wh(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ss)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+fR(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Al(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){if(r===void 0)return this.lerp(this,t,e);for(let n=0;n<this.ELEMENTS;++n){const o=t[n];this[n]=o+r*(e[n]-o)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(ss.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}get elements(){return this}}function xR(i,t){if(i.length!==t)return!1;for(let e=0;e<i.length;++e)if(!Number.isFinite(i[e]))return!1;return!0}function Sr(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function af(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(ss.debug&&!xR(i,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return i}class G1 extends U1{get x(){return this[0]}set x(t){this[0]=Sr(t)}get y(){return this[1]}set y(t){this[1]=Sr(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-t[r];e+=n*n}return Sr(e)}dot(t){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Sr(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return bl(t>=0&&t<this.ELEMENTS,"index is out of range"),Sr(this[t])}setComponent(t,e){return bl(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var lf=1e-6,El=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function wR(){var i=new El(2);return El!=Float32Array&&(i[0]=0,i[1]=0),i}function Lx(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i}function SR(i,t){return i[0]=-t[0],i[1]=-t[1],i}function ES(i,t,e,r){var n=t[0],o=t[1];return i[0]=n+r*(e[0]-n),i[1]=o+r*(e[1]-o),i}function AR(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n,i[1]=e[1]*r+e[3]*n,i}function ER(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n+e[4],i[1]=e[1]*r+e[3]*n+e[5],i}function TS(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[3]*n+e[6],i[1]=e[1]*r+e[4]*n+e[7],i}function CS(i,t,e){var r=t[0],n=t[1];return i[0]=e[0]*r+e[4]*n+e[12],i[1]=e[1]*r+e[5]*n+e[13],i}(function(){var i=wR();return function(t,e,r,n,o,c){var l,_;for(e||(e=2),r||(r=0),n?_=Math.min(n*e+r,t.length):_=t.length,l=r;l<_;l+=e)i[0]=t[l],i[1]=t[l+1],o(i,i,c),t[l]=i[0],t[l+1]=i[1];return t}})();function PS(i,t,e){const r=t[0],n=t[1],o=e[3]*r+e[7]*n||1;return i[0]=(e[0]*r+e[4]*n)/o,i[1]=(e[1]*r+e[5]*n)/o,i}function IS(i,t,e){const r=t[0],n=t[1],o=t[2],c=e[3]*r+e[7]*n+e[11]*o||1;return i[0]=(e[0]*r+e[4]*n+e[8]*o)/c,i[1]=(e[1]*r+e[5]*n+e[9]*o)/c,i[2]=(e[2]*r+e[6]*n+e[10]*o)/c,i}function TR(i,t,e){const r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n,i[1]=e[1]*r+e[3]*n,i[2]=t[2],i}function CR(i,t,e){const r=t[0],n=t[1];return i[0]=e[0]*r+e[2]*n,i[1]=e[1]*r+e[3]*n,i[2]=t[2],i[3]=t[3],i}function LS(i,t,e){const r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[3]*n+e[6]*o,i[1]=e[1]*r+e[4]*n+e[7]*o,i[2]=e[2]*r+e[5]*n+e[8]*o,i[3]=t[3],i}class V1 extends G1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),Wh(t)&&arguments.length===1?this.copy(t):(ss.debug&&(Sr(t),Sr(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return ss.debug&&(Sr(t.x),Sr(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return CS(this,this,t),this.check()}transformAsVector(t){return PS(this,this,t),this.check()}transformByMatrix3(t){return TS(this,this,t),this.check()}transformByMatrix2x3(t){return ER(this,this,t),this.check()}transformByMatrix2(t){return AR(this,this,t),this.check()}}function MS(){var i=new El(3);return El!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function BS(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function Mx(i,t,e){var r=new El(3);return r[0]=i,r[1]=t,r[2]=e,r}function PR(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function IR(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function LR(i,t){var e=t[0],r=t[1],n=t[2],o=e*e+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function q1(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function qm(i,t,e){var r=t[0],n=t[1],o=t[2],c=e[0],l=e[1],_=e[2];return i[0]=n*_-o*l,i[1]=o*c-r*_,i[2]=r*l-n*c,i}function H1(i,t,e){var r=t[0],n=t[1],o=t[2],c=e[3]*r+e[7]*n+e[11]*o+e[15];return c=c||1,i[0]=(e[0]*r+e[4]*n+e[8]*o+e[12])/c,i[1]=(e[1]*r+e[5]*n+e[9]*o+e[13])/c,i[2]=(e[2]*r+e[6]*n+e[10]*o+e[14])/c,i}function RS(i,t,e){var r=t[0],n=t[1],o=t[2];return i[0]=r*e[0]+n*e[3]+o*e[6],i[1]=r*e[1]+n*e[4]+o*e[7],i[2]=r*e[2]+n*e[5]+o*e[8],i}function kS(i,t,e){var r=e[0],n=e[1],o=e[2],c=e[3],l=t[0],_=t[1],v=t[2],S=n*v-o*_,T=o*l-r*v,P=r*_-n*l,I=n*P-o*T,z=o*S-r*P,N=r*T-n*S,X=c*2;return S*=X,T*=X,P*=X,I*=2,z*=2,N*=2,i[0]=l+S+I,i[1]=_+T+z,i[2]=v+P+N,i}function MR(i,t,e,r){var n=[],o=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function BR(i,t,e,r){var n=[],o=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function RR(i,t,e,r){var n=[],o=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i}function kR(i,t){var e=i[0],r=i[1],n=i[2],o=t[0],c=t[1],l=t[2],_=Math.sqrt(e*e+r*r+n*n),v=Math.sqrt(o*o+c*c+l*l),S=_*v,T=S&&q1(i,t)/S;return Math.acos(Math.min(Math.max(T,-1),1))}var FR=PR,DR=BS;(function(){var i=MS();return function(t,e,r,n,o,c){var l,_;for(e||(e=3),r||(r=0),n?_=Math.min(n*e+r,t.length):_=t.length,l=r;l<_;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],o(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2];return t}})();const c_=[0,0,0];let _m;class Kt extends G1{static get ZERO(){return _m||(_m=new Kt(0,0,0),Object.freeze(_m)),_m}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&Wh(t)?this.copy(t):(ss.debug&&(Sr(t),Sr(e),Sr(r)),this[0]=t,this[1]=e,this[2]=r)}set(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ss.debug&&(Sr(t.x),Sr(t.y),Sr(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Sr(t)}angle(t){return kR(this,t)}cross(t){return qm(this,this,t),this.check()}rotateX(t){let{radians:e,origin:r=c_}=t;return MR(this,this,r,e),this.check()}rotateY(t){let{radians:e,origin:r=c_}=t;return BR(this,this,r,e),this.check()}rotateZ(t){let{radians:e,origin:r=c_}=t;return RR(this,this,r,e),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return H1(this,this,t),this.check()}transformAsVector(t){return IS(this,this,t),this.check()}transformByMatrix3(t){return RS(this,this,t),this.check()}transformByMatrix2(t){return TR(this,this,t),this.check()}transformByQuaternion(t){return kS(this,this,t),this.check()}}let ym;class W1 extends G1{static get ZERO(){return ym||(ym=new W1(0,0,0,0),Object.freeze(ym)),ym}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),Wh(t)&&arguments.length===1?this.copy(t):(ss.debug&&(Sr(t),Sr(e),Sr(r),Sr(n)),this[0]=t,this[1]=e,this[2]=r,this[3]=n)}set(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return ss.debug&&(Sr(t.x),Sr(t.y),Sr(t.z),Sr(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Sr(t)}get w(){return this[3]}set w(t){this[3]=Sr(t)}transform(t){return H1(this,this,t),this.check()}transformByMatrix3(t){return LS(this,this,t),this.check()}transformByMatrix2(t){return CR(this,this,t),this.check()}transformByQuaternion(t){return kS(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class FS extends U1{toString(){let t="[";if(ss.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=Sr(r),this}getColumn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=t*this.RANK;for(let n=0;n<this.RANK;++n)e[n]=this[r+n];return e}setColumn(t,e){const r=t*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}function OR(){var i=new El(9);return El!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function NR(i,t){if(i===t){var e=t[1],r=t[2],n=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=r,i[7]=n}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function zR(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=t[4],l=t[5],_=t[6],v=t[7],S=t[8],T=S*c-l*v,P=-S*o+l*_,I=v*o-c*_,z=e*T+r*P+n*I;return z?(z=1/z,i[0]=T*z,i[1]=(-S*r+n*v)*z,i[2]=(l*r-n*c)*z,i[3]=P*z,i[4]=(S*e-n*_)*z,i[5]=(-l*e+n*o)*z,i[6]=I*z,i[7]=(-v*e+r*_)*z,i[8]=(c*e-r*o)*z,i):null}function jR(i){var t=i[0],e=i[1],r=i[2],n=i[3],o=i[4],c=i[5],l=i[6],_=i[7],v=i[8];return t*(v*o-c*_)+e*(-v*n+c*l)+r*(_*n-o*l)}function Bx(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3],l=t[4],_=t[5],v=t[6],S=t[7],T=t[8],P=e[0],I=e[1],z=e[2],N=e[3],X=e[4],H=e[5],Z=e[6],ot=e[7],gt=e[8];return i[0]=P*r+I*c+z*v,i[1]=P*n+I*l+z*S,i[2]=P*o+I*_+z*T,i[3]=N*r+X*c+H*v,i[4]=N*n+X*l+H*S,i[5]=N*o+X*_+H*T,i[6]=Z*r+ot*c+gt*v,i[7]=Z*n+ot*l+gt*S,i[8]=Z*o+ot*_+gt*T,i}function UR(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3],l=t[4],_=t[5],v=t[6],S=t[7],T=t[8],P=e[0],I=e[1];return i[0]=r,i[1]=n,i[2]=o,i[3]=c,i[4]=l,i[5]=_,i[6]=P*r+I*c+v,i[7]=P*n+I*l+S,i[8]=P*o+I*_+T,i}function GR(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3],l=t[4],_=t[5],v=t[6],S=t[7],T=t[8],P=Math.sin(e),I=Math.cos(e);return i[0]=I*r+P*c,i[1]=I*n+P*l,i[2]=I*o+P*_,i[3]=I*c-P*r,i[4]=I*l-P*n,i[5]=I*_-P*o,i[6]=v,i[7]=S,i[8]=T,i}function Rx(i,t,e){var r=e[0],n=e[1];return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=n*t[3],i[4]=n*t[4],i[5]=n*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function VR(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=e+e,l=r+r,_=n+n,v=e*c,S=r*c,T=r*l,P=n*c,I=n*l,z=n*_,N=o*c,X=o*l,H=o*_;return i[0]=1-T-z,i[3]=S-H,i[6]=P+X,i[1]=S+H,i[4]=1-v-z,i[7]=I-N,i[2]=P-X,i[5]=I+N,i[8]=1-v-T,i}var wy;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(wy||(wy={}));const qR=Object.freeze([1,0,0,0,1,0,0,0,1]);class Cn extends FS{static get IDENTITY(){return WR()}static get ZERO(){return HR()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return wy}constructor(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(qR)}fromObject(t){return this.check()}fromQuaternion(t){return VR(this,t),this.check()}set(t,e,r,n,o,c,l,_,v){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=o,this[5]=c,this[6]=l,this[7]=_,this[8]=v,this.check()}setRowMajor(t,e,r,n,o,c,l,_,v){return this[0]=t,this[1]=n,this[2]=l,this[3]=e,this[4]=o,this[5]=_,this[6]=r,this[7]=c,this[8]=v,this.check()}determinant(){return jR(this)}transpose(){return NR(this,this),this.check()}invert(){return zR(this,this),this.check()}multiplyLeft(t){return Bx(this,t,this),this.check()}multiplyRight(t){return Bx(this,this,t),this.check()}rotate(t){return GR(this,this,t),this.check()}scale(t){return Array.isArray(t)?Rx(this,this,t):Rx(this,this,[t,t]),this.check()}translate(t){return UR(this,this,t),this.check()}transform(t,e){let r;switch(t.length){case 2:r=TS(e||[-0,-0],t,this);break;case 3:r=RS(e||[-0,-0,-0],t,this);break;case 4:r=LS(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return af(r,t.length),r}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let vm,bm;function HR(){return vm||(vm=new Cn([0,0,0,0,0,0,0,0,0]),Object.freeze(vm)),vm}function WR(){return bm||(bm=new Cn,Object.freeze(bm)),bm}function XR(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ZR(i,t){if(i===t){var e=t[1],r=t[2],n=t[3],o=t[6],c=t[7],l=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=r,i[9]=o,i[11]=t[14],i[12]=n,i[13]=c,i[14]=l}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function Sy(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=t[4],l=t[5],_=t[6],v=t[7],S=t[8],T=t[9],P=t[10],I=t[11],z=t[12],N=t[13],X=t[14],H=t[15],Z=e*l-r*c,ot=e*_-n*c,gt=e*v-o*c,Et=r*_-n*l,Ft=r*v-o*l,Mt=n*v-o*_,yt=S*N-T*z,Ut=S*X-P*z,zt=S*H-I*z,at=T*X-P*N,pt=T*H-I*N,Lt=P*H-I*X,bt=Z*Lt-ot*pt+gt*at+Et*zt-Ft*Ut+Mt*yt;return bt?(bt=1/bt,i[0]=(l*Lt-_*pt+v*at)*bt,i[1]=(n*pt-r*Lt-o*at)*bt,i[2]=(N*Mt-X*Ft+H*Et)*bt,i[3]=(P*Ft-T*Mt-I*Et)*bt,i[4]=(_*zt-c*Lt-v*Ut)*bt,i[5]=(e*Lt-n*zt+o*Ut)*bt,i[6]=(X*gt-z*Mt-H*ot)*bt,i[7]=(S*Mt-P*gt+I*ot)*bt,i[8]=(c*pt-l*zt+v*yt)*bt,i[9]=(r*zt-e*pt-o*yt)*bt,i[10]=(z*Ft-N*gt+H*Z)*bt,i[11]=(T*gt-S*Ft-I*Z)*bt,i[12]=(l*Ut-c*at-_*yt)*bt,i[13]=(e*at-r*Ut+n*yt)*bt,i[14]=(N*ot-z*Et-X*Z)*bt,i[15]=(S*Et-T*ot+P*Z)*bt,i):null}function $R(i){var t=i[0],e=i[1],r=i[2],n=i[3],o=i[4],c=i[5],l=i[6],_=i[7],v=i[8],S=i[9],T=i[10],P=i[11],I=i[12],z=i[13],N=i[14],X=i[15],H=t*c-e*o,Z=t*l-r*o,ot=t*_-n*o,gt=e*l-r*c,Et=e*_-n*c,Ft=r*_-n*l,Mt=v*z-S*I,yt=v*N-T*I,Ut=v*X-P*I,zt=S*N-T*z,at=S*X-P*z,pt=T*X-P*N;return H*pt-Z*at+ot*zt+gt*Ut-Et*yt+Ft*Mt}function Ru(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3],l=t[4],_=t[5],v=t[6],S=t[7],T=t[8],P=t[9],I=t[10],z=t[11],N=t[12],X=t[13],H=t[14],Z=t[15],ot=e[0],gt=e[1],Et=e[2],Ft=e[3];return i[0]=ot*r+gt*l+Et*T+Ft*N,i[1]=ot*n+gt*_+Et*P+Ft*X,i[2]=ot*o+gt*v+Et*I+Ft*H,i[3]=ot*c+gt*S+Et*z+Ft*Z,ot=e[4],gt=e[5],Et=e[6],Ft=e[7],i[4]=ot*r+gt*l+Et*T+Ft*N,i[5]=ot*n+gt*_+Et*P+Ft*X,i[6]=ot*o+gt*v+Et*I+Ft*H,i[7]=ot*c+gt*S+Et*z+Ft*Z,ot=e[8],gt=e[9],Et=e[10],Ft=e[11],i[8]=ot*r+gt*l+Et*T+Ft*N,i[9]=ot*n+gt*_+Et*P+Ft*X,i[10]=ot*o+gt*v+Et*I+Ft*H,i[11]=ot*c+gt*S+Et*z+Ft*Z,ot=e[12],gt=e[13],Et=e[14],Ft=e[15],i[12]=ot*r+gt*l+Et*T+Ft*N,i[13]=ot*n+gt*_+Et*P+Ft*X,i[14]=ot*o+gt*v+Et*I+Ft*H,i[15]=ot*c+gt*S+Et*z+Ft*Z,i}function _g(i,t,e){var r=e[0],n=e[1],o=e[2],c,l,_,v,S,T,P,I,z,N,X,H;return t===i?(i[12]=t[0]*r+t[4]*n+t[8]*o+t[12],i[13]=t[1]*r+t[5]*n+t[9]*o+t[13],i[14]=t[2]*r+t[6]*n+t[10]*o+t[14],i[15]=t[3]*r+t[7]*n+t[11]*o+t[15]):(c=t[0],l=t[1],_=t[2],v=t[3],S=t[4],T=t[5],P=t[6],I=t[7],z=t[8],N=t[9],X=t[10],H=t[11],i[0]=c,i[1]=l,i[2]=_,i[3]=v,i[4]=S,i[5]=T,i[6]=P,i[7]=I,i[8]=z,i[9]=N,i[10]=X,i[11]=H,i[12]=c*r+S*n+z*o+t[12],i[13]=l*r+T*n+N*o+t[13],i[14]=_*r+P*n+X*o+t[14],i[15]=v*r+I*n+H*o+t[15]),i}function X1(i,t,e){var r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i[4]=t[4]*n,i[5]=t[5]*n,i[6]=t[6]*n,i[7]=t[7]*n,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function YR(i,t,e,r){var n=r[0],o=r[1],c=r[2],l=Math.hypot(n,o,c),_,v,S,T,P,I,z,N,X,H,Z,ot,gt,Et,Ft,Mt,yt,Ut,zt,at,pt,Lt,bt,ee;return l<lf?null:(l=1/l,n*=l,o*=l,c*=l,_=Math.sin(e),v=Math.cos(e),S=1-v,T=t[0],P=t[1],I=t[2],z=t[3],N=t[4],X=t[5],H=t[6],Z=t[7],ot=t[8],gt=t[9],Et=t[10],Ft=t[11],Mt=n*n*S+v,yt=o*n*S+c*_,Ut=c*n*S-o*_,zt=n*o*S-c*_,at=o*o*S+v,pt=c*o*S+n*_,Lt=n*c*S+o*_,bt=o*c*S-n*_,ee=c*c*S+v,i[0]=T*Mt+N*yt+ot*Ut,i[1]=P*Mt+X*yt+gt*Ut,i[2]=I*Mt+H*yt+Et*Ut,i[3]=z*Mt+Z*yt+Ft*Ut,i[4]=T*zt+N*at+ot*pt,i[5]=P*zt+X*at+gt*pt,i[6]=I*zt+H*at+Et*pt,i[7]=z*zt+Z*at+Ft*pt,i[8]=T*Lt+N*bt+ot*ee,i[9]=P*Lt+X*bt+gt*ee,i[10]=I*Lt+H*bt+Et*ee,i[11]=z*Lt+Z*bt+Ft*ee,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function DS(i,t,e){var r=Math.sin(e),n=Math.cos(e),o=t[4],c=t[5],l=t[6],_=t[7],v=t[8],S=t[9],T=t[10],P=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=o*n+v*r,i[5]=c*n+S*r,i[6]=l*n+T*r,i[7]=_*n+P*r,i[8]=v*n-o*r,i[9]=S*n-c*r,i[10]=T*n-l*r,i[11]=P*n-_*r,i}function JR(i,t,e){var r=Math.sin(e),n=Math.cos(e),o=t[0],c=t[1],l=t[2],_=t[3],v=t[8],S=t[9],T=t[10],P=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*n-v*r,i[1]=c*n-S*r,i[2]=l*n-T*r,i[3]=_*n-P*r,i[8]=o*r+v*n,i[9]=c*r+S*n,i[10]=l*r+T*n,i[11]=_*r+P*n,i}function OS(i,t,e){var r=Math.sin(e),n=Math.cos(e),o=t[0],c=t[1],l=t[2],_=t[3],v=t[4],S=t[5],T=t[6],P=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*n+v*r,i[1]=c*n+S*r,i[2]=l*n+T*r,i[3]=_*n+P*r,i[4]=v*n-o*r,i[5]=S*n-c*r,i[6]=T*n-l*r,i[7]=P*n-_*r,i}function KR(i,t){var e=t[0],r=t[1],n=t[2],o=t[4],c=t[5],l=t[6],_=t[8],v=t[9],S=t[10];return i[0]=Math.hypot(e,r,n),i[1]=Math.hypot(o,c,l),i[2]=Math.hypot(_,v,S),i}function QR(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=e+e,l=r+r,_=n+n,v=e*c,S=r*c,T=r*l,P=n*c,I=n*l,z=n*_,N=o*c,X=o*l,H=o*_;return i[0]=1-T-z,i[1]=S+H,i[2]=P-X,i[3]=0,i[4]=S-H,i[5]=1-v-z,i[6]=I+N,i[7]=0,i[8]=P+X,i[9]=I-N,i[10]=1-v-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function tk(i,t,e,r,n,o,c){var l=1/(e-t),_=1/(n-r),v=1/(o-c);return i[0]=o*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*_,i[6]=0,i[7]=0,i[8]=(e+t)*l,i[9]=(n+r)*_,i[10]=(c+o)*v,i[11]=-1,i[12]=0,i[13]=0,i[14]=c*o*2*v,i[15]=0,i}function ek(i,t,e,r,n){var o=1/Math.tan(t/2),c;return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(c=1/(r-n),i[10]=(n+r)*c,i[14]=2*n*r*c):(i[10]=-1,i[14]=-2*r),i}var ik=ek;function rk(i,t,e,r,n,o,c){var l=1/(t-e),_=1/(r-n),v=1/(o-c);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(t+e)*l,i[13]=(n+r)*_,i[14]=(c+o)*v,i[15]=1,i}var nk=rk;function sk(i,t,e,r){var n,o,c,l,_,v,S,T,P,I,z=t[0],N=t[1],X=t[2],H=r[0],Z=r[1],ot=r[2],gt=e[0],Et=e[1],Ft=e[2];return Math.abs(z-gt)<lf&&Math.abs(N-Et)<lf&&Math.abs(X-Ft)<lf?XR(i):(S=z-gt,T=N-Et,P=X-Ft,I=1/Math.hypot(S,T,P),S*=I,T*=I,P*=I,n=Z*P-ot*T,o=ot*S-H*P,c=H*T-Z*S,I=Math.hypot(n,o,c),I?(I=1/I,n*=I,o*=I,c*=I):(n=0,o=0,c=0),l=T*c-P*o,_=P*n-S*c,v=S*o-T*n,I=Math.hypot(l,_,v),I?(I=1/I,l*=I,_*=I,v*=I):(l=0,_=0,v=0),i[0]=n,i[1]=l,i[2]=S,i[3]=0,i[4]=o,i[5]=_,i[6]=T,i[7]=0,i[8]=c,i[9]=v,i[10]=P,i[11]=0,i[12]=-(n*z+o*N+c*X),i[13]=-(l*z+_*N+v*X),i[14]=-(S*z+T*N+P*X),i[15]=1,i)}function ok(){var i=new El(4);return El!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function ak(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i}function NS(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i}function lk(i){var t=i[0],e=i[1],r=i[2],n=i[3];return Math.hypot(t,e,r,n)}function ck(i){var t=i[0],e=i[1],r=i[2],n=i[3];return t*t+e*e+r*r+n*n}function hk(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=e*e+r*r+n*n+o*o;return c>0&&(c=1/Math.sqrt(c)),i[0]=e*c,i[1]=r*c,i[2]=n*c,i[3]=o*c,i}function uk(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function dk(i,t,e,r){var n=t[0],o=t[1],c=t[2],l=t[3];return i[0]=n+r*(e[0]-n),i[1]=o+r*(e[1]-o),i[2]=c+r*(e[2]-c),i[3]=l+r*(e[3]-l),i}function Ff(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*c,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*c,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*c,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*c,i}function pk(i,t,e){var r=t[0],n=t[1],o=t[2],c=e[0],l=e[1],_=e[2],v=e[3],S=v*r+l*o-_*n,T=v*n+_*r-c*o,P=v*o+c*n-l*r,I=-c*r-l*n-_*o;return i[0]=S*v+I*-c+T*-_-P*-l,i[1]=T*v+I*-l+P*-c-S*-_,i[2]=P*v+I*-_+S*-l-T*-c,i[3]=t[3],i}(function(){var i=ok();return function(t,e,r,n,o,c){var l,_;for(e||(e=4),r||(r=0),n?_=Math.min(n*e+r,t.length):_=t.length,l=r;l<_;l+=e)i[0]=t[l],i[1]=t[l+1],i[2]=t[l+2],i[3]=t[l+3],o(i,i,c),t[l]=i[0],t[l+1]=i[1],t[l+2]=i[2],t[l+3]=i[3];return t}})();var Ay;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(Ay||(Ay={}));const fk=45*Math.PI/180,mk=1,h_=.1,u_=500,gk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ar extends FS{static get IDENTITY(){return yk()}static get ZERO(){return _k()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ay}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,n,o,c,l,_,v,S,T,P,I,z,N,X){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=o,this[5]=c,this[6]=l,this[7]=_,this[8]=v,this[9]=S,this[10]=T,this[11]=P,this[12]=I,this[13]=z,this[14]=N,this[15]=X,this.check()}setRowMajor(t,e,r,n,o,c,l,_,v,S,T,P,I,z,N,X){return this[0]=t,this[1]=o,this[2]=v,this[3]=I,this[4]=e,this[5]=c,this[6]=S,this[7]=z,this[8]=r,this[9]=l,this[10]=T,this[11]=N,this[12]=n,this[13]=_,this[14]=P,this[15]=X,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(gk)}fromObject(t){return this.check()}fromQuaternion(t){return QR(this,t),this.check()}frustum(t){const{left:e,right:r,bottom:n,top:o,near:c=h_,far:l=u_}=t;return l===1/0?vk(this,e,r,n,o,c):tk(this,e,r,n,o,c,l),this.check()}lookAt(t){const{eye:e,center:r=[0,0,0],up:n=[0,1,0]}=t;return sk(this,e,r,n),this.check()}ortho(t){const{left:e,right:r,bottom:n,top:o,near:c=h_,far:l=u_}=t;return nk(this,e,r,n,o,c,l),this.check()}orthographic(t){const{fovy:e=fk,aspect:r=mk,focalDistance:n=1,near:o=h_,far:c=u_}=t;kx(e);const l=e/2,_=n*Math.tan(l),v=_*r;return this.ortho({left:-v,right:v,bottom:-_,top:_,near:o,far:c})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:r=1,near:n=.1,far:o=500}=t;return kx(e),ik(this,e,r,n,o),this.check()}determinant(){return $R(this)}getScale(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),n=1/r[0],o=1/r[1],c=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*o,t[2]=this[2]*c,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*o,t[6]=this[6]*c,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*o,t[10]=this[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const r=this.getScale(e),n=1/r[0],o=1/r[1],c=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*o,t[2]=this[2]*c,t[3]=this[4]*n,t[4]=this[5]*o,t[5]=this[6]*c,t[6]=this[8]*n,t[7]=this[9]*o,t[8]=this[10]*c,t}transpose(){return ZR(this,this),this.check()}invert(){return Sy(this,this),this.check()}multiplyLeft(t){return Ru(this,t,this),this.check()}multiplyRight(t){return Ru(this,this,t),this.check()}rotateX(t){return DS(this,this,t),this.check()}rotateY(t){return JR(this,this,t),this.check()}rotateZ(t){return OS(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return YR(this,this,t,e),this.check()}scale(t){return X1(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return _g(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Ff(e||[-0,-0,-0,-0],t,this),af(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;let n;switch(r){case 2:n=CS(e||[-0,-0],t,this);break;case 3:n=H1(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return af(n,t.length),n}transformAsVector(t,e){let r;switch(t.length){case 2:r=PS(e||[-0,-0],t,this);break;case 3:r=IS(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return af(r,t.length),r}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}}let xm,wm;function _k(){return xm||(xm=new ar([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(xm)),xm}function yk(){return wm||(wm=new ar,Object.freeze(wm)),wm}function kx(i){if(i>Math.PI*2)throw Error("expected radians")}function vk(i,t,e,r,n,o){const c=2*o/(e-t),l=2*o/(n-r),_=(e+t)/(e-t),v=(n+r)/(n-r),S=-1,T=-1,P=-2*o;return i[0]=c,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=_,i[9]=v,i[10]=S,i[11]=T,i[12]=0,i[13]=0,i[14]=P,i[15]=0,i}function Fx(){var i=new El(4);return El!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function bk(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function zS(i,t,e){e=e*.5;var r=Math.sin(e);return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=Math.cos(e),i}function Dx(i,t,e){var r=t[0],n=t[1],o=t[2],c=t[3],l=e[0],_=e[1],v=e[2],S=e[3];return i[0]=r*S+c*l+n*v-o*_,i[1]=n*S+c*_+o*l-r*v,i[2]=o*S+c*v+r*_-n*l,i[3]=c*S-r*l-n*_-o*v,i}function xk(i,t,e){e*=.5;var r=t[0],n=t[1],o=t[2],c=t[3],l=Math.sin(e),_=Math.cos(e);return i[0]=r*_+c*l,i[1]=n*_+o*l,i[2]=o*_-n*l,i[3]=c*_-r*l,i}function wk(i,t,e){e*=.5;var r=t[0],n=t[1],o=t[2],c=t[3],l=Math.sin(e),_=Math.cos(e);return i[0]=r*_-o*l,i[1]=n*_+c*l,i[2]=o*_+r*l,i[3]=c*_-n*l,i}function Sk(i,t,e){e*=.5;var r=t[0],n=t[1],o=t[2],c=t[3],l=Math.sin(e),_=Math.cos(e);return i[0]=r*_+n*l,i[1]=n*_-r*l,i[2]=o*_+c*l,i[3]=c*_-o*l,i}function Ak(i,t){var e=t[0],r=t[1],n=t[2];return i[0]=e,i[1]=r,i[2]=n,i[3]=Math.sqrt(Math.abs(1-e*e-r*r-n*n)),i}function Hm(i,t,e,r){var n=t[0],o=t[1],c=t[2],l=t[3],_=e[0],v=e[1],S=e[2],T=e[3],P,I,z,N,X;return I=n*_+o*v+c*S+l*T,I<0&&(I=-I,_=-_,v=-v,S=-S,T=-T),1-I>lf?(P=Math.acos(I),z=Math.sin(P),N=Math.sin((1-r)*P)/z,X=Math.sin(r*P)/z):(N=1-r,X=r),i[0]=N*n+X*_,i[1]=N*o+X*v,i[2]=N*c+X*S,i[3]=N*l+X*T,i}function Ek(i,t){var e=t[0],r=t[1],n=t[2],o=t[3],c=e*e+r*r+n*n+o*o,l=c?1/c:0;return i[0]=-e*l,i[1]=-r*l,i[2]=-n*l,i[3]=o*l,i}function Tk(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function jS(i,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),i[3]=.5*r,r=.5/r,i[0]=(t[5]-t[7])*r,i[1]=(t[6]-t[2])*r,i[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var o=(n+1)%3,c=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[o*3+o]-t[c*3+c]+1),i[n]=.5*r,r=.5/r,i[3]=(t[o*3+c]-t[c*3+o])*r,i[o]=(t[o*3+n]+t[n*3+o])*r,i[c]=(t[c*3+n]+t[n*3+c])*r}return i}var Ck=ak,Pk=NS,Ik=uk,Lk=dk,Mk=lk,Bk=ck,US=hk,Rk=function(){var i=MS(),t=Mx(1,0,0),e=Mx(0,1,0);return function(r,n,o){var c=q1(n,o);return c<-.999999?(qm(i,t,n),DR(i)<1e-6&&qm(i,e,n),LR(i,i),zS(r,i,Math.PI),r):c>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(qm(i,n,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+c,US(r,r))}}();(function(){var i=Fx(),t=Fx();return function(e,r,n,o,c,l){return Hm(i,r,c,l),Hm(t,n,o,l),Hm(e,i,t,2*l*(1-l)),e}})();(function(){var i=OR();return function(t,e,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],US(t,jS(t,i))}})();const kk=[0,0,0,1];class _f extends U1{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,r,n)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return jS(this,t),this.check()}fromAxisRotation(t,e){return zS(this,t,e),this.check()}identity(){return bk(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Sr(t)}get y(){return this[1]}set y(t){this[1]=Sr(t)}get z(){return this[2]}set z(t){this[2]=Sr(t)}get w(){return this[3]}set w(t){this[3]=Sr(t)}len(){return Mk(this)}lengthSquared(){return Bk(this)}dot(t){return Ik(this,t)}rotationTo(t,e){return Rk(this,t,e),this.check()}add(t){return Ck(this,this,t),this.check()}calculateW(){return Ak(this,this),this.check()}conjugate(){return Tk(this,this),this.check()}invert(){return Ek(this,this),this.check()}lerp(t,e,r){return r===void 0?this.lerp(this,t,e):(Lk(this,t,e,r),this.check())}multiplyRight(t){return Dx(this,this,t),this.check()}multiplyLeft(t){return Dx(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return xk(this,this,t),this.check()}rotateY(t){return wk(this,this,t),this.check()}rotateZ(t){return Sk(this,this,t),this.check()}scale(t){return Pk(this,this,t),this.check()}slerp(t,e,r){let n,o,c;switch(arguments.length){case 1:({start:n=kk,target:o,ratio:c}=t);break;case 2:n=this,o=t,c=e;break;default:n=t,o=e,c=r}return Hm(this,n,o,c),this.check()}transformVector4(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new W1;return pk(e,t,this),af(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const yf={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},Ox=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,Fk={lightSources:{}};function d_(){let{color:i=[0,0,0],intensity:t=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(e=>e*t/255)}function Dk(i){let{ambientLight:t,pointLights:e=[],directionalLights:r=[]}=i;const n={};return t?n["lighting_uAmbientLight.color"]=d_(t):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((o,c)=>{n["lighting_uPointLight[".concat(c,"].color")]=d_(o),n["lighting_uPointLight[".concat(c,"].position")]=o.position,n["lighting_uPointLight[".concat(c,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,r.forEach((o,c)=>{n["lighting_uDirectionalLight[".concat(c,"].color")]=d_(o),n["lighting_uDirectionalLight[".concat(c,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function GS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Fk;if("lightSources"in i){const{ambientLight:t,pointLights:e,directionalLights:r}=i.lightSources||{};return t||e&&e.length>0||r&&r.length>0?Object.assign({},Dk({ambientLight:t,pointLights:e,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const t={pointLights:[],directionalLights:[]};for(const e of i.lights||[])switch(e.type){case"ambient":t.ambientLight=e;break;case"directional":t.directionalLights.push(e);break;case"point":t.pointLights.push(e);break}return GS({lightSources:t})}return{}}const Z1={name:"lights",vs:Ox,fs:Ox,getUniforms:GS,defines:{MAX_LIGHTS:3}},Ok=new Uint8Array([0,255,255,255]),Nk={pickingSelectedColor:null,pickingHighlightColor:Ok,pickingActive:!1,pickingAttribute:!1};function zk(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Nk;const t={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const e=i.pickingSelectedColor.slice(0,3);t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=e}if(i.pickingHighlightColor){const e=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(e[3])||(e[3]=1),t.picking_uHighlightColor=e}return i.pickingActive!==void 0&&(t.picking_uActive=!!i.pickingActive,t.picking_uAttribute=!!i.pickingAttribute),t}const jk=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Uk=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Gk={name:"picking",vs:jk,fs:Uk,getUniforms:zk},VS=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,Vk={};function qk(i){const{ambient:t=.35,diffuse:e=.6,shininess:r=32,specularColor:n=[30,30,30]}=i;return{lighting_uAmbient:t,lighting_uDiffuse:e,lighting_uShininess:r,lighting_uSpecularColor:n.map(o=>o/255)}}function qS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vk;if(!("material"in i))return{};const{material:t}=i;return t?qk(t):{lighting_uEnabled:!1}}const Hk={name:"gouraud-lighting",dependencies:[Z1],vs:VS,defines:{LIGHTING_VERTEX:1},getUniforms:qS},Wk={name:"phong-lighting",dependencies:[Z1],fs:VS,defines:{LIGHTING_FRAGMENT:1},getUniforms:qS},Xk=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,Zk=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,$1={name:"pbr",vs:Xk,fs:Zk,defines:{LIGHTING_FRAGMENT:1},dependencies:[Z1]},$k=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Yk={name:"transform",vs:$k,fs:null};class Df{static getDefaultProgramManager(t){return t.luma=t.luma||{},t.luma.defaultProgramManager=t.luma.defaultProgramManager||new Df(t),t.luma.defaultProgramManager}constructor(t){this.gl=t,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(t){this._defaultModules.find(e=>e.name===t.name)||this._defaultModules.push(t),this.stateHash++}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==e),this.stateHash++}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}get(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:e="",fs:r="",defines:n={},inject:o={},varyings:c=[],bufferMode:l=35981,transpileToGLSL100:_=!1}=t,v=this._getModuleList(t.modules),S=this._getHash(e),T=this._getHash(r),P=v.map(ot=>this._getHash(ot.name)).sort(),I=c.map(ot=>this._getHash(ot)),z=Object.keys(n).sort(),N=Object.keys(o).sort(),X=[],H=[];for(const ot of z)X.push(this._getHash(ot)),X.push(this._getHash(n[ot]));for(const ot of N)H.push(this._getHash(ot)),H.push(this._getHash(o[ot]));const Z="".concat(S,"/").concat(T,"D").concat(X.join("/"),"M").concat(P.join("/"),"I").concat(H.join("/"),"V").concat(I.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(_?"T":"");if(!this._programCache[Z]){const ot=K6(this.gl,{vs:e,fs:r,modules:v,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:_});this._programCache[Z]=new mS(this.gl,{hash:Z,vs:ot.vs,fs:ot.fs,varyings:c,bufferMode:l}),this._getUniforms[Z]=ot.getUniforms||(gt=>{}),this._useCounts[Z]=0}return this._useCounts[Z]++,this._programCache[Z]}getUniforms(t){return this._getUniforms[t.hash]||null}release(t){const e=t.hash;this._useCounts[e]--,this._useCounts[e]===0&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}_getModuleList(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=new Array(this._defaultModules.length+t.length),r={};let n=0;for(let o=0,c=this._defaultModules.length;o<c;++o){const l=this._defaultModules[o],_=l.name;e[n++]=l,r[_]=!0}for(let o=0,c=t.length;o<c;++o){const l=t[o],_=l.name;r[_]||(e[n++]=l,r[_]=!0)}return e.length=n,e}}const Jk={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Kk(i,t,e){const r={};let n=t.indices;for(const o in t.attributes){const c=t.attributes[o],l=Qk(o);if(o==="indices")n=c;else if(c.constant)r[l]=c.value;else{const _=c.value,v={...c};delete v.value,r[l]=[new Gr(i,_),v],tF(o,v)}}if(n){const o=n.value||n;Ze(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const c={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};r.indices=[new Gr(i,{data:o,target:34963}),c]}return r}function Qk(i,t){const{attributeMap:e=Jk}={};return e&&e[i]||i}function tF(i,t){let e;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break}switch(e){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2;break}Ze(Number.isFinite(t.size),"attribute ".concat(i," needs size"))}const gd=2,eF=1e4,iF="Model needs drawMode and vertexCount",Nx=()=>{},rF={};class $d{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=oh("model")}=e;Ze(Dg(t)),this.id=r,this.gl=t,this.id=e.id||oh("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}initialize(t){this.props={},this.programManager=t.programManager||Df.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:e=null,vs:r,fs:n,modules:o,defines:c,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S}=t;this.programProps={program:e,vs:r,fs:n,modules:o,defines:c,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=t.drawMode!==void 0?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Ze(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),iF)}setProps(t){this._setModelProps(t)}delete(){for(const t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(t){const{program:e,vs:r,fs:n,modules:o,defines:c,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S}=t;this.programProps={program:e,vs:r,fs:n,modules:o,defines:c,inject:l,varyings:_,bufferMode:v,transpileToGLSL100:S},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(t){return this.drawMode=t,this}setVertexCount(t){return Ze(Number.isFinite(t)),this.vertexCount=t,this}setInstanceCount(t){return Ze(Number.isFinite(t)),this.instanceCount=t,this}setGeometry(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Kk(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Wd(t))return this;const e={};for(const r in t){const n=t[r];e[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(e),this}setUniforms(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,t),this}getModuleUniforms(t){this._checkProgram();const e=this.programManager.getUniforms(this.program);return e?e(t):{}}updateModuleSettings(t){const e=this.getModuleUniforms(t||{});return this.setUniforms(e)}clear(t){return F1(this.program.gl,t),this}draw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:e=null,framebuffer:r,uniforms:n={},attributes:o={},transformFeedback:c=this.transformFeedback,parameters:l={},vertexArray:_=this.vertexArray}=t;this.setAttributes(o),this.updateModuleSettings(e),this.setUniforms(n);let v;ai.priority>=gd&&(v=this._logDrawCallStart(gd));const S=this.vertexArray.getDrawParams(),{isIndexed:T=S.isIndexed,indexType:P=S.indexType,indexOffset:I=S.indexOffset,vertexArrayInstanced:z=S.isInstanced}=this.props;z&&!this.isInstanced&&ai.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:N,instanceCount:X}=this,{onBeforeRender:H=Nx,onAfterRender:Z=Nx}=this.props;H(),this.program.setUniforms(this.uniforms);const ot=this.program.draw(Object.assign(rF,t,{logPriority:v,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:_,transformFeedback:c,isIndexed:T,indexType:P,isInstanced:N,instanceCount:X,offset:T?I:0}));return Z(),ai.priority>=gd&&this._logDrawCallEnd(v,_,r),ot}transform(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:e=!0,feedbackBuffers:r,unbindModels:n=[]}=t;let{parameters:o}=t;r&&this._setFeedbackBuffers(r),e&&(o=Object.assign({},o,{35977:e})),n.forEach(c=>c.vertexArray.unbindBuffers());try{this.draw(Object.assign({},t,{parameters:o}))}finally{n.forEach(c=>c.vertexArray.bindBuffers())}return this}render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ai.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}_setModelProps(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e,fs:r,modules:n,inject:o,defines:c,varyings:l,bufferMode:_,transpileToGLSL100:v}=this.programProps;t=this.programManager.get({vs:e,fs:r,modules:n,inject:o,defines:c,varyings:l,bufferMode:_,transpileToGLSL100:v}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Ze(t instanceof mS,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new p6(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const t in this.geometryBuffers){const e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Gr&&e.delete()}}_setAnimationProps(t){this.animated&&Ze(t,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Wd(t))return this;const{gl:e}=this.program;return this.transformFeedback=this.transformFeedback||new gS(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}_logDrawCallStart(t){const e=t>3?0:eF;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),ai.group(gd,">>> DRAWING MODEL ".concat(this.id),{collapsed:ai.level<=2})(),t}_logDrawCallEnd(t,e,r,n){if(t===void 0)return;const o=g6({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:c,unusedTable:l,unusedCount:_}=vx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:v,count:S}=vx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});S>0&&ai.log("MISSING UNIFORMS",Object.keys(v))(),_>0&&ai.log("UNUSED UNIFORMS",Object.keys(l))();const T=y6(this.vertexArray.configuration);ai.table(t,o)(),ai.table(t,c)(),ai.table(t+1,T)(),n&&n.log({logLevel:gd,message:"Rendered to ".concat(n.id)}),ai.groupEnd(gd)()}}class nF{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}setupResources(t){for(const e of this.bindings)this._setupTransformFeedback(e,t)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:e}=this;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=e;return{attributes:Object.assign({},r,t.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t)}getBuffer(t){const{feedbackBuffers:e}=this.bindings[this.currentIndex],r=t?e[t]:null;return r?r instanceof Gr?r:r.buffer:null}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:e}=t,r=this.getBuffer(e);return r?r.getData():null}delete(){for(const t in this.resources)this.resources[t].delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Ze(tr(this.gl))}_getFeedbackBuffers(t){const{sourceBuffers:e={}}=t,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in e&&(r[o]=n)}Object.assign(r,t.feedbackBuffers);for(const n in r){const o=r[n];if(typeof o=="string"){const c=e[o],{byteLength:l,usage:_,accessor:v}=c;r[n]=this._createNewBuffer(n,{byteLength:l,usage:_,accessor:v})}}return r}_setupBuffers(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e=null}=t;Object.assign(this.feedbackMap,t.feedbackMap);const r=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:e,feedbackBuffers:r})}_setupTransformFeedback(t,e){let{model:r}=e;const{program:n}=r;t.transformFeedback=new gS(this.gl,{program:n,buffers:t.feedbackBuffers})}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:e,feedbackBuffers:r})}}_updateBinding(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}_swapBuffers(t){if(!this.feedbackMap)return null;const e=Object.assign({},t.sourceBuffers),r=Object.assign({},t.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];e[n]=t.feedbackBuffers[o],r[o]=t.sourceBuffers[n],Ze(r[o]instanceof Gr)}return{sourceBuffers:e,feedbackBuffers:r}}_createNewBuffer(t,e){const r=new Gr(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const sF="transform_uSampler_",yg="transform_uSize_",zx="transform_position";function oF(i){let{vs:t,sourceTextureMap:e,targetTextureVarying:r,targetTexture:n}=i,o=Object.keys(e).length,c=null;const l={};let _=t,v={};if(o>0||r){const S=_.split(`
`),T=S.slice();if(S.forEach((P,I,z)=>{if(o>0){const N=uF(P,e);if(N){const{updatedLine:X,inject:H}=N;T[I]=X,v=vy([v,H]),Object.assign(l,N.samplerTextureMap),o--}}r&&!c&&(c=hF(P,r))}),r){Ze(n);const P="".concat(yg).concat(r),I="uniform vec2 ".concat(P,`;
`),z="     vec2 ".concat(zx," = transform_getPos(").concat(P,`);
     gl_Position = vec4(`).concat(zx,`, 0, 1.);
`);v=vy([v,{"vs:#decl":I,"vs:#main-start":z}])}_=T.join(`
`)}return{vs:_,targetTextureType:c,inject:v,samplerTextureMap:l}}function aF(i){let{sourceTextureMap:t,targetTextureVarying:e,targetTexture:r}=i;const n={};let o,c;e&&({width:o,height:c}=r,n["".concat(yg).concat(e)]=[o,c]);for(const l in t)({width:o,height:c}=t[l]),n["".concat(yg).concat(l)]=[o,c];return n}function lF(i){return SS(i,["attribute","in"])}function cF(i){const t="".concat(sF).concat(i),e="".concat(yg).concat(i),r="  uniform sampler2D ".concat(t,`;
  uniform vec2 `).concat(e,";");return{samplerName:t,sizeName:e,uniformDeclerations:r}}function hF(i,t){const e=SS(i,["varying","out"]);return e&&e.name===t?e.type:null}function uF(i,t){const e={},r=lF(i);if(!r)return null;const{type:n,name:o}=r;if(o&&t[o]){const c="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:_,uniformDeclerations:v}=cF(o),S=aR(n),T="  ".concat(n," ").concat(o," = transform_getInput(").concat(l,", ").concat(_,").").concat(S,`;
`);return e[l]=o,{updatedLine:c,inject:{"vs:#decl":v,"vs:#main-start":T},samplerTextureMap:e}}return null}const dF={10241:9728,10240:9728,10242:33071,10243:33071},pF="transform_output";class fF{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}updateModelProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this._processVertexShader(t);return Object.assign({},t,e)}getDrawOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,sourceTextures:r,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],c=Object.assign({},e,t.attributes),l=Object.assign({},t.uniforms),_=Object.assign({},t.parameters);let v=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){c.transform_elementID=this.elementIDBuffer;for(const T in this.samplerTextureMap){const P=this.samplerTextureMap[T];l[T]=r[P]}this._setSourceTextureParameters();const S=aF({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(l,S)}return this.hasTargetTexture&&(v=!1,_.viewport=[0,0,n.width,n.height]),{attributes:c,framebuffer:n,uniforms:l,discard:v,parameters:_}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(t)}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getData(){let{packed:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:e}=this.bindings[this.currentIndex],r=Ng(e);if(!t)return r;const n=r.constructor,o=lR(this.targetTextureType),c=new n(r.length*o/4);let l=0;for(let _=0;_<r.length;_+=4)for(let v=0;v<o;v++)c[l++]=r[_+v];return c}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:e,_swapTexture:r}=t;this._swapTexture=r,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}_createTargetTexture(t){const{sourceTextures:e,textureOrReference:r}=t;if(r instanceof Sa)return r;const n=e[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:e,_sourceTextures:r={},_targetTexture:n}=t,o=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:r,targetTexture:o}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}_updateElementIDBuffer(t){if(typeof t!="number"||this.elementCount>=t)return;const e=new Float32Array(t);e.forEach((r,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Gr(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}_updateBindings(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){const{sourceTextures:e,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:e,targetTexture:r})}}_updateBinding(t,e){const{sourceBuffers:r,sourceTextures:n,targetTexture:o}=e;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,r),o){t.targetTexture=o;const{width:c,height:l}=o,{framebuffer:_}=t;_?(_.update({attachments:{36064:o},resizeAttachments:!1}),_.resize({width:c,height:l})):t.framebuffer=new os(this.gl,{id:"transform-framebuffer",width:c,height:l,attachments:{36064:o}})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:e}=this.bindings[t];for(const r in e)e[r].setParameters(dF)}_swapTextures(t){if(!this._swapTexture)return null;const e=Object.assign({},t.sourceTextures);e[this._swapTexture]=t.targetTexture;const r=t.sourceTextures[this._swapTexture];return{sourceTextures:e,targetTexture:r}}_createNewTexture(t){const e=iB(t,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=e,e}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:e,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:c,inject:l,samplerTextureMap:_}=oF({vs:t.vs,sourceTextureMap:e,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),v=vy([t.inject||{},l]);this.targetTextureType=c,this.samplerTextureMap=_;const S=t._fs||AS({version:pS(n),input:this.targetTextureVarying,inputType:c,output:pF}),T=this.hasSourceTextures||this.targetTextureVarying?[Yk].concat(t.modules||[]):t.modules;return{vs:n,fs:S,modules:T,uniforms:o,inject:v}}}class Y1{static isSupported(t){return tr(t)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}delete(){const{model:t,bufferTransform:e,textureTransform:r}=this;t&&t.delete(),e&&e.delete(),r&&r.delete()}run(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:e=!0}=t,r=this._updateDrawOptions(t);e&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let t=!1;const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)t=t||r.swap();Ze(t,"Nothing to swap")}getBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(t)}getData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e){const n=r.getData(t);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);const e=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of e)r.update(t)}_initialize(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:e}=this;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new $d(e,Object.assign({},t,{fs:t.fs||AS({version:pS(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)e=n.updateModelProps(e);return e}_buildResourceTransforms(t,e){mF(e)&&(this.bufferTransform=new nF(t,e)),gF(e)&&(this.textureTransform=new fF(t,e)),Ze(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(t){let e=Object.assign({},t);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)e=Object.assign(e,n.getDrawOptions(e));return e}}function mF(i){return!!(!Wd(i.feedbackBuffers)||!Wd(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function gF(i){return!!(!Wd(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const jx={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class cf{static get DRAW_MODE(){return jx}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e=oh("geometry"),drawMode:r=jx.TRIANGLES,attributes:n={},indices:o=null,vertexCount:c=null}=t;this.id=e,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return"Geometry ".concat(this.id," attribute ").concat(t)}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const r in t){let n=t[r];n=ArrayBuffer.isView(n)?{value:n}:n,Ze(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!n.size&&(n.size=3),r==="indices"?(Ze(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let r=1/0;for(const n in t){const o=t[n],{value:c,size:l,constant:_}=o;!_&&c&&l>=1&&(r=Math.min(r,c.length/l))}return Ze(Number.isFinite(r)),r}}let _F=1,yF=1;class HS{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(t){const{delay:e=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=t,c=_F++,l={time:0,delay:e,duration:r,rate:n,repeat:o};return this._setChannelTime(l,this.time),this.channels.set(c,l),c}removeChannel(t){this.channels.delete(t);for(const[e,r]of this.animations)r.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const n of e)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:o,channel:c}=n;o.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const r=yF++;return this.animations.set(r,{animation:t,channel:e}),t.setTime(this.getTime(e)),r}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const r=e-t.delay,n=t.duration*t.repeat;r>=n?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}const vF=[255,255,255],bF=1;let xF=0;class WS{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"id",void 0),G(this,"color",void 0),G(this,"intensity",void 0),G(this,"type","ambient");const{color:e=vF}=t,{intensity:r=bF}=t;this.id=t.id||"ambient-".concat(xF++),this.color=e,this.intensity=r}}const wF=[255,255,255],SF=1,AF=[0,0,-1];let EF=0;class Ux{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"id",void 0),G(this,"color",void 0),G(this,"intensity",void 0),G(this,"type","directional"),G(this,"direction",void 0),G(this,"shadow",void 0);const{color:e=wF}=t,{intensity:r=SF}=t,{direction:n=AF}=t,{_shadow:o=!1}=t;this.id=t.id||"directional-".concat(EF++),this.color=e,this.intensity=r,this.type="directional",this.direction=new Kt(n).normalize().toArray(),this.shadow=o}getProjectedLight(t){return this}}class TF{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};G(this,"id",void 0),G(this,"gl",void 0),G(this,"props",void 0);const{id:r}=e;this.id=r,this.gl=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class J1 extends TF{constructor(){super(...arguments),G(this,"_lastRenderIndex",-1)}render(t){const e=this.gl;return sh(e,{framebuffer:t.target}),this._drawLayers(t)}_drawLayers(t){const{target:e,moduleParameters:r,viewports:n,views:o,onViewportActive:c,clearStack:l=!0,clearCanvas:_=!0}=t;t.pass=t.pass||"unknown";const v=this.gl;_&&PF(v,e),l&&(this._lastRenderIndex=-1);const S=[];for(const T of n){const P=o&&o[T.id];c==null||c(T);const I=this._getDrawLayerParams(T,t),z=T.subViewports||[T];for(const N of z){const X=this._drawLayersInViewport(v,{target:e,moduleParameters:r,viewport:N,view:P,pass:t.pass,layers:t.layers},I);S.push(X)}}return S}_getDrawLayerParams(t,e){let{layers:r,pass:n,isPicking:o=!1,layerFilter:c,cullRect:l,effects:_,moduleParameters:v}=e,S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const T=[],P=XS(this._lastRenderIndex+1),I={layer:r[0],viewport:t,isPicking:o,renderPass:n,cullRect:l},z={};for(let N=0;N<r.length;N++){const X=r[N],H=this._shouldDrawLayer(X,I,c,z),Z={shouldDrawLayer:H};H&&!S&&(Z.layerRenderIndex=P(X,H),Z.moduleParameters=this._getModuleParameters(X,_,n,v),Z.layerParameters=this.getLayerParameters(X,N,t)),T[N]=Z}return T}_drawLayersInViewport(t,e,r){let{layers:n,moduleParameters:o,pass:c,target:l,viewport:_,view:v}=e;const S=CF(t,{moduleParameters:o,target:l,viewport:_});if(v&&v.props.clear){const P=v.props.clear===!0?{color:!0,depth:!0}:v.props.clear;Sl(t,{scissorTest:!0,scissor:S},()=>F1(t,P))}const T={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};sh(t,{viewport:S});for(let P=0;P<n.length;P++){const I=n[P],{shouldDrawLayer:z,layerRenderIndex:N,moduleParameters:X,layerParameters:H}=r[P];if(z&&I.props.pickable&&T.pickableCount++,I.isComposite)T.compositeCount++;else if(z){T.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,N),X.viewport=_;try{I._drawLayer({moduleParameters:X,uniforms:{layerIndex:N},parameters:H})}catch(Z){I.raiseError(Z,"drawing ".concat(I," to ").concat(c))}}}return T}shouldDrawLayer(t){return!0}getModuleParameters(t,e){return null}getLayerParameters(t,e,r){return t.props.parameters}_shouldDrawLayer(t,e,r,n){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let o=t.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(e))return!1;e.layer=o,o=o.parent}if(r){const c=e.layer.id;if(c in n||(n[c]=r(e)),!n[c])return!1}return t.activateViewport(e.viewport),!0}_getModuleParameters(t,e,r,n){var o;const c=Object.assign(Object.create(((o=t.internalState)===null||o===void 0?void 0:o.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Hd(this.gl)});if(e)for(const _ of e){var l;Object.assign(c,(l=_.getModuleParameters)===null||l===void 0?void 0:l.call(_,t))}return Object.assign(c,this.getModuleParameters(t,e),n)}}function XS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={},r=(n,o)=>{const c=n.props._offset,l=n.id,_=n.parent&&n.parent.id;let v;if(_&&!(_ in t)&&r(n.parent,!1),_ in e){const S=e[_]=e[_]||XS(t[_],t);v=S(n,o),e[l]=S}else Number.isFinite(c)?(v=c+(t[_]||0),e[l]=null):v=i;return o&&v>=i&&(i=v+1),t[l]=v,v};return r}function CF(i,t){let{moduleParameters:e,target:r,viewport:n}=t;const o=r&&r.id!=="default-framebuffer",c=e&&e.devicePixelRatio||Hd(i),l=o?r.height:i.drawingBufferHeight,_=n;return[_.x*c,l-(_.y+_.height)*c,_.width*c,_.height*c]}function PF(i,t){const e=t?t.width:i.drawingBufferWidth,r=t?t.height:i.drawingBufferHeight;sh(i,{viewport:[0,0,e,r]}),i.clear(16640)}class IF extends J1{constructor(t,e){super(t,e),G(this,"shadowMap",void 0),G(this,"depthBuffer",void 0),G(this,"fbo",void 0),this.shadowMap=new Sa(t,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Id(t,{format:33189,width:1,height:1}),this.fbo=new os(t,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(t){const e=this.fbo;Sl(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=t.viewports[0],n=Hd(this.gl),o=r.width*n,c=r.height*n;(o!==e.width||c!==e.height)&&e.resize({width:o,height:c}),super.render({...t,target:e,pass:"shadow"})})}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const ZS="#define SMOOTH_EDGE_RADIUS 0.5",LF=`
`.concat(ZS,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),MF=`
`.concat(ZS,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),BF={name:"geometry",vs:LF,fs:MF},RF=Object.keys(lr).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(lr[i],";")).join(""),kF=Object.keys(_c).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(_c[i],";")).join(""),FF=Object.keys(fy).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(fy[i],";")).join(""),DF="".concat(RF,`
`).concat(kF,`
`).concat(FF,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function OF(i,t){if(i===t)return!0;if(Array.isArray(i)){const e=i.length;if(!t||t.length!==e)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}return!1}function Of(i){let t={},e;return r=>{for(const n in r)if(!OF(r[n],t[n])){e=i(r),t=r;break}return e}}const Gx=[0,0,0,0],NF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$S=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zF=[0,0,0],YS=[0,0,0],jF=Of(VF);function JS(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:YS;e.length<3&&(e=[e[0],e[1],0]);let r=e,n,o=!0;switch(t===lr.LNGLAT_OFFSETS||t===lr.METER_OFFSETS?n=e:n=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case _c.WEB_MERCATOR:(t===lr.LNGLAT||t===lr.CARTESIAN)&&(n=[0,0,0],o=!1);break;case _c.WEB_MERCATOR_AUTO_OFFSET:t===lr.LNGLAT?r=n:t===lr.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],n=i.unprojectPosition(r),r[0]-=e[0],r[1]-=e[1],r[2]-=e[2]);break;case _c.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case _c.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:o}}function UF(i,t,e){const{viewMatrixUncentered:r,projectionMatrix:n}=i;let{viewMatrix:o,viewProjectionMatrix:c}=i,l=Gx,_=Gx,v=i.cameraPosition;const{geospatialOrigin:S,shaderCoordinateOrigin:T,offsetMode:P}=JS(i,t,e);return P&&(_=i.projectPosition(S||T),v=[v[0]-_[0],v[1]-_[1],v[2]-_[2]],_[3]=1,l=Ff([],_,c),o=r||o,c=Ru([],n,o),c=Ru([],c,NF)),{viewMatrix:o,viewProjectionMatrix:c,projectionCenter:l,originCommon:_,cameraPosCommon:v,shaderCoordinateOrigin:T,geospatialOrigin:S}}function GF(i){let{viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=lr.DEFAULT,coordinateOrigin:o=YS,autoWrapLongitude:c=!1}=i;n===lr.DEFAULT&&(n=t.isGeospatial?lr.LNGLAT:lr.CARTESIAN);const l=jF({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:o});return l.project_uWrapLongitude=c,l.project_uModelMatrix=r||$S,l}function VF(i){let{viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}=i;const{projectionCenter:o,viewProjectionMatrix:c,originCommon:l,cameraPosCommon:_,shaderCoordinateOrigin:v,geospatialOrigin:S}=UF(t,r,n),T=t.getDistanceScales(),P=[t.width*e,t.height*e],I=Ff([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,z={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:l.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:P,project_uDevicePixelRatio:e,project_uFocalDistance:I,project_uCommonUnitsPerMeter:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:zF,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:c,project_uModelMatrix:$S,project_uCameraPosition:_};if(S){const N=t.getDistanceScales(S);switch(r){case lr.METER_OFFSETS:z.project_uCommonUnitsPerWorldUnit=N.unitsPerMeter,z.project_uCommonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case lr.LNGLAT:case lr.LNGLAT_OFFSETS:t._pseudoMeters||(z.project_uCommonUnitsPerMeter=N.unitsPerMeter),z.project_uCommonUnitsPerWorldUnit=N.unitsPerDegree,z.project_uCommonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case lr.CARTESIAN:z.project_uCommonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],z.project_uCommonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return z}const qF={};function HF(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:qF;return"viewport"in i?GF(i):{}}const K1={name:"project",dependencies:[uR,BF],vs:DF,getUniforms:HF};function WF(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fd(i,t){const e=Ff([],t,i);return NS(e,e,1/e[3]),e}function Vx(i,t){const e=i%t;return e<0?t+e:e}function Ey(i,t,e){return i<t?t:i>e?e:i}function XF(i){return Math.log(i)*Math.LOG2E}const Q1=Math.log2||XF;function ah(i,t){if(!i)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const xl=Math.PI,KS=xl/4,Ya=xl/180,Ty=180/xl,Yd=512,vg=4003e4,Sm=85.051129,ZF=1.5;function $F(i){return Q1(i)}function vf(i){const[t,e]=i;ah(Number.isFinite(t)),ah(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const r=t*Ya,n=e*Ya,o=Yd*(r+xl)/(2*xl),c=Yd*(xl+Math.log(Math.tan(KS+n*.5)))/(2*xl);return[o,c]}function Jd(i){const[t,e]=i,r=t/Yd*(2*xl)-xl,n=2*(Math.atan(Math.exp(e/Yd*(2*xl)-xl))-KS);return[r*Ty,n*Ty]}function YF(i){const{latitude:t}=i;ah(Number.isFinite(t));const e=Math.cos(t*Ya);return $F(vg*e)-9}function Wm(i){const t=Math.cos(i*Ya);return Yd/vg/t}function Cy(i){const{latitude:t,longitude:e,highPrecision:r=!1}=i;ah(Number.isFinite(t)&&Number.isFinite(e));const n=Yd,o=Math.cos(t*Ya),c=n/360,l=c/o,_=n/vg/o,v={unitsPerMeter:[_,_,_],metersPerUnit:[1/_,1/_,1/_],unitsPerDegree:[c,l,_],degreesPerUnit:[1/c,1/l,1/_]};if(r){const S=Ya*Math.tan(t*Ya)/o,T=c*S/2,P=n/vg*S,I=P/l*_;v.unitsPerDegree2=[0,T,P],v.unitsPerMeter2=[I,0,I]}return v}function QS(i,t){const[e,r,n]=i,[o,c,l]=t,{unitsPerMeter:_,unitsPerMeter2:v}=Cy({longitude:e,latitude:r,highPrecision:!0}),S=vf(i);S[0]+=o*(_[0]+v[0]*c),S[1]+=c*(_[1]+v[1]*c);const T=Jd(S),P=(n||0)+(l||0);return Number.isFinite(n)||Number.isFinite(l)?[T[0],T[1],P]:T}function JF(i){const{height:t,pitch:e,bearing:r,altitude:n,scale:o,center:c}=i,l=WF();_g(l,l,[0,0,-n]),DS(l,l,-e*Ya),OS(l,l,r*Ya);const _=o/t;return X1(l,l,[_,_,_]),c&&_g(l,l,IR([],c)),l}function KF(i){const{width:t,height:e,altitude:r,pitch:n=0,offset:o,center:c,scale:l,nearZMultiplier:_=1,farZMultiplier:v=1}=i;let{fovy:S=bg(ZF)}=i;r!==void 0&&(S=bg(r));const T=S*Ya,P=n*Ya,I=tA(S);let z=I;c&&(z+=c[2]*l/Math.cos(P)/e);const N=T*(.5+(o?o[1]:0)/e),X=Math.sin(N)*z/Math.sin(Ey(Math.PI/2-P-N,.01,Math.PI-.01)),H=Math.sin(P)*X+z,Z=z*10,ot=Math.min(H*v,Z);return{fov:T,aspect:t/e,focalDistance:I,near:_,far:ot}}function bg(i){return 2*Math.atan(.5/i)*Ty}function tA(i){return .5/Math.tan(.5*i*Ya)}function eA(i,t){const[e,r,n=0]=i;return ah(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(n)),Fd(t,[e,r,n,1])}function tv(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,n,o]=i;if(ah(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return Fd(t,[r,n,o,1]);const c=Fd(t,[r,n,0,1]),l=Fd(t,[r,n,1,1]),_=c[2],v=l[2],S=_===v?0:((e||0)-_)/(v-_);return ES([],c,l,S)}function QF(i){const{width:t,height:e,bounds:r,minExtent:n=0,maxZoom:o=24,offset:c=[0,0]}=i,[[l,_],[v,S]]=r,T=tD(i.padding),P=vf([l,Ey(S,-Sm,Sm)]),I=vf([v,Ey(_,-Sm,Sm)]),z=[Math.max(Math.abs(I[0]-P[0]),n),Math.max(Math.abs(I[1]-P[1]),n)],N=[t-T.left-T.right-Math.abs(c[0])*2,e-T.top-T.bottom-Math.abs(c[1])*2];ah(N[0]>0&&N[1]>0);const X=N[0]/z[0],H=N[1]/z[1],Z=(T.right-T.left)/2/X,ot=(T.top-T.bottom)/2/H,gt=[(I[0]+P[0])/2+Z,(I[1]+P[1])/2+ot],Et=Jd(gt),Ft=Math.min(o,Q1(Math.abs(Math.min(X,H))));return ah(Number.isFinite(Ft)),{longitude:Et[0],latitude:Et[1],zoom:Ft}}function tD(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(ah(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const qx=Math.PI/180;function eD(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:e,height:r,unproject:n}=i,o={targetZ:t},c=n([0,r],o),l=n([e,r],o);let _,v;const S=i.fovy?.5*i.fovy*qx:Math.atan(.5/i.altitude),T=(90-i.pitch)*qx;return S>T-.01?(_=Hx(i,0,t),v=Hx(i,e,t)):(_=n([0,0],o),v=n([e,0],o)),[c,l,v,_]}function Hx(i,t,e){const{pixelUnprojectionMatrix:r}=i,n=Fd(r,[t,0,1,1]),o=Fd(r,[t,i.height,1,1]),c=(e*i.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),l=ES([],n,o,c),_=Jd(l);return _.push(e),_}const Wx=512;function iD(i){const{width:t,height:e,pitch:r=0}=i;let{longitude:n,latitude:o,zoom:c,bearing:l=0}=i;(n<-180||n>180)&&(n=Vx(n+180,360)-180),(l<-180||l>180)&&(l=Vx(l+180,360)-180);const _=Q1(e/Wx);if(c<=_)c=_,o=0;else{const v=e/2/Math.pow(2,c),S=Jd([0,v])[1];if(o<S)o=S;else{const T=Jd([0,Wx-v])[1];o>T&&(o=T)}}return{width:t,height:e,longitude:n,latitude:o,zoom:c,pitch:r,bearing:l}}const rD=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,nD=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,sD=Of(hD),oD=Of(uD),aD=[0,0,0,1],lD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function cD(i,t){const[e,r,n]=i,o=tv([e,r,n],t);return Number.isFinite(n)?o:[o[0],o[1],0]}function hD(i){let{viewport:t,center:e}=i;return new ar(t.viewProjectionMatrix).invert().transform(e)}function uD(i){let{viewport:t,shadowMatrices:e}=i;const r=[],n=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,c=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>cD(l,n));for(const l of e){const _=l.clone().translate(new Kt(t.center).negate()),v=c.map(T=>_.transform(T)),S=new ar().ortho({left:Math.min(...v.map(T=>T[0])),right:Math.max(...v.map(T=>T[0])),bottom:Math.min(...v.map(T=>T[1])),top:Math.max(...v.map(T=>T[1])),near:Math.min(...v.map(T=>-T[2])),far:Math.max(...v.map(T=>-T[2]))});r.push(S.multiplyRight(l))}return r}function dD(i,t){const{shadowEnabled:e=!0}=i;if(!e||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||aD,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},n=sD({viewport:i.viewport,center:t.project_uCenter}),o=[],c=oD({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let l=0;l<i.shadowMatrices.length;l++){const _=c[l],v=_.clone().translate(new Kt(i.viewport.center).negate());t.project_uCoordinateSystem===lr.LNGLAT&&t.project_uProjectionMode===_c.WEB_MERCATOR?(c[l]=v,o[l]=n):(c[l]=_.clone().multiplyRight(lD),o[l]=v.transform(n))}for(let l=0;l<c.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=c[l],r["shadow_uProjectCenters[".concat(l,"]")]=o[l],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=i.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=i.dummyShadowMap;return r}const p_={name:"shadow",dependencies:[K1],vs:rD,fs:nD,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?dD(i,t):{}}},pD={color:[255,255,255],intensity:1},Xx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],fD=[0,0,0,200/255];class ev{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"id","lighting-effect"),G(this,"props",void 0),G(this,"shadowColor",fD),G(this,"shadow",void 0),G(this,"ambientLight",void 0),G(this,"directionalLights",void 0),G(this,"pointLights",void 0),G(this,"shadowPasses",[]),G(this,"shadowMaps",[]),G(this,"dummyShadowMap",null),G(this,"programManager",void 0),G(this,"shadowMatrices",void 0),this.setProps(t)}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const e in t){const r=t[e];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.props=t}preRender(t,e){let{layers:r,layerFilter:n,viewports:o,onViewportActive:c,views:l}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(t),this.programManager||(this.programManager=Df.getDefaultProgramManager(t),p_&&this.programManager.addDefaultModule(p_)),this.dummyShadowMap||(this.dummyShadowMap=new Sa(t,{width:1,height:1}));for(let _=0;_<this.shadowPasses.length;_++)this.shadowPasses[_].render({layers:r,layerFilter:n,viewports:o,onViewportActive:c,views:l,moduleParameters:{shadowLightId:_,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){const e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:t})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:t}))},e}cleanup(){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(p_),this.programManager=null)}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const r=new ar().lookAt({eye:new Kt(e.direction).negate()});t.push(r)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const r=new IF(t);this.shadowPasses[e]=r,this.shadowMaps[e]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:r}=this;!t&&e.length===0&&r.length===0&&(this.ambientLight=new WS(pD),this.directionalLights.push(new Ux(Xx[0]),new Ux(Xx[1])))}}class mD{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"_pool",[]),G(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,r){let{size:n=1,type:o,padding:c=0,copy:l=!1,initialize:_=!1,maxCount:v}=r;const S=o||t&&t.constructor||Float32Array,T=e*n+c;if(ArrayBuffer.isView(t)){if(T<=t.length)return t;if(T*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new S(t.buffer,0,T)}let P=1/0;v&&(P=v*n+c);const I=this._allocate(S,T,_,P);return t&&l?I.set(t):_||I.fill(0,0,4),this._release(t),I}release(t){this._release(t)}_allocate(t,e,r,n){let o=Math.max(Math.ceil(e*this.opts.overAlloc),1);o>n&&(o=n);const c=this._pool,l=t.BYTES_PER_ELEMENT*o,_=c.findIndex(v=>v.byteLength>=l);if(_>=0){const v=new t(c.splice(_,1)[0],0,o);return r&&v.fill(0),v}return new t(o)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:r}=t,{byteLength:n}=r,o=e.findIndex(c=>c.byteLength>=n);o<0?e.push(r):(o>0||e.length<this.opts.poolSize)&&e.splice(o,0,r),e.length>this.opts.poolSize&&e.shift()}}const bf=new mD;function Qp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function gD(i){return[i[12],i[13],i[14]]}function _D(i){return{left:_d(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:_d(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:_d(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:_d(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:_d(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:_d(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Zx=new Kt;function _d(i,t,e,r){Zx.set(i,t,e);const n=Zx.len();return{distance:r/n,normal:new Kt(-i/n,-t/n,-e/n)}}function yD(i){return i-Math.fround(i)}let jp;function f_(i,t){const{size:e=1,startIndex:r=0}=t,n=t.endIndex!==void 0?t.endIndex:i.length,o=(n-r)/e;jp=bf.allocate(jp,o,{type:Float32Array,size:e*2});let c=r,l=0;for(;c<n;){for(let _=0;_<e;_++){const v=i[c++];jp[l+_]=v,jp[l+_+e]=yD(v)}l+=e*2}return jp.subarray(0,o*e*2)}function vD(i){let t=null,e=!1;for(const r of i)r&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}const bD=Math.PI/180,xD=Qp(),$x=[0,0,0],wD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function SD(i){let{width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:o,padding:c,near:l,far:_}=i;const v=t/e,S=r?new ar().orthographic({fovy:n,aspect:v,focalDistance:o,near:l,far:_}):new ar().perspective({fovy:n,aspect:v,near:l,far:_});if(c){const{left:T=0,right:P=0,top:I=0,bottom:z=0}=c,N=th((T+t-P)/2,0,t)-t/2,X=th((I+e-z)/2,0,e)-e/2;S[8]-=N*2/t,S[9]+=X*2/e}return S}class ip{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};G(this,"id",void 0),G(this,"x",void 0),G(this,"y",void 0),G(this,"width",void 0),G(this,"height",void 0),G(this,"padding",void 0),G(this,"isGeospatial",void 0),G(this,"zoom",void 0),G(this,"focalDistance",void 0),G(this,"position",void 0),G(this,"modelMatrix",void 0),G(this,"distanceScales",void 0),G(this,"scale",void 0),G(this,"center",void 0),G(this,"cameraPosition",void 0),G(this,"projectionMatrix",void 0),G(this,"viewMatrix",void 0),G(this,"viewMatrixUncentered",void 0),G(this,"viewMatrixInverse",void 0),G(this,"viewProjectionMatrix",void 0),G(this,"pixelProjectionMatrix",void 0),G(this,"pixelUnprojectionMatrix",void 0),G(this,"resolution",void 0),G(this,"_frustumPlanes",{}),this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||wD,this.focalDistance=t.focalDistance||1,this.position=t.position||$x,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:r}=t;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?_c.WEB_MERCATOR:_c.WEB_MERCATOR_AUTO_OFFSET:_c.IDENTITY}equals(t){return t instanceof ip?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Al(t.projectionMatrix,this.projectionMatrix)&&Al(t.viewMatrix,this.viewMatrix):!1}project(t){let{topLeft:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(t),n=eA(r,this.pixelProjectionMatrix),[o,c]=n,l=e?c:this.height-c;return t.length===2?[o,l]:[o,l,n[2]]}unproject(t){let{topLeft:e=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,c]=t,l=e?o:this.height-o,_=r&&r*this.distanceScales.unitsPerMeter[2],v=tv([n,l,c],this.pixelUnprojectionMatrix,_),[S,T,P]=this.unprojectPosition(v);return Number.isFinite(c)?[S,T,P]:Number.isFinite(r)?[S,T,r]:[S,T]}projectPosition(t){const[e,r]=this.projectFlat(t),n=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,r,n]}unprojectPosition(t){const[e,r]=this.unprojectFlat(t),n=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,r,n]}projectFlat(t){if(this.isGeospatial){const e=vf(t);return e[1]=th(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?Jd(t):t}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},e=this.unproject([0,0],t),r=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(e[0],r[0],n[0],o[0]),Math.min(e[1],r[1],n[1],o[1]),Math.max(e[0],r[0],n[0],o[0]),Math.max(e[1],r[1],n[1],o[1])]}getDistanceScales(t){return t?Cy({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel(t){let{x:e,y:r,width:n=1,height:o=1}=t;return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_D(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,r=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=YF({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Cy({latitude:r,longitude:e}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:c}=t;let l=$x;if(o&&(l=c?new ar(c).transformAsVector(o,[]):o),this.isGeospatial){const _=this.projectPosition([e,r,0]);this.center=new Kt(l).scale(this.distanceScales.unitsPerMeter).add(_)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=xD,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:o,fovy:c=75,near:l=.1,far:_=1e3,padding:v=null,focalDistance:S=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new ar().multiplyRight(e).translate(new Kt(this.center).negate()),this.projectionMatrix=r||SD({width:this.width,height:this.height,orthographic:n,fovyRadians:o||c*bD,focalDistance:S,padding:v,near:l,far:_});const T=Qp();Ru(T,T,this.projectionMatrix),Ru(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Sy([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=gD(this.viewMatrixInverse);const P=Qp(),I=Qp();X1(P,P,[this.width/2,-this.height/2,1]),_g(P,P,[1,-1,0]),Ru(I,P,this.viewProjectionMatrix),this.pixelProjectionMatrix=I,this.pixelUnprojectionMatrix=Sy(Qp(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||hr.warn("Pixel project matrix not invertible")()}}G(ip,"displayName","Viewport");class Ou extends ip{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:e=0,longitude:r=0,zoom:n=0,pitch:o=0,bearing:c=0,nearZMultiplier:l=.1,farZMultiplier:_=1.01,nearZ:v,farZ:S,orthographic:T=!1,projectionMatrix:P,repeat:I=!1,worldOffset:z=0,position:N,padding:X,legacyMeterSizes:H=!1}=t;let{width:Z,height:ot,altitude:gt=1.5}=t;const Et=Math.pow(2,n);Z=Z||1,ot=ot||1;let Ft,Mt=null;if(P)gt=P[5]/2,Ft=bg(gt);else{t.fovy?(Ft=t.fovy,gt=tA(Ft)):Ft=bg(gt);let Ut;if(X){const{top:zt=0,bottom:at=0}=X;Ut=[0,th((zt+ot-at)/2,0,ot)-ot/2]}Mt=KF({width:Z,height:ot,scale:Et,center:N&&[0,0,N[2]*Wm(e)],offset:Ut,pitch:o,fovy:Ft,nearZMultiplier:l,farZMultiplier:_}),Number.isFinite(v)&&(Mt.near=v),Number.isFinite(S)&&(Mt.far=S)}let yt=JF({height:ot,pitch:o,bearing:c,scale:Et,altitude:gt});z&&(yt=new ar().translate([512*z,0,0]).multiplyLeft(yt)),super({...t,width:Z,height:ot,viewMatrix:yt,longitude:r,latitude:e,zoom:n,...Mt,fovy:Ft,focalDistance:gt}),G(this,"longitude",void 0),G(this,"latitude",void 0),G(this,"pitch",void 0),G(this,"bearing",void 0),G(this,"altitude",void 0),G(this,"fovy",void 0),G(this,"orthographic",void 0),G(this,"_subViewports",void 0),G(this,"_pseudoMeters",void 0),this.latitude=e,this.longitude=r,this.zoom=n,this.pitch=o,this.bearing=c,this.altitude=gt,this.fovy=Ft,this.orthographic=T,this._subViewports=I?[]:null,this._pseudoMeters=H,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),r=Math.ceil((t[2]-180)/360);for(let n=e;n<=r;n++){const o=n?new Ou({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,r]=this.projectFlat(t),n=(t[2]||0)*Wm(t[1]);return[e,r,n]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,r]=this.unprojectFlat(t),n=(t[2]||0)/Wm(r);return[e,r,n]}addMetersToLngLat(t,e){return QS(t,e)}panByPosition(t,e){const r=tv(e,this.pixelUnprojectionMatrix),n=this.projectFlat(t),o=Lx([],n,SR([],r)),c=Lx([],this.center,o),[l,_]=this.unprojectFlat(c);return{longitude:l,latitude:_}}getBounds(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=eD(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:n}=this,{longitude:o,latitude:c,zoom:l}=QF({width:r,height:n,bounds:t,...e});return new Ou({width:r,height:n,longitude:o,latitude:c,zoom:l})}}G(Ou,"displayName","WebMercatorViewport");const Yx=[0,0,0];function m_(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=t.projectPosition(i);if(e&&t instanceof Ou){const[n,o,c=0]=i,l=t.getDistanceScales([n,o]);r[2]=c*l.unitsPerMeter[2]}return r}function AD(i){const{viewport:t,modelMatrix:e,coordinateOrigin:r}=i;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:c}=i;return n===lr.DEFAULT&&(n=t.isGeospatial?lr.LNGLAT:lr.CARTESIAN),o===void 0&&(o=n),c===void 0&&(c=r),{viewport:t,coordinateSystem:n,coordinateOrigin:r,modelMatrix:e,fromCoordinateSystem:o,fromCoordinateOrigin:c}}function iA(i,t){let{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:c}=t,[l,_,v=0]=i;switch(r&&([l,_,v]=Ff([],[l,_,v,1],r)),n){case lr.LNGLAT:return m_([l,_,v],e,c);case lr.LNGLAT_OFFSETS:return m_([l+o[0],_+o[1],v+(o[2]||0)],e,c);case lr.METER_OFFSETS:return m_(QS(o,[l,_,v]),e,c);case lr.CARTESIAN:default:return e.isGeospatial?[l+o[0],_+o[1],v+o[2]]:e.projectPosition([l,_,v])}}function ED(i,t){const{viewport:e,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:c,fromCoordinateOrigin:l}=AD(t),{autoOffset:_=!0}=t,{geospatialOrigin:v=Yx,shaderCoordinateOrigin:S=Yx,offsetMode:T=!1}=_?JS(e,r,n):{},P=iA(i,{viewport:e,modelMatrix:o,coordinateSystem:c,coordinateOrigin:l,offsetMode:T});if(T){const I=e.projectPosition(v||S);FR(P,P,I)}return P}const Jx={blendFunc:[1,0,32771,0],blendEquation:32774};class rA extends J1{constructor(){super(...arguments),G(this,"pickZ",void 0),G(this,"_colorEncoderState",null)}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer(t){let{layers:e,layerFilter:r,views:n,viewports:o,onViewportActive:c,pickingFBO:l,deviceRect:{x:_,y:v,width:S,height:T},cullRect:P,effects:I,pass:z="picking",pickZ:N,moduleParameters:X}=t;const H=this.gl;this.pickZ=N;const Z=this._resetColorEncoder(N),ot=Sl(H,{scissorTest:!0,scissor:[_,v,S,T],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Jx,blend:!N},()=>super.render({target:l,layers:e,layerFilter:r,views:n,viewports:o,onViewportActive:c,cullRect:P,effects:I==null?void 0:I.filter(gt=>gt.useInPicking),pass:z,isPicking:!0,moduleParameters:X}));return this._colorEncoderState=null,{decodePickingColor:Z&&CD.bind(null,Z),stats:ot}}shouldDrawLayer(t){const{pickable:e,operation:r}=t.props;return e&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(t,e,r){const n={...t.props.parameters},{pickable:o,operation:c}=t.props;return this._colorEncoderState?o&&c.includes("draw")&&(Object.assign(n,Jx),n.blend=!0,n.blendColor=TD(this._colorEncoderState,t,r)):n.blend=!1,c.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function TD(i,t,e){const{byLayer:r,byAlpha:n}=i;let o,c=r.get(t);return c?(c.viewports.push(e),o=c.a):(o=r.size+1,o<=255?(c={a:o,layer:t,viewports:[e]},r.set(t,c),n[o]=c):(hr.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function CD(i,t){const e=i.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const Ad={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},xg=Symbol.for("component"),Vh=Symbol.for("propTypes"),g_=Symbol.for("deprecatedProps"),Dd=Symbol.for("asyncPropDefaults"),Nu=Symbol.for("asyncPropOriginal"),jh=Symbol.for("asyncPropResolved");function zg(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?nA(i,t,[]):t(i)?[i]:[]}function nA(i,t,e){let r=-1;for(;++r<i.length;){const n=i[r];Array.isArray(n)?nA(n,t,e):t(n)&&e.push(n)}return e}function PD(i){let{target:t,source:e,start:r=0,count:n=1}=i;const o=e.length,c=n*o;let l=0;for(let _=r;l<o;l++)t[_++]=e[l];for(;l<c;)l<c-l?(t.copyWithin(r+l,r,r+l),l*=2):(t.copyWithin(r+l,r,r+c-l),l=c);return t}class ID{constructor(t,e,r){G(this,"id",void 0),G(this,"context",void 0),G(this,"isLoaded",void 0),G(this,"persistent",void 0),G(this,"_loadCount",0),G(this,"_subscribers",new Set),G(this,"_data",void 0),G(this,"_loader",void 0),G(this,"_error",void 0),G(this,"_content",void 0),this.id=t,this.context=r,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const r=++this._loadCount;let n=t;typeof t=="string"&&(n=Hh(t)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const o of this._subscribers)o.onChange(this.getData())}}class LD{constructor(t){let{gl:e,protocol:r}=t;G(this,"protocol",void 0),G(this,"_context",void 0),G(this,"_resources",void 0),G(this,"_consumers",void 0),G(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add(t){let{resourceId:e,data:r,forceUpdate:n=!1,persistent:o=!0}=t,c=this._resources[e];c?c.setData(r,n):(c=new ID(e,r,this._context),this._resources[e]=c),c.persistent=o}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe(t){let{consumerId:e}=t;const r=this._consumers[e];if(r){for(const n in r){const o=r[n],c=this._resources[o.resourceId];c&&c.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe(t){let{resourceId:e,onChange:r,consumerId:n,requestId:o="default"}=t;const{_resources:c,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),c[e]||this.add({resourceId:e,data:null,persistent:!1}));const _=c[e];if(this._track(n,o,_,r),_)return _.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,r,n){const o=this._consumers,c=o[t]=o[t]||{},l=c[e]||{},_=l.resourceId&&this._resources[l.resourceId];_&&(_.unsubscribe(l),this.prune()),r&&(c[e]=l,l.onChange=n,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const MD=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,iv={name:"project32",dependencies:[K1],vs:MD},rv={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...Gk},BD=[K1],RD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function kD(i){const t=Df.getDefaultProgramManager(i);for(const e of BD)t.addDefaultModule(e);for(const e of RD)t.addShaderHook(e);return t}const FD="layerManager.setLayers",DD="layerManager.activateViewport";class OD{constructor(t){let{deck:e,stats:r,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};G(this,"layers",void 0),G(this,"context",void 0),G(this,"resourceManager",void 0),G(this,"_lastRenderedLayers",[]),G(this,"_needsRedraw",!1),G(this,"_needsUpdate",!1),G(this,"_nextLayers",null),G(this,"_debug",!1),G(this,"activateViewport",c=>{to(DD,this,c),c&&(this.context.viewport=c)}),this.layers=[],this.resourceManager=new LD({gl:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:t,deck:e,programManager:t&&kD(t),stats:r||new If({id:"deck.gl"}),viewport:n||new ip({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new HS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(t);e=e||n}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers(){let{layerIds:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t?this.layers.filter(e=>t.find(r=>e.id.indexOf(r)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){to(FD,this,e,t),this._lastRenderedLayers=t;const r=zg(t,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}_handleError(t,e,r){r.raiseError(e,"".concat(t," of ").concat(r))}_updateLayers(t,e){const r={};for(const c of t)r[c.id]?hr.warn("Multiple old layers with same id ".concat(c.id))():r[c.id]=c;const n=[];this._updateSublayersRecursively(e,r,n),this._finalizeOldLayers(r);let o=!1;for(const c of n)if(c.hasUniformTransition()){o="Uniform transition in ".concat(c);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(t,e,r){for(const n of t){n.context=this.context;const o=e[n.id];o===null&&hr.warn("Multiple new layers with same id ".concat(n.id))(),e[n.id]=null;let c=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),c=n.isComposite?n.getSubLayers():null}catch(l){this._handleError("matching",l,n)}c&&this._updateSublayersRecursively(c,e,r)}}_finalizeOldLayers(t){for(const e in t){const r=t[e];r&&this._finalizeLayer(r)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Ad.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Ad.MATCHED,e!==t&&(t.lifecycle=Ad.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=Ad.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Ad.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function yc(i,t,e){if(i===t)return!0;if(!e||!i||!t)return!1;if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!yc(i[r],t[r],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof i=="object"&&typeof t=="object"){const r=Object.keys(i),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(!t.hasOwnProperty(o)||!yc(i[o],t[o],e-1))return!1;return!0}return!1}class ND{constructor(t){G(this,"width",void 0),G(this,"height",void 0),G(this,"views",void 0),G(this,"viewState",void 0),G(this,"controllers",void 0),G(this,"timeline",void 0),G(this,"_viewports",void 0),G(this,"_viewportMap",void 0),G(this,"_isUpdating",void 0),G(this,"_needsRedraw",void 0),G(this,"_needsUpdate",void 0),G(this,"_eventManager",void 0),G(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,r=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(r):r}getViewport(t){return this._viewportMap[t]}unproject(t,e){const r=this.getViewports(),n={x:t[0],y:t[1]};for(let o=r.length-1;o>=0;--o){const c=r[o];if(c.containsPixel(n)){const l=t.slice();return l[0]-=c.x,l[1]-=c.y,c.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=zg(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!yc(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):hr.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(t,e){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...e,viewId:t})}_createController(t,e){const r=e.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:n=>{var o;return(o=this.getView(t.id))===null||o===void 0?void 0:o.makeViewport({viewState:n,width:this.width,height:this.height})}})}_updateController(t,e,r,n){const o=t.controller;if(o&&r){const c={...e,...o,id:t.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==o.type)&&(n=this._createController(t,c)),n&&n.setProps(c),n}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=t.length;n--;){const o=t[n],c=this.getViewState(o),l=o.makeViewport({viewState:c,width:this.width,height:this.height});let _=e[o.id];const v=!!o.controller;v&&!_&&(r=!0),(r||!v)&&_&&(_.finalize(),_=null),this.controllers[o.id]=this._updateController(o,c,l,_),l&&this._viewports.unshift(l)}for(const n in e){const o=e[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((r,n)=>!t[n].equals(e[n]))}}const zD=/([0-9]+\.?[0-9]*)(%|px)/;function Mh(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const t=zD.exec(i);if(t&&t.length>=3){const e=t[2]==="%",r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw new Error("Could not parse position string ".concat(i))}}function Bh(i,t){return i.relative?Math.round(i.position*t):i.position}function Rs(i,t){if(!i)throw new Error(t||"deck.gl: assertion failed.")}class jD{constructor(t){G(this,"id",void 0),G(this,"viewportInstance",void 0),G(this,"_x",void 0),G(this,"_y",void 0),G(this,"_width",void 0),G(this,"_height",void 0),G(this,"_padding",void 0),G(this,"props",void 0);const{id:e,x:r=0,y:n=0,width:o="100%",height:c="100%",padding:l=null,viewportInstance:_}=t||{};Rs(!_||_ instanceof ip),this.viewportInstance=_,this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Mh(r),this._y=Mh(n),this._width=Mh(o),this._height=Mh(c),this._padding=l&&{left:Mh(l.left||0),right:Mh(l.right||0),top:Mh(l.top||0),bottom:Mh(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.viewportInstance?t.viewportInstance?this.viewportInstance.equals(t.viewportInstance):!1:this.ViewportType===t.ViewportType&&yc(this.props,t.props,2)}makeViewport(t){let{width:e,height:r,viewState:n}=t;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:e,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const r in this.props.viewState)r!=="id"&&(e[r]=this.props.viewState[r]);return e}return t}getDimensions(t){let{width:e,height:r}=t;const n={x:Bh(this._x,e),y:Bh(this._y,r),width:Bh(this._width,e),height:Bh(this._height,r)};return this._padding&&(n.padding={left:Bh(this._padding.left,e),top:Bh(this._padding.top,r),right:Bh(this._padding.right,e),bottom:Bh(this._padding.bottom,r)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Nf{constructor(t){G(this,"_inProgress",void 0),G(this,"_handle",void 0),G(this,"_timeline",void 0),G(this,"time",void 0),G(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=t,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(t){var e,r;this.cancel(),this.settings=t,this._inProgress=!0,(e=(r=this.settings).onStart)===null||e===void 0||e.call(r,this)}end(){if(this._inProgress){var t,e;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)===null||t===void 0||t.call(e,this)}}cancel(){if(this._inProgress){var t,e;(t=(e=this.settings).onInterrupt)===null||t===void 0||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)===null||t===void 0||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Kx=()=>{},Py={BREAK:1,SNAP_TO_END:2,IGNORE:3},UD=i=>i,GD=Py.BREAK;class VD{constructor(t){G(this,"getControllerState",void 0),G(this,"props",void 0),G(this,"propsInTransition",void 0),G(this,"transition",void 0),G(this,"onViewStateChange",void 0),G(this,"onStateChange",void 0),G(this,"_onTransitionUpdate",e=>{const{time:r,settings:{interpolator:n,startProps:o,endProps:c,duration:l,easing:_}}=e,v=_(r/l),S=n.interpolateProps(o,c,v);this.propsInTransition=this.getControllerState({...this.props,...S}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Nf(t.timeline),this.onViewStateChange=t.onViewStateChange||Kx,this.onStateChange=t.onStateChange||Kx}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const r=this.props;if(this.props=t,!r||this._shouldIgnoreViewportChange(r,t))return!1;if(this._isTransitionEnabled(t)){let n=r;if(this.transition.inProgress){const{interruption:o,endProps:c}=this.transition.settings;n={...r,...o===Py.SNAP_TO_END?c:this.propsInTransition||r}}this._triggerTransition(n,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:r}=t;return(e>0||e==="auto")&&!!r}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===Py.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const r=this.getControllerState(t),n=this.getControllerState(e).shortestPathFrom(r),o=e.transitionInterpolator,c=o.getDuration?o.getDuration(t,e):e.transitionDuration;if(c===0)return;const l=o.initializeProps(t,n);this.propsInTransition={};const _={duration:c,easing:e.transitionEasing||UD,interpolator:o,interruption:e.transitionInterruption||GD,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(_),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}class qD{constructor(t){G(this,"_propsToCompare",void 0),G(this,"_propsToExtract",void 0),G(this,"_requiredProps",void 0);const{compare:e,extract:r,required:n}=t;this._propsToCompare=e,this._propsToExtract=r||e,this._requiredProps=n}arePropsEqual(t,e){for(const r of this._propsToCompare)if(!(r in t)||!(r in e)||!Al(t[r],e[r]))return!1;return!0}initializeProps(t,e){const r={},n={};for(const o of this._propsToExtract)(o in t||o in e)&&(r[o]=t[o],n[o]=e[o]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const r=t[e];Rs(Number.isFinite(r)||Array.isArray(r),"".concat(e," is required for transition"))})}}const HD=["longitude","latitude","zoom","bearing","pitch"],WD=["longitude","latitude","zoom"];class sA extends qD{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Array.isArray(t)?t:t.transitionProps,r=Array.isArray(t)?{}:t;r.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:HD,required:WD},super(r.transitionProps),G(this,"opts",void 0),this.opts=r}initializeProps(t,e){const r=super.initializeProps(t,e),{makeViewport:n,around:o}=this.opts;if(n&&o){const c=n(t),l=n(e),_=c.unproject(o);r.start.around=o,Object.assign(r.end,{around:l.project(_),aroundPosition:_,width:e.width,height:e.height})}return r}interpolateProps(t,e,r){const n={};for(const o of this._propsToExtract)n[o]=gg(t[o]||0,e[o]||0,r);if(e.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...e,...n});Object.assign(n,o.panByPosition(e.aroundPosition,gg(t.around,e.around,r)))}return n}}const Rh={transitionDuration:0},XD=300,Am=i=>1-(1-i)*(1-i),yd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},yu={};class ZD{constructor(t){G(this,"props",void 0),G(this,"state",{}),G(this,"transitionManager",void 0),G(this,"eventManager",void 0),G(this,"onViewStateChange",void 0),G(this,"onStateChange",void 0),G(this,"makeViewport",void 0),G(this,"_controllerState",void 0),G(this,"_events",{}),G(this,"_interactionState",{isDragging:!1}),G(this,"_customEvents",[]),G(this,"_eventStartBlocked",null),G(this,"_panMove",!1),G(this,"invertPan",!1),G(this,"dragMode","rotate"),G(this,"inertia",0),G(this,"scrollZoom",!0),G(this,"dragPan",!0),G(this,"dragRotate",!0),G(this,"doubleClickZoom",!0),G(this,"touchZoom",!0),G(this,"touchRotate",!1),G(this,"keyboard",!0),this.transitionManager=new VD({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)if(this._events[e]){var t;(t=this.eventManager)===null||t===void 0||t.off(e,this.handleEvent)}this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return e?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:r}=this.props,{offsetCenter:n}=t;return[n.x-e,n.y-r]}isPointInBounds(t,e){const{width:r,height:n}=this.props;if(e&&e.handled)return!1;const o=t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=n;return o&&e&&e.stopPropagation(),o}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?XD:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:c=!0,touchZoom:l=!0,touchRotate:_=!1,keyboard:v=!0}=t,S=!!this.onViewStateChange;this.toggleEvents(yd.WHEEL,S&&r),this.toggleEvents(yd.PAN,S),this.toggleEvents(yd.PINCH,S&&(l||_)),this.toggleEvents(yd.TRIPLE_PAN,S&&_),this.toggleEvents(yd.DOUBLE_TAP,S&&c),this.toggleEvents(yd.KEYBOARD,S&&v),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=l,this.touchRotate=_,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(r=>{this._events[r]!==e&&(this._events[r]=e,e?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...t.getViewportProps(),...e},o=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(r),o){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:c})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let r=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:e});return this._panMove=r,this.updateViewport(n,Rh,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),r=this.controllerState.pan({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const r=this.getCenter(t),n=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Am},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const r=this.getCenter(t),n=[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Am},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=t;let c=2/(1+Math.exp(-Math.abs(o*r)));o<0&&c!==0&&(c=1/c);const l=this.controllerState.zoom({pos:e,scale:c});return this.updateViewport(l,{...this._getTransitionProps({around:e}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.rotateStart({pos:e});return this.updateViewport(r,Rh,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const r=this.controllerState.rotate({pos:e});return this.updateViewport(r,Rh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const r=this.getCenter(t),n=[r[0],r[1]+=t.velocityY*e/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Am},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return yu._startPinchRotation=t.rotation,yu._lastPinchEvent=t,this.updateViewport(r,Rh,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:r}=t,n=this.getCenter(t);e=e.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=t;e=e.rotate({deltaAngleX:yu._startPinchRotation-r})}return this.updateViewport(e,Rh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),yu._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:r}=yu;if(this.touchZoom&&e&&r&&t.scale!==r.scale){const n=this.getCenter(t);let o=this.controllerState.rotateEnd();const c=Math.log2(t.scale),l=(c-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),_=Math.pow(2,c+l*e/2);o=o.zoom({pos:n,scale:_}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:e,transitionEasing:Am},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return yu._startPinchRotation=null,yu._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const r=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:e,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let _;const v={};switch(t.srcEvent.code){case"Minus":_=e?l.zoomOut(r).zoomOut(r):l.zoomOut(r),v.isZooming=!0;break;case"Equal":_=e?l.zoomIn(r).zoomIn(r):l.zoomIn(r),v.isZooming=!0;break;case"ArrowLeft":e?(_=l.rotateLeft(o),v.isRotating=!0):(_=l.moveLeft(n),v.isPanning=!0);break;case"ArrowRight":e?(_=l.rotateRight(o),v.isRotating=!0):(_=l.moveRight(n),v.isPanning=!0);break;case"ArrowUp":e?(_=l.rotateUp(c),v.isRotating=!0):(_=l.moveUp(n),v.isPanning=!0);break;case"ArrowDown":e?(_=l.rotateDown(c),v.isRotating=!0):(_=l.moveDown(n),v.isPanning=!0);break;default:return!1}return this.updateViewport(_,this._getTransitionProps(),v),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?Rh:t?{...e,transitionInterpolator:new sA({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class $D{constructor(t,e){G(this,"_viewportProps",void 0),G(this,"_state",void 0),this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Qx=5,YD=1.2;class JD extends $D{constructor(t){const{width:e,height:r,latitude:n,longitude:o,zoom:c,bearing:l=0,pitch:_=0,altitude:v=1.5,position:S=[0,0,0],maxZoom:T=20,minZoom:P=0,maxPitch:I=60,minPitch:z=0,startPanLngLat:N,startZoomLngLat:X,startRotatePos:H,startBearing:Z,startPitch:ot,startZoom:gt,normalize:Et=!0}=t;Rs(Number.isFinite(o)),Rs(Number.isFinite(n)),Rs(Number.isFinite(c)),super({width:e,height:r,latitude:n,longitude:o,zoom:c,bearing:l,pitch:_,altitude:v,maxZoom:T,minZoom:P,maxPitch:I,minPitch:z,normalize:Et,position:S},{startPanLngLat:N,startZoomLngLat:X,startRotatePos:H,startBearing:Z,startPitch:ot,startZoom:gt}),G(this,"makeViewport",void 0),this.makeViewport=t.makeViewport}panStart(t){let{pos:e}=t;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan(t){let{pos:e,startPos:r}=t;const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(t){let{pos:e}=t;return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(t){let{pos:e,deltaAngleX:r=0,deltaAngleY:n=0}=t;const{startRotatePos:o,startBearing:c,startPitch:l}=this.getState();if(!o||c===void 0||l===void 0)return this;let _;return e?_=this._getNewRotation(e,o,l,c):_={bearing:c+r,pitch:l+n},this._getUpdatedState(_)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(t){let{pos:e}=t;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom(t){let{pos:e,startPos:r,scale:n}=t,{startZoom:o,startZoomLngLat:c}=this.getState();if(c||(o=this.getViewportProps().zoom,c=this._unproject(r)||this._unproject(e)),!c)return this;const{maxZoom:l,minZoom:_}=this.getViewportProps();let v=o+Math.log2(n);v=th(v,_,l);const S=this.makeViewport({...this.getViewportProps(),zoom:v});return this._getUpdatedState({zoom:v,...S.panByPosition(c,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(t)}zoomOut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/t)}moveLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([t,0])}moveRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-t,0])}moveUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,t])}moveDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-t])}rotateLeft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:o}=r;return Math.abs(n-e.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(o-e.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(t){const{maxZoom:e,minZoom:r,zoom:n}=t;t.zoom=th(n,r,e);const{maxPitch:o,minPitch:c,pitch:l}=t;t.pitch=th(l,c,o);const{normalize:_=!0}=t;return _&&Object.assign(t,iD(t)),t}_zoomFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.zoom({pos:[e/2,r/2],scale:t})}_panFromCenter(t){const{width:e,height:r}=this.getViewportProps();return this.pan({startPos:[e/2,r/2],pos:[e/2+t[0],r/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,r,n){const o=t[0]-e[0],c=t[1]-e[1],l=t[1],_=e[1],{width:v,height:S}=this.getViewportProps(),T=o/v;let P=0;c>0?Math.abs(S-_)>Qx&&(P=c/(_-S)*YD):c<0&&_>Qx&&(P=1-l/_),P=th(P,-1,1);const{minPitch:I,maxPitch:z}=this.getViewportProps(),N=n+180*T;let X=r;return P>0?X=r+P*(z-r):P<0&&(X=r-P*(I-r)),{pitch:X,bearing:N}}}class KD extends ZD{constructor(){super(...arguments),G(this,"ControllerState",JD),G(this,"transition",{transitionDuration:300,transitionInterpolator:new sA({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),G(this,"dragMode","pan")}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class nv extends jD{get ViewportType(){return Ou}get ControllerType(){return KD}}G(nv,"displayName","MapView");const QD=new ev;function t8(i,t){var e,r;const n=(e=i.order)!==null&&e!==void 0?e:1/0,o=(r=t.order)!==null&&r!==void 0?r:1/0;return n-o}class e8{constructor(){G(this,"effects",void 0),G(this,"_resolvedEffects",[]),G(this,"_defaultEffects",[]),G(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(r=>r.id===t.id)){const r=e.findIndex(n=>t8(n,t)>0);r<0?e.push(t):e.splice(r,0,t),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(yc(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const n of this.effects)e[n.id]=n;const r=[];for(const n of t){const o=e[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),r.push(o)):(o.cleanup(),r.push(n)):r.push(n),delete e[n.id]}for(const n in e)e[n].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),t.some(n=>n instanceof ev)||this._resolvedEffects.push(QD),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class i8 extends J1{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const r8="deckRenderer.renderLayers";class n8{constructor(t){G(this,"gl",void 0),G(this,"layerFilter",void 0),G(this,"drawPickingColors",void 0),G(this,"drawLayersPass",void 0),G(this,"pickLayersPass",void 0),G(this,"renderCount",void 0),G(this,"_needsRedraw",void 0),G(this,"renderBuffers",void 0),G(this,"lastPostProcessEffect",void 0),this.gl=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new i8(t),this.pickLayersPass=new rA(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t,target:t.target||os.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=e.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,to(r8,this,o,t)}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const r of t)e.preRenderStats[r.id]=r.preRender(this.gl,e),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this;t.length===0&&t.push(new os(this.gl),new os(this.gl));for(const e of t)e.resize()}_postRender(t,e){const{renderBuffers:r}=this,n={...e,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of t)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=e.target,o.postRender(this.gl,n);break}const c=o.postRender(this.gl,n);n.inputBuffer=c,n.swapBuffer=c===r[0]?r[1]:r[0]}}}const s8={pickedColor:null,pickedObjectIndex:-1};function o8(i){let{pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:c}=i;const{x:l,y:_,width:v,height:S}=c;let T=o*o,P=-1,I=0;for(let z=0;z<S;z++){const N=z+_-n,X=N*N;if(X>T)I+=4*v;else for(let H=0;H<v;H++){if(t[I+3]-1>=0){const Z=H+l-r,ot=Z*Z+X;ot<=T&&(T=ot,P=I)}I+=4}}if(P>=0){const z=t.slice(P,P+4),N=e(z);if(N){const X=Math.floor(P/4/v),H=P/4-X*v;return{...N,pickedColor:z,pickedX:l+H,pickedY:_+X}}hr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return s8}function a8(i){let{pickedColors:t,decodePickingColor:e}=i;const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const o=t.slice(n,n+4),c=o.join(",");if(!r.has(c)){const l=e(o);l?r.set(c,{...l,color:o}):hr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function oA(i){let{pickInfo:t,viewports:e,pixelRatio:r,x:n,y:o,z:c}=i,l=e[0];e.length>1&&(l=c8((t==null?void 0:t.pickedViewports)||e,{x:n,y:o}));let _;if(l){const v=[n-l.x,o-l.y];c!==void 0&&(v[2]=c),_=l.unproject(v)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:_,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function l8(i){const{pickInfo:t,lastPickedInfo:e,mode:r,layers:n}=i,{pickedColor:o,pickedLayer:c,pickedObjectIndex:l}=t,_=c?[c]:[];if(r==="hover"){const T=e.index,P=e.layerId,I=c?c.props.id:null;if(I!==P||l!==T){if(I!==P){const z=n.find(N=>N.props.id===P);z&&_.unshift(z)}e.layerId=I,e.index=l,e.info=null}}const v=oA(i),S=new Map;return S.set(null,v),_.forEach(T=>{let P={...v};T===c&&(P.color=o,P.index=l,P.picked=!0),P=aA({layer:T,info:P,mode:r});const I=P.layer;T===c&&r==="hover"&&(e.info=P),S.set(I.id,P),r==="hover"&&I.updateAutoHighlight(P)}),S}function aA(i){let{layer:t,info:e,mode:r}=i;for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function c8(i,t){for(let e=i.length-1;e>=0;e--){const r=i[e];if(r.containsPixel(t))return r}return i[0]}class h8{constructor(t){G(this,"gl",void 0),G(this,"pickingFBO",void 0),G(this,"depthFBO",void 0),G(this,"pickLayersPass",void 0),G(this,"layerFilter",void 0),G(this,"lastPickedInfo",void 0),G(this,"_pickable",!0),this.gl=t,this.pickLayersPass=new rA(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject(t){let{x:e,y:r,layers:n,viewports:o}=t,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const l=c&&c.layer&&c.layer.id,_=c&&c.viewport&&c.viewport.id,v=l?n.find(P=>P.id===l):null,S=_&&o.find(P=>P.id===_)||o[0],T=S&&S.unproject([e-S.x,r-S.y]);return{...c,x:e,y:r,viewport:S,coordinate:T,layer:v}}_resizeBuffer(){var t,e;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new os(r),os.isSupported(r,{colorBufferFloat:!0}))){const n=new os(r);n.attach({36064:new Sa(r,{format:tr(r)?34836:6408,type:5126})}),this.depthFBO=n}(t=this.pickingFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height}),(e=this.depthFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return e.length?e:null}_pickClosestObject(t){let{layers:e,views:r,viewports:n,x:o,y:c,radius:l=0,depth:_=1,mode:v="query",unproject3D:S,onViewportActive:T,effects:P}=t;const I=this._getPickable(e),z=Hd(this.gl);if(!I)return{result:[],emptyInfo:oA({viewports:n,x:o,y:c,pixelRatio:z})};this._resizeBuffer();const N=t_(this.gl,[o,c],!0),X=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],H=Math.round(l*z),{width:Z,height:ot}=this.pickingFBO,gt=this._getPickingRect({deviceX:X[0],deviceY:X[1],deviceRadius:H,deviceWidth:Z,deviceHeight:ot}),Et={x:o-l,y:c-l,width:l*2+1,height:l*2+1};let Ft;const Mt=[],yt=new Set;for(let Ut=0;Ut<_;Ut++){let zt;if(gt){const pt=this._drawAndSample({layers:I,views:r,viewports:n,onViewportActive:T,deviceRect:gt,cullRect:Et,effects:P,pass:"picking:".concat(v)});zt=o8({...pt,deviceX:X[0],deviceY:X[1],deviceRadius:H,deviceRect:gt})}else zt={pickedColor:null,pickedObjectIndex:-1};let at;if(zt.pickedLayer&&S&&this.depthFBO){const{pickedColors:pt}=this._drawAndSample({layers:[zt.pickedLayer],views:r,viewports:n,onViewportActive:T,deviceRect:{x:zt.pickedX,y:zt.pickedY,width:1,height:1},cullRect:Et,effects:P,pass:"picking:".concat(v,":z")},!0);pt[3]&&(at=pt[0])}zt.pickedLayer&&Ut+1<_&&(yt.add(zt.pickedLayer),zt.pickedLayer.disablePickingIndex(zt.pickedObjectIndex)),Ft=l8({pickInfo:zt,lastPickedInfo:this.lastPickedInfo,mode:v,layers:I,viewports:n,x:o,y:c,z:at,pixelRatio:z});for(const pt of Ft.values())pt.layer&&Mt.push(pt);if(!zt.pickedColor)break}for(const Ut of yt)Ut.restorePickingColors();return{result:Mt,emptyInfo:Ft.get(null)}}_pickVisibleObjects(t){let{layers:e,views:r,viewports:n,x:o,y:c,width:l=1,height:_=1,mode:v="query",maxObjects:S=null,onViewportActive:T,effects:P}=t;const I=this._getPickable(e);if(!I)return[];this._resizeBuffer();const z=Hd(this.gl),N=t_(this.gl,[o,c],!0),X=N.x,H=N.y+N.height,Z=t_(this.gl,[o+l,c+_],!0),ot=Z.x+Z.width,gt=Z.y,Et={x:X,y:gt,width:ot-X,height:H-gt},Ft=this._drawAndSample({layers:I,views:r,viewports:n,onViewportActive:T,deviceRect:Et,cullRect:{x:o,y:c,width:l,height:_},effects:P,pass:"picking:".concat(v)}),Mt=a8(Ft),yt=new Map,Ut=Number.isFinite(S);for(let at=0;at<Mt.length;at++){var zt;if(Ut&&S&&yt.size>=S)break;const pt=Mt[at];let Lt={color:pt.pickedColor,layer:null,index:pt.pickedObjectIndex,picked:!0,x:o,y:c,pixelRatio:z};Lt=aA({layer:pt.pickedLayer,info:Lt,mode:v});const bt=(zt=Lt.object)!==null&&zt!==void 0?zt:"".concat(Lt.layer.id,"[").concat(Lt.index,"]");yt.has(bt)||yt.set(bt,Lt)}return Array.from(yt.values())}_drawAndSample(t){let{layers:e,views:r,viewports:n,onViewportActive:o,deviceRect:c,cullRect:l,effects:_,pass:v}=t,S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const T=S?this.depthFBO:this.pickingFBO,P={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:T,deviceRect:c,cullRect:l,effects:_,pass:v,pickZ:S,preRenderStats:{}};for(const ot of _)ot.useInPicking&&(P.preRenderStats[ot.id]=ot.preRender(this.gl,P));const{decodePickingColor:I}=this.pickLayersPass.render(P),{x:z,y:N,width:X,height:H}=c,Z=new(S?Float32Array:Uint8Array)(X*H*4);return Ng(T,{sourceX:z,sourceY:N,sourceWidth:X,sourceHeight:H,target:Z}),{pickedColors:Z,decodePickingColor:I}}_getPickingRect(t){let{deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:c}=t;const l=Math.max(0,e-n),_=Math.max(0,r-n),v=Math.min(o,e+n+1)-l,S=Math.min(c,r+n+1)-_;return v<=0||S<=0?null:{x:l,y:_,width:v,height:S}}}const u8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class d8{constructor(t){G(this,"el",null),G(this,"isVisible",!1);const e=t.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,u8),e.appendChild(this.el))}setTooltip(t,e,r){const n=this.el;if(n){if(typeof t=="string")n.innerText=t;else if(t)t.text&&(n.innerText=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(e,"px, ").concat(r,"px)"),t&&typeof t=="object"&&"style"in t&&Object.assign(n.style,t.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var lA={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(t,e,r,n){var o=["","webkit","Moz","MS","ms","o"],c=e.createElement("div"),l="function",_=Math.round,v=Math.abs,S=Date.now;function T(rt,mt,Dt){return setTimeout(ot(rt,Dt),mt)}function P(rt,mt,Dt){return Array.isArray(rt)?(I(rt,Dt[mt],Dt),!0):!1}function I(rt,mt,Dt){var ne;if(rt)if(rt.forEach)rt.forEach(mt,Dt);else if(rt.length!==n)for(ne=0;ne<rt.length;)mt.call(Dt,rt[ne],ne,rt),ne++;else for(ne in rt)rt.hasOwnProperty(ne)&&mt.call(Dt,rt[ne],ne,rt)}function z(rt,mt,Dt){var ne="DEPRECATED METHOD: "+mt+`
`+Dt+` AT 
`;return function(){var Se=new Error("get-stack-trace"),oi=Se&&Se.stack?Se.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Pi=t.console&&(t.console.warn||t.console.log);return Pi&&Pi.call(t.console,ne,oi),rt.apply(this,arguments)}}var N;typeof Object.assign!="function"?N=function(rt){if(rt===n||rt===null)throw new TypeError("Cannot convert undefined or null to object");for(var mt=Object(rt),Dt=1;Dt<arguments.length;Dt++){var ne=arguments[Dt];if(ne!==n&&ne!==null)for(var Se in ne)ne.hasOwnProperty(Se)&&(mt[Se]=ne[Se])}return mt}:N=Object.assign;var X=z(function(rt,mt,Dt){for(var ne=Object.keys(mt),Se=0;Se<ne.length;)(!Dt||Dt&&rt[ne[Se]]===n)&&(rt[ne[Se]]=mt[ne[Se]]),Se++;return rt},"extend","Use `assign`."),H=z(function(rt,mt){return X(rt,mt,!0)},"merge","Use `assign`.");function Z(rt,mt,Dt){var ne=mt.prototype,Se;Se=rt.prototype=Object.create(ne),Se.constructor=rt,Se._super=ne,Dt&&N(Se,Dt)}function ot(rt,mt){return function(){return rt.apply(mt,arguments)}}function gt(rt,mt){return typeof rt==l?rt.apply(mt&&mt[0]||n,mt):rt}function Et(rt,mt){return rt===n?mt:rt}function Ft(rt,mt,Dt){I(zt(mt),function(ne){rt.addEventListener(ne,Dt,!1)})}function Mt(rt,mt,Dt){I(zt(mt),function(ne){rt.removeEventListener(ne,Dt,!1)})}function yt(rt,mt){for(;rt;){if(rt==mt)return!0;rt=rt.parentNode}return!1}function Ut(rt,mt){return rt.indexOf(mt)>-1}function zt(rt){return rt.trim().split(/\s+/g)}function at(rt,mt,Dt){if(rt.indexOf&&!Dt)return rt.indexOf(mt);for(var ne=0;ne<rt.length;){if(Dt&&rt[ne][Dt]==mt||!Dt&&rt[ne]===mt)return ne;ne++}return-1}function pt(rt){return Array.prototype.slice.call(rt,0)}function Lt(rt,mt,Dt){for(var ne=[],Se=[],oi=0;oi<rt.length;){var Pi=rt[oi][mt];at(Se,Pi)<0&&ne.push(rt[oi]),Se[oi]=Pi,oi++}return ne=ne.sort(function(cr,fn){return cr[mt]>fn[mt]}),ne}function bt(rt,mt){for(var Dt,ne,Se=mt[0].toUpperCase()+mt.slice(1),oi=0;oi<o.length;){if(Dt=o[oi],ne=Dt?Dt+Se:mt,ne in rt)return ne;oi++}return n}var ee=1;function ie(){return ee++}function re(rt){var mt=rt.ownerDocument||rt;return mt.defaultView||mt.parentWindow||t}var Yt=/mobile|tablet|ip(ad|hone|od)|android/i,ce="ontouchstart"in t,le=bt(t,"PointerEvent")!==n,Be=ce&&Yt.test(navigator.userAgent),nt="touch",St="pen",Tt="mouse",jt="kinect",qt=25,Ht=1,Jt=2,$t=4,Ae=8,Le=1,Fe=2,Ne=4,si=8,oe=16,it=Fe|Ne,pi=si|oe,Ke=it|pi,de=["x","y"],Ee=["clientX","clientY"];function Me(rt,mt){var Dt=this;this.manager=rt,this.callback=mt,this.element=rt.element,this.target=rt.options.inputTarget,this.domHandler=function(ne){gt(rt.options.enable,[rt])&&Dt.handler(ne)},this.init()}Me.prototype={handler:function(){},init:function(){this.evEl&&Ft(this.element,this.evEl,this.domHandler),this.evTarget&&Ft(this.target,this.evTarget,this.domHandler),this.evWin&&Ft(re(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Mt(this.element,this.evEl,this.domHandler),this.evTarget&&Mt(this.target,this.evTarget,this.domHandler),this.evWin&&Mt(re(this.element),this.evWin,this.domHandler)}};function De(rt){var mt,Dt=rt.options.inputClass;return Dt?mt=Dt:le?mt=xt:Be?mt=Ct:ce?mt=be:mt=ze,new mt(rt,ei)}function ei(rt,mt,Dt){var ne=Dt.pointers.length,Se=Dt.changedPointers.length,oi=mt&Ht&&ne-Se===0,Pi=mt&($t|Ae)&&ne-Se===0;Dt.isFirst=!!oi,Dt.isFinal=!!Pi,oi&&(rt.session={}),Dt.eventType=mt,Si(rt,Dt),rt.emit("hammer.input",Dt),rt.recognize(Dt),rt.session.prevInput=Dt}function Si(rt,mt){var Dt=rt.session,ne=mt.pointers,Se=ne.length;Dt.firstInput||(Dt.firstInput=zi(mt)),Se>1&&!Dt.firstMultiple?Dt.firstMultiple=zi(mt):Se===1&&(Dt.firstMultiple=!1);var oi=Dt.firstInput,Pi=Dt.firstMultiple,cr=Pi?Pi.center:oi.center,fn=mt.center=me(ne);mt.timeStamp=S(),mt.deltaTime=mt.timeStamp-oi.timeStamp,mt.angle=_r(cr,fn),mt.distance=ke(cr,fn),vi(Dt,mt),mt.offsetDirection=bi(mt.deltaX,mt.deltaY);var vn=ci(mt.deltaTime,mt.deltaX,mt.deltaY);mt.overallVelocityX=vn.x,mt.overallVelocityY=vn.y,mt.overallVelocity=v(vn.x)>v(vn.y)?vn.x:vn.y,mt.scale=Pi?yi(Pi.pointers,ne):1,mt.rotation=Pi?ge(Pi.pointers,ne):0,mt.maxPointers=Dt.prevInput?mt.pointers.length>Dt.prevInput.maxPointers?mt.pointers.length:Dt.prevInput.maxPointers:mt.pointers.length,Ri(Dt,mt);var er=rt.element;yt(mt.srcEvent.target,er)&&(er=mt.srcEvent.target),mt.target=er}function vi(rt,mt){var Dt=mt.center,ne=rt.offsetDelta||{},Se=rt.prevDelta||{},oi=rt.prevInput||{};(mt.eventType===Ht||oi.eventType===$t)&&(Se=rt.prevDelta={x:oi.deltaX||0,y:oi.deltaY||0},ne=rt.offsetDelta={x:Dt.x,y:Dt.y}),mt.deltaX=Se.x+(Dt.x-ne.x),mt.deltaY=Se.y+(Dt.y-ne.y)}function Ri(rt,mt){var Dt=rt.lastInterval||mt,ne=mt.timeStamp-Dt.timeStamp,Se,oi,Pi,cr;if(mt.eventType!=Ae&&(ne>qt||Dt.velocity===n)){var fn=mt.deltaX-Dt.deltaX,vn=mt.deltaY-Dt.deltaY,er=ci(ne,fn,vn);oi=er.x,Pi=er.y,Se=v(er.x)>v(er.y)?er.x:er.y,cr=bi(fn,vn),rt.lastInterval=mt}else Se=Dt.velocity,oi=Dt.velocityX,Pi=Dt.velocityY,cr=Dt.direction;mt.velocity=Se,mt.velocityX=oi,mt.velocityY=Pi,mt.direction=cr}function zi(rt){for(var mt=[],Dt=0;Dt<rt.pointers.length;)mt[Dt]={clientX:_(rt.pointers[Dt].clientX),clientY:_(rt.pointers[Dt].clientY)},Dt++;return{timeStamp:S(),pointers:mt,center:me(mt),deltaX:rt.deltaX,deltaY:rt.deltaY}}function me(rt){var mt=rt.length;if(mt===1)return{x:_(rt[0].clientX),y:_(rt[0].clientY)};for(var Dt=0,ne=0,Se=0;Se<mt;)Dt+=rt[Se].clientX,ne+=rt[Se].clientY,Se++;return{x:_(Dt/mt),y:_(ne/mt)}}function ci(rt,mt,Dt){return{x:mt/rt||0,y:Dt/rt||0}}function bi(rt,mt){return rt===mt?Le:v(rt)>=v(mt)?rt<0?Fe:Ne:mt<0?si:oe}function ke(rt,mt,Dt){Dt||(Dt=de);var ne=mt[Dt[0]]-rt[Dt[0]],Se=mt[Dt[1]]-rt[Dt[1]];return Math.sqrt(ne*ne+Se*Se)}function _r(rt,mt,Dt){Dt||(Dt=de);var ne=mt[Dt[0]]-rt[Dt[0]],Se=mt[Dt[1]]-rt[Dt[1]];return Math.atan2(Se,ne)*180/Math.PI}function ge(rt,mt){return _r(mt[1],mt[0],Ee)+_r(rt[1],rt[0],Ee)}function yi(rt,mt){return ke(mt[0],mt[1],Ee)/ke(rt[0],rt[1],Ee)}var Ue={mousedown:Ht,mousemove:Jt,mouseup:$t},Vi="mousedown",Zr="mousemove mouseup";function ze(){this.evEl=Vi,this.evWin=Zr,this.pressed=!1,Me.apply(this,arguments)}Z(ze,Me,{handler:function(rt){var mt=Ue[rt.type];mt&Ht&&rt.button===0&&(this.pressed=!0),mt&Jt&&rt.which!==1&&(mt=$t),this.pressed&&(mt&$t&&(this.pressed=!1),this.callback(this.manager,mt,{pointers:[rt],changedPointers:[rt],pointerType:Tt,srcEvent:rt}))}});var _n={pointerdown:Ht,pointermove:Jt,pointerup:$t,pointercancel:Ae,pointerout:Ae},ir={2:nt,3:St,4:Tt,5:jt},Qr="pointerdown",tn="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Qr="MSPointerDown",tn="MSPointerMove MSPointerUp MSPointerCancel");function xt(){this.evEl=Qr,this.evWin=tn,Me.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Z(xt,Me,{handler:function(rt){var mt=this.store,Dt=!1,ne=rt.type.toLowerCase().replace("ms",""),Se=_n[ne],oi=ir[rt.pointerType]||rt.pointerType,Pi=oi==nt,cr=at(mt,rt.pointerId,"pointerId");Se&Ht&&(rt.button===0||Pi)?cr<0&&(mt.push(rt),cr=mt.length-1):Se&($t|Ae)&&(Dt=!0),!(cr<0)&&(mt[cr]=rt,this.callback(this.manager,Se,{pointers:mt,changedPointers:[rt],pointerType:oi,srcEvent:rt}),Dt&&mt.splice(cr,1))}});var Y={touchstart:Ht,touchmove:Jt,touchend:$t,touchcancel:Ae},K="touchstart",ct="touchstart touchmove touchend touchcancel";function _t(){this.evTarget=K,this.evWin=ct,this.started=!1,Me.apply(this,arguments)}Z(_t,Me,{handler:function(rt){var mt=Y[rt.type];if(mt===Ht&&(this.started=!0),!!this.started){var Dt=kt.call(this,rt,mt);mt&($t|Ae)&&Dt[0].length-Dt[1].length===0&&(this.started=!1),this.callback(this.manager,mt,{pointers:Dt[0],changedPointers:Dt[1],pointerType:nt,srcEvent:rt})}}});function kt(rt,mt){var Dt=pt(rt.touches),ne=pt(rt.changedTouches);return mt&($t|Ae)&&(Dt=Lt(Dt.concat(ne),"identifier")),[Dt,ne]}var Gt={touchstart:Ht,touchmove:Jt,touchend:$t,touchcancel:Ae},Rt="touchstart touchmove touchend touchcancel";function Ct(){this.evTarget=Rt,this.targetIds={},Me.apply(this,arguments)}Z(Ct,Me,{handler:function(rt){var mt=Gt[rt.type],Dt=te.call(this,rt,mt);Dt&&this.callback(this.manager,mt,{pointers:Dt[0],changedPointers:Dt[1],pointerType:nt,srcEvent:rt})}});function te(rt,mt){var Dt=pt(rt.touches),ne=this.targetIds;if(mt&(Ht|Jt)&&Dt.length===1)return ne[Dt[0].identifier]=!0,[Dt,Dt];var Se,oi,Pi=pt(rt.changedTouches),cr=[],fn=this.target;if(oi=Dt.filter(function(vn){return yt(vn.target,fn)}),mt===Ht)for(Se=0;Se<oi.length;)ne[oi[Se].identifier]=!0,Se++;for(Se=0;Se<Pi.length;)ne[Pi[Se].identifier]&&cr.push(Pi[Se]),mt&($t|Ae)&&delete ne[Pi[Se].identifier],Se++;if(cr.length)return[Lt(oi.concat(cr),"identifier"),cr]}var he=2500,Wt=25;function be(){Me.apply(this,arguments);var rt=ot(this.handler,this);this.touch=new Ct(this.manager,rt),this.mouse=new ze(this.manager,rt),this.primaryTouch=null,this.lastTouches=[]}Z(be,Me,{handler:function(rt,mt,Dt){var ne=Dt.pointerType==nt,Se=Dt.pointerType==Tt;if(!(Se&&Dt.sourceCapabilities&&Dt.sourceCapabilities.firesTouchEvents)){if(ne)We.call(this,mt,Dt);else if(Se&&Li.call(this,Dt))return;this.callback(rt,mt,Dt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function We(rt,mt){rt&Ht?(this.primaryTouch=mt.changedPointers[0].identifier,Je.call(this,mt)):rt&($t|Ae)&&Je.call(this,mt)}function Je(rt){var mt=rt.changedPointers[0];if(mt.identifier===this.primaryTouch){var Dt={x:mt.clientX,y:mt.clientY};this.lastTouches.push(Dt);var ne=this.lastTouches,Se=function(){var oi=ne.indexOf(Dt);oi>-1&&ne.splice(oi,1)};setTimeout(Se,he)}}function Li(rt){for(var mt=rt.srcEvent.clientX,Dt=rt.srcEvent.clientY,ne=0;ne<this.lastTouches.length;ne++){var Se=this.lastTouches[ne],oi=Math.abs(mt-Se.x),Pi=Math.abs(Dt-Se.y);if(oi<=Wt&&Pi<=Wt)return!0}return!1}var Qe=bt(c.style,"touchAction"),Ci=Qe!==n,xi="compute",rr="auto",Hi="manipulation",hi="none",Fi="pan-x",Qi="pan-y",pr=so();function Ar(rt,mt){this.manager=rt,this.set(mt)}Ar.prototype={set:function(rt){rt==xi&&(rt=this.compute()),Ci&&this.manager.element.style&&pr[rt]&&(this.manager.element.style[Qe]=rt),this.actions=rt.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var rt=[];return I(this.manager.recognizers,function(mt){gt(mt.options.enable,[mt])&&(rt=rt.concat(mt.getTouchAction()))}),$r(rt.join(" "))},preventDefaults:function(rt){var mt=rt.srcEvent,Dt=rt.offsetDirection;if(this.manager.session.prevented){mt.preventDefault();return}var ne=this.actions,Se=Ut(ne,hi)&&!pr[hi],oi=Ut(ne,Qi)&&!pr[Qi],Pi=Ut(ne,Fi)&&!pr[Fi];if(Se){var cr=rt.pointers.length===1,fn=rt.distance<2,vn=rt.deltaTime<250;if(cr&&fn&&vn)return}if(!(Pi&&oi)&&(Se||oi&&Dt&it||Pi&&Dt&pi))return this.preventSrc(mt)},preventSrc:function(rt){this.manager.session.prevented=!0,rt.preventDefault()}};function $r(rt){if(Ut(rt,hi))return hi;var mt=Ut(rt,Fi),Dt=Ut(rt,Qi);return mt&&Dt?hi:mt||Dt?mt?Fi:Qi:Ut(rt,Hi)?Hi:rr}function so(){if(!Ci)return!1;var rt={},mt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Dt){rt[Dt]=mt?t.CSS.supports("touch-action",Dt):!0}),rt}var $i=1,yn=2,Xn=4,Ir=8,Lr=Ir,oo=16,Mr=32;function Er(rt){this.options=N({},this.defaults,rt||{}),this.id=ie(),this.manager=null,this.options.enable=Et(this.options.enable,!0),this.state=$i,this.simultaneous={},this.requireFail=[]}Er.prototype={defaults:{},set:function(rt){return N(this.options,rt),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(rt){if(P(rt,"recognizeWith",this))return this;var mt=this.simultaneous;return rt=yr(rt,this),mt[rt.id]||(mt[rt.id]=rt,rt.recognizeWith(this)),this},dropRecognizeWith:function(rt){return P(rt,"dropRecognizeWith",this)?this:(rt=yr(rt,this),delete this.simultaneous[rt.id],this)},requireFailure:function(rt){if(P(rt,"requireFailure",this))return this;var mt=this.requireFail;return rt=yr(rt,this),at(mt,rt)===-1&&(mt.push(rt),rt.requireFailure(this)),this},dropRequireFailure:function(rt){if(P(rt,"dropRequireFailure",this))return this;rt=yr(rt,this);var mt=at(this.requireFail,rt);return mt>-1&&this.requireFail.splice(mt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(rt){return!!this.simultaneous[rt.id]},emit:function(rt){var mt=this,Dt=this.state;function ne(Se){mt.manager.emit(Se,rt)}Dt<Ir&&ne(mt.options.event+ao(Dt)),ne(mt.options.event),rt.additionalEvent&&ne(rt.additionalEvent),Dt>=Ir&&ne(mt.options.event+ao(Dt))},tryEmit:function(rt){if(this.canEmit())return this.emit(rt);this.state=Mr},canEmit:function(){for(var rt=0;rt<this.requireFail.length;){if(!(this.requireFail[rt].state&(Mr|$i)))return!1;rt++}return!0},recognize:function(rt){var mt=N({},rt);if(!gt(this.options.enable,[this,mt])){this.reset(),this.state=Mr;return}this.state&(Lr|oo|Mr)&&(this.state=$i),this.state=this.process(mt),this.state&(yn|Xn|Ir|oo)&&this.tryEmit(mt)},process:function(rt){},getTouchAction:function(){},reset:function(){}};function ao(rt){return rt&oo?"cancel":rt&Ir?"end":rt&Xn?"move":rt&yn?"start":""}function Zn(rt){return rt==oe?"down":rt==si?"up":rt==Fe?"left":rt==Ne?"right":""}function yr(rt,mt){var Dt=mt.manager;return Dt?Dt.get(rt):rt}function Yi(){Er.apply(this,arguments)}Z(Yi,Er,{defaults:{pointers:1},attrTest:function(rt){var mt=this.options.pointers;return mt===0||rt.pointers.length===mt},process:function(rt){var mt=this.state,Dt=rt.eventType,ne=mt&(yn|Xn),Se=this.attrTest(rt);return ne&&(Dt&Ae||!Se)?mt|oo:ne||Se?Dt&$t?mt|Ir:mt&yn?mt|Xn:yn:Mr}});function un(){Yi.apply(this,arguments),this.pX=null,this.pY=null}Z(un,Yi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ke},getTouchAction:function(){var rt=this.options.direction,mt=[];return rt&it&&mt.push(Qi),rt&pi&&mt.push(Fi),mt},directionTest:function(rt){var mt=this.options,Dt=!0,ne=rt.distance,Se=rt.direction,oi=rt.deltaX,Pi=rt.deltaY;return Se&mt.direction||(mt.direction&it?(Se=oi===0?Le:oi<0?Fe:Ne,Dt=oi!=this.pX,ne=Math.abs(rt.deltaX)):(Se=Pi===0?Le:Pi<0?si:oe,Dt=Pi!=this.pY,ne=Math.abs(rt.deltaY))),rt.direction=Se,Dt&&ne>mt.threshold&&Se&mt.direction},attrTest:function(rt){return Yi.prototype.attrTest.call(this,rt)&&(this.state&yn||!(this.state&yn)&&this.directionTest(rt))},emit:function(rt){this.pX=rt.deltaX,this.pY=rt.deltaY;var mt=Zn(rt.direction);mt&&(rt.additionalEvent=this.options.event+mt),this._super.emit.call(this,rt)}});function fr(){Yi.apply(this,arguments)}Z(fr,Yi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(rt){return this._super.attrTest.call(this,rt)&&(Math.abs(rt.scale-1)>this.options.threshold||this.state&yn)},emit:function(rt){if(rt.scale!==1){var mt=rt.scale<1?"in":"out";rt.additionalEvent=this.options.event+mt}this._super.emit.call(this,rt)}});function lo(){Er.apply(this,arguments),this._timer=null,this._input=null}Z(lo,Er,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[rr]},process:function(rt){var mt=this.options,Dt=rt.pointers.length===mt.pointers,ne=rt.distance<mt.threshold,Se=rt.deltaTime>mt.time;if(this._input=rt,!ne||!Dt||rt.eventType&($t|Ae)&&!Se)this.reset();else if(rt.eventType&Ht)this.reset(),this._timer=T(function(){this.state=Lr,this.tryEmit()},mt.time,this);else if(rt.eventType&$t)return Lr;return Mr},reset:function(){clearTimeout(this._timer)},emit:function(rt){this.state===Lr&&(rt&&rt.eventType&$t?this.manager.emit(this.options.event+"up",rt):(this._input.timeStamp=S(),this.manager.emit(this.options.event,this._input)))}});function dn(){Yi.apply(this,arguments)}Z(dn,Yi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(rt){return this._super.attrTest.call(this,rt)&&(Math.abs(rt.rotation)>this.options.threshold||this.state&yn)}});function $o(){Yi.apply(this,arguments)}Z($o,Yi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:it|pi,pointers:1},getTouchAction:function(){return un.prototype.getTouchAction.call(this)},attrTest:function(rt){var mt=this.options.direction,Dt;return mt&(it|pi)?Dt=rt.overallVelocity:mt&it?Dt=rt.overallVelocityX:mt&pi&&(Dt=rt.overallVelocityY),this._super.attrTest.call(this,rt)&&mt&rt.offsetDirection&&rt.distance>this.options.threshold&&rt.maxPointers==this.options.pointers&&v(Dt)>this.options.velocity&&rt.eventType&$t},emit:function(rt){var mt=Zn(rt.offsetDirection);mt&&this.manager.emit(this.options.event+mt,rt),this.manager.emit(this.options.event,rt)}});function Tr(){Er.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Z(Tr,Er,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Hi]},process:function(rt){var mt=this.options,Dt=rt.pointers.length===mt.pointers,ne=rt.distance<mt.threshold,Se=rt.deltaTime<mt.time;if(this.reset(),rt.eventType&Ht&&this.count===0)return this.failTimeout();if(ne&&Se&&Dt){if(rt.eventType!=$t)return this.failTimeout();var oi=this.pTime?rt.timeStamp-this.pTime<mt.interval:!0,Pi=!this.pCenter||ke(this.pCenter,rt.center)<mt.posThreshold;this.pTime=rt.timeStamp,this.pCenter=rt.center,!Pi||!oi?this.count=1:this.count+=1,this._input=rt;var cr=this.count%mt.taps;if(cr===0)return this.hasRequireFailures()?(this._timer=T(function(){this.state=Lr,this.tryEmit()},mt.interval,this),yn):Lr}return Mr},failTimeout:function(){return this._timer=T(function(){this.state=Mr},this.options.interval,this),Mr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Lr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function $n(rt,mt){return mt=mt||{},mt.recognizers=Et(mt.recognizers,$n.defaults.preset),new Yn(rt,mt)}$n.VERSION="2.0.7",$n.defaults={domEvents:!1,touchAction:xi,enable:!0,inputTarget:null,inputClass:null,preset:[[dn,{enable:!1}],[fr,{enable:!1},["rotate"]],[$o,{direction:it}],[un,{direction:it},["swipe"]],[Tr],[Tr,{event:"doubletap",taps:2},["tap"]],[lo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var pn=1,as=2;function Yn(rt,mt){this.options=N({},$n.defaults,mt||{}),this.options.inputTarget=this.options.inputTarget||rt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=rt,this.input=De(this),this.touchAction=new Ar(this,this.options.touchAction),Wi(this,!0),I(this.options.recognizers,function(Dt){var ne=this.add(new Dt[0](Dt[1]));Dt[2]&&ne.recognizeWith(Dt[2]),Dt[3]&&ne.requireFailure(Dt[3])},this)}Yn.prototype={set:function(rt){return N(this.options,rt),rt.touchAction&&this.touchAction.update(),rt.inputTarget&&(this.input.destroy(),this.input.target=rt.inputTarget,this.input.init()),this},stop:function(rt){this.session.stopped=rt?as:pn},recognize:function(rt){var mt=this.session;if(!mt.stopped){this.touchAction.preventDefaults(rt);var Dt,ne=this.recognizers,Se=mt.curRecognizer;(!Se||Se&&Se.state&Lr)&&(Se=mt.curRecognizer=null);for(var oi=0;oi<ne.length;)Dt=ne[oi],mt.stopped!==as&&(!Se||Dt==Se||Dt.canRecognizeWith(Se))?Dt.recognize(rt):Dt.reset(),!Se&&Dt.state&(yn|Xn|Ir)&&(Se=mt.curRecognizer=Dt),oi++}},get:function(rt){if(rt instanceof Er)return rt;for(var mt=this.recognizers,Dt=0;Dt<mt.length;Dt++)if(mt[Dt].options.event==rt)return mt[Dt];return null},add:function(rt){if(P(rt,"add",this))return this;var mt=this.get(rt.options.event);return mt&&this.remove(mt),this.recognizers.push(rt),rt.manager=this,this.touchAction.update(),rt},remove:function(rt){if(P(rt,"remove",this))return this;if(rt=this.get(rt),rt){var mt=this.recognizers,Dt=at(mt,rt);Dt!==-1&&(mt.splice(Dt,1),this.touchAction.update())}return this},on:function(rt,mt){if(rt!==n&&mt!==n){var Dt=this.handlers;return I(zt(rt),function(ne){Dt[ne]=Dt[ne]||[],Dt[ne].push(mt)}),this}},off:function(rt,mt){if(rt!==n){var Dt=this.handlers;return I(zt(rt),function(ne){mt?Dt[ne]&&Dt[ne].splice(at(Dt[ne],mt),1):delete Dt[ne]}),this}},emit:function(rt,mt){this.options.domEvents&&Aa(rt,mt);var Dt=this.handlers[rt]&&this.handlers[rt].slice();if(!(!Dt||!Dt.length)){mt.type=rt,mt.preventDefault=function(){mt.srcEvent.preventDefault()};for(var ne=0;ne<Dt.length;)Dt[ne](mt),ne++}},destroy:function(){this.element&&Wi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Wi(rt,mt){var Dt=rt.element;if(Dt.style){var ne;I(rt.options.cssProps,function(Se,oi){ne=bt(Dt.style,oi),mt?(rt.oldCssProps[ne]=Dt.style[ne],Dt.style[ne]=Se):Dt.style[ne]=rt.oldCssProps[ne]||""}),mt||(rt.oldCssProps={})}}function Aa(rt,mt){var Dt=e.createEvent("Event");Dt.initEvent(rt,!0,!0),Dt.gesture=mt,mt.target.dispatchEvent(Dt)}N($n,{INPUT_START:Ht,INPUT_MOVE:Jt,INPUT_END:$t,INPUT_CANCEL:Ae,STATE_POSSIBLE:$i,STATE_BEGAN:yn,STATE_CHANGED:Xn,STATE_ENDED:Ir,STATE_RECOGNIZED:Lr,STATE_CANCELLED:oo,STATE_FAILED:Mr,DIRECTION_NONE:Le,DIRECTION_LEFT:Fe,DIRECTION_RIGHT:Ne,DIRECTION_UP:si,DIRECTION_DOWN:oe,DIRECTION_HORIZONTAL:it,DIRECTION_VERTICAL:pi,DIRECTION_ALL:Ke,Manager:Yn,Input:Me,TouchAction:Ar,TouchInput:Ct,MouseInput:ze,PointerEventInput:xt,TouchMouseInput:be,SingleTouchInput:_t,Recognizer:Er,AttrRecognizer:Yi,Tap:Tr,Pan:un,Swipe:$o,Pinch:fr,Rotate:dn,Press:lo,on:Ft,off:Mt,each:I,merge:H,extend:X,assign:N,inherit:Z,bindFn:ot,prefixed:bt});var Ja=typeof t<"u"?t:typeof self<"u"?self:{};Ja.Hammer=$n,i.exports?i.exports=$n:t[r]=$n})(window,document,"Hammer")})(lA);var zf=lA.exports;const p8=Mg(zf),hc=fP({__proto__:null,default:p8},[zf]),cA=1,hA=2,Iy=4,f8={mousedown:cA,mousemove:hA,mouseup:Iy};function m8(i,t){for(let e=0;e<i.length;e++)if(t(i[e]))return!0;return!1}function g8(i){const t=i.prototype.handler;i.prototype.handler=function(e){const r=this.store;e.button>0&&e.type==="pointerdown"&&(m8(r,n=>n.pointerId===e.pointerId)||r.push(e)),t.call(this,e)}}function _8(i){i.prototype.handler=function(t){let e=f8[t.type];e&cA&&t.button>=0&&(this.pressed=!0),e&hA&&t.which===0&&(e=Iy),this.pressed&&(e&Iy&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}g8(zf.PointerEventInput);_8(zf.MouseInput);const y8=zf.Manager;class jg{constructor(t,e,r){this.element=t,this.callback=e,this.options={enable:!0,...r}}}const v8=hc?[[hc.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[hc.Rotate,{enable:!1}],[hc.Pinch,{enable:!1}],[hc.Swipe,{enable:!1}],[hc.Pan,{threshold:0,enable:!1}],[hc.Press,{enable:!1}],[hc.Tap,{event:"doubletap",taps:2,enable:!1}],[hc.Tap,{event:"anytap",enable:!1}],[hc.Tap,{enable:!1}]]:null,tw={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},b8={doubletap:["tap"]},x8={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},sv={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},w8={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ew={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},S8=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ld=typeof window<"u"?window:global;let Ly=!1;try{const i={get passive(){return Ly=!0,!0}};Ld.addEventListener("test",null,i),Ld.removeEventListener("test",null)}catch{Ly=!1}const A8=S8.indexOf("firefox")!==-1,{WHEEL_EVENTS:E8}=sv,iw="wheel",rw=4.000244140625,T8=40,C8=.25;class P8 extends jg{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;Ld.WheelEvent&&(A8&&n.deltaMode===Ld.WheelEvent.DOM_DELTA_PIXEL&&(o/=Ld.devicePixelRatio),n.deltaMode===Ld.WheelEvent.DOM_DELTA_LINE&&(o*=T8)),o!==0&&o%rw===0&&(o=Math.floor(o/rw)),n.shiftKey&&o&&(o=o*C8),this.callback({type:iw,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(E8),this.events.forEach(n=>t.addEventListener(n,this.handleEvent,Ly?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===iw&&(this.options.enable=e)}}const{MOUSE_EVENTS:I8}=sv,nw="pointermove",sw="pointerover",ow="pointerout",aw="pointerenter",lw="pointerleave";class L8 extends jg{constructor(t,e,r){super(t,e,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(I8),this.events.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===nw&&(this.enableMoveEvent=e),t===sw&&(this.enableOverEvent=e),t===ow&&(this.enableOutEvent=e),t===aw&&(this.enableEnterEvent=e),t===lw&&(this.enableLeaveEvent=e)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(sw,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(ow,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(aw,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(lw,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(nw,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const{KEY_EVENTS:M8}=sv,cw="keydown",hw="keyup";class B8 extends jg{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:cw,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:hw,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(M8),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(n=>t.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t===cw&&(this.enableDownEvent=e),t===hw&&(this.enableUpEvent=e)}}const uw="contextmenu";class R8 extends jg{constructor(t,e,r){super(t,e,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:uw,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t===uw&&(this.options.enable=e)}}const My=1,wg=2,By=4,k8={pointerdown:My,pointermove:wg,pointerup:By,mousedown:My,mousemove:wg,mouseup:By},F8=1,D8=2,O8=3,N8=0,z8=1,j8=2,U8=1,G8=2,V8=4;function q8(i){const t=k8[i.srcEvent.type];if(!t)return null;const{buttons:e,button:r,which:n}=i.srcEvent;let o=!1,c=!1,l=!1;return t===By||t===wg&&!Number.isFinite(e)?(o=n===F8,c=n===D8,l=n===O8):t===wg?(o=!!(e&U8),c=!!(e&V8),l=!!(e&G8)):t===My&&(o=r===N8,c=r===z8,l=r===j8),{leftButton:o,middleButton:c,rightButton:l}}function H8(i,t){const e=i.center;if(!e)return null;const r=t.getBoundingClientRect(),n=r.width/t.offsetWidth||1,o=r.height/t.offsetHeight||1,c={x:(e.x-r.left-t.clientLeft)/n,y:(e.y-r.top-t.clientTop)/o};return{center:e,offsetCenter:c}}const __={srcElement:"root",priority:0};class W8{constructor(t){this.handleEvent=e=>{if(this.isEmpty())return;const r=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:c,handlersByElement:l}=this;let _=__;typeof r=="string"||r&&r.addEventListener?_={...__,srcElement:r}:r&&(_={...__,...r});let v=l.get(_.srcElement);v||(v=[],l.set(_.srcElement,v));const S={type:t,handler:e,srcElement:_.srcElement,priority:_.priority};n&&(S.once=!0),o&&(S.passive=!0),c.push(S),this._active=this._active||!S.passive;let T=v.length-1;for(;T>=0&&!(v[T].priority>=S.priority);)T--;v.splice(T+1,0,S)}remove(t,e){const{handlers:r,handlersByElement:n}=this;for(let o=r.length-1;o>=0;o--){const c=r[o];if(c.type===t&&c.handler===e){r.splice(o,1);const l=n.get(c.srcElement);l.splice(l.indexOf(c),1),l.length===0&&n.delete(c.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(t,e){const r=this.handlersByElement.get(e);if(r){let n=!1;const o=()=>{t.handled=!0},c=()=>{t.handled=!0,n=!0},l=[];for(let _=0;_<r.length;_++){const{type:v,handler:S,once:T}=r[_];if(S({...t,type:v,stopPropagation:o,stopImmediatePropagation:c}),T&&l.push(r[_]),n)break}for(let _=0;_<l.length;_++){const{type:v,handler:S}=l[_];this.remove(v,S)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...q8(t),...H8(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}const X8={events:null,recognizers:null,recognizerOptions:{},Manager:y8,touchAction:"none",tabIndex:0};class Z8{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,c=x8[o.type];c&&this.manager.emit(c,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...X8,...e},this.events=new Map,this.setElement(t);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:e}=this,r=e.Manager;this.manager=new r(t,{touchAction:e.touchAction,recognizers:e.recognizers||v8}).on("hammer.input",this._onBasicInput),e.recognizers||Object.keys(tw).forEach(n=>{const o=this.manager.get(n);o&&tw[n].forEach(c=>{o.recognizeWith(c)})});for(const n in e.recognizerOptions){const o=this.manager.get(n);if(o){const c=e.recognizerOptions[n];delete c.enable,o.set(c)}}this.wheelInput=new P8(t,this._onOtherEvent,{enable:!1}),this.moveInput=new L8(t,this._onOtherEvent,{enable:!1}),this.keyInput=new B8(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new R8(t,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,e,r){this._addEventHandler(t,e,r,!1)}once(t,e,r){this._addEventHandler(t,e,r,!0)}watch(t,e,r){this._addEventHandler(t,e,r,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){const{manager:r}=this;if(!r)return;const n=r.get(t);if(n&&n.options.enable!==e){n.set({enable:e});const o=b8[t];o&&!this.options.recognizers&&o.forEach(c=>{const l=r.get(c);e?(l.requireFailure(t),n.dropRequireFailure(c)):l.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}_addEventHandler(t,e,r,n,o){if(typeof t!="string"){r=e;for(const S in t)this._addEventHandler(S,t[S],r,n,o);return}const{manager:c,events:l}=this,_=ew[t]||t;let v=l.get(_);v||(v=new W8(this),l.set(_,v),v.recognizerName=w8[_]||_,c&&c.on(_,v.handleEvent)),v.add(t,e,r,n,o),v.isEmpty()||this._toggleRecognizer(v.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const c in t)this._removeEventHandler(c,t[c]);return}const{events:r}=this,n=ew[t]||t,o=r.get(n);if(o&&(o.remove(t,e),o.isEmpty())){const{recognizerName:c}=o;let l=!1;for(const _ of r.values())if(_.recognizerName===c&&!_.isEmpty()){l=!0;break}l||this._toggleRecognizer(c,!1)}}}function vu(){}const $8=i=>{let{isDragging:t}=i;return t?"grabbing":"grab"},uA={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:vu,onResize:vu,onViewStateChange:vu,onInteractionStateChange:vu,onBeforeRender:vu,onAfterRender:vu,onLoad:vu,onError:i=>hr.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$8,getTooltip:null,debug:!1,drawPickingColors:!1};class ov{constructor(t){G(this,"props",void 0),G(this,"width",0),G(this,"height",0),G(this,"userData",{}),G(this,"canvas",null),G(this,"viewManager",null),G(this,"layerManager",null),G(this,"effectManager",null),G(this,"deckRenderer",null),G(this,"deckPicker",null),G(this,"eventManager",null),G(this,"tooltip",null),G(this,"metrics",void 0),G(this,"animationLoop",void 0),G(this,"stats",void 0),G(this,"viewState",void 0),G(this,"cursorState",void 0),G(this,"_needsRedraw",void 0),G(this,"_pickRequest",void 0),G(this,"_lastPointerDownInfo",null),G(this,"_metricsCounter",void 0),G(this,"_onPointerMove",e=>{const{_pickRequest:r}=this;if(e.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;r.x=n.x,r.y=n.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=e}),G(this,"_onEvent",e=>{const r=W2[e.type],n=e.offsetCenter;if(!r||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:l}=c,_=l&&(l[r.handler]||l.props[r.handler]),v=this.props[r.handler];let S=!1;_&&(S=_.call(l,c,e)),!S&&v&&v(c,e)}),G(this,"_onPointerDown",e=>{const r=e.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...uA,...t},t=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},t.viewState&&t.initialViewState&&hr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),O3()==="IE"&&hr.warn("IE 11 is not supported")(),this.viewState=t.initialViewState,t.gl||typeof document<"u"&&(this.canvas=this._createCanvas(t)),this.animationLoop=this._createAnimationLoop(t),this.stats=new If({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(t),t._typedArrayManagerProps&&bf.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,r,n,o,c,l,_;if((t=this.animationLoop)===null||t===void 0||t.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(c=this.deckPicker)===null||c===void 0||c.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(_=this.tooltip)===null||_===void 0||_.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var v;(v=this.canvas.parentElement)===null||v===void 0||v.removeChild(this.canvas),this.canvas=null}}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&hr.removed("onLayerHover","onHover")(),"onLayerClick"in t&&hr.removed("onLayerClick","onClick")(),t.initialViewState&&!yc(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),o=this.effectManager.needsRedraw(t),c=this.deckRenderer.needsRedraw(t);return e=e||r||n||o||c,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return Rs(this.viewManager),this.viewManager.views}getViewports(t){return Rs(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_pick(t,e,r){Rs(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(e).timeStart();const o=this.deckPicker[t]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(e).timeEnd(),o}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),Rs(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){if(!this.canvas)return;const{width:e,height:r}=t;if(e||e===0){const o=Number.isFinite(e)?"".concat(e,"px"):e;this.canvas.style.width=o}if(r||r===0){var n;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((n=t.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var t,e;const{canvas:r}=this;if(!r)return;const n=(t=r.clientWidth)!==null&&t!==void 0?t:r.width,o=(e=r.clientHeight)!==null&&e!==void 0?e:r.height;if(n!==this.width||o!==this.height){var c,l;this.width=n,this.height=o,(c=this.viewManager)===null||c===void 0||c.setProps({width:n,height:o}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(t){const{width:e,height:r,gl:n,glOptions:o,debug:c,onError:l,onBeforeRender:_,onAfterRender:v,useDevicePixels:S}=t;return new b6({width:e,height:r,useDevicePixels:S,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:T=>iS({...o,...T,canvas:this.canvas,debug:c,onContextLost:()=>this._onContextLost()}),onInitialize:T=>this._setGLContext(T.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:_,onAfterRender:v,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let t=this.props.views||[new nv({id:"default-view"})];return t=Array.isArray(t)?t:[t],t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:t}=this;if(t.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let o=n,c=!1;for(const l of r){var e;o=l,c=((e=l.layer)===null||e===void 0?void 0:e.onHover(l,t.event))||c}if(!c&&this.props.onHover&&this.props.onHover(o,t.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(o);this.tooltip.setTooltip(l,o.x,o.y)}t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(t){if(this.layerManager)return;this.canvas||(this.canvas=t.canvas,R1(t,{enable:!0,copyState:!0})),this.tooltip=new d8(this.canvas),sh(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);const e=new HS;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Z8(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in W2)this.eventManager.on(n,this._onEvent);this.viewManager=new ND({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new OD(t,{deck:this,stats:this.stats,viewport:r,timeline:e}),this.effectManager=new e8,this.deckRenderer=new n8(t),this.deckPicker=new h8(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){const{gl:r}=this.layerManager.context;sh(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e}),this.props.onAfterRender({gl:r})}_onRenderFrame(t){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),hr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const r=Cu.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}G(ov,"defaultProps",uA);G(ov,"VERSION",T4);class y_{constructor(t,e){G(this,"opts",void 0),G(this,"source",void 0),this.opts=e,this.source=t}get value(){return this.source.value}getValue(){const t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];const{value:r}=this.source,{size:n}=e;let o=r;if(r&&r.length!==n){o=new Float32Array(n);const c=e.elementOffset||0;for(let l=0;l<n;++l)o[l]=r[c+l]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function Y8(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Xm(i){return i.stride||i.size*i.bytesPerElement}function dA(i,t){t.offset&&hr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=Xm(i),r=t.vertexOffset!==void 0?t.vertexOffset:i.vertexOffset||0,n=t.elementOffset||0,o=r*e+n*i.bytesPerElement+(i.offset||0);return{...t,offset:o,stride:e}}function J8(i,t){const e=dA(i,t);return{high:e,low:{...e,offset:e.offset+i.size*4}}}class K8{constructor(t,e,r){G(this,"gl",void 0),G(this,"id",void 0),G(this,"size",void 0),G(this,"settings",void 0),G(this,"value",void 0),G(this,"doublePrecision",void 0),G(this,"_buffer",void 0),G(this,"state",void 0),this.gl=t,this.id=e.id||"",this.size=e.size||1;const n=e.logicalType||e.type,o=n===5130;let{defaultValue:c}=e;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let l;o?l=5126:!n&&e.isIndexed?l=t&&D1(t,Kr.ELEMENT_INDEX_UINT32)?5125:5123:l=n||5126;let _=Y8(n||l||5126);this.doublePrecision=o,o&&e.fp64===!1&&(_=Float32Array),this.value=null,this.settings={...e,defaultType:_,defaultValue:c,logicalType:n,type:l,size:this.size,bytesPerElement:_.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:t,type:e}=this.settings;this._buffer=new Gr(this.gl,{id:this.id,target:t?34963:34962,accessor:{type:e}})}return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*Xm(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),bf.release(this.state.allocatedValue)}getShaderAttributes(t,e){if(this.doublePrecision){const r={},n=this.value instanceof Float64Array,o=J8(this.getAccessor(),e||{});return r[t]=new y_(this,o.high),r["".concat(t,"64Low")]=n?new y_(this,o.low):new Float32Array(this.size),r}if(e){const r=dA(this.getAccessor(),e);return{[t]:new y_(this,r)}}return{[t]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:r,size:n}=this,o=r*n;if(e&&o&&e.length>=o){const c=new Array(n).fill(1/0),l=new Array(n).fill(-1/0);for(let _=0;_<o;)for(let v=0;v<n;v++){const S=e[_++];S<c[v]&&(c[v]=S),S>l[v]&&(l[v]=S)}t=[c,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let r;ArrayBuffer.isView(t)?r={value:t}:t instanceof Gr?r={buffer:t}:r=t;const n={...this.settings,...r};if(e.bufferAccessor=n,e.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!e.constant||!this._areValuesEqual(o,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;e.externalBuffer=o,e.constant=!1,this.value=r.value||null;const c=r.value instanceof Float64Array;n.type=r.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(c?2:1),n.stride=Xm(n)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;e.externalBuffer=null,e.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=Xm(n);const{buffer:c,byteOffset:l}=this;this.doublePrecision&&o instanceof Float64Array&&(o=f_(o,n));const _=o.byteLength+l+n.stride*2;c.byteLength<_&&c.reallocate(_),c.setAccessor(null),c.subData({data:o,offset:l}),n.type=r.type||c.accessor.type}return!0}updateSubBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const e=this.value,{startOffset:r=0,endOffset:n}=t;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?f_(e,{size:this.size,startIndex:r,endIndex:n}):e.subarray(r,n),offset:r*e.BYTES_PER_ELEMENT+this.byteOffset})}allocate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,n=r.allocatedValue,o=bf.allocate(n,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=o;const{buffer:c,byteOffset:l}=this;return c.byteLength<o.byteLength+l&&(c.reallocate(o.byteLength+l),e&&n&&c.subData({data:n instanceof Float64Array?f_(n,this):n,offset:l})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=e.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));!(e instanceof r)&&this.settings.normalized&&!("normalized"in t)&&hr.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(t){switch(this.settings.type){case 5120:return new Float32Array(t).map(e=>(e+128)/255*2-1);case 5122:return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case 5121:return new Float32Array(t).map(e=>e/255);case 5123:return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,r){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(t))return e[r]=t,e;if(!t){let c=o;for(;--c>=0;)e[r+c]=n[c];return e}switch(o){case 4:e[r+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:e[r+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:e[r+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:e[r+0]=Number.isFinite(t[0])?t[0]:n[0];break;default:let c=o;for(;--c>=0;)e[r+c]=Number.isFinite(t[c])?t[c]:n[c]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}}const dw=[],pw=[];function pA(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=dw;const n={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(pw.length=i.length,r=pw):r=dw,(t>0||Number.isFinite(e))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,e),n.index=t-1),{iterable:r,objectInfo:n}}function fA(i){return i&&i[Symbol.asyncIterator]}function Q8(i,t){const{size:e,stride:r,offset:n,startIndices:o,nested:c}=t,l=i.BYTES_PER_ELEMENT,_=r?r/l:e,v=n?n/l:0,S=Math.floor((i.length-v)/_);return(T,P)=>{let{index:I,target:z}=P;if(!o){const Z=I*_+v;for(let ot=0;ot<e;ot++)z[ot]=i[Z+ot];return z}const N=o[I],X=o[I+1]||S;let H;if(c){H=new Array(X-N);for(let Z=N;Z<X;Z++){const ot=Z*_+v;z=new Array(e);for(let gt=0;gt<e;gt++)z[gt]=i[ot+gt];H[Z-N]=z}}else if(_===e)H=i.subarray(N*e+v,X*e+v);else{H=new i.constructor((X-N)*e);let Z=0;for(let ot=N;ot<X;ot++){const gt=ot*_+v;for(let Et=0;Et<e;Et++)H[Z++]=i[gt+Et]}}return H}}const tO=[],Zm=[[0,1/0]];function eO(i,t){if(i===Zm||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return i;const e=[],r=i.length;let n=0;for(let o=0;o<r;o++){const c=i[o];c[1]<t[0]?(e.push(c),n=o+1):c[0]>t[1]?e.push(c):t=[Math.min(c[0],t[0]),Math.max(c[1],t[1])]}return e.splice(n,0,t),e}function v_(i){const{source:t,target:e,start:r=0,size:n,getData:o}=i,c=i.end||e.length,l=t.length,_=c-r;if(l>_){e.set(t.subarray(0,_),r);return}if(e.set(t,r),!o)return;let v=l;for(;v<_;){const S=o(v,t);for(let T=0;T<n;T++)e[r+v]=S[T]||0,v++}}function iO(i){let{source:t,target:e,size:r,getData:n,sourceStartIndices:o,targetStartIndices:c}=i;if(!Array.isArray(c))return v_({source:t,target:e,size:r,getData:n}),e;let l=0,_=0;const v=n&&((T,P)=>n(T+_,P)),S=Math.min(o.length,c.length);for(let T=1;T<S;T++){const P=o[T]*r,I=c[T]*r;v_({source:t.subarray(l,P),target:e,start:_,end:I,size:r,getData:v}),l=P,_=I}return _<e.length&&v_({source:[],target:e,start:_,size:r,getData:v}),e}const rO={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function mA(i,t){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const e=i.type||"interpolation";return{...rO[e],...t,...i,type:e}}function gA(i,t){const e=t.getBuffer();return e?[e,{divisor:0,size:t.size,normalized:t.settings.normalized}]:t.value}function _A(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function yA(i){i.push(i.shift())}function av(i,t){const{doublePrecision:e,settings:r,value:n,size:o}=i,c=e&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:t*o)*c}function vA(i){let{buffer:t,numInstances:e,attribute:r,fromLength:n,fromStartIndices:o,getData:c=Z=>Z}=i;const l=r.doublePrecision&&r.value instanceof Float64Array?2:1,_=r.size*l,v=r.byteOffset,S=r.startIndices,T=o&&S,P=av(r,e),I=r.isConstant;if(!T&&n>=P)return;const z=I?r.value:r.getBuffer().getData({srcByteOffset:v});if(r.settings.normalized&&!I){const Z=c;c=(ot,gt)=>r.normalizeConstant(Z(ot,gt))}const N=I?(Z,ot)=>c(z,ot):(Z,ot)=>c(z.subarray(Z,Z+_),ot),X=t.getData({length:n}),H=new Float32Array(P);iO({source:X,target:H,sourceStartIndices:o,targetStartIndices:S,size:_,getData:N}),t.byteLength<H.byteLength+v&&t.reallocate(H.byteLength+v),t.subData({data:H,offset:v})}class lv extends K8{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Zm}),G(this,"constant",!1),this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,r=this.settings.transition,n=Array.isArray(e)?t[e.find(o=>t[o])]:t[e];return mA(n,r)}setNeedsUpdate(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:r=0,endRow:n=1/0}=e;this.state.updateRanges=eO(this.state.updateRanges,[r,n])}else this.state.updateRanges=Zm}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=tO}setNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(t,e.updateRanges!==Zm),!0):!1}updateBuffer(t){let{numInstances:e,data:r,props:n,context:o}=t;if(!this.needsUpdate())return!1;const{state:{updateRanges:c},settings:{update:l,noAlloc:_}}=this;let v=!0;if(l){for(const[S,T]of c)l.call(o,this,{data:r,startRow:S,endRow:T,props:n,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[S,T]of c){const P=Number.isFinite(S)?this.getVertexOffset(S):0,I=Number.isFinite(T)?this.getVertexOffset(T):_||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:P,endOffset:I})}this._checkAttributeArray()}else v=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),v}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:n}=this;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),n.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const o=t;Rs(ArrayBuffer.isView(o.value),"invalid ".concat(n.accessor));const c=!!o.size&&o.size!==this.size;return r.binaryAccessor=Q8(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:e,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getShaderAttributes(){const t=this.settings.shaderAttributes||{[this.id]:null},e={};for(const r in t)Object.assign(e,super.getShaderAttributes(r,t[r]));return e}_autoUpdater(t,e){let{data:r,startRow:n,endRow:o,props:c,numInstances:l}=e;if(t.constant)return;const{settings:_,state:v,value:S,size:T,startIndices:P}=t,{accessor:I,transform:z}=_,N=v.binaryAccessor||(typeof I=="function"?I:c[I]);Rs(typeof N=="function",'accessor "'.concat(I,'" is not a function'));let X=t.getVertexOffset(n);const{iterable:H,objectInfo:Z}=pA(r,n,o);for(const ot of H){Z.index++;let gt=N(ot,Z);if(z&&(gt=z.call(this,gt)),P){const Et=(Z.index<P.length-1?P[Z.index+1]:l)-P[Z.index];if(gt&&Array.isArray(gt[0])){let Ft=X;for(const Mt of gt)t._normalizeValue(Mt,S,Ft),Ft+=T}else gt&&gt.length>T?S.set(gt,X):(t._normalizeValue(gt,Z.target,0),PD({target:S,source:Z.target,start:X,count:Et}));X+=Et*T}else t._normalizeValue(gt,S,X),X+=T}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let r=!0;switch(e){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class nO{constructor(t){let{gl:e,attribute:r,timeline:n}=t;G(this,"gl",void 0),G(this,"type","interpolation"),G(this,"attributeInTransition",void 0),G(this,"settings",void 0),G(this,"attribute",void 0),G(this,"transition",void 0),G(this,"currentStartIndices",void 0),G(this,"currentLength",void 0),G(this,"transform",void 0),G(this,"buffers",void 0),this.gl=e,this.transition=new Nf(n),this.attribute=r,this.attributeInTransition=new lv(e,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=oO(e,r);const o={byteLength:0,usage:35050};this.buffers=[new Gr(e,o),new Gr(e,o)]}get inProgress(){return this.transition.inProgress}start(t,e){if(t.duration<=0){this.transition.cancel();return}this.settings=t;const{gl:r,buffers:n,attribute:o}=this;yA(n);const c={numInstances:e,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of n)vA({buffer:l,...c});this.currentStartIndices=o.startIndices,this.currentLength=av(o,e),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:gA(r,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const t=this.transition.update();if(t){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let o=n/e;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return t}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0}}const sO=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function oO(i,t){const e=_A(t.size);return new Y1(i,{vs:sO,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}class aO{constructor(t){let{gl:e,attribute:r,timeline:n}=t;G(this,"gl",void 0),G(this,"type","spring"),G(this,"attributeInTransition",void 0),G(this,"settings",void 0),G(this,"attribute",void 0),G(this,"transition",void 0),G(this,"currentStartIndices",void 0),G(this,"currentLength",void 0),G(this,"texture",void 0),G(this,"framebuffer",void 0),G(this,"transform",void 0),G(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Nf(n),this.attribute=r,this.attributeInTransition=new lv(e,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=cO(e),this.framebuffer=hO(e,this.texture),this.transform=lO(e,r,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new Gr(e,o),new Gr(e,o),new Gr(e,o)]}get inProgress(){return this.transition.inProgress}start(t,e){const{gl:r,buffers:n,attribute:o}=this,c={numInstances:e,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter};for(const l of n)vA({buffer:l,...c});this.settings=t,this.currentStartIndices=o.startIndices,this.currentLength=av(o,e),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...t,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:gA(r,o)}})}update(){const{buffers:t,transform:e,framebuffer:r,transition:n}=this;if(!n.update())return!1;const o=this.settings;return e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),yA(t),this.attributeInTransition.setData({buffer:t[1],value:this.attribute.value}),Ng(r)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const t of this.buffers)t.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function lO(i,t,e){const r=_A(t.size);return new Y1(i,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function cO(i){return new Sa(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function hO(i,t){return new os(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:t}})}const uO={interpolation:nO,spring:aO};class dO{constructor(t,e){let{id:r,timeline:n}=e;G(this,"id",void 0),G(this,"isSupported",void 0),G(this,"gl",void 0),G(this,"timeline",void 0),G(this,"transitions",void 0),G(this,"needsRedraw",void 0),G(this,"numInstances",void 0),this.id=r,this.gl=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Y1.isSupported(t)}finalize(){for(const t in this.transitions)this._removeTransition(t)}update(t){let{attributes:e,transitions:r,numInstances:n}=t;this.numInstances=n||1;for(const o in e){const c=e[o],l=c.getTransitionSetting(r);l&&this._updateAttribute(o,c,l)}for(const o in this.transitions){const c=e[o];(!c||!c.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const r=this.transitions[e];r.inProgress&&(t[e]=r.attributeInTransition)}return t}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].cancel(),delete this.transitions[t]}_updateAttribute(t,e,r){const n=this.transitions[t];let o=!n||n.type!==r.type;if(o){if(!this.isSupported){hr.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();return}n&&this._removeTransition(t);const c=uO[r.type];c?this.transitions[t]=new c({attribute:e,timeline:this.timeline,gl:this.gl}):(hr.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}const fw="attributeManager.invalidate",pO="attributeManager.updateStart",fO="attributeManager.updateEnd",mO="attribute.updateStart",gO="attribute.allocate",_O="attribute.updateEnd";class yO{constructor(t){let{id:e="attribute-manager",stats:r,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};G(this,"id",void 0),G(this,"gl",void 0),G(this,"attributes",void 0),G(this,"updateTriggers",void 0),G(this,"needsRedraw",void 0),G(this,"userData",void 0),G(this,"stats",void 0),G(this,"attributeTransitionManager",void 0),G(this,"mergeBoundsMemoized",Of(vD)),this.id=e,this.gl=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new dO(t,{id:"".concat(e,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{instanced:1})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const r=this._invalidateTrigger(t,e);to(fw,this,t,r)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);to(fw,this,"all")}update(t){let{data:e,numInstances:r,startIndices:n=null,transitions:o,props:c={},buffers:l={},context:_={}}=t,v=!1;to(pO,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const S in this.attributes){const T=this.attributes[S],P=T.settings.accessor;T.startIndices=n,T.numInstances=r,c[S]&&hr.removed("props.".concat(S),"data.attributes.".concat(S))(),T.setExternalBuffer(l[S])||T.setBinaryValue(typeof P=="string"?l[P]:void 0,e.startIndices)||typeof P=="string"&&!l[P]&&T.setConstantValue(c[P])||T.needsUpdate()&&(v=!0,this._updateAttribute({attribute:T,numInstances:r,data:e,props:c,context:_})),this.needsRedraw=this.needsRedraw||T.needsRedraw()}v&&to(fO,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return this.attributes}getBounds(t){const e=t.map(r=>{var n;return(n=this.attributes[r])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:e,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const o in e){const c=e[o];c.needsRedraw(t)&&!r.hasAttribute(o)&&(n[o]=c)}return n}getShaderAttributes(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t||(t=this.getAttributes());const r={};for(const n in t)e[n]||Object.assign(r,t[n].getShaderAttributes());return r}_add(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in t){const n=t[r];this.attributes[r]=this._createAttribute(r,n,e)}this._mapUpdateTriggersToAttributes()}_createAttribute(t,e,r){const n={...e,id:t,size:e.isIndexed&&1||e.size||1,divisor:r.instanced?1:e.divisor||0};return new lv(this.gl,n)}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(r=>{t[r]||(t[r]=[]),t[r].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:r,updateTriggers:n}=this,o=n[t];return o&&o.forEach(c=>{const l=r[c];l&&l.setNeedsUpdate(l.id,e)}),o}_updateAttribute(t){const{attribute:e,numInstances:r}=t;if(to(mO,e),e.constant){e.setConstantValue(e.value);return}e.allocate(r)&&to(gO,e,r),e.updateBuffer(t)&&(this.needsRedraw=!0,to(_O,e,r))}}class vO extends Nf{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:r,duration:n,easing:o}}=this,c=o(t/n);this._value=gg(e,r,c)}}const mw=1e-5;function gw(i,t,e,r,n){const o=t-i,c=(e-t)*n,l=-o*r;return c+l+o+t}function bO(i,t,e,r,n){if(Array.isArray(e)){const o=[];for(let c=0;c<e.length;c++)o[c]=gw(i[c],t[c],e[c],r,n);return o}return gw(i,t,e,r,n)}function _w(i,t){if(Array.isArray(i)){let e=0;for(let r=0;r<i.length;r++){const n=i[r]-t[r];e+=n*n}return Math.sqrt(e)}return Math.abs(i-t)}class xO extends Nf{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:r,stiffness:n}=this.settings,{_prevValue:o=t,_currValue:c=t}=this;let l=bO(o,c,e,r,n);const _=_w(l,e),v=_w(l,c);_<mw&&v<mw&&(l=e,this.end()),this._prevValue=c,this._currValue=l}}const wO={interpolation:vO,spring:xO};class SO{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,r,n){const{transitions:o}=this;if(o.has(t)){const _=o.get(t),{value:v=_.settings.fromValue}=_;e=v,this.remove(t)}if(n=mA(n),!n)return;const c=wO[n.type];if(!c){hr.error("unsupported transition type '".concat(n.type,"'"))();return}const l=new c(this.timeline);l.start({...n,fromValue:e,toValue:r}),o.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,r]of this.transitions)r.update(),t[e]=r.value,r.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function AO(i){const t=i[Vh];for(const e in t){const r=t[e],{validate:n}=r;if(n&&!n(i[e],r))throw new Error("Invalid prop ".concat(e,": ").concat(i[e]))}}function EO(i,t){const e=bA({newProps:i,oldProps:t,propTypes:i[Vh],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=CO(i,t);let n=!1;return r||(n=PO(i,t)),{dataChanged:r,propsChanged:e,updateTriggersChanged:n,extensionsChanged:IO(i,t),transitionsChanged:TO(i,t)}}function TO(i,t){if(!i.transitions)return!1;const e={},r=i[Vh];let n=!1;for(const o in i.transitions){const c=r[o],l=c&&c.type;(l==="number"||l==="color"||l==="array")&&Ry(i[o],t[o],c)&&(e[o]=!0,n=!0)}return n?e:!1}function bA(i){let{newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:o="props"}=i;if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const c of Object.keys(t))if(!(c in r)){if(!(c in e))return"".concat(o,".").concat(c," added");const l=Ry(t[c],e[c],n[c]);if(l)return"".concat(o,".").concat(c," ").concat(l)}for(const c of Object.keys(e))if(!(c in r)){if(!(c in t))return"".concat(o,".").concat(c," dropped");if(!Object.hasOwnProperty.call(t,c)){const l=Ry(t[c],e[c],n[c]);if(l)return"".concat(o,".").concat(c," ").concat(l)}}return!1}function Ry(i,t,e){let r=e&&e.equal;return r&&!r(i,t,e)||!r&&(r=i&&t&&i.equals,r&&!r.call(i,t))?"changed deeply":!r&&t!==i?"changed shallowly":null}function CO(i,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:r,_dataDiff:n}=i;return r?r(i.data,t.data)||(e="Data comparator detected a change"):i.data!==t.data&&(e="A new data container was supplied"),e&&n&&(e=n(i.data,t.data)||e),e}function PO(i,t){if(t===null)return{all:!0};if("all"in i.updateTriggers&&yw(i,t,"all"))return{all:!0};const e={};let r=!1;for(const n in i.updateTriggers)n!=="all"&&yw(i,t,n)&&(e[n]=!0,r=!0);return r?e:!1}function IO(i,t){if(t===null)return!0;const e=t.extensions,{extensions:r}=i;if(r===e)return!1;if(!e||!r||r.length!==e.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(e[n]))return!0;return!1}function yw(i,t,e){let r=i.updateTriggers[e];r=r??{};let n=t.updateTriggers[e];return n=n??{},bA({oldProps:n,newProps:r,triggerName:e})}const LO="count(): argument not an object",MO="count(): argument not a container";function BO(i){if(!kO(i))throw new Error(LO);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(RO(i))return Object.keys(i).length;throw new Error(MO)}function RO(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function kO(i){return i!==null&&typeof i=="object"}function FO(i,t){if(!t)return i;const e={...i,...t};if("defines"in t&&(e.defines={...i.defines,...t.defines}),"modules"in t&&(e.modules=(i.modules||[]).concat(t.modules),t.modules.some(r=>r.name==="project64"))){const r=e.modules.findIndex(n=>n.name==="project32");r>=0&&e.modules.splice(r,1)}if("inject"in t)if(!i.inject)e.inject=t.inject;else{const r={...i.inject};for(const n in t.inject)r[n]=(r[n]||"")+t.inject[n];e.inject=r}return e}const DO={10241:9987,10240:9729,10242:33071,10243:33071},ky={};function OO(i,t,e,r){if(e instanceof Sa)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let n=null;e.compressed&&(n={10241:e.data.length>1?9985:9729});const o=new Sa(t,{...e,parameters:{...DO,...n,...r}});return ky[o.id]=i,o}function NO(i,t){!t||!(t instanceof Sa)||ky[t.id]===i&&(t.delete(),delete ky[t.id])}const zO={boolean:{validate(i,t){return!0},equal(i,t,e){return!!i==!!t}},number:{validate(i,t){return Number.isFinite(i)&&(!("max"in t)||i<=t.max)&&(!("min"in t)||i>=t.min)}},color:{validate(i,t){return t.optional&&!i||Fy(i)&&(i.length===3||i.length===4)},equal(i,t,e){return yc(i,t,1)}},accessor:{validate(i,t){const e=Sg(i);return e==="function"||e===Sg(t.value)},equal(i,t,e){return typeof t=="function"?!0:yc(i,t,1)}},array:{validate(i,t){return t.optional&&!i||Fy(i)},equal(i,t,e){const{compare:r}=e,n=Number.isInteger(r)?r:r?1:0;return r?yc(i,t,n):i===t}},object:{equal(i,t,e){if(e.ignore)return!0;const{compare:r}=e,n=Number.isInteger(r)?r:r?1:0;return r?yc(i,t,n):i===t}},function:{validate(i,t){return t.optional&&!i||typeof i=="function"},equal(i,t,e){return!e.compare&&e.ignore!==!1||i===t}},data:{transform:(i,t,e)=>{const{dataTransform:r}=e.props;return r&&i?r(i):i}},image:{transform:(i,t,e)=>{const r=e.context;return!r||!r.gl?null:OO(e.id,r.gl,i,{...t.parameters,...e.props.textureParameters})},release:(i,t,e)=>{NO(e.id,i)}}};function jO(i){const t={},e={},r={};for(const[n,o]of Object.entries(i)){const c=o==null?void 0:o.deprecatedFor;if(c)r[n]=Array.isArray(c)?c:[c];else{const l=UO(n,o);t[n]=l,e[n]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:r}}function UO(i,t){switch(Sg(t)){case"object":return Up(i,t);case"array":return Up(i,{type:"array",value:t,compare:!1});case"boolean":return Up(i,{type:"boolean",value:t});case"number":return Up(i,{type:"number",value:t});case"function":return Up(i,{type:"function",value:t,compare:!0});default:return{name:i,type:"unknown",value:t}}}function Up(i,t){return"type"in t?{name:i,...zO[t.type],...t}:"value"in t?{name:i,type:Sg(t.value),...t}:{name:i,type:"object",value:t}}function Fy(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function Sg(i){return Fy(i)?"array":i===null?"null":typeof i}function GO(i,t){let e;for(let o=t.length-1;o>=0;o--){const c=t[o];"extensions"in c&&(e=c.extensions)}const r=Dy(i.constructor,e),n=Object.create(r);n[xg]=i,n[Nu]={},n[jh]={};for(let o=0;o<t.length;++o){const c=t[o];for(const l in c)n[l]=c[l]}return Object.freeze(n),n}const VO="_mergedDefaultProps";function Dy(i,t){let e=VO;if(t)for(const n of t){const o=n.constructor;o&&(e+=":".concat(o.extensionName||o.name))}return xA(i,e)||(i[e]=qO(i,t||[]))}function qO(i,t){if(!i.prototype)return null;const e=Object.getPrototypeOf(i),r=Dy(e),n=xA(i,"defaultProps")||{},o=jO(n),c=Object.assign(Object.create(null),r,o.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[Vh],o.propTypes),_=Object.assign(Object.create(null),r==null?void 0:r[g_],o.deprecatedProps);for(const v of t){const S=Dy(v.constructor);S&&(Object.assign(c,S),Object.assign(l,S[Vh]),Object.assign(_,S[g_]))}return HO(c,i),XO(c,l),WO(c,_),c[Vh]=l,c[g_]=_,t.length===0&&!cv(i,"_propTypes")&&(i._propTypes=l),c}function HO(i,t){const e=$O(t);Object.defineProperties(i,{id:{writable:!0,value:e}})}function WO(i,t){for(const e in t)Object.defineProperty(i,e,{enumerable:!1,set(r){const n="".concat(this.id,": ").concat(e);for(const o of t[e])cv(this,o)||(this[o]=r);hr.deprecated(n,t[e].join("/"))()}})}function XO(i,t){const e={},r={};for(const n in t){const o=t[n],{name:c,value:l}=o;o.async&&(e[c]=l,r[c]=ZO(c))}i[Dd]=e,i[Nu]={},Object.defineProperties(i,r)}function ZO(i){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||fA(t)?this[Nu][i]=t:this[jh][i]=t},get(){if(this[jh]){if(i in this[jh])return this[jh][i]||this[Dd][i];if(i in this[Nu]){const t=this[xg]&&this[xg].internalState;if(t&&t.hasAsyncProp(i))return t.getAsyncProp(i)||this[Dd][i]}}return this[Dd][i]}}}function cv(i,t){return Object.prototype.hasOwnProperty.call(i,t)}function xA(i,t){return cv(i,t)&&i[t]}function $O(i){const t=i.componentName;return t||hr.warn("".concat(i.name,".componentName not specified"))(),t||i.name}let YO=0;class hv{constructor(){G(this,"id",void 0),G(this,"props",void 0),G(this,"count",void 0);for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.props=GO(this,e),this.id=this.props.id,this.count=YO++}clone(t){const{props:e}=this,r={};for(const n in e[Dd])n in e[jh]?r[n]=e[jh][n]:n in e[Nu]&&(r[n]=e[Nu][n]);return new this.constructor({...e,...r,...t})}}G(hv,"componentName","Component");G(hv,"defaultProps",{});const JO=Object.freeze({});class KO{constructor(t){G(this,"component",void 0),G(this,"onAsyncPropUpdated",void 0),G(this,"asyncProps",void 0),G(this,"oldProps",void 0),G(this,"oldAsyncProps",void 0),this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||JO}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[xg]||this.component;const e=t[jh]||{},r=t[Nu]||t,n=t[Dd]||{};for(const o in e){const c=e[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,c),e[o]=this.getAsyncProp(o)}for(const o in r){const c=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,c)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(fA(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const r=this.asyncProps[t];return e===r.resolvedValue||e===r.lastValue?!1:(r.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const r=this.asyncProps[t];r&&(e=this._postProcessValue(r,e),r.resolvedValue=e,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(t,e,r){const n=this.asyncProps[t];n&&r>=n.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=e,n.resolvedLoadCount=r,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const r=this.asyncProps[t];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;e.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(t,o,n),this._onResolve(t,o))}).catch(o=>{this._onError(t,o)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const r=this.asyncProps[t];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],c=0;for await(const l of e){if(!this.component)return;const{dataTransform:_}=this.component.props;_?o=_(l,o):o=o.concat(l),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:c,endRow:o.length}]}),c=o.length,this._setAsyncPropValue(t,o,n)}this._onResolve(t,o)}_postProcessValue(t,e){const r=t.type;return r&&this.component&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(e,r,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const r=this.component&&this.component.props[Vh];this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class QO extends KO{constructor(t){let{attributeManager:e,layer:r}=t;super(r),G(this,"attributeManager",void 0),G(this,"needsRedraw",void 0),G(this,"needsUpdate",void 0),G(this,"subLayers",void 0),G(this,"usesPickingColorCache",void 0),G(this,"hasPickingBuffer",void 0),G(this,"changeFlags",void 0),G(this,"viewport",void 0),G(this,"uniformTransitions",void 0),G(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(e,{propName:t,layer:r}):super._fetch(t,e)}_onResolve(t,e){const r=this.layer;if(r){const n=r.props.onDataLoad;t==="data"&&n&&n(e,{propName:t,layer:r})}}_onError(t,e){const r=this.layer;r&&r.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}const tN="layer.changeFlag",eN="layer.initialize",iN="layer.update",rN="layer.finalize",nN="layer.matched",vw=2**24-1,sN=Object.freeze([]),oN=Of(i=>{let{oldViewport:t,viewport:e}=i;return t.equals(e)});let uc=new Uint8ClampedArray(0);const aN={data:{type:"data",value:sN,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,t)=>{let{propName:e,layer:r,loaders:n,loadOptions:o,signal:c}=t;const{resourceManager:l}=r.context;if(o=o||r.getLoadOptions(),n=n||r.props.loaders,c){var _;o={...o,fetch:{...(_=o)===null||_===void 0?void 0:_.fetch,signal:c}}}let v=l.contains(i);return!v&&!o&&(l.add({resourceId:i,data:Hh(i,n),persistent:!1}),v=!0),v?l.subscribe({resourceId:i,onChange:S=>{var T;return(T=r.internalState)===null||T===void 0?void 0:T.reloadAsyncProp(e,S)},consumerId:r.id,requestId:e}):Hh(i,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:lr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:t}=i;return[0,-t*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class rp extends hv{constructor(){super(...arguments),G(this,"internalState",null),G(this,"lifecycle",Ad.NO_STATE),G(this,"context",void 0),G(this,"state",void 0),G(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){const t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}project(t){Rs(this.internalState);const e=this.internalState.viewport||this.context.viewport,r=iA(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,c]=eA(r,e.pixelProjectionMatrix);return t.length===2?[n,o]:[n,o,c]}unproject(t){return Rs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){Rs(this.internalState);const r=this.internalState.viewport||this.context.viewport;return ED(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(t){for(const e of this.getModels())e.updateModuleSettings(t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===lr.DEFAULT||t===lr.LNGLAT||t===lr.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){Rs(t instanceof Uint8Array);const[e,r,n]=t;return e+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:BO(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())===null||t===void 0?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){for(const e of this.props.extensions)t=FO(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:r}=t.changeFlags;if(r&&e)if(Array.isArray(r))for(const n of r)e.invalidateAll(n);else e.invalidateAll();if(e){const{props:n}=t,o=this.internalState.hasPickingBuffer,c=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(o!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:l,instancePickingColors:_}=e.attributes,v=l||_;v&&(c&&v.constant&&(v.constant=!1,e.invalidate(v.id)),!v.value&&!c&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(t){for(const r of this.getModels())r.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t)}getPickingInfo(t){let{info:e,mode:r,sourceLayer:n}=t;const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(t,e){var r,n;if(e&&(t=new Error("".concat(e,": ").concat(t.message),{cause:t})),!((r=(n=this.props).onError)!==null&&r!==void 0&&r.call(n,t))){var o,c;(o=this.context)===null||o===void 0||(c=o.onError)===null||c===void 0||c.call(o,t,this)}}getNeedsRedraw(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)===null||t===void 0?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!oN({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){for(const e of this.getModels())this._setModelAttributes(e,t)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,r=this.getNumInstances(),n=this.getStartIndices();t.update({data:e.data,numInstances:r,startIndices:n,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const o=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),r=Object.create(this.props);for(const n in e)Object.defineProperty(r,n,{value:e[n]});return r}return this.props}calculateInstancePickingColors(t,e){let{numInstances:r}=e;if(t.constant)return;const n=Math.floor(uc.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>vw&&hr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),uc=bf.allocate(uc,r,{size:3,copy:!0,maxCount:Math.max(r,vw)});const o=Math.floor(uc.length/3),c=[];for(let l=n;l<o;l++)this.encodePickingColor(l,c),uc[l*3+0]=c[0],uc[l*3+1]=c[1],uc[l*3+2]=c[2]}t.value=uc.subarray(0,r*3)}_setModelAttributes(t,e){const r=this.getAttributeManager(),n=t.userData.excludeAttributes||{},o=r.getShaderAttributes(e,n);t.setAttributes(o)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n,c=o&&e.attributes&&e.attributes[o.id];if(c&&c.value){const l=c.value,_=this.encodePickingColor(t);for(let v=0;v<e.length;v++){const S=o.getVertexOffset(v);l[S]===_[0]&&l[S+1]===_[1]&&l[S+2]===_[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;if(!n)return;const o=n.getVertexOffset(t),c=n.getVertexOffset(t+1);n.buffer.subData({data:new Uint8Array(c-o),offset:o})}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,r=t||e;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==uc.buffer&&(r.value=uc.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Rs(!this.internalState),Rs(Number.isFinite(this.props.coordinateSystem)),to(eN,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new QO({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(hr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new SO(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){to(nN,this,this===t);const{state:e,internalState:r}=t;this!==t&&(this.internalState=r,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(to(iN,this,t),!t)return;const e=this.props,r=this.context,n=this.internalState,o=r.viewport,c=this._updateUniformTransition();n.propsInTransition=c,r.viewport=n.viewport||o,this.props=c;try{const l=this._getUpdateParams(),_=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const S of this.props.extensions)S.updateState.call(this,l,S);const v=this.getModels()[0]!==_[0];this._postUpdate(l,v)}finally{r.viewport=o,this.props=e,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){to(rN,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer(t){let{moduleParameters:e=null,uniforms:r={},parameters:n={}}=t;this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;const l=this.props.opacity;r.opacity=Math.pow(l,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:_}=this.props,v=_&&_(r)||[0,0];sh(c.gl,{polygonOffset:v}),Sl(c.gl,n,()=>{const S={moduleParameters:e,uniforms:r,parameters:n,context:c};for(const T of this.props.extensions)T.draw.call(this,S,T);this.draw(S)})}finally{this.props=o}}getChangeFlags(){var t;return(t=this.internalState)===null||t===void 0?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const n in t)if(t[n]){let o=!1;switch(n){case"dataChanged":const c=t[n],l=e[n];c&&Array.isArray(l)&&(e.dataChanged=Array.isArray(c)?l.concat(c):c,o=!0);default:e[n]||(e[n]=t[n],o=!0)}o&&to(tN,this,n,t)}const r=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=r,e.somethingChanged=r||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){const r=EO(t,e);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,e[o],t[o],(n=t.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(r)}validateProps(){AO(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={pickingSelectedColor:t.picked?t.color:null},{highlightColor:r}=this.props;t.picked&&typeof r=="function"&&(e.pickingHighlightColor=r(t)),this.setModuleParameters(e),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new yO(t.gl,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:r,oldProps:n}=t;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:l,highlightColor:_}=r;if(e||n.autoHighlight!==c||n.highlightedObjectIndex!==l||n.highlightColor!==_){const v={};c||(v.pickingSelectedColor=null),Array.isArray(_)&&(v.pickingHighlightColor=_),(e||l!==n.highlightedObjectIndex)&&(v.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(v)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(t):!1;if(e=e||n,e)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}G(rp,"defaultProps",aN);G(rp,"layerName","Layer");const lN="compositeLayer.renderLayers";class wA extends rp{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo(t){let{info:e}=t;const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:r}=this.props;return r&&r[t]&&r[t].type||e}getSubLayerRow(t,e,r){return t.__source={parent:this,object:e,index:r},t}getSubLayerAccessor(t){if(typeof t=="function"){const e={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(e.index=r.__source.index,t(r.__source.object,e)):t(r,n)}return t}getSubLayerProps(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var e;const{opacity:r,pickable:n,visible:o,parameters:c,getPolygonOffset:l,highlightedObjectIndex:_,autoHighlight:v,highlightColor:S,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:I,positionFormat:z,modelMatrix:N,extensions:X,fetch:H,operation:Z,_subLayerProps:ot}=this.props,gt={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:c,getPolygonOffset:l,highlightedObjectIndex:_,autoHighlight:v,highlightColor:S,coordinateSystem:T,coordinateOrigin:P,wrapLongitude:I,positionFormat:z,modelMatrix:N,extensions:X,fetch:H,operation:Z},Et=ot&&t.id&&ot[t.id],Ft=Et&&Et.updateTriggers,Mt=t.id||"sublayer";if(Et){const yt=this.props[Vh],Ut=t.type?t.type._propTypes:{};for(const zt in Et){const at=Ut[zt]||yt[zt];at&&at.type==="accessor"&&(Et[zt]=this.getSubLayerAccessor(Et[zt]))}}Object.assign(gt,t,Et),gt.id="".concat(this.props.id,"-").concat(Mt),gt.updateTriggers={all:(e=this.props.updateTriggers)===null||e===void 0?void 0:e.all,...t.updateTriggers,...Ft};for(const yt of X){const Ut=yt.getSubLayerProps.call(this,yt);Ut&&Object.assign(gt,Ut,{updateTriggers:Object.assign(gt.updateTriggers,Ut.updateTriggers)})}return gt}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const o=this.renderLayers();r=zg(o,Boolean),this.internalState.subLayers=r}to(lN,this,n,r);for(const o of r)o.parent=this}}G(wA,"layerName","CompositeLayer");const b_=512,cN=Math.PI/180;function hN(i){let{map:t,gl:e,deck:r}=i;if(t.__deck)return t.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,c=dN({...r==null?void 0:r.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}});let l;return(!r||r.props.gl===e)&&(Object.assign(c,{gl:e,width:null,height:null,touchAction:"unset",viewState:uv(t)}),r!=null&&r.isInitialized?bw(r,t):c.onLoad=()=>{o==null||o(),bw(l,t)}),r?(l=r,r.setProps(c),r.userData.isExternal=!0):(l=new ov(c),t.on("remove",()=>{uN(t)})),l.userData.mapboxLayers=new Set,t.__deck=l,t.on("render",()=>{l.isInitialized&&yN(l,t)}),l}function bw(i,t){const e=()=>{i.isInitialized?vN(i,t):t.off("move",e)};t.on("move",e)}function uN(i){var t;(t=i.__deck)===null||t===void 0||t.finalize(),i.__deck=null}function dN(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new nv({id:"mapbox"})]}}function pN(i,t){i.userData.mapboxLayers.add(t),dv(i)}function fN(i,t){i.userData.mapboxLayers.delete(t),dv(i)}function mN(i,t){dv(i)}function gN(i,t,e){let{currentViewport:r}=i.userData,n=!1;r||(r=SA(i,t,!0),i.userData.currentViewport=r,n=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:o=>{let{layer:c}=o;return e.id===c.id||c.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function uv(i){var t;const{lng:e,lat:r}=i.getCenter(),n={longitude:(e+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(t=i.getTerrain)!==null&&t!==void 0&&t.call(i)&&_N(i,n),n}function _N(i,t){if(i.getFreeCameraOptions){const{position:e}=i.getFreeCameraOptions();if(!e||e.z===void 0)return;const r=i.transform.height,{longitude:n,latitude:o,pitch:c}=t,l=e.x*b_,_=(1-e.y)*b_,v=e.z*b_,S=vf([n,o]),T=l-S[0],P=_-S[1],I=Math.sqrt(T*T+P*P),z=c*cN,N=1.5*r,X=z<.001?N*Math.cos(z)/v:N*Math.sin(z)/I;t.zoom=Math.log2(X);const H=N*Math.cos(z)/X,Z=v-H;t.position=[0,0,Z/Wm(o)]}else typeof i.transform.elevation=="number"&&(t.position=[0,0,i.transform.elevation])}function SA(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Ou({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...uv(t),nearZMultiplier:e?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function yN(i,t){const{mapboxLayers:e,isExternal:r}=i.userData;if(r){const n=Array.from(e,v=>v.id),o=zg(i.props.layers,Boolean).some(v=>v&&!n.includes(v.id));let c=i.getViewports();const l=c.findIndex(v=>v.id==="mapbox"),_=c.length>1||l<0;(o||_)&&(l>=0&&(c=c.slice(),c[l]=SA(i,t,!1)),i._drawLayers("mapbox-repaint",{viewports:c,layerFilter:v=>(!i.props.layerFilter||i.props.layerFilter(v))&&(v.viewport.id!=="mapbox"||!n.includes(v.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function vN(i,t){i.setProps({viewState:uv(t)}),i.needsRedraw({clearRedrawFlags:!0})}function dv(i){if(i.userData.isExternal)return;const t=[];i.userData.mapboxLayers.forEach(e=>{const r=e.props.type,n=new r(e.props);t.push(n)}),i.setProps({layers:t})}class bN{constructor(t){if(G(this,"id",void 0),G(this,"type",void 0),G(this,"renderingMode",void 0),G(this,"map",void 0),G(this,"deck",void 0),G(this,"props",void 0),!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,e){this.map=t,this.deck=hN({map:t,gl:e,deck:this.props.deck}),pN(this.deck,this)}onRemove(){this.deck&&fN(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&mN(this.deck)}render(){gN(this.deck,this.map,this)}}const xN=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wN=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,AA=[0,0,0,255],EA=[0,0,1],SN={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:EA},getColor:{type:"accessor",value:AA},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function AN(i){const{header:t,attributes:e}=i;!t||!e||(i.length=t.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0&&(e.instanceColors=e.COLOR_0))}class pv extends rp{getShaders(){return super.getShaders({vs:xN,fs:wN,modules:[iv,Hk,rv]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:EA},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:AA}})}updateState(t){const{changeFlags:e,props:r}=t;if(super.updateState(t),e.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}e.dataChanged&&AN(r.data)}draw(t){let{uniforms:e}=t;const{pointSize:r,sizeUnits:n}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:fy[n],radiusPixels:r}).draw()}_getModel(t){const e=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new $d(t,{...this.getShaders(),id:this.props.id,geometry:new cf({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}G(pv,"layerName","PointCloudLayer");G(pv,"defaultProps",SN);const va={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Kt;new Kt;const Gp=new Kt,xw=new Kt;class jf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;G(this,"center",void 0),G(this,"radius",void 0),this.radius=-0,this.center=new Kt,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=Gp.from(e),this.center=new Kt().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new jf(this.center,this.radius)}union(t){const e=this.center,r=this.radius,n=t.center,o=t.radius,c=Gp.copy(n).subtract(e),l=c.magnitude();if(r>=l+o)return this.clone();if(o>=l+r)return t.clone();const _=(r+l+o)*.5;return xw.copy(c).scale((-r+_)/l).add(e),this.center.copy(xw),this.radius=_,this}expand(t){const e=Gp.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=KR(Gp,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=Gp.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?va.OUTSIDE:n<r?va.INTERSECTING:va.INSIDE}}const EN=new Kt,TN=new Kt,Em=new Kt,Tm=new Kt,Cm=new Kt,CN=new Kt,PN=new Kt,Zc={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Uf{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];G(this,"center",void 0),G(this,"halfAxes",void 0),this.center=new Kt().from(t),this.halfAxes=new Cn(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Kt(t).len(),new Kt(e).len(),new Kt(r).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Kt(t).normalize(),o=new Kt(e).normalize(),c=new Kt(r).normalize();return new _f().fromMatrix3(new Cn([...n,...o,...c]))}fromCenterHalfSizeQuaternion(t,e,r){const n=new _f(r),o=new Cn().fromQuaternion(n);return o[0]=o[0]*e[0],o[1]=o[1]*e[0],o[2]=o[2]*e[0],o[3]=o[3]*e[1],o[4]=o[4]*e[1],o[5]=o[5]*e[1],o[6]=o[6]*e[2],o[7]=o[7]*e[2],o[8]=o[8]*e[2],this.center=new Kt().from(t),this.halfAxes=o,this}clone(){return new Uf(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new jf;const e=this.halfAxes,r=e.getColumn(0,Em),n=e.getColumn(1,Tm),o=e.getColumn(2,Cm),c=EN.copy(r).add(n).add(o);return t.center.copy(this.center),t.radius=c.magnitude(),t}intersectPlane(t){const e=this.center,r=t.normal,n=this.halfAxes,o=r.x,c=r.y,l=r.z,_=Math.abs(o*n[Zc.COLUMN0ROW0]+c*n[Zc.COLUMN0ROW1]+l*n[Zc.COLUMN0ROW2])+Math.abs(o*n[Zc.COLUMN1ROW0]+c*n[Zc.COLUMN1ROW1]+l*n[Zc.COLUMN1ROW2])+Math.abs(o*n[Zc.COLUMN2ROW0]+c*n[Zc.COLUMN2ROW1]+l*n[Zc.COLUMN2ROW2]),v=r.dot(e)+t.distance;return v<=-_?va.OUTSIDE:v>=_?va.INSIDE:va.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=TN.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,Em),o=r.getColumn(1,Tm),c=r.getColumn(2,Cm),l=n.magnitude(),_=o.magnitude(),v=c.magnitude();n.normalize(),o.normalize(),c.normalize();let S=0,T;return T=Math.abs(e.dot(n))-l,T>0&&(S+=T*T),T=Math.abs(e.dot(o))-_,T>0&&(S+=T*T),T=Math.abs(e.dot(c))-v,T>0&&(S+=T*T),S}computePlaneDistances(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const c=this.center,l=this.halfAxes,_=l.getColumn(0,Em),v=l.getColumn(1,Tm),S=l.getColumn(2,Cm),T=CN.copy(_).add(v).add(S).add(c),P=PN.copy(T).subtract(t);let I=e.dot(P);return n=Math.min(I,n),o=Math.max(I,o),T.copy(c).add(_).add(v).subtract(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),T.copy(c).add(_).subtract(v).add(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),T.copy(c).add(_).subtract(v).subtract(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),c.copy(T).subtract(_).add(v).add(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),c.copy(T).subtract(_).add(v).subtract(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),c.copy(T).subtract(_).subtract(v).add(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),c.copy(T).subtract(_).subtract(v).subtract(S),P.copy(T).subtract(t),I=e.dot(P),n=Math.min(I,n),o=Math.max(I,o),r[0]=n,r[1]=o,r}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Em);e.transformAsPoint(t);const r=this.halfAxes.getColumn(1,Tm);r.transformAsPoint(t);const n=this.halfAxes.getColumn(2,Cm);return n.transformAsPoint(t),this.halfAxes=new Cn([...e,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const ww=new Kt,Sw=new Kt;class vl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;G(this,"normal",void 0),G(this,"distance",void 0),this.normal=new Kt,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return bl(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=ww.from(t),this.normal.from(e).normalize();const r=-this.normal.dot(t);return this.distance=r,this}fromCoefficients(t,e,r,n){return this.normal.set(t,e,r),bl(Al(this.normal.len(),1)),this.distance=n,this}clone(){return new vl(this.normal,this.distance)}equals(t){return Al(this.distance,t.distance)&&Al(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Sw.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}projectPointOntoPlane(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];t=ww.from(t);const r=this.getPointDistance(t),n=Sw.copy(this.normal).scale(r);return t.subtract(n).to(e)}}const Aw=[new Kt([1,0,0]),new Kt([0,1,0]),new Kt([0,0,1])],Ew=new Kt,IN=new Kt;new vl(new Kt(1,0,0),0);class Xa{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];G(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Aw.length;const e=t.center,r=t.radius;let n=0;for(const o of Aw){let c=this.planes[n],l=this.planes[n+1];c||(c=this.planes[n]=new vl),l||(l=this.planes[n+1]=new vl);const _=Ew.copy(o).scale(-r).add(e);-o.dot(_),c.fromPointNormal(_,o);const v=Ew.copy(o).scale(r).add(e),S=IN.copy(o).negate();-S.dot(v),l.fromPointNormal(v,S),n+=2}return this}computeVisibility(t){let e=va.INSIDE;for(const r of this.planes)switch(t.intersectPlane(r)){case va.OUTSIDE:return va.OUTSIDE;case va.INTERSECTING:e=va.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(bl(Number.isFinite(e),"parentPlaneMask is required."),e===Xa.MASK_OUTSIDE||e===Xa.MASK_INSIDE)return e;let r=Xa.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const c=o<31?1<<o:0;if(o<31&&!(e&c))continue;const l=n[o],_=t.intersectPlane(l);if(_===va.OUTSIDE)return Xa.MASK_OUTSIDE;_===va.INTERSECTING&&(r|=c)}return r}}G(Xa,"MASK_OUTSIDE",4294967295);G(Xa,"MASK_INSIDE",0);G(Xa,"MASK_INDETERMINATE",2147483647);new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;new Kt;const pc=new Cn,LN=new Cn,MN=new Cn,Pm=new Cn,Tw=new Cn;function BN(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=yf.EPSILON20,r=10;let n=0,o=0;const c=LN,l=MN;c.identity(),l.copy(i);const _=e*RN(l);for(;o<r&&kN(l)>_;)FN(l,Pm),Tw.copy(Pm).transpose(),l.multiplyRight(Pm),l.multiplyLeft(Tw),c.multiplyRight(Pm),++n>2&&(++o,n=0);return t.unitary=c.toTarget(t.unitary),t.diagonal=l.toTarget(t.diagonal),t}function RN(i){let t=0;for(let e=0;e<9;++e){const r=i[e];t+=r*r}return Math.sqrt(t)}const Oy=[1,0,0],Ny=[2,2,1];function kN(i){let t=0;for(let e=0;e<3;++e){const r=i[pc.getElementIndex(Ny[e],Oy[e])];t+=2*r*r}return Math.sqrt(t)}function FN(i,t){const e=yf.EPSILON15;let r=0,n=1;for(let v=0;v<3;++v){const S=Math.abs(i[pc.getElementIndex(Ny[v],Oy[v])]);S>r&&(n=v,r=S)}const o=Oy[n],c=Ny[n];let l=1,_=0;if(Math.abs(i[pc.getElementIndex(c,o)])>e){const v=i[pc.getElementIndex(c,c)],S=i[pc.getElementIndex(o,o)],T=i[pc.getElementIndex(c,o)],P=(v-S)/2/T;let I;P<0?I=-1/(-P+Math.sqrt(1+P*P)):I=1/(P+Math.sqrt(1+P*P)),l=1/Math.sqrt(1+I*I),_=I*l}return Cn.IDENTITY.to(t),t[pc.getElementIndex(o,o)]=t[pc.getElementIndex(c,c)]=l,t[pc.getElementIndex(c,o)]=_,t[pc.getElementIndex(o,c)]=-_,t}const kh=new Kt,DN=new Kt,ON=new Kt,NN=new Kt,zN=new Kt,jN=new Cn,UN={diagonal:new Cn,unitary:new Cn};function GN(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Uf;if(!i||i.length===0)return t.halfAxes=new Cn([0,0,0,0,0,0,0,0,0]),t.center=new Kt,t;const e=i.length,r=new Kt(0,0,0);for(const Ut of i)r.add(Ut);const n=1/e;r.multiplyByScalar(n);let o=0,c=0,l=0,_=0,v=0,S=0;for(const Ut of i){const zt=kh.copy(Ut).subtract(r);o+=zt.x*zt.x,c+=zt.x*zt.y,l+=zt.x*zt.z,_+=zt.y*zt.y,v+=zt.y*zt.z,S+=zt.z*zt.z}o*=n,c*=n,l*=n,_*=n,v*=n,S*=n;const T=jN;T[0]=o,T[1]=c,T[2]=l,T[3]=c,T[4]=_,T[5]=v,T[6]=l,T[7]=v,T[8]=S;const{unitary:P}=BN(T,UN),I=t.halfAxes.copy(P);let z=I.getColumn(0,ON),N=I.getColumn(1,NN),X=I.getColumn(2,zN),H=-Number.MAX_VALUE,Z=-Number.MAX_VALUE,ot=-Number.MAX_VALUE,gt=Number.MAX_VALUE,Et=Number.MAX_VALUE,Ft=Number.MAX_VALUE;for(const Ut of i)kh.copy(Ut),H=Math.max(kh.dot(z),H),Z=Math.max(kh.dot(N),Z),ot=Math.max(kh.dot(X),ot),gt=Math.min(kh.dot(z),gt),Et=Math.min(kh.dot(N),Et),Ft=Math.min(kh.dot(X),Ft);z=z.multiplyByScalar(.5*(gt+H)),N=N.multiplyByScalar(.5*(Et+Z)),X=X.multiplyByScalar(.5*(Ft+ot)),t.center.copy(z).add(N).add(X);const Mt=DN.set(H-gt,Z-Et,ot-Ft).multiplyByScalar(.5),yt=new Cn([Mt[0],0,0,0,Mt[1],0,0,0,Mt[2]]);return t.halfAxes.multiplyRight(yt),t}const x_=Math.PI/180,Im=new Float32Array(16),Cw=new Float32Array(12);function Pw(i,t,e){const r=t[0]*x_,n=t[1]*x_,o=t[2]*x_,c=Math.sin(o),l=Math.sin(r),_=Math.sin(n),v=Math.cos(o),S=Math.cos(r),T=Math.cos(n),P=e[0],I=e[1],z=e[2];i[0]=P*T*S,i[1]=P*_*S,i[2]=P*-l,i[3]=I*(-_*v+T*l*c),i[4]=I*(T*v+_*l*c),i[5]=I*S*c,i[6]=z*(_*c+T*l*v),i[7]=z*(-T*c+_*l*v),i[8]=z*S*v}function Iw(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const TA={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,t){let{startRow:e,endRow:r}=t;const{data:n,getOrientation:o,getScale:c,getTranslation:l,getTransformMatrix:_}=this.props,v=Array.isArray(_),S=v&&_.length===16,T=Array.isArray(c),P=Array.isArray(o),I=Array.isArray(l),z=S||!v&&!!_(n[0]);z?i.constant=S:i.constant=P&&T&&I;const N=i.value;if(i.constant){let X;z?(Im.set(_),X=Iw(Im)):(X=Cw,Pw(X,o,c),X.set(l,9)),i.value=new Float32Array(X)}else{let X=e*i.size;const{iterable:H,objectInfo:Z}=pA(n,e,r);for(const ot of H){Z.index++;let gt;if(z)Im.set(S?_:_(ot,Z)),gt=Iw(Im);else{gt=Cw;const Et=P?o:o(ot,Z),Ft=T?c:c(ot,Z);Pw(gt,Et,Ft),gt.set(I?l:l(ot,Z),9)}N[X++]=gt[0],N[X++]=gt[1],N[X++]=gt[2],N[X++]=gt[3],N[X++]=gt[4],N[X++]=gt[5],N[X++]=gt[6],N[X++]=gt[7],N[X++]=gt[8],N[X++]=gt[9],N[X++]=gt[10],N[X++]=gt[11]}}}};function CA(i,t){return t===lr.CARTESIAN||t===lr.METER_OFFSETS||t===lr.DEFAULT&&!i.isGeospatial}const VN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function PA(i){let t=1/0,e=1/0,r=1/0,n=-1/0,o=-1/0,c=-1/0;const l=i.POSITION?i.POSITION.value:[],_=l&&l.length;for(let v=0;v<_;v+=3){const S=l[v],T=l[v+1],P=l[v+2];t=S<t?S:t,e=T<e?T:e,r=P<r?P:r,n=S>n?S:n,o=T>o?T:o,c=P>c?P:c}return[[t,e,r],[n,o,c]]}function HN(i,t){if(!i)throw new Error("loader assertion failed.")}class Md{constructor(t,e){G(this,"fields",void 0),G(this,"metadata",void 0),HN(Array.isArray(t)),WN(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(){const t=Object.create(null);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];for(const c of r)t[c]=!0;const o=this.fields.filter(c=>t[c.name]);return new Md(o,this.metadata)}selectAt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=e.map(o=>this.fields[o]).filter(Boolean);return new Md(n,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof Md){const c=t;e=c.fields,r=Lw(Lw(new Map,this.metadata),c.metadata)}else e=t;const n=Object.create(null);for(const c of this.fields)n[c.name]=c;for(const c of e)n[c.name]=c;const o=Object.values(n);return new Md(o,r)}}function WN(i){const t={};for(const e of i)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function Lw(i,t){return new Map([...i||new Map,...t||new Map])}class Ag{constructor(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;G(this,"name",void 0),G(this,"type",void 0),G(this,"nullable",void 0),G(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new Ag(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let En=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),IA,LA,MA;class fv{static isNull(t){return t&&t.typeId===En.Null}static isInt(t){return t&&t.typeId===En.Int}static isFloat(t){return t&&t.typeId===En.Float}static isBinary(t){return t&&t.typeId===En.Binary}static isUtf8(t){return t&&t.typeId===En.Utf8}static isBool(t){return t&&t.typeId===En.Bool}static isDecimal(t){return t&&t.typeId===En.Decimal}static isDate(t){return t&&t.typeId===En.Date}static isTime(t){return t&&t.typeId===En.Time}static isTimestamp(t){return t&&t.typeId===En.Timestamp}static isInterval(t){return t&&t.typeId===En.Interval}static isList(t){return t&&t.typeId===En.List}static isStruct(t){return t&&t.typeId===En.Struct}static isUnion(t){return t&&t.typeId===En.Union}static isFixedSizeBinary(t){return t&&t.typeId===En.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===En.FixedSizeList}static isMap(t){return t&&t.typeId===En.Map}static isDictionary(t){return t&&t.typeId===En.Dictionary}get typeId(){return En.NONE}compareTo(t){return this===t}}IA=Symbol.toStringTag;class np extends fv{constructor(t,e){super(),G(this,"isSigned",void 0),G(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return En.Int}get[IA](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class XN extends np{constructor(){super(!0,8)}}class ZN extends np{constructor(){super(!0,16)}}class $N extends np{constructor(){super(!0,32)}}class YN extends np{constructor(){super(!1,8)}}class JN extends np{constructor(){super(!1,16)}}class KN extends np{constructor(){super(!1,32)}}const BA={HALF:16,SINGLE:32,DOUBLE:64};LA=Symbol.toStringTag;class RA extends fv{constructor(t){super(),G(this,"precision",void 0),this.precision=t}get typeId(){return En.Float}get[LA](){return"Float"}toString(){return"Float".concat(this.precision)}}class QN extends RA{constructor(){super(BA.SINGLE)}}class tz extends RA{constructor(){super(BA.DOUBLE)}}MA=Symbol.toStringTag;class ez extends fv{constructor(t,e){super(),G(this,"listSize",void 0),G(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return En.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[MA](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function iz(i){switch(i.constructor){case Int8Array:return new XN;case Uint8Array:return new YN;case Int16Array:return new ZN;case Uint16Array:return new JN;case Int32Array:return new $N;case Uint32Array:return new KN;case Float32Array:return new QN;case Float64Array:return new tz;default:throw new Error("array type not supported")}}function rz(i,t,e){const r=iz(t.value),n=e||nz(t);return new Ag(i,new ez(t.size,new Ag("value",r)),!1,n)}function nz(i){const t=new Map;return"byteOffset"in i&&t.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&t.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&t.set("normalized",i.normalized.toString()),t}function Mw(i,t){(i.COLOR_0||i.colors)&&t||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),hr.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function Bw(i,t){if(i.attributes)return Mw(i.attributes,t),i instanceof cf?i:new cf(i);if(i.positions||i.POSITION)return Mw(i,t),new cf({attributes:i});throw Error("Invalid mesh")}const sz=[0,0,0,255],oz={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:sz},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class mv extends rp{constructor(){super(...arguments),G(this,"state",void 0)}getShaders(){const t=!tr(this.context.gl),e={};return D1(this.context.gl,Kr.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:VN,fs:qN,modules:[iv,Wk,rv],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:r}=this.props;if(!r)return null;if(e=(t=r.header)===null||t===void 0?void 0:t.boundingBox,!e){const{attributes:n}=Bw(r,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,e=PA(n)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:TA}),this.setState({emptyTexture:new Sa(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:r,changeFlags:n}=t;if(e.mesh!==r.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const c=e.mesh.attributes||e.mesh;this.setState({hasNormals:!!(c.NORMAL||c.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==r.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw(t){let{uniforms:e}=t;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:c}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:n,composeModelMatrix:!c||CA(r,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.model)&&super.isLoaded}getModel(t){const e=new $d(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:Bw(t,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return e.setUniforms({sampler:r||n,hasTexture:!!r}),e}setTexture(t){const{emptyTexture:e,model:r}=this.state;r&&r.setUniforms({sampler:t||e,hasTexture:!!t})}}G(mv,"defaultProps",oz);G(mv,"layerName","SimpleMeshLayer");class Od{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:e}=t;this.id=e||oh(this.constructor.name),this.display=!0,this.position=new Kt,this.rotation=new Kt,this.scale=new Kt(1,1,1),this.matrix=new ar,this.userData={},this.props={},this._setScenegraphNodeProps(t)}delete(){}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(t){return Ze(t.length===3,"setPosition requires vector argument"),this.position=t,this}setRotation(t){return Ze(t.length===3,"setRotation requires vector argument"),this.rotation=t,this}setScale(t){return Ze(t.length===3,"setScale requires vector argument"),this.scale=t,this}setMatrix(t){!(arguments.length>1&&arguments[1]!==void 0)||arguments[1]?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:e,rotation:r,scale:n,update:o=!0}=t;return e&&this.setPosition(e),r&&this.setRotation(r),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const t=this.position,e=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(r),this}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:e,rotation:r,scale:n}=t;return e&&this.setPosition(e),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(t,e){Ze(t),e=e||this.matrix;const r=new ar(t).multiplyRight(e),n=r.invert(),o=n.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class hf extends Od{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t=Array.isArray(t)?{children:t}:t;const{children:e=[]}=t;ai.assert(e.every(r=>r instanceof Od),"every child must an instance of ScenegraphNode"),super(t),this.children=e}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(t){const e=this.children,r=e.indexOf(t);return r>-1&&e.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(t=>t.delete()),this.removeAll(),super.delete()}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((e,r)=>{let{worldMatrix:n}=r;const o=e.getBounds();if(!o)return;const[c,l]=o,_=new Kt(c).add(l).divide([2,2,2]);n.transformAsPoint(_,_);const v=new Kt(l).subtract(c).divide([2,2,2]);n.transformAsVector(v,v);for(let S=0;S<8;S++){const T=new Kt(S&1?-1:1,S&2?-1:1,S&4?-1:1).multiply(v).add(_);for(let P=0;P<3;P++)t[0][P]=Math.min(t[0][P],T[P]),t[1][P]=Math.max(t[1][P],T[P])}}),Number.isFinite(t[0][0])?t:null}traverse(t){let{worldMatrix:e=new ar}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new ar(e).multiplyRight(this.matrix);for(const n of this.children)n instanceof hf?n.traverse(t,{worldMatrix:r}):t(n,{worldMatrix:r})}}const az={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Rw(i){if(!i._animation){const t=lz[i.componentType],e=az[i.type],r=e*i.count,{buffer:n,byteOffset:o}=i.bufferView.data,c=new t(n,o+(i.byteOffset||0),r);if(e===1)i._animation=Array.from(c);else{const l=[];for(let _=0;_<c.length;_+=e)l.push(Array.from(c.slice(_,_+e)));i._animation=l}}return i._animation}const cz=new ar;function hz(i,t){if(t.matrix.identity(),i.translation&&t.matrix.translate(i.translation),i.rotation){const e=cz.fromQuaternion(i.rotation);t.matrix.multiplyRight(e)}i.scale&&t.matrix.scale(i.scale)}const w_=new _f;function uz(i,t,e,r,n){if(t==="rotation"){w_.slerp({start:e,target:r,ratio:n});for(let o=0;o<w_.length;o++)i[t][o]=w_[o]}else for(let o=0;o<e.length;o++)i[t][o]=n*r[o]+(1-n)*e[o]}function dz(i,t,e){let{p0:r,outTangent0:n,inTangent1:o,p1:c,tDiff:l,ratio:_}=e;for(let v=0;v<i[t].length;v++){const S=n[v]*l,T=o[v]*l;i[t][v]=(2*Math.pow(_,3)-3*Math.pow(_,2)+1)*r[v]+(Math.pow(_,3)-2*Math.pow(_,2)+_)*S+(-2*Math.pow(_,3)+3*Math.pow(_,2))*c[v]+(Math.pow(_,3)-Math.pow(_,2))*T}}function pz(i,t,e){for(let r=0;r<e.length;r++)i[t][r]=e[r]}function fz(i,t,e,r){let{input:n,interpolation:o,output:c}=t;const l=n[n.length-1],_=i%l,v=n.findIndex(I=>I>=_),S=Math.max(0,v-1);if(!Array.isArray(e[r]))switch(r){case"translation":e[r]=[0,0,0];break;case"rotation":e[r]=[0,0,0,1];break;case"scale":e[r]=[1,1,1];break;default:ai.warn("Bad animation path ".concat(r))()}Ze(e[r].length===c[S].length);const T=n[S],P=n[v];switch(o){case"STEP":pz(e,r,c[S]);break;case"LINEAR":if(P>T){const I=(_-T)/(P-T);uz(e,r,c[S],c[v],I)}break;case"CUBICSPLINE":if(P>T){const I=(_-T)/(P-T),z=P-T,N=c[3*S+1],X=c[3*S+2],H=c[3*v+0],Z=c[3*v+1];dz(e,r,{p0:N,outTangent0:X,inTangent1:H,p1:Z,tDiff:z,ratio:I})}break;default:ai.warn("Interpolation ".concat(o," not supported"))();break}}class mz{constructor(t){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,t)}animate(t){if(!this.playing)return;const e=(t/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:n,target:o,path:c}=r;fz(e,n,o,c),hz(o,o._node)})}}class gz{constructor(t){this.animations=t.animations.map((e,r)=>{const n=e.name||"Animation-".concat(r),o=e.samplers.map(l=>{let{input:_,interpolation:v="LINEAR",output:S}=l;return{input:Rw(t.accessors[_]),interpolation:v,output:Rw(t.accessors[S])}}),c=e.channels.map(l=>{let{sampler:_,target:v}=l;return{sampler:o[_],target:t.nodes[v.node],path:v.path}});return new mz({name:n,channels:c})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(e=>e.animate(t))}getAnimations(){return this.animations}}class _z extends Od{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),this.onBeforeRender=null,this.AfterRender=null,t instanceof $d?(this.model=t,this._setModelNodeProps(e)):this.model=new $d(t,e),this.bounds=null,this.managedResources=e.managedResources||[]}setProps(t){return super.setProps(t),this._setModelNodeProps(t),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(t=>t.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(t){this.model.setProps(t)}}class kA{constructor(t,e){let{attributes:r,material:n,pbrDebug:o,imageBasedLightingEnvironment:c,lights:l,useTangents:_}=e;this.gl=t,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},D1(t,Kr.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],c&&(this.uniforms.u_DiffuseEnvSampler=c.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=c.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=c.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&_,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(c,"USE_IBL"),this.defineIfPresent(l,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(t,e){t&&(this.defines[e]=1)}parseTexture(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},o=t.texture.source.image;let c,l={};o.compressed?(c=o,l={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):c={data:o};const _=new Sa(this.gl,{id:t.name||t.id,parameters:{...n,...l},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...c});this.uniforms[e]=_,this.defineIfPresent(r,r),this.generatedTextures.push(_)}parsePbrMetallicRoughness(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:e=1,roughnessFactor:r=1}=t;this.uniforms.u_MetallicRoughnessValues=[e,r]}parseMaterial(t){if(this.uniforms.pbr_uUnlit=!!t.unlit,t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:e=1}=t.normalTexture;this.uniforms.u_NormalScale=e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:e=1}=t.occlusionTexture;this.uniforms.u_OcclusionStrength=e}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode==="MASK"){const{alphaCutoff:e=.5}=t;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=e}else t.alphaMode==="BLEND"&&(ai.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(t=>t.delete())}}const yz=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,vz=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function kw(i,t){return tr(i)?`#version 300 es
`.concat(t):t}function bz(i,t){const{id:e,drawMode:r,vertexCount:n,attributes:o,modelOptions:c}=t,l=new kA(i,t);ai.info(4,"createGLTFModel defines: ",l.defines)();const _=[];_.push(...l.generatedTextures),_.push(...Object.values(o).map(S=>S.buffer));const v=new _z(i,{id:e,drawMode:r,vertexCount:n,modules:[$1],parameters:l.parameters,vs:kw(i,yz),fs:kw(i,vz),managedResources:_,...c,defines:{...l.defines,...c.defines}});return v.setProps({attributes:o}),v.setUniforms(l.uniforms),v}const xz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wz={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Sz{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=t,this.options=Object.assign({},wz,e)}instantiate(t){return this.gltf=t,(t.scenes||[]).map(e=>this.createScene(e))}createAnimator(){return Array.isArray(this.gltf.animations)?new gz(this.gltf):null}createScene(t){const e=(t.nodes||[]).map(r=>this.createNode(r));return new hf({id:t.name||t.id,children:e})}createNode(t){if(!t._node){const e=(t.children||[]).map(n=>this.createNode(n));t.mesh&&e.push(this.createMesh(t.mesh));const r=new hf({id:t.name||t.id,children:e});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const n=new ar().fromQuaternion(t.rotation);r.matrix.multiplyRight(n)}t.scale&&r.matrix.scale(t.scale)}t._node=r}return t._node}createMesh(t){if(!t._mesh){const e=(t.primitives||[]).map((n,o)=>this.createPrimitive(n,o,t)),r=new hf({id:t.name||t.id,children:e});t._mesh=r}return t._mesh}getVertexCount(t){ai.warn("getVertexCount() not found")()}createPrimitive(t,e,r){const n=bz(this.gl,Object.assign({id:t.name||"".concat(r.name||r.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options));return n.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],n}createAttributes(t,e){const r={};return Object.keys(t).forEach(n=>{r[n]=this.createAccessor(t[n],this.createBuffer(t[n],this.gl.ARRAY_BUFFER))}),e&&(r.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),ai.info(4,"glTF Attributes",{attributes:t,indices:e,generated:r})(),r}createBuffer(t,e){t.bufferView||(t.bufferView={});const{bufferView:r}=t;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[e]||(r.lumaBuffers[e]=new Gr(this.gl,{id:"from-".concat(r.id),data:r.data||t.value,target:e})),r.lumaBuffers[e]}createAccessor(t,e){return new Go({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:xz[t.type]})}createSampler(t){return t}needsPOT(){return!1}}function Az(i,t,e){const r=new Sz(i,e),n=r.instantiate(t),o=r.createAnimator();return{scenes:n,animator:o}}const Ez="3.4.15",Tz="3.4.15",FA="3.4.15",Cz="https://unpkg.com/@loaders.gl/textures@".concat(FA,"/dist/libs/basis_encoder.wasm"),Pz="https://unpkg.com/@loaders.gl/textures@".concat(FA,"/dist/libs/basis_encoder.js");let S_;async function Fw(i){const t=i.modules||{};return t.basis?t.basis:(S_=S_||Iz(i),await S_)}async function Iz(i){let t=null,e=null;return[t,e]=await Promise.all([await Bu("basis_transcoder.js","textures",i),await Bu("basis_transcoder.wasm","textures",i)]),t=t||globalThis.BASIS,await Lz(t,e)}function Lz(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(n=>{const{BasisFile:o,initializeBasis:c}=n;c(),r({BasisFile:o})})})}let A_;async function Dw(i){const t=i.modules||{};return t.basisEncoder?t.basisEncoder:(A_=A_||Mz(i),await A_)}async function Mz(i){let t=null,e=null;return[t,e]=await Promise.all([await Bu(Pz,"textures",i),await Bu(Cz,"textures",i)]),t=t||globalThis.BASIS,await Bz(t,e)}function Bz(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i(e).then(n=>{const{BasisFile:o,KTX2File:c,initializeBasis:l,BasisEncoder:_}=n;l(),r({BasisFile:o,KTX2File:c,BasisEncoder:_})})})}const vd={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Rz=["","WEBKIT_","MOZ_"],Ow={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Lm=null;function kz(i){if(!Lm){i=i||Fz()||void 0,Lm=new Set;for(const t of Rz)for(const e in Ow)if(i&&i.getExtension("".concat(t).concat(e))){const r=Ow[e];Lm.add(r)}}return Lm}function Fz(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Nw,zw,jw,Uw,Gw,Vw,qw,Hw;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(Nw||(Nw={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(zw||(zw={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(jw||(jw={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(Uw||(Uw={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(Gw||(Gw={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Vw||(Vw={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(qw||(qw={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(Hw||(Hw={}));const ma=[171,75,84,88,32,50,48,187,13,10,26,10];function Dz(i){const t=new Uint8Array(i);return!(t.byteLength<ma.length||t[0]!==ma[0]||t[1]!==ma[1]||t[2]!==ma[2]||t[3]!==ma[3]||t[4]!==ma[4]||t[5]!==ma[5]||t[6]!==ma[6]||t[7]!==ma[7]||t[8]!==ma[8]||t[9]!==ma[9]||t[10]!==ma[10]||t[11]!==ma[11])}const Oz={etc1:{basisFormat:0,compressed:!0,format:vd.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:vd.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:vd.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:vd.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:vd.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:vd.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Nz(i,t){if(t.basis.containerFormat==="auto"){if(Dz(i)){const r=await Dw(t);return Ww(r.KTX2File,i,t)}const{BasisFile:e}=await Fw(t);return E_(e,i,t)}switch(t.basis.module){case"encoder":const e=await Dw(t);switch(t.basis.containerFormat){case"ktx2":return Ww(e.KTX2File,i,t);case"basis":default:return E_(e.BasisFile,i,t)}case"transcoder":default:const{BasisFile:r}=await Fw(t);return E_(r,i,t)}}function E_(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),o=[];for(let c=0;c<n;c++){const l=r.getNumLevels(c),_=[];for(let v=0;v<l;v++)_.push(zz(r,c,v,e));o.push(_)}return o}finally{r.close(),r.delete()}}function zz(i,t,e,r){const n=i.getImageWidth(t,e),o=i.getImageHeight(t,e),c=i.getHasAlpha(),{compressed:l,format:_,basisFormat:v}=DA(r,c),S=i.getImageTranscodedSizeInBytes(t,e,v),T=new Uint8Array(S);if(!i.transcodeImage(T,t,e,v,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:T,compressed:l,format:_,hasAlpha:c}}function Ww(i,t,e){const r=new i(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),o=[];for(let c=0;c<n;c++){o.push(jz(r,c,e));break}return[o]}finally{r.close(),r.delete()}}function jz(i,t,e){const{alphaFlag:r,height:n,width:o}=i.getImageLevelInfo(t,0,0),{compressed:c,format:l,basisFormat:_}=DA(e,r),v=i.getImageTranscodedSizeInBytes(t,0,0,_),S=new Uint8Array(v);if(!i.transcodeImage(S,t,0,0,_,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:S,compressed:c,levelSize:v,hasAlpha:r,format:l}}function DA(i,t){let e=i&&i.basis&&i.basis.format;return e==="auto"&&(e=OA()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),Oz[e]}function OA(){const i=kz();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const Uz={name:"Basis",id:ih?"basis":"basis-nodejs",module:"textures",version:Tz,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},Gz={...Uz,parse:Nz};function ba(i,t){if(!i)throw new Error(t||"assert failed: gltf")}function NA(i,t){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const e=t.baseUri||t.uri;if(!e)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return e.substr(0,e.lastIndexOf("/")+1)+i}function Vz(i,t,e){const r=i.bufferViews[e];ba(r);const n=r.buffer,o=t[n];ba(o);const c=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,c,r.byteLength)}const Xw=["SCALAR","VEC2","VEC3","VEC4"],qz=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Hz=new Map(qz),Wz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xz={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Zz={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function zA(i){return Xw[i-1]||Xw[0]}function jA(i){const t=Hz.get(i.constructor);if(!t)throw new Error("Illegal typed array");return t}function gv(i,t){const e=Zz[i.componentType],r=Wz[i.type],n=Xz[i.componentType],o=i.count*r,c=i.count*r*n;return ba(c>=0&&c<=t.byteLength),{ArrayType:e,length:o,byteLength:c}}function UA(i){let{images:t,bufferViews:e}=i;t=t||[],e=e||[];const r=t.map(c=>c.bufferView);e=e.filter(c=>!r.includes(c));const n=e.reduce((c,l)=>c+l.byteLength,0),o=t.reduce((c,l)=>{const{width:_,height:v}=l.image;return c+_*v},0);return n+Math.ceil(4*o*1.33)}const $z={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Wo{constructor(t){G(this,"gltf",void 0),G(this,"sourceBuffers",void 0),G(this,"byteLength",void 0),this.gltf=t||{json:{...$z},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}getExtension(t){const e=this.getUsedExtensions().find(n=>n===t),r=this.json.extensions||{};return e?r[t]||!0:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,r=this.gltf.buffers[e];ba(r);const n=(t.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,t.byteLength)}getTypedArrayForAccessor(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,{ArrayType:n,length:o}=gv(t,e),c=e.byteOffset+t.byteOffset;return new n(r,c,o)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=e.byteOffset||0;return new Uint8Array(r,n,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}setObjectExtension(t,e,r){const n=t.extensions||{};n[e]=r}removeObjectExtension(t,e){const r=t.extensions||{},n=r[e];return delete r[e],n}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ba(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ba(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(!this.getExtension(t))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:r}=t;this.json.nodes=this.json.nodes||[];const n={mesh:e};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:r,material:n,mode:o=4}=t,c={primitives:[{attributes:this._addAttributes(e),mode:o}]};if(r){const l=this._addIndices(r);c.primitives[0].indices=l}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const r=L1(t),n=e||(r==null?void 0:r.mimeType),o={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t){const e=t.byteLength;ba(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Pf(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const r={bufferView:t,type:zA(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(t);let n={min:e.min,max:e.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(t,e.size));const o={size:e.size,componentType:jA(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,e))}addTexture(t){const{imageIndex:e}=t,r={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),o=new Uint8Array(n);let c=0;for(const l of this.sourceBuffers||[])c=_I(l,o,c);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(t,e){let r=!0;for(;r;){const n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const r in t){const n=t[r],o=this._getGltfAttributeName(r),c=this.addBinaryBuffer(n.value,n);e[o]=c}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];const n=t.subarray(0,e);for(const o of n)r.min.push(o),r.max.push(o);for(let o=e;o<t.length;o+=e)for(let c=0;c<e;c++)r.min[0+c]=Math.min(r.min[0+c],t[o+c]),r.max[0+c]=Math.max(r.max[0+c],t[o+c]);return r}}const Yz="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Jz="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Kz=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Qz=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),t7={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},e7={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function i7(i,t,e,r,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const c=await r7();o7(c,c.exports[e7[n]],i,t,e,r,c.exports[t7[o||"NONE"]])}let T_;async function r7(){return T_||(T_=n7()),T_}async function n7(){let i=Yz;WebAssembly.validate(Kz)&&(i=Jz,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(s7(i),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function s7(i){const t=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const n=i.charCodeAt(r);t[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let e=0;for(let r=0;r<i.length;++r)t[e++]=t[r]<60?Qz[t[r]]:(t[r]-60)*64+t[++r];return t.buffer.slice(0,e)}function o7(i,t,e,r,n,o,c){const l=i.exports.sbrk,_=r+3&-4,v=l(_*n),S=l(o.length),T=new Uint8Array(i.exports.memory.buffer);T.set(o,S);const P=t(v,r,n,S,o.length);if(P===0&&c&&c(v,_,n),e.set(T.subarray(v,v+r*n)),l(v-l(0)),P!==0)throw new Error("Malformed buffer data: ".concat(P))}const _v="EXT_meshopt_compression",a7=_v;async function l7(i,t){var e;const r=new Wo(i);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes))return;const n=[];for(const o of i.json.bufferViews||[])n.push(c7(r,o));await Promise.all(n),r.removeExtension(_v)}async function c7(i,t){const e=i.getObjectExtension(t,_v);if(e){const{byteOffset:r=0,byteLength:n=0,byteStride:o,count:c,mode:l,filter:_="NONE",buffer:v}=e,S=i.gltf.buffers[v],T=new Uint8Array(S.arrayBuffer,S.byteOffset+r,n),P=new Uint8Array(i.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await i7(P,c,o,T,l,_),P}return null}const h7=Object.freeze(Object.defineProperty({__proto__:null,decode:l7,name:a7},Symbol.toStringTag,{value:"Module"})),Ed="EXT_texture_webp",u7=Ed;function d7(i,t){const e=new Wo(i);if(!m4("image/webp")){if(e.getRequiredExtensions().includes(Ed))throw new Error("gltf: Required extension ".concat(Ed," not supported by browser"));return}const{json:r}=e;for(const n of r.textures||[]){const o=e.getObjectExtension(n,Ed);o&&(n.source=o.source),e.removeObjectExtension(n,Ed)}e.removeExtension(Ed)}const p7=Object.freeze(Object.defineProperty({__proto__:null,name:u7,preprocess:d7},Symbol.toStringTag,{value:"Module"})),$m="KHR_texture_basisu",f7=$m;function m7(i,t){const e=new Wo(i),{json:r}=e;for(const n of r.textures||[]){const o=e.getObjectExtension(n,$m);o&&(n.source=o.source),e.removeObjectExtension(n,$m)}e.removeExtension($m)}const g7=Object.freeze(Object.defineProperty({__proto__:null,name:f7,preprocess:m7},Symbol.toStringTag,{value:"Module"})),_7="3.4.15",y7={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},v7={name:"Draco",id:ih?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:_7,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:y7};function b7(i,t,e){const r=GA(t.metadata),n=[],o=x7(t.attributes);for(const c in i){const l=i[c],_=Zw(c,l,o[c]);n.push(_)}if(e){const c=Zw("indices",e);n.push(c)}return new Md(n,r)}function x7(i){const t={};for(const e in i){const r=i[e];t[r.name||"undefined"]=r}return t}function Zw(i,t,e){const r=e?GA(e.metadata):void 0;return rz(i,t,r)}function GA(i){const t=new Map;for(const e in i)t.set("".concat(e,".string"),JSON.stringify(i[e]));return t}const $w={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},w7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},S7=4;class A7{constructor(t){G(this,"draco",void 0),G(this,"decoder",void 0),G(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(n){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!o.ptr){const T="DRACO decompression failed: ".concat(c.error_msg());throw new Error(T)}const l=this._getDracoLoaderData(o,n,e),_=this._getMeshData(o,l,e),v=PA(_.attributes),S=b7(_.attributes,l,_.indices);return{loader:"draco",loaderData:l,header:{vertexCount:o.num_points(),boundingBox:v},..._,schema:S}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(t,e,r){const n=this._getTopLevelMetadata(t),o=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(t,e){const r={};for(let n=0;n<t.num_attributes();n++){const o=this.decoder.GetAttribute(t,n),c=this._getAttributeMetadata(t,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:c};const l=this._getQuantizationTransform(o,e);l&&(r[o.unique_id()].quantization_transform=l);const _=this._getOctahedronTransform(o,e);_&&(r[o.unique_id()].octahedron_transform=_)}return r}_getMeshData(t,e,r){const n=this._getMeshAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,r){const n={};for(const o of Object.values(t.attributes)){const c=this._deduceAttributeName(o,r);o.name=c;const{value:l,size:_}=this._getAttributeValues(e,o);n[c]={value:l,size:_,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(t){const e=t.num_faces()*3,r=e*S7,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),C7(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=w7[e.data_type],n=e.num_components,o=t.num_points()*n,c=o*r.BYTES_PER_ELEMENT,l=E7(this.draco,r);let _;const v=this.draco._malloc(c);try{const S=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,S,l,c,v),_=new r(this.draco.HEAPF32.buffer,v,o).slice()}finally{this.draco._free(v)}return{value:_,size:n}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[c,l]of Object.entries(e.extraAttributes||{}))if(l===r)return c;const n=t.attribute_type;for(const c in $w)if(this.draco[c]===n)return $w[c];const o=e.attributeNameEntry||"name";return t.metadata[o]?t.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let n=0;n<r;n++){const o=this.metadataQuerier.GetEntryName(t,n);e[o]=this._getDracoMetadataField(t,o)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const n=T7(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,n=[...e,...r];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,n=t.attribute_type();if(r.map(o=>this.decoder[o]).includes(n)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(c=>o.min_value(c))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,n=t.attribute_type();if(r.map(o=>this.decoder[o]).includes(n)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function E7(i,t){switch(t){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function T7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}function C7(i){const t=i.size(),e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=i.GetValue(r);return e}const P7="1.5.5",yv="https://www.gstatic.com/draco/versioned/decoders/".concat(P7),I7="".concat(yv,"/draco_decoder.js"),L7="".concat(yv,"/draco_wasm_wrapper.js"),M7="".concat(yv,"/draco_decoder.wasm");let Vp;async function B7(i){const t=i.modules||{};return t.draco3d?Vp=Vp||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):Vp=Vp||R7(i),await Vp}async function R7(i){let t,e;switch(i.draco&&i.draco.decoderType){case"js":t=await Bu(I7,"draco",i);break;case"wasm":default:[t,e]=await Promise.all([await Bu(L7,"draco",i),await Bu(M7,"draco",i)])}return t=t||globalThis.DracoDecoderModule,await k7(t,e)}function k7(i,t){const e={};return t&&(e.wasmBinary=t),new Promise(r=>{i({...e,onModuleLoaded:n=>r({draco:n})})})}const VA={...v7,parse:F7};async function F7(i,t){const{draco:e}=await B7(t),r=new A7(e);try{return r.parseSync(i,t==null?void 0:t.draco)}finally{r.destroy()}}function D7(i){const t={};for(const e in i){const r=i[e];if(e!=="indices"){const n=qA(r);t[e]=n}}return t}function qA(i){const{buffer:t,size:e,count:r}=O7(i);return{value:t,size:e,byteOffset:0,count:r,type:zA(e),componentType:jA(t)}}function O7(i){let t=i,e=1,r=0;return i&&i.value&&(t=i.value,e=i.size||1),t&&(ArrayBuffer.isView(t)||(t=N7(t,Float32Array)),r=t.length/e),{buffer:t,size:e,count:r}}function N7(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new t(i):e&&!(i instanceof t)?new t(i):i:null}const zu="KHR_draco_mesh_compression",z7=zu;function j7(i,t,e){const r=new Wo(i);for(const n of HA(r))r.getObjectExtension(n,zu)}async function U7(i,t,e){var r;if(!(t!=null&&(r=t.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=new Wo(i),o=[];for(const c of HA(n))n.getObjectExtension(c,zu)&&o.push(V7(n,c,t,e));await Promise.all(o),n.removeExtension(zu)}function G7(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new Wo(i);for(const r of e.json.meshes||[])q7(r,t),e.addRequiredExtension(zu)}async function V7(i,t,e,r){const n=i.getObjectExtension(t,zu);if(!n)return;const o=i.getTypedArrayForBufferView(n.bufferView),c=w1(o.buffer,o.byteOffset),{parse:l}=r,_={...e};delete _["3d-tiles"];const v=await l(c,VA,_,r),S=D7(v.attributes);for(const[T,P]of Object.entries(S))if(T in t.attributes){const I=t.attributes[T],z=i.getAccessor(I);z!=null&&z.min&&z!==null&&z!==void 0&&z.max&&(P.min=z.min,P.max=z.max)}t.attributes=S,v.indices&&(t.indices=qA(v.indices)),H7(t)}function q7(i,t){var e;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const c=n.DracoWriter.encodeSync({attributes:i}),l=o==null||(e=o.parseSync)===null||e===void 0?void 0:e.call(o,{attributes:i}),_=n._addFauxAttributes(l.attributes),v=n.addBufferView(c);return{primitives:[{attributes:_,mode:r,extensions:{[zu]:{bufferView:v,attributes:_}}}]}}function H7(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*HA(i){for(const t of i.json.meshes||[])for(const e of t.primitives)yield e}const W7=Object.freeze(Object.defineProperty({__proto__:null,decode:U7,encode:G7,name:z7,preprocess:j7},Symbol.toStringTag,{value:"Module"})),X7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Z7={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},vv="KHR_texture_transform",$7=vv,Mm=new Kt,Y7=new Cn,J7=new Cn;async function K7(i,t){if(!new Wo(i).getExtension(vv))return;const e=i.json.materials||[];for(let r=0;r<e.length;r++)Q7(r,i)}function Q7(i,t){var e,r,n;const o=[],c=(e=t.json.materials)===null||e===void 0?void 0:e[i],l=c==null||(r=c.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;l&&qp(t,i,l,o);const _=c==null?void 0:c.emissiveTexture;_&&qp(t,i,_,o);const v=c==null?void 0:c.normalTexture;v&&qp(t,i,v,o);const S=c==null?void 0:c.occlusionTexture;S&&qp(t,i,S,o);const T=c==null||(n=c.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;T&&qp(t,i,T,o)}function qp(i,t,e,r){const n=t9(e,r);if(!n)return;const o=i.json.meshes||[];for(const c of o)for(const l of c.primitives){const _=l.material;Number.isFinite(_)&&t===_&&e9(i,l,n)}}function t9(i,t){var e;const r=(e=i.extensions)===null||e===void 0?void 0:e[vv],{texCoord:n=0}=i,{texCoord:o=n}=r;if(t.findIndex(c=>{let[l,_]=c;return l===n&&_===o})===-1){const c=n9(r);return n!==o&&(i.texCoord=o),t.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:c}}return null}function e9(i,t,e){const{originalTexCoord:r,texCoord:n,matrix:o}=e,c=t.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(c)){var l;const v=(l=i.json.accessors)===null||l===void 0?void 0:l[c];if(v&&v.bufferView){var _;const S=(_=i.json.bufferViews)===null||_===void 0?void 0:_[v.bufferView];if(S){const{arrayBuffer:T,byteOffset:P}=i.buffers[S.buffer],I=(P||0)+(v.byteOffset||0)+(S.byteOffset||0),{ArrayType:z,length:N}=gv(v,S),X=Z7[v.componentType],H=X7[v.type],Z=S.byteStride||X*H,ot=new Float32Array(N);for(let gt=0;gt<v.count;gt++){const Et=new z(T,I+gt*Z,2);Mm.set(Et[0],Et[1],1),Mm.transformByMatrix3(o),ot.set([Mm[0],Mm[1]],gt*H)}r===n?i9(v,S,i.buffers,ot):r9(n,v,t,i,ot)}}}}function i9(i,t,e,r){i.componentType=5126,e.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function r9(i,t,e,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes["TEXCOORD_".concat(i)]=c.length-1)}function n9(i){const{offset:t=[0,0],rotation:e=0,scale:r=[1,1]}=i,n=new Cn().set(1,0,0,0,1,0,t[0],t[1],1),o=Y7.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),c=J7.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(c)}const s9=Object.freeze(Object.defineProperty({__proto__:null,decode:K7,name:$7},Symbol.toStringTag,{value:"Module"})),Pu="KHR_lights_punctual",o9=Pu;async function a9(i){const t=new Wo(i),{json:e}=t,r=t.getExtension(Pu);r&&(t.json.lights=r.lights,t.removeExtension(Pu));for(const n of e.nodes||[]){const o=t.getObjectExtension(n,Pu);o&&(n.light=o.light),t.removeObjectExtension(n,Pu)}}async function l9(i){const t=new Wo(i),{json:e}=t;if(e.lights){const r=t.addExtension(Pu);ba(!r.lights),r.lights=e.lights,delete e.lights}if(t.json.lights){for(const r of t.json.lights){const n=r.node;t.addObjectExtension(n,Pu,r)}delete t.json.lights}}const c9=Object.freeze(Object.defineProperty({__proto__:null,decode:a9,encode:l9,name:o9},Symbol.toStringTag,{value:"Module"})),xf="KHR_materials_unlit",h9=xf;async function u9(i){const t=new Wo(i),{json:e}=t;for(const r of e.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),t.removeObjectExtension(r,xf);t.removeExtension(xf)}function d9(i){const t=new Wo(i),{json:e}=t;if(t.materials)for(const r of e.materials||[])r.unlit&&(delete r.unlit,t.addObjectExtension(r,xf,{}),t.addExtension(xf))}const p9=Object.freeze(Object.defineProperty({__proto__:null,decode:u9,encode:d9,name:h9},Symbol.toStringTag,{value:"Module"})),tf="KHR_techniques_webgl",f9=tf;async function m9(i){const t=new Wo(i),{json:e}=t,r=t.getExtension(tf);if(r){const n=_9(r,t);for(const o of e.materials||[]){const c=t.getObjectExtension(o,tf);c&&(o.technique=Object.assign({},c,n[c.technique]),o.technique.values=y9(o.technique,t)),t.removeObjectExtension(o,tf)}t.removeExtension(tf)}}async function g9(i,t){}function _9(i,t){const{programs:e=[],shaders:r=[],techniques:n=[]}=i,o=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=o.decode(t.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),n.forEach(c=>{c.program=e[c.program]}),n}function y9(i,t){const e=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in e)&&(e[r]=i.uniforms[r].value)}),Object.keys(e).forEach(r=>{typeof e[r]=="object"&&e[r].index!==void 0&&(e[r].texture=t.getTexture(e[r].index))}),e}const v9=Object.freeze(Object.defineProperty({__proto__:null,decode:m9,encode:g9,name:f9},Symbol.toStringTag,{value:"Module"})),WA="EXT_feature_metadata",b9=WA;async function x9(i){const t=new Wo(i);w9(t)}function w9(i){var t;const e=i.getExtension(WA),r=e==null||(t=e.schema)===null||t===void 0?void 0:t.classes,n=e==null?void 0:e.featureTables;if(e!=null&&e.featureTextures&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&n)for(const o in r){const c=r[o],l=E9(n,o);l&&S9(i,l,c)}}function S9(i,t,e){for(const n in e.properties){var r;const o=e.properties[n],c=t==null||(r=t.properties)===null||r===void 0?void 0:r[n],l=t.count;if(c){const _=A9(i,o,l,c);c.data=_}}}function A9(i,t,e,r){const n=r.bufferView;let o=i.getTypedArrayForBufferView(n);switch(t.type){case"STRING":{const c=r.stringOffsetBufferView,l=i.getTypedArrayForBufferView(c);o=T9(o,l,e);break}}return o}function E9(i,t){for(const e in i){const r=i[e];if(r.class===t)return r}return null}function T9(i,t,e){const r=[],n=new TextDecoder("utf8");let o=0;const c=4;for(let l=0;l<e;l++){const _=t[(l+1)*c]-t[l*c],v=i.subarray(o,_+o),S=n.decode(v);r.push(S),o+=_}return r}const C9=Object.freeze(Object.defineProperty({__proto__:null,decode:x9,name:b9},Symbol.toStringTag,{value:"Module"})),XA=[h7,p7,g7,W7,c9,p9,v9,s9,C9];function P9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=XA.filter(o=>ZA(o.name,t));for(const o of r){var n;(n=o.preprocess)===null||n===void 0||n.call(o,i,t,e)}}async function I9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const r=XA.filter(o=>ZA(o.name,t));for(const o of r){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,i,t,e))}}function ZA(i,t){var e;const r=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(i in r&&!r[i])}const C_="KHR_binary_glTF";function L9(i){const t=new Wo(i),{json:e}=t;for(const r of e.images||[]){const n=t.getObjectExtension(r,C_);n&&Object.assign(r,n),t.removeObjectExtension(r,C_)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(C_)}const Yw={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},M9={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class B9{constructor(){G(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),G(this,"json",void 0)}normalize(t,e){this.json=t.json;const r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),L9(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Yw)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const r=t[e];if(!(!r||Array.isArray(r))){t[e]=[];for(const n in r){const o=r[n];o.id=o.id||n;const c=t[e].length;t[e].push(o),this.idToIndexMap[e][n]=c}}}_convertObjectIdsToArrayIndices(t){for(const e in Yw)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:r,indices:n,material:o}=e;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");n&&(e.indices=this._convertIdToIndex(n,"accessor")),o&&(e.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);for(const r of t[e])for(const n in r){const o=r[n],c=this._convertIdToIndex(o,n);r[n]=c}}_convertIdToIndex(t,e){const r=M9[e];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return n}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const o of t.materials){var e,r,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const c=((e=o.values)===null||e===void 0?void 0:e.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),l=t.textures.findIndex(_=>_.id===c);l!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:l})}}}function R9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new B9().normalize(i,t)}const k9={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F9={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ha={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},D9={magFilter:Ha.TEXTURE_MAG_FILTER,minFilter:Ha.TEXTURE_MIN_FILTER,wrapS:Ha.TEXTURE_WRAP_S,wrapT:Ha.TEXTURE_WRAP_T},O9={[Ha.TEXTURE_MAG_FILTER]:Ha.LINEAR,[Ha.TEXTURE_MIN_FILTER]:Ha.NEAREST_MIPMAP_LINEAR,[Ha.TEXTURE_WRAP_S]:Ha.REPEAT,[Ha.TEXTURE_WRAP_T]:Ha.REPEAT};function N9(i){return F9[i]}function z9(i){return k9[i]}class j9{constructor(){G(this,"baseUri",""),G(this,"json",{}),G(this,"buffers",[]),G(this,"images",[])}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:n=[],images:o=[],baseUri:c=""}=t;return ba(r),this.baseUri=c,this.json=r,this.buffers=n,this.images=o,this._resolveTree(this.json,e),this.json}_resolveTree(t){t.bufferViews&&(t.bufferViews=t.bufferViews.map((e,r)=>this._resolveBufferView(e,r))),t.images&&(t.images=t.images.map((e,r)=>this._resolveImage(e,r))),t.samplers&&(t.samplers=t.samplers.map((e,r)=>this._resolveSampler(e,r))),t.textures&&(t.textures=t.textures.map((e,r)=>this._resolveTexture(e,r))),t.accessors&&(t.accessors=t.accessors.map((e,r)=>this._resolveAccessor(e,r))),t.materials&&(t.materials=t.materials.map((e,r)=>this._resolveMaterial(e,r))),t.meshes&&(t.meshes=t.meshes.map((e,r)=>this._resolveMesh(e,r))),t.nodes&&(t.nodes=t.nodes.map((e,r)=>this._resolveNode(e,r))),t.skins&&(t.skins=t.skins.map((e,r)=>this._resolveSkin(e,r))),t.scenes&&(t.scenes=t.scenes.map((e,r)=>this._resolveScene(e,r))),t.scene!==void 0&&(t.scene=t.scenes[this.json.scene])}getScene(t){return this._get("scenes",t)}getNode(t){return this._get("nodes",t)}getSkin(t){return this._get("skins",t)}getMesh(t){return this._get("meshes",t)}getMaterial(t){return this._get("materials",t)}getAccessor(t){return this._get("accessors",t)}getCamera(t){return null}getTexture(t){return this._get("textures",t)}getSampler(t){return this._get("samplers",t)}getImage(t){return this._get("images",t)}getBufferView(t){return this._get("bufferViews",t)}getBuffer(t){return this._get("buffers",t)}_get(t,e){if(typeof e=="object")return e;const r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}_resolveScene(t,e){return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map(r=>this.getNode(r)),t}_resolveNode(t,e){return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map(r=>this.getNode(r))),t.mesh!==void 0?t.mesh=this.getMesh(t.mesh):t.meshes!==void 0&&t.meshes.length&&(t.mesh=t.meshes.reduce((r,n)=>{const o=this.getMesh(n);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),t.camera!==void 0&&(t.camera=this.getCamera(t.camera)),t.skin!==void 0&&(t.skin=this.getSkin(t.skin)),t}_resolveSkin(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}_resolveMesh(t,e){return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map(r=>{r={...r};const n=r.attributes;r.attributes={};for(const o in n)r.attributes[o]=this.getAccessor(n[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),t}_resolveMaterial(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture={...t.normalTexture},t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture={...t.occlustionTexture},t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture={...t.emmisiveTexture},t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness={...t.pbrMetallicRoughness};const r=t.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return t}_resolveAccessor(t,e){if(t.id=t.id||"accessor-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=N9(t.componentType),t.components=z9(t.type),t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){const r=t.bufferView.buffer,{ArrayType:n,byteLength:o}=gv(t,t.bufferView),c=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+r.byteOffset;let l=r.arrayBuffer.slice(c,c+o);t.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(r,c,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new n(l)}return t}_getValueFromInterleavedBuffer(t,e,r,n,o){const c=new Uint8Array(o*n);for(let l=0;l<o;l++){const _=e+l*r;c.set(new Uint8Array(t.arrayBuffer.slice(_,_+n)),l*n)}return c.buffer}_resolveTexture(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):O9,t.source=this.getImage(t.source),t}_resolveSampler(t,e){t.id=t.id||"sampler-".concat(e),t.parameters={};for(const r in t){const n=this._enumSamplerParameter(r);n!==void 0&&(t.parameters[n]=t[r])}return t}_enumSamplerParameter(t){return D9[t]}_resolveImage(t,e){t.id=t.id||"image-".concat(e),t.bufferView!==void 0&&(t.bufferView=this.getBufferView(t.bufferView));const r=this.images[e];return r&&(t.image=r),t}_resolveBufferView(t,e){const r=t.buffer,n={id:"bufferView-".concat(e),...t,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let c=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(c+=t.byteOffset),n.data=new Uint8Array(o,c,t.byteLength),n}_resolveCamera(t,e){return t.id=t.id||"camera-".concat(e),t.perspective,t.orthographic,t}}function U9(i,t){return new j9().postProcess(i,t)}const Jw=1735152710,bv=12,Eg=8,G9=1313821514,V9=5130562,q9=0,H9=1,W9=0,Kd=!0;function X9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(t+0))).concat(String.fromCharCode(i.getUint8(t+1))).concat(String.fromCharCode(i.getUint8(t+2))).concat(String.fromCharCode(i.getUint8(t+3)))}function Z9(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:n=Jw}=e,o=r.getUint32(t,!1);return o===n||o===Jw}function $9(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t),n=X9(r,e+0),o=r.getUint32(e+4,Kd),c=r.getUint32(e+8,Kd);switch(Object.assign(i,{header:{byteOffset:e,byteLength:c,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),e+=bv,i.version){case 1:return Y9(i,r,e);case 2:return J9(i,r,e,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function Y9(i,t,e){Xr(i.header.byteLength>bv+Eg);const r=t.getUint32(e+0,Kd),n=t.getUint32(e+4,Kd);return e+=Eg,Xr(n===W9),zy(i,t,e,r),e+=r,e+=jy(i,t,e,i.header.byteLength),e}function J9(i,t,e,r){return Xr(i.header.byteLength>bv+Eg),K9(i,t,e,r),e+i.header.byteLength}function K9(i,t,e,r){for(;e+8<=i.header.byteLength;){const n=t.getUint32(e+0,Kd),o=t.getUint32(e+4,Kd);switch(e+=Eg,o){case G9:zy(i,t,e,n);break;case V9:jy(i,t,e,n);break;case q9:r.strict||zy(i,t,e,n);break;case H9:r.strict||jy(i,t,e,n);break}e+=Pf(n,4)}return e}function zy(i,t,e,r){const n=new Uint8Array(t.buffer,e,r),o=new TextDecoder("utf8").decode(n);return i.json=JSON.parse(o),Pf(r,4)}function jy(i,t,e,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:e,byteLength:r,arrayBuffer:t.buffer}),Pf(r,4)}async function Q9(i,t){var e,r,n,o;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0,_=arguments.length>4?arguments[4]:void 0;tj(i,t,c,l),R9(i,{normalize:l==null||(e=l.gltf)===null||e===void 0?void 0:e.normalize}),P9(i,l,_);const v=[];if(l!=null&&(r=l.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await ej(i,l,_),l!=null&&(n=l.gltf)!==null&&n!==void 0&&n.loadImages){const T=ij(i,l,_);v.push(T)}const S=I9(i,l,_);return v.push(S),await Promise.all(v),l!=null&&(o=l.gltf)!==null&&o!==void 0&&o.postProcess?U9(i,l):i}function tj(i,t,e,r){if(r.uri&&(i.baseUri=r.uri),t instanceof ArrayBuffer&&!Z9(t,e,r)&&(t=new TextDecoder().decode(t)),typeof t=="string")i.json=fI(t);else if(t instanceof ArrayBuffer){const c={};e=$9(c,t,e,r.glb),ba(c.type==="glTF","Invalid GLB magic string ".concat(c.type)),i._glb=c,i.json=c.json}else ba(!1,"GLTF: must be ArrayBuffer or string");const n=i.json.buffers||[];if(i.buffers=new Array(n.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:c}=i._glb;i.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function ej(i,t,e){const r=i.json.buffers||[];for(let c=0;c<r.length;++c){const l=r[c];if(l.uri){var n,o;const{fetch:_}=e;ba(_);const v=NA(l.uri,t),S=await(e==null||(n=e.fetch)===null||n===void 0?void 0:n.call(e,v)),T=await(S==null||(o=S.arrayBuffer)===null||o===void 0?void 0:o.call(S));i.buffers[c]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete l.uri}else i.buffers[c]===null&&(i.buffers[c]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function ij(i,t,e){const r=rj(i),n=i.json.images||[],o=[];for(const c of r)o.push(nj(i,n[c],c,t,e));return await Promise.all(o)}function rj(i){const t=new Set,e=i.json.textures||[];for(const r of e)r.source!==void 0&&t.add(r.source);return Array.from(t).sort()}async function nj(i,t,e,r,n){const{fetch:o,parse:c}=n;let l;if(t.uri&&!t.hasOwnProperty("bufferView")){const v=NA(t.uri,r);l=await(await o(v)).arrayBuffer(),t.bufferView={data:l}}if(Number.isFinite(t.bufferView)){const v=Vz(i.json,i.buffers,t.bufferView);l=w1(v.buffer,v.byteOffset,v.byteLength)}ba(l,"glTF image has no data");let _=await c(l,[Y3,Gz],{mimeType:t.mimeType,basis:r.basis||{format:OA()}},n);_&&_[0]&&(_={compressed:!0,mipmaps:!1,width:_[0].width,height:_[0].height,data:_[0]}),i.images=i.images||[],i.images[e]=_}const wf={name:"glTF",id:"gltf",module:"gltf",version:Ez,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:sj,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function sj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...wf.options,...t},t.gltf={...wf.options.gltf,...t.gltf};const{byteOffset:r=0}=t;return await Q9({},i,r,t,e)}async function oj(i){const t=[];return i.scenes.forEach(e=>{e.traverse(r=>{Object.values(r.model.getUniforms()).forEach(n=>{n.loaded===!1&&t.push(n)})})}),await aj(()=>t.some(e=>!e.loaded))}async function aj(i){for(;i();)await new Promise(t=>requestAnimationFrame(t))}const lj=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cj=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,$A=[255,255,255,255],hj={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:$A},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[wf]};class xv extends rp{constructor(){super(...arguments),G(this,"state",void 0)}getShaders(){const t=[iv,rv];return this.props._lighting==="pbr"&&t.push($1),super.getShaders({vs:lj,fs:cj,modules:t})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:$A,transition:!0},instanceModelMatrix:TA})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.scenegraph!==r.scenegraph?this._updateScenegraph():e._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}finalizeState(t){super.finalizeState(t),this._deleteScenegraph()}get isLoaded(){var t;return((t=this.state)===null||t===void 0?void 0:t.scenegraph)&&super.isLoaded}_updateScenegraph(){const t=this.props,{gl:e}=this.context;let r=null;if(t.scenegraph instanceof Od)r={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){const l=t.scenegraph,_=Az(e,l,this._getModelOptions());r={gltf:l,..._},oj(_).then(()=>this.setNeedsRedraw())}else t.scenegraph&&(hr.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=t.scenegraph);const n={layer:this,gl:e},o=t.getScene(r,n),c=t.getAnimator(r,n);o instanceof Od?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,c,t._animations),this.setState({scenegraph:o,animator:c})):o!==null&&hr.warn("invalid scenegraph:",o)()}_applyAllAttributes(t){if(this.state.attributesAvailable){const e=this.getAttributeManager().getAttributes();t.traverse(r=>{this._setModelAttributes(r.model,e)})}}_applyAnimationsProp(t,e,r){if(!t||!e||!r)return;const n=e.getAnimations();Object.keys(r).sort().forEach(o=>{const c=r[o];if(o==="*")n.forEach(l=>{Object.assign(l,c)});else if(Number.isFinite(Number(o))){const l=Number(o);l>=0&&l<n.length?Object.assign(n[l],c):hr.warn("animation ".concat(o," not found"))()}else{const l=n.find(_=>{let{name:v}=_;return v===o});l?Object.assign(l,c):hr.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:t}=this.state;t instanceof Od&&t.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let e=null;return t&&(typeof t=="function"?e=t({gl:this.context.gl,layer:this}):e=t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:{isInstanced:!0,transpileToGLSL100:!tr(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(t){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(e=>{this._setModelAttributes(e.model,t)})}draw(t){let{moduleParameters:e=null,parameters:r={},context:n}=t;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:c,sizeMinPixels:l,sizeMaxPixels:_,opacity:v,coordinateSystem:S}=this.props,T=this.getNumInstances();this.state.scenegraph.traverse((P,I)=>{let{worldMatrix:z}=I;P.model.setInstanceCount(T),P.updateModuleSettings(e),P.draw({parameters:r,uniforms:{sizeScale:c,opacity:v,sizeMinPixels:l,sizeMaxPixels:_,composeModelMatrix:CA(o,S),sceneModelMatrix:z,u_Camera:P.model.getUniforms().project_uCameraPosition}})})}}G(xv,"defaultProps",hj);G(xv,"layerName","ScenegraphLayer");const uj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function pj(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const fj={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class wv extends mv{getShaders(){const t=super.getShaders();return t.modules.push($1),{...t,vs:uj,fs:dj}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const e=this.getAttributeManager();t&&e.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:e,oldProps:r}=t;e.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}draw(t){const{featureIds:e}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!e}),super.draw(t))}getModel(t){const{id:e,pbrMaterial:r}=this.props,n=this.parseMaterial(r,t);this.setState({materialParser:n});const o=this.getShaders();return pj(t.attributes),new $d(this.context.gl,{...this.getShaders(),id:e,geometry:t,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:t.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:e}=this.state;if(e){const{mesh:r}=this.props,n=this.parseMaterial(t,r);this.setState({materialParser:n}),e.setUniforms(n.uniforms)}}parseMaterial(t,e){var r;const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new kA(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:{unlit:n,...t},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const e=this.props.featureIds,r=new Uint8ClampedArray(e.length*t.size),n=[];for(let o=0;o<e.length;o++)this.encodePickingColor(e[o],n),r[o*3]=n[0],r[o*3+1]=n[1],r[o*3+2]=n[2];t.value=r}finalizeState(t){var e;super.finalizeState(t),(e=this.state.materialParser)===null||e===void 0||e.delete(),this.setState({materialParser:null})}}G(wv,"layerName","MeshLayer");G(wv,"defaultProps",fj);const mj=6378137,gj=6378137,_j=6356752314245179e-9;function Ug(i){return i}new Kt;function yj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ug;return"longitude"in i?(t[0]=e(i.longitude),t[1]=e(i.latitude),t[2]=i.height):"x"in i?(t[0]=e(i.x),t[1]=e(i.y),t[2]=i.z):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function vj(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return yj(i,t,ss._cartographicRadians?Ug:mR)}function bj(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ug;return"longitude"in t?(t.longitude=e(i[0]),t.latitude=e(i[1]),t.height=i[2]):"x"in t?(t.x=e(i[0]),t.y=e(i[1]),t.z=i[2]):(t[0]=e(i[0]),t[1]=e(i[1]),t[2]=i[2]),t}function xj(i,t){return bj(i,t,ss._cartographicRadians?Ug:gR)}const bd=new Kt,wj=new Kt,Sj=new Kt;function Aj(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:o}=t;bd.from(i);const c=bd.x,l=bd.y,_=bd.z,v=r.x,S=r.y,T=r.z,P=c*c*v*v,I=l*l*S*S,z=_*_*T*T,N=P+I+z,X=Math.sqrt(1/N);if(!Number.isFinite(X))return;const H=wj;if(H.copy(i).scale(X),N<o)return H.to(e);const Z=n.x,ot=n.y,gt=n.z,Et=Sj;Et.set(H.x*Z*2,H.y*ot*2,H.z*gt*2);let Ft=(1-X)*bd.len()/(.5*Et.len()),Mt=0,yt,Ut,zt,at;do{Ft-=Mt,yt=1/(1+Ft*Z),Ut=1/(1+Ft*ot),zt=1/(1+Ft*gt);const pt=yt*yt,Lt=Ut*Ut,bt=zt*zt,ee=pt*yt,ie=Lt*Ut,re=bt*zt;at=P*pt+I*Lt+z*bt-1;const Yt=-2*(P*ee*Z+I*ie*ot+z*re*gt);Mt=at/Yt}while(Math.abs(at)>yf.EPSILON12);return bd.scale([yt,Ut,zt]).to(e)}const Kw=1e-14,Ej=new Kt,Qw={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},P_={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Hp={east:new Kt,north:new Kt,up:new Kt,west:new Kt,south:new Kt,down:new Kt},Tj=new Kt,Cj=new Kt,Pj=new Kt;function t5(i,t,e,r,n,o){const c=Qw[t]&&Qw[t][e];bl(c&&(!r||r===c));let l,_,v;const S=Ej.copy(n);if(Al(S.x,0,Kw)&&Al(S.y,0,Kw)){const T=Math.sign(S.z);l=Tj.fromArray(P_[t]),t!=="east"&&t!=="west"&&l.scale(T),_=Cj.fromArray(P_[e]),e!=="east"&&e!=="west"&&_.scale(T),v=Pj.fromArray(P_[r]),r!=="east"&&r!=="west"&&v.scale(T)}else{const{up:T,east:P,north:I}=Hp;P.set(-S.y,S.x,0).normalize(),i.geodeticSurfaceNormal(S,T),I.copy(T).cross(P);const{down:z,west:N,south:X}=Hp;z.copy(T).scale(-1),N.copy(P).scale(-1),X.copy(I).scale(-1),l=Hp[t],_=Hp[e],v=Hp[r]}return o[0]=l.x,o[1]=l.y,o[2]=l.z,o[3]=0,o[4]=_.x,o[5]=_.y,o[6]=_.z,o[7]=0,o[8]=v.x,o[9]=v.y,o[10]=v.z,o[11]=0,o[12]=S.x,o[13]=S.y,o[14]=S.z,o[15]=1,o}const Bm=new Kt,e5=new Kt,Ij=new Kt,fl=new Kt,Lj=new Kt,Rm=new Kt;class gn{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;G(this,"radii",void 0),G(this,"radiiSquared",void 0),G(this,"radiiToTheFourth",void 0),G(this,"oneOverRadii",void 0),G(this,"oneOverRadiiSquared",void 0),G(this,"minimumRadius",void 0),G(this,"maximumRadius",void 0),G(this,"centerToleranceSquared",yf.EPSILON1),G(this,"squaredXOverSquaredZ",void 0),bl(t>=0),bl(e>=0),bl(r>=0),this.radii=new Kt(t,e,r),this.radiiSquared=new Kt(t*t,e*e,r*r),this.radiiToTheFourth=new Kt(t*t*t*t,e*e*e*e,r*r*r*r),this.oneOverRadii=new Kt(t===0?0:1/t,e===0?0:1/e,r===0?0:1/r),this.oneOverRadiiSquared=new Kt(t===0?0:1/(t*t),e===0?0:1/(e*e),r===0?0:1/(r*r)),this.minimumRadius=Math.min(t,e,r),this.maximumRadius=Math.max(t,e,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=e5,n=Ij,[,,o]=t;this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);const c=Math.sqrt(r.dot(n));return n.scale(1/c),r.scale(o),n.add(r),n.to(e)}cartesianToCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];Rm.from(t);const r=this.scaleToGeodeticSurface(Rm,fl);if(!r)return;const n=this.geodeticSurfaceNormal(r,e5),o=Lj;o.copy(Rm).subtract(r);const c=Math.atan2(n.y,n.x),l=Math.asin(n.z),_=Math.sign(q1(o,Rm))*BS(o);return xj([c,l,_],e)}eastNorthUpToFixedFrame(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ar;return t5(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new ar;return t5(this,t,e,r,n,o)}geocentricSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Bm.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=vj(t),n=r[0],o=r[1],c=Math.cos(o);return Bm.set(c*Math.cos(n),c*Math.sin(n),Math.sin(o)).normalize(),Bm.to(e)}geodeticSurfaceNormal(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return Bm.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return Aj(t,this,e)}scaleToGeocentricSurface(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];fl.from(t);const r=fl.x,n=fl.y,o=fl.z,c=this.oneOverRadiiSquared,l=1/Math.sqrt(r*r*c.x+n*n*c.y+o*o*c.z);return fl.multiplyScalar(l).to(e)}transformPositionToScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return fl.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return fl.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];bl(Al(this.radii.x,this.radii.y,yf.EPSILON15)),bl(this.radii.z>0),fl.from(t);const n=fl.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return fl.set(0,0,n).to(r)}}G(gn,"WGS84",new gn(mj,gj,_j));class Mj{constructor(t,e,r){G(this,"item",void 0),G(this,"previous",void 0),G(this,"next",void 0),this.item=t,this.previous=e,this.next=r}}class Bj{constructor(){G(this,"head",null),G(this,"tail",null),G(this,"_length",0)}get length(){return this._length}add(t){const e=new Mj(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}class Rj{constructor(){G(this,"_list",void 0),G(this,"_sentinel",void 0),G(this,"_trimTiles",void 0),this._list=new Bj,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,r){e._cacheNode||(e._cacheNode=this._list.add(e),r&&r(t,e))}unloadTile(t,e,r){const n=e._cacheNode;n&&(this._list.remove(n),e._cacheNode=null,r&&r(t,e))}unloadTiles(t,e){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,o=t.maximumMemoryUsage*1024*1024,c=this._sentinel;let l=n.head;for(;l!==c&&(t.gpuMemoryUsageInBytes>o||r);){const _=l.item;l=l.next,this.unloadTile(t,_,e)}}trim(){this._trimTiles=!0}}function kj(i,t){Xr(i),Xr(t);const{rtcCenter:e,gltfUpAxis:r}=t,{computedTransform:n,boundingVolume:{center:o}}=i;let c=new ar(n);switch(e&&c.translate(e),r){case"Z":break;case"Y":const S=new ar().rotateX(Math.PI/2);c=c.multiplyRight(S);break;case"X":const T=new ar().rotateY(-Math.PI/2);c=c.multiplyRight(T);break}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new Kt(o);t.cartesianModelMatrix=c,t.cartesianOrigin=l;const _=gn.WGS84.cartesianToCartographic(l,new Kt),v=gn.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=v.multiplyRight(c),t.cartographicOrigin=_,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const i5=new Kt,I_=new Kt,Uy=new Xa([new vl,new vl,new vl,new vl,new vl,new vl]);function Fj(i,t){const{cameraDirection:e,cameraUp:r,height:n}=i,{metersPerUnit:o}=i.distanceScales,c=Ym(i,i.center),l=gn.WGS84.eastNorthUpToFixedFrame(c),_=i.unprojectPosition(i.cameraPosition),v=gn.WGS84.cartographicToCartesian(_,new Kt),S=new Kt(l.transformAsVector(new Kt(e).scale(o))).normalize(),T=new Kt(l.transformAsVector(new Kt(r).scale(o))).normalize();Oj(i);const P=i.constructor,{longitude:I,latitude:z,width:N,bearing:X,zoom:H}=i,Z=new P({longitude:I,latitude:z,height:n,width:N,bearing:X,zoom:H,pitch:0});return{camera:{position:v,direction:S,up:T},viewport:i,topDownViewport:Z,height:n,cullingVolume:Uy,frameNumber:t,sseDenominator:1.15}}function Dj(i,t,e){if(e===0||i.length<=e)return[i,[]];const r=[],{longitude:n,latitude:o}=t.viewport;for(const[v,S]of i.entries()){const[T,P]=S.header.mbs,I=Math.abs(n-T),z=Math.abs(o-P),N=Math.sqrt(z*z+I*I);r.push([v,N])}const c=r.sort((v,S)=>v[1]-S[1]),l=[];for(let v=0;v<e;v++)l.push(i[c[v][0]]);const _=[];for(let v=e;v<c.length;v++)_.push(i[c[v][0]]);return[l,_]}function Oj(i){const t=i.getFrustumPlanes(),e=r5(t.near,i.cameraPosition),r=Ym(i,e),n=Ym(i,i.cameraPosition,I_);let o=0;Uy.planes[o++].fromPointNormal(r,i5.copy(r).subtract(n));for(const c in t){if(c==="near")continue;const l=t[c],_=r5(l,e,I_),v=Ym(i,_,I_);Uy.planes[o++].fromPointNormal(v,i5.copy(r).subtract(v))}}function r5(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Kt;const r=i.normal.dot(t);return e.copy(i.normal).scale(i.distance-r).add(t),e}function Ym(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Kt;const r=i.unprojectPosition(t);return gn.WGS84.cartographicToCartesian(r,e)}const Nj=6378137,zj=6378137,Gy=6356752314245179e-9,n5=new Kt;function jj(i,t){if(i instanceof Uf){const{halfAxes:e}=i,r=Gj(e);return Math.log2(Gy/(r+t[2]))}else if(i instanceof jf){const{radius:e}=i;return Math.log2(Gy/(e+t[2]))}else if(i.width&&i.height){const{width:e,height:r}=i,n=Math.log2(Nj/e),o=Math.log2(zj/r);return(n+o)/2}return 1}function YA(i,t,e){const r=gn.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new Kt),n=Math.sqrt(Math.pow(r[0]-e[0],2)+Math.pow(r[1]-e[1],2)+Math.pow(r[2]-e[2],2));return Math.log2(Gy/(n+t[2]))}function Uj(i,t,e){const[r,n,o,c]=i;return YA({xmin:r,xmax:o,ymin:n,ymax:c,zmin:0,zmax:0},t,e)}function Gj(i){i.getColumn(0,n5);const t=i.getColumn(1),e=i.getColumn(2);return n5.add(t).add(e).len()}const ga={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},rh={ADD:1,REPLACE:2},Nd={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},qa={I3S:"I3S",TILES3D:"TILES3D"},Gg={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},Vj={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function JA(i){return i!=null}const eo=new Kt,Jm=new Kt,qj=new Kt,Hj=new Kt;function L_(i,t,e){if(Xr(i,"3D Tile: boundingVolume must be defined"),i.box)return Xj(i.box,t,e);if(i.region){const[r,n,o,c,l,_]=i.region,v=gn.WGS84.cartographicToCartesian([Qc(r),Qc(c),l],qj),S=gn.WGS84.cartographicToCartesian([Qc(o),Qc(n),_],Hj),T=new Kt().addVectors(v,S).multiplyScalar(.5),P=new Kt().subVectors(v,S).len()/2;return s5([T[0],T[1],T[2],P],new ar)}if(i.sphere)return s5(i.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Wj(i,t){if(i.box)return Zj(t);if(i.region){const[e,r,n,o,c,l]=i.region;return[[Qc(e),Qc(r),c],[Qc(n),Qc(o),l]]}if(i.sphere)return $j(t);throw new Error("Unkown boundingVolume type")}function Xj(i,t,e){const r=new Kt(i[0],i[1],i[2]);t.transform(r,r);let n=[];if(i.length===10){const v=i.slice(3,6),S=new _f;S.fromArray(i,6);const T=new Kt([1,0,0]),P=new Kt([0,1,0]),I=new Kt([0,0,1]);T.transformByQuaternion(S),T.scale(v[0]),P.transformByQuaternion(S),P.scale(v[1]),I.transformByQuaternion(S),I.scale(v[2]),n=[...T.toArray(),...P.toArray(),...I.toArray()]}else n=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=t.transformAsVector(n.slice(0,3)),c=t.transformAsVector(n.slice(3,6)),l=t.transformAsVector(n.slice(6,9)),_=new Cn([o[0],o[1],o[2],c[0],c[1],c[2],l[0],l[1],l[2]]);return JA(e)?(e.center=r,e.halfAxes=_,e):new Uf(r,_)}function s5(i,t,e){const r=new Kt(i[0],i[1],i[2]);t.transform(r,r);const n=t.getScale(Jm),o=Math.max(Math.max(n[0],n[1]),n[2]),c=i[3]*o;return JA(e)?(e.center=r,e.radius=c,e):new jf(r,c)}function Zj(i){const t=KA(),{halfAxes:e}=i,r=new Kt(e.getColumn(0)),n=new Kt(e.getColumn(1)),o=new Kt(e.getColumn(2));for(let c=0;c<2;c++){for(let l=0;l<2;l++){for(let _=0;_<2;_++)eo.copy(i.center),eo.add(r),eo.add(n),eo.add(o),QA(t,eo),o.negate();n.negate()}r.negate()}return t}function $j(i){const t=KA(),{center:e,radius:r}=i,n=gn.WGS84.scaleToGeodeticSurface(e,eo);let o;n?o=gn.WGS84.geodeticSurfaceNormal(n):o=new Kt(0,0,1);let c=new Kt(o[2],-o[1],0);c.len()>0?c.normalize():c=new Kt(0,1,0);const l=c.clone().cross(o);for(const _ of[c,l,o]){Jm.copy(_).scale(r);for(let v=0;v<2;v++)eo.copy(e),eo.add(Jm),QA(t,eo),Jm.negate()}return t}function KA(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function QA(i,t){gn.WGS84.cartesianToCartographic(t,eo),i[0][0]=Math.min(i[0][0],eo[0]),i[0][1]=Math.min(i[0][1],eo[1]),i[0][2]=Math.min(i[0][2],eo[2]),i[1][0]=Math.max(i[1][0],eo[0]),i[1][1]=Math.max(i[1][1],eo[1]),i[1][2]=Math.max(i[1][2],eo[2])}new Kt;new Kt;new ar;new Kt;new Kt;new Kt;function Yj(i,t){const e=i*t;return 1-Math.exp(-(e*e))}function Jj(i,t){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const e=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return Yj(t,e)*r}return 0}function Kj(i,t,e){const r=i.tileset,n=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=e?n:i.lodMetricValue;if(o===0)return 0;const c=Math.max(i._distanceToCamera,1e-7),{height:l,sseDenominator:_}=t,{viewDistanceScale:v}=r.options;let S=o*l*(v||1)/(c*_);return S-=Jj(r,c),S}const M_=new Kt,o5=new Kt,Fh=new Kt,a5=new Kt,Qj=new Kt,B_=new ar,l5=new ar;function tU(i,t){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const e=2*tE(i,t);return e<2?"OUT":!i.header.children||e<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function tE(i,t){const{topDownViewport:e}=t,r=i.header.mbs[1],n=i.header.mbs[0],o=i.header.mbs[2],c=i.header.mbs[3],l=[...i.boundingVolume.center],_=e.unprojectPosition(e.cameraPosition);gn.WGS84.cartographicToCartesian(_,M_),o5.copy(M_).subtract(l).normalize(),gn.WGS84.eastNorthUpToFixedFrame(l,B_),l5.copy(B_).invert(),Fh.copy(M_).transform(l5);const v=Math.sqrt(Fh[0]*Fh[0]+Fh[1]*Fh[1]),S=v*v/Fh[2];a5.copy([Fh[0],Fh[1],S]);const T=a5.transform(B_).subtract(l).normalize(),P=o5.cross(T).normalize().scale(c).add(l),I=gn.WGS84.cartesianToCartographic(P),z=e.project([n,r,o]),N=e.project(I);return Qj.copy(z).subtract(N).magnitude()}function eU(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class c5{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;G(this,"_map",new Map),G(this,"_array",void 0),G(this,"_length",void 0),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return Xr(t<this._array.length),this._array[t]}set(t,e){Xr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){Xr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){Xr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const iU={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Vg{traversalFinished(t){return!0}constructor(t){G(this,"options",void 0),G(this,"root",null),G(this,"selectedTiles",{}),G(this,"requestedTiles",{}),G(this,"emptyTiles",{}),G(this,"lastUpdate",new Date().getTime()),G(this,"updateDebounceTime",1e3),G(this,"_traversalStack",new c5),G(this,"_emptyTraversalStack",new c5),G(this,"_frameNumber",null),this.options={...iU,...t}}traverse(t,e,r){this.root=t,this.options={...this.options,...r},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){const o=r.pop();let c=!1;this.canTraverse(o,e)&&(this.updateChildTiles(o,e),c=this.updateAndPushChildren(o,e,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const l=o.parent,_=!!(!l||l._shouldRefine),v=!c;o.hasRenderContent?o.refine===rh.ADD?(this.loadTile(o,e),this.selectTile(o,e)):o.refine===rh.REPLACE&&(this.loadTile(o,e),v&&this.selectTile(o,e)):(this.emptyTiles[o.id]=o,this.loadTile(o,e),v&&this.selectTile(o,e)),this.touchTile(o,e),o._shouldRefine=c&&_}const n=new Date().getTime();(this.traversalFinished(e)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const r=t.children;for(const n of r)this.updateTile(n,e)}updateAndPushChildren(t,e,r,n){const{loadSiblings:o,skipLevelOfDetail:c}=this.options,l=t.children;l.sort(this.compareDistanceToCamera.bind(this));const _=t.refine===rh.REPLACE&&t.hasRenderContent&&!c;let v=!1,S=!0;for(const T of l)if(T._selectionDepth=n,T.isVisibleAndInRequestVolume?(r.find(T)&&r.delete(T),r.push(T),v=!0):(_||o)&&(this.loadTile(T,e),this.touchTile(T,e)),_){let P;if(T._inRequestVolume?T.hasRenderContent?P=T.contentAvailable:P=this.executeEmptyTraversal(T,e):P=!1,S=S&&P,!S)return!1}return v||(S=!1),S}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!n&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,e,r):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(t,e){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===e.viewport.id&&r.push(n);else r.push(e.viewport.id);t.updateVisibility(e,r)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let r=!1;for(const n of t.children)n.updateVisibility(e),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(t,e){let r=!0;const n=this._emptyTraversalStack;for(n.push(t);n.length>0&&r;){const o=n.pop();if(this.updateTile(o,e),o.isVisibleAndInRequestVolume||this.loadTile(o,e),this.touchTile(o,e),!o.hasRenderContent&&this.canTraverse(o,e,!1,!0)){const c=o.children;for(const l of c)n.find(l)&&n.delete(l),n.push(l)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const h5=new Kt;function rU(i){return i!=null}class Vy{constructor(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";G(this,"tileset",void 0),G(this,"header",void 0),G(this,"id",void 0),G(this,"url",void 0),G(this,"parent",void 0),G(this,"refine",void 0),G(this,"type",void 0),G(this,"contentUrl",void 0),G(this,"lodMetricType","geometricError"),G(this,"lodMetricValue",0),G(this,"boundingVolume",null),G(this,"content",null),G(this,"contentState",ga.UNLOADED),G(this,"gpuMemoryUsageInBytes",0),G(this,"children",[]),G(this,"depth",0),G(this,"viewportIds",[]),G(this,"transform",new ar),G(this,"extensions",null),G(this,"implicitTiling",null),G(this,"userData",{}),G(this,"computedTransform",void 0),G(this,"hasEmptyContent",!1),G(this,"hasTilesetContent",!1),G(this,"traverser",new Vg({})),G(this,"_cacheNode",null),G(this,"_frameNumber",null),G(this,"_expireDate",null),G(this,"_expiredContent",null),G(this,"_boundingBox",void 0),G(this,"_distanceToCamera",0),G(this,"_screenSpaceError",0),G(this,"_visibilityPlaneMask",void 0),G(this,"_visible",void 0),G(this,"_contentBoundingVolume",void 0),G(this,"_viewerRequestVolume",void 0),G(this,"_initialTransform",new ar),G(this,"_priority",0),G(this,"_selectedFrame",0),G(this,"_requestedFrame",0),G(this,"_selectionDepth",0),G(this,"_touchedFrame",0),G(this,"_centerZDepth",0),G(this,"_shouldRefine",!1),G(this,"_stackLength",0),G(this,"_visitedFrame",0),G(this,"_inRequestVolume",!1),G(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=n||e.id,this.url=e.url,this.parent=r,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ga.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ga.UNLOADED}get contentExpired(){return this.contentState===ga.EXPIRED}get contentFailed(){return this.contentState===ga.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Wj(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case qa.I3S:return tE(this,t);case qa.TILES3D:return Kj(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,r=this.refine===rh.ADD||e;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ga.UNLOADED)return-1;const n=this.parent,o=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=t.root?t.root._screenSpaceError:0;return Math.max(c-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ga.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ga.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,n={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Hh(e,r,n),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ga.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=ga.FAILED,e}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ga.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Xa.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Xa.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:r}=t,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:e}=t;const r=this.boundingVolume;return h5.subVectors(r.center,e.position),e.direction.dot(h5)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(rU(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=ga.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ar(t.transform):new ar;const e=this.parent,r=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new ar(n).multiplyRight(this.transform);const o=e&&e._initialTransform?e._initialTransform.clone():new ar;this._initialTransform=new ar(o).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ga.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Xa.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||rh.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=L_(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=L_(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=L_(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new ar).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return eU(this.tileset.tileset)}}}class nU extends Vg{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const r=t.children.length>0;if(t.hasTilesetContent&&r){const c=t.children[0];this.updateTileVisibility(c,e),t._visible=c._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const n=t.refine===rh.REPLACE,o=t._optimChildrenWithinParent===Vj.USE_OPTIMIZATION;if(n&&o&&r&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:r}=t;return!r||r.hasTilesetContent||r.refine!==rh.ADD?!1:!this.shouldRefine(t,e,!0)}}class sU{constructor(){G(this,"frameNumberMap",new Map)}register(t,e){const r=this.frameNumberMap.get(t)||new Map,n=r.get(e)||0;r.set(e,n+1),this.frameNumberMap.set(t,r)}deregister(t,e){const r=this.frameNumberMap.get(t);if(!r)return;const n=r.get(e)||1;r.set(e,n-1)}isZero(t,e){var r;return(((r=this.frameNumberMap.get(t))===null||r===void 0?void 0:r.get(e))||0)===0}}const R_={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class oU{constructor(){G(this,"_statusMap",void 0),G(this,"pendingTilesRegister",new sU),this._statusMap={}}add(t,e,r,n){if(!this._statusMap[e]){const{frameNumber:o,viewport:{id:c}}=n;this._statusMap[e]={request:t,callback:r,key:e,frameState:n,status:R_.REQUESTED},this.pendingTilesRegister.register(c,o),t().then(l=>{this._statusMap[e].status=R_.COMPLETED;const{frameNumber:_,viewport:{id:v}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(v,_),this._statusMap[e].callback(l,n)}).catch(l=>{this._statusMap[e].status=R_.ERROR;const{frameNumber:_,viewport:{id:v}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(v,_),r(l)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:o,viewport:{id:c}}=e;this.pendingTilesRegister.register(c,o),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class aU extends Vg{constructor(t){super(t),G(this,"_tileManager",void 0),this._tileManager=new oU}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=tU(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const r=t.header.children||[],n=t.children,o=t.tileset;for(const c of r){const l="".concat(c.id,"-").concat(e.viewport.id),_=n&&n.find(v=>v.id===l);if(_)_&&this.updateTile(_,e);else{let v=()=>this._loadTile(c.id,o);this._tileManager.find(l)?this._tileManager.update(l,e):(o.tileset.nodePages&&(v=()=>o.tileset.nodePagesTile.formTileFromNodePages(c.id)),this._tileManager.add(v,l,S=>this._onTileLoad(S,t,l),e))}}return!1}async _loadTile(t,e){const{loader:r}=e,n=e.getTileUrl("".concat(e.url,"/nodes/").concat(t)),o={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await Hh(n,r,o)}_onTileLoad(t,e,r){const n=new Vy(e.tileset,t,e,r);e.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const lU={description:"",ellipsoid:gn.WGS84,modelMatrix:new ar,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},km="Tiles In Tileset(s)",k_="Tiles In Memory",u5="Tiles In View",d5="Tiles To Render",p5="Tiles Loaded",F_="Tiles Loading",f5="Tiles Unloaded",m5="Failed Tile Loads",g5="Points/Vertices",D_="Tile Memory Use";class cU{constructor(t,e){G(this,"options",void 0),G(this,"loadOptions",void 0),G(this,"type",void 0),G(this,"tileset",void 0),G(this,"loader",void 0),G(this,"url",void 0),G(this,"basePath",void 0),G(this,"modelMatrix",void 0),G(this,"ellipsoid",void 0),G(this,"lodMetricType",void 0),G(this,"lodMetricValue",void 0),G(this,"refine",void 0),G(this,"root",null),G(this,"roots",{}),G(this,"asset",{}),G(this,"description",""),G(this,"properties",void 0),G(this,"extras",null),G(this,"attributions",{}),G(this,"credits",{}),G(this,"stats",void 0),G(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),G(this,"cartographicCenter",null),G(this,"cartesianCenter",null),G(this,"zoom",1),G(this,"boundingVolume",null),G(this,"dynamicScreenSpaceErrorComputedDensity",0),G(this,"maximumMemoryUsage",32),G(this,"gpuMemoryUsageInBytes",0),G(this,"_frameNumber",0),G(this,"_queryParams",{}),G(this,"_extensionsUsed",[]),G(this,"_tiles",{}),G(this,"_pendingCount",0),G(this,"selectedTiles",[]),G(this,"traverseCounter",0),G(this,"geometricError",0),G(this,"lastUpdatedVieports",null),G(this,"_requestedTiles",[]),G(this,"_emptyTiles",[]),G(this,"frameStateData",{}),G(this,"_traverser",void 0),G(this,"_cache",new Rj),G(this,"_requestScheduler",void 0),G(this,"updatePromise",null),G(this,"tilesetInitializationPromise",void 0),this.options={...lU,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||S1(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new EI({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new If({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}setOptions(t){this.options={...this.options,...t}}getTileUrl(t){return t.startsWith("data:")?t:"".concat(t).concat(t.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const r=[];for(const n of e){const o=n.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const n of e){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const c=Fj(n,this._frameNumber);this._traverser.traverse(this.roots[o],c,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[e],n=Object.values(this._traverser.selectedTiles),[o,c]=Dj(n,t,this.options.maximumTilesSelected);r.selectedTiles=o;for(const l of c)l.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const r=new Set(t.map(c=>c.id)),n=new Set(e.map(c=>c.id));let o=t.filter(c=>!n.has(c.id)).length>0;return o=o||e.filter(c=>!r.has(c.id)).length>0,o}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(t++,r.content.pointCount?e+=r.content.pointCount:e+=r.content.vertexCount);this.stats.get(u5).count=this.selectedTiles.length,this.stats.get(d5).count=t,this.stats.get(g5).count=e}async _initializeTileSet(t){this.type===qa.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===qa.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===qa.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:n,xmax:o,ymin:c,ymax:l,zmin:_,zmax:v}=e;this.cartographicCenter=new Kt(n+(o-n)/2,c+(l-c)/2,_+(v-_)/2),this.cartesianCenter=gn.WGS84.cartographicToCartesian(this.cartographicCenter,new Kt),this.zoom=YA(e,this.cartographicCenter,this.cartesianCenter);return}const r=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(r){const[n,o,c,l]=r;this.cartographicCenter=new Kt(n+(c-n)/2,o+(l-o)/2,0),this.cartesianCenter=gn.WGS84.cartographicToCartesian(this.cartographicCenter,new Kt),this.zoom=Uj(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Kt,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Kt,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?this.cartographicCenter=gn.WGS84.cartesianToCartographic(e,new Kt):this.cartographicCenter=new Kt(0,0,-gn.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=jj(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(km),this.stats.get(F_),this.stats.get(k_),this.stats.get(u5),this.stats.get(d5),this.stats.get(p5),this.stats.get(f5),this.stats.get(m5),this.stats.get(g5),this.stats.get(D_,"memory")}_initializeTileHeaders(t,e){const r=new Vy(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===qa.TILES3D){const o=[];for(o.push(r);o.length>0;){const c=o.pop();this.stats.get(km).incrementCount();const l=c.header.children||[];for(const _ of l){var n;const v=new Vy(this,_,c);if((n=v.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const S=new URL(v.contentUrl).searchParams.get("session");S&&(this._queryParams.session=S)}c.children.push(v),v.depth=c.depth+1,o.push(v)}}}return r}_initializeTraverser(){let t;switch(this.type){case qa.TILES3D:t=nU;break;case qa.I3S:t=aU;break;default:t=Vg}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(r){this._onTileLoadError(t,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(m5).incrementCount();const r=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,n)}_onTileLoad(t,e){if(e){if(this.type===qa.I3S){var r,n;const o=((r=this.tileset)===null||r===void 0||(n=r.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(km).reset(),this.stats.get(km).addCount(o)}t&&t.content&&kj(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===qa.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===qa.TILES3D){var e;const{extensionsRemoved:r=[]}=((e=t.content)===null||e===void 0?void 0:e.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(F_).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(F_).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(p5).incrementCount(),this.stats.get(k_).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(D_).count=this.gpuMemoryUsageInBytes}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(k_).decrementCount(),this.stats.get(f5).incrementCount(),this.stats.get(D_).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const r of e.children)t.push(r);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,r=[];for(r.push(e);r.length>0;){t=r.pop();for(const n of t.children)r.push(n);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),r=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const eE="3.4.15",Wp={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function iE(i,t,e){Xr(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(i,t,e);return r.decode(n)}function hU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(i);return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}const uU={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Hn={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},dr={...uU,...Hn},O_={[Hn.DOUBLE]:Float64Array,[Hn.FLOAT]:Float32Array,[Hn.UNSIGNED_SHORT]:Uint16Array,[Hn.UNSIGNED_INT]:Uint32Array,[Hn.UNSIGNED_BYTE]:Uint8Array,[Hn.BYTE]:Int8Array,[Hn.SHORT]:Int16Array,[Hn.INT]:Int32Array},dU={DOUBLE:Hn.DOUBLE,FLOAT:Hn.FLOAT,UNSIGNED_SHORT:Hn.UNSIGNED_SHORT,UNSIGNED_INT:Hn.UNSIGNED_INT,UNSIGNED_BYTE:Hn.UNSIGNED_BYTE,BYTE:Hn.BYTE,SHORT:Hn.SHORT,INT:Hn.INT},N_="Failed to convert GL type";class vc{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in O_)if(O_[e]===t)return e;throw new Error(N_)}static fromName(t){const e=dU[t];if(!e)throw new Error(N_);return e}static getArrayType(t){switch(t){case Hn.UNSIGNED_SHORT_5_6_5:case Hn.UNSIGNED_SHORT_4_4_4_4:case Hn.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=O_[t];if(!e)throw new Error(N_);return e}}static getByteSize(t){return vc.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!vc.getArrayType(t)}static createTypedArray(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(e.byteLength-r)/vc.getByteSize(t));const o=vc.getArrayType(t);return new o(e,r,n)}}function pU(i,t){if(!i)throw new Error("math.gl assertion failed. ".concat(t))}function fU(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=i>>11&31,r=i>>5&63,n=i&31;return t[0]=e<<3,t[1]=r<<2,t[2]=n<<3,t}new V1;new Kt;new V1;new V1;function _5(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return th(i,0,t)/t*2-1}function y5(i){return i<0?-1:1}function mU(i,t,e,r){if(pU(r),i<0||i>e||t<0||t>e)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(e));if(r.x=_5(i,e),r.y=_5(t,e),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*y5(n),r.y=(1-Math.abs(n))*y5(r.y)}return r.normalize()}function gU(i,t,e){return mU(i,t,255,e)}class Sv{constructor(t,e){G(this,"json",void 0),G(this,"buffer",void 0),G(this,"featuresLength",0),G(this,"_cachedTypedArrays",{}),this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dr.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}getPropertyArray(t,e,r){const n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=vc.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}getProperty(t,e,r,n,o){const c=this.json[t];if(!c)return c;const l=this.getPropertyArray(t,e,r);if(r===1)return l[n];for(let _=0;_<r;++_)o[_]=l[r*n+_];return o}_getTypedArrayFromBinary(t,e,r,n,o){const c=this._cachedTypedArrays;let l=c[t];return l||(l=vc.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+o,n*r),c[t]=l),l}_getTypedArrayFromArray(t,e,r){const n=this._cachedTypedArrays;let o=n[t];return o||(o=vc.createTypedArray(e,r),n[t]=o),o}}const _U={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yU={SCALAR:(i,t)=>i[t],VEC2:(i,t)=>[i[2*t+0],i[2*t+1]],VEC3:(i,t)=>[i[3*t+0],i[3*t+1],i[3*t+2]],VEC4:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT2:(i,t)=>[i[4*t+0],i[4*t+1],i[4*t+2],i[4*t+3]],MAT3:(i,t)=>[i[9*t+0],i[9*t+1],i[9*t+2],i[9*t+3],i[9*t+4],i[9*t+5],i[9*t+6],i[9*t+7],i[9*t+8]],MAT4:(i,t)=>[i[16*t+0],i[16*t+1],i[16*t+2],i[16*t+3],i[16*t+4],i[16*t+5],i[16*t+6],i[16*t+7],i[16*t+8],i[16*t+9],i[16*t+10],i[16*t+11],i[16*t+12],i[16*t+13],i[16*t+14],i[16*t+15]]},vU={SCALAR:(i,t,e)=>{t[e]=i},VEC2:(i,t,e)=>{t[2*e+0]=i[0],t[2*e+1]=i[1]},VEC3:(i,t,e)=>{t[3*e+0]=i[0],t[3*e+1]=i[1],t[3*e+2]=i[2]},VEC4:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT2:(i,t,e)=>{t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},MAT3:(i,t,e)=>{t[9*e+0]=i[0],t[9*e+1]=i[1],t[9*e+2]=i[2],t[9*e+3]=i[3],t[9*e+4]=i[4],t[9*e+5]=i[5],t[9*e+6]=i[6],t[9*e+7]=i[7],t[9*e+8]=i[8],t[9*e+9]=i[9]},MAT4:(i,t,e)=>{t[16*e+0]=i[0],t[16*e+1]=i[1],t[16*e+2]=i[2],t[16*e+3]=i[3],t[16*e+4]=i[4],t[16*e+5]=i[5],t[16*e+6]=i[6],t[16*e+7]=i[7],t[16*e+8]=i[8],t[16*e+9]=i[9],t[16*e+10]=i[10],t[16*e+11]=i[11],t[16*e+12]=i[12],t[16*e+13]=i[13],t[16*e+14]=i[14],t[16*e+15]=i[15]}};function bU(i,t,e,r){const{componentType:n}=i;Xr(i.componentType);const o=typeof n=="string"?vc.fromName(n):n,c=_U[i.type],l=yU[i.type],_=vU[i.type];return e+=i.byteOffset,{values:vc.createTypedArray(o,t,e,c*r),type:o,size:c,unpacker:l,packer:_}}const gc=i=>i!==void 0;function xU(i,t,e){if(!t)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?wU(r,e):null}function wU(i,t){let e,r,n;const o=i.instancesLength,c=i.classes;let l=i.classIds,_=i.parentCounts,v=i.parentIds,S=o;gc(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,n=getBinaryAccessor(l),l=n.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,o));let T;if(gc(_))for(gc(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,n=getBinaryAccessor(_),_=n.createArrayBufferView(t.buffer,t.byteOffset+_.byteOffset,o)),T=new Uint16Array(o),S=0,e=0;e<o;++e)T[e]=S,S+=_[e];gc(v)&&gc(v.byteOffset)&&(v.componentType=defaultValue(v.componentType,GL.UNSIGNED_SHORT),v.type=AttributeType.SCALAR,n=getBinaryAccessor(v),v=n.createArrayBufferView(t.buffer,t.byteOffset+v.byteOffset,S));const P=c.length;for(e=0;e<P;++e){const X=c[e].length,H=c[e].instances,Z=getBinaryProperties(X,H,t);c[e].instances=combine(Z,H)}const I=new Array(P).fill(0),z=new Uint16Array(o);for(e=0;e<o;++e)r=l[e],z[e]=I[r],++I[r];const N={classes:c,classIds:l,classIndexes:z,parentCounts:_,parentIndexes:T,parentIds:v};return EU(N),N}function Xp(i,t,e){if(!i)return;const r=i.parentCounts;return i.parentIds?e(i,t):r>0?SU(i,t,e):AU(i,t,e)}function SU(i,t,e){const r=i.classIds,n=i.parentCounts,o=i.parentIds,c=i.parentIndexes,l=r.length,_=scratchVisited;_.length=Math.max(_.length,l);const v=++marker,S=scratchStack;for(S.length=0,S.push(t);S.length>0;){if(t=S.pop(),_[t]===v)continue;_[t]=v;const T=e(i,t);if(gc(T))return T;const P=n[t],I=c[t];for(let z=0;z<P;++z){const N=o[I+z];N!==t&&S.push(N)}}return null}function AU(i,t,e){let r=!0;for(;r;){const n=e(i,t);if(gc(n))return n;const o=i.parentIds[t];r=o!==t,t=o}throw new Error("traverseHierarchySingleParent")}function EU(i){const t=i.classIds.length;for(let e=0;e<t;++e)rE(i,e,stack)}function rE(i,t,e){const r=i.parentCounts,n=i.parentIds,o=i.parentIndexes,c=i.classIds.length;if(!gc(n))return;assert(t<c,"Parent index ".concat(t," exceeds the total number of instances: ").concat(c)),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const l=gc(r)?r[t]:1,_=gc(r)?o[t]:t;for(let v=0;v<l;++v){const S=n[_+v];S!==t&&rE(i,S,e)}e.pop(t)}function jo(i){return i!=null}const Fm=(i,t)=>i,TU={HIERARCHY:!0,extensions:!0,extras:!0};class nE{constructor(t,e,r){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};G(this,"json",void 0),G(this,"binary",void 0),G(this,"featureCount",void 0),G(this,"_extensions",void 0),G(this,"_properties",void 0),G(this,"_binaryProperties",void 0),G(this,"_hierarchy",void 0),Xr(r>=0),this.json=t||{},this.binary=e,this.featureCount=r,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const c in this.json)TU[c]||(this._properties[c]=this.json[c]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=xU(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Xr(typeof e=="string",e),this._hierarchy){const r=Xp(this._hierarchy,t,(n,o)=>{const c=n.classIds[o];return n.classes[c].name===e});return jo(r)}return!1}isExactClass(t,e){return Xr(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Xr(typeof e=="string",e),jo(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=jo(e)?e:[],e.length=0;const r=Object.keys(this._properties);return e.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Xr(typeof e=="string",e),this._binaryProperties){const n=this._binaryProperties[e];if(jo(n))return this._getBinaryProperty(n,t)}const r=this._properties[e];if(jo(r))return Fm(r[t]);if(this._hierarchy){const n=this._getHierarchyProperty(t,e);if(jo(n))return n}}setProperty(t,e,r){const n=this.featureCount;if(this._checkBatchId(t),Xr(typeof e=="string",e),this._binaryProperties){const c=this._binaryProperties[e];if(c){this._setBinaryProperty(c,t,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,r))return;let o=this._properties[e];jo(o)||(this._properties[e]=new Array(n),o=this._properties[e]),o[t]=Fm(r)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,r){t.pack(r,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const r=this._properties[e],n=this._initializeBinaryProperty(e,r);n&&(t=t||{},t[e]=n)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const r=e;Xr(this.binary,"Property ".concat(t," requires a batch table binary.")),Xr(r.type,"Property ".concat(t," requires a type."));const n=bU(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const r=Xp(this._hierarchy,t,(n,o)=>{const c=n.classIds[o],l=n.classes[c].instances;return jo(l[e])});return jo(r)}_getPropertyNamesInHierarchy(t,e){Xp(this._hierarchy,t,(r,n)=>{const o=r.classIds[n],c=r.classes[o].instances;for(const l in c)c.hasOwnProperty(l)&&e.indexOf(l)===-1&&e.push(l)})}_getHierarchyProperty(t,e){return Xp(this._hierarchy,t,(r,n)=>{const o=r.classIds[n],c=r.classes[o],l=r.classIndexes[n],_=c.instances[e];return jo(_)?jo(_.typedArray)?this._getBinaryProperty(_,l):Fm(_[l]):null})}_setHierarchyProperty(t,e,r,n){const o=Xp(this._hierarchy,e,(c,l)=>{const _=c.classIds[l],v=c.classes[_],S=c.classIndexes[l],T=v.instances[r];return jo(T)?(Xr(l===e,'Inherited property "'.concat(r,'" is read-only.')),jo(T.typedArray)?this._setBinaryProperty(T,S,n):T[S]=Fm(n),!0):!1});return jo(o)}}const z_=4;function qg(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(t);if(i.magic=r.getUint32(e,!0),e+=z_,i.version=r.getUint32(e,!0),e+=z_,i.byteLength=r.getUint32(e,!0),e+=z_,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return e}const xd=4,v5="b3dm tile in legacy format.";function Av(i,t,e){const r=new DataView(t);let n;i.header=i.header||{};let o=r.getUint32(e,!0);e+=xd;let c=r.getUint32(e,!0);e+=xd;let l=r.getUint32(e,!0);e+=xd;let _=r.getUint32(e,!0);return e+=xd,l>=570425344?(e-=xd*2,n=o,l=c,_=0,o=0,c=0,console.warn(v5)):_>=570425344&&(e-=xd,n=l,l=o,_=c,o=0,c=0,console.warn(v5)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=c,i.header.batchTableJsonByteLength=l,i.header.batchTableBinaryByteLength=_,i.header.batchLength=n,e}function Ev(i,t,e,r){return e=CU(i,t,e),e=PU(i,t,e),e}function CU(i,t,e,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:c}=i.header;if(i.featureTableJson={BATCH_LENGTH:c||0},n>0){const l=iE(t,e,n);i.featureTableJson=JSON.parse(l)}return e+=n,i.featureTableBinary=new Uint8Array(t,e,o),e+=o,e}function PU(i,t,e,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=i.header;if(n>0){const c=iE(t,e,n);i.batchTableJson=JSON.parse(c),e+=n,o>0&&(i.batchTableBinary=new Uint8Array(t,e,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),e+=o)}return e}function sE(i,t,e){if(!t&&(!i||!i.batchIds||!e))return null;const{batchIds:r,isRGB565:n,pointCount:o}=i;if(r&&e){const c=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const _=r[l],v=e.getProperty(_,"dimensions").map(S=>S*255);c[l*3]=v[0],c[l*3+1]=v[1],c[l*3+2]=v[2]}return{type:dr.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}if(n){const c=new Uint8ClampedArray(o*3);for(let l=0;l<o;l++){const _=fU(t[l]);c[l*3]=_[0],c[l*3+1]=_[1],c[l*3+2]=_[2]}return{type:dr.UNSIGNED_BYTE,value:c,size:3,normalized:!0}}return t&&t.length===o*3?{type:dr.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:dr.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}const b5=new Kt;function IU(i,t){if(!t)return null;if(i.isOctEncoded16P){const e=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)gU(t[r*2],t[r*2+1],b5),b5.toArray(e,r*3);return{type:dr.FLOAT,size:2,value:e}}return{type:dr.FLOAT,size:2,value:t}}function LU(i,t,e){return i.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,MU(i,t)):{type:dr.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function MU(i,t){const e=new Kt,r=new Float32Array(i.pointCount*3);for(let n=0;n<i.pointCount;n++)e.set(t[n*3],t[n*3+1],t[n*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,n*3);return r}async function BU(i,t,e,r,n){e=qg(i,t,e),e=Av(i,t,e),e=Ev(i,t,e),RU(i);const{featureTable:o,batchTable:c}=kU(i);return await zU(i,o,c,r,n),FU(i,o,r),DU(i,o,c),OU(i,o),e}function RU(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function kU(i){const t=new Sv(i.featureTableJson,i.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,i.featuresLength=e,i.pointsLength=e,i.pointCount=e,i.rtcCenter=t.getGlobalProperty("RTC_CENTER",dr.FLOAT,3);const r=NU(i,t);return{featureTable:t,batchTable:r}}function FU(i,t,e){if(!i.attributes.positions){if(t.hasProperty("POSITION"))i.attributes.positions=t.getPropertyArray("POSITION",dr.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const r=t.getPropertyArray("POSITION_QUANTIZED",dr.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",dr.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",dr.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=LU(i,r,e)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function DU(i,t,e){if(!i.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",dr.UNSIGNED_BYTE,4),i.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",dr.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",dr.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=sE(i,r,e)}t.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",dr.UNSIGNED_BYTE,4))}function OU(i,t){if(!i.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",dr.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",dr.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=IU(i,e)}}function NU(i,t){let e=null;if(!i.batchIds&&t.hasProperty("BATCH_ID")&&(i.batchIds=t.getPropertyArray("BATCH_ID",dr.UNSIGNED_SHORT,1),i.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=i;e=new nE(n,o,r)}return e}async function zU(i,t,e,r,n){let o,c,l;const _=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];_&&(l=_.properties);const v=t.getExtension("3DTILES_draco_point_compression");if(v){c=v.properties;const T=v.byteOffset,P=v.byteLength;if(!c||!Number.isFinite(T)||!P)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=i.featureTableBinary.slice(T,T+P),i.hasPositions=Number.isFinite(c.POSITION),i.hasColors=Number.isFinite(c.RGB)||Number.isFinite(c.RGBA),i.hasNormals=Number.isFinite(c.NORMAL),i.hasBatchIds=Number.isFinite(c.BATCH_ID),i.isTranslucent=Number.isFinite(c.RGBA)}if(!o)return!0;const S={buffer:o,properties:{...c,...l},featureTableProperties:c,batchTableProperties:l,dequantizeInShader:!1};return await jU(i,S,r,n)}async function jU(i,t,e,r){const{parse:n}=r,o={...e,draco:{...e.draco,extraAttributes:t.batchTableProperties||{}}};delete o["3d-tiles"];const c=await n(t.buffer,VA,o),l=c.attributes.POSITION&&c.attributes.POSITION.value,_=c.attributes.COLOR_0&&c.attributes.COLOR_0.value,v=c.attributes.NORMAL&&c.attributes.NORMAL.value,S=c.attributes.BATCH_ID&&c.attributes.BATCH_ID.value,T=l&&c.attributes.POSITION.value.quantization,P=v&&c.attributes.NORMAL.value.quantization;if(T){const z=c.POSITION.data.quantization,N=z.range;i.quantizedVolumeScale=new Kt(N,N,N),i.quantizedVolumeOffset=new Kt(z.minValues),i.quantizedRange=(1<<z.quantizationBits)-1,i.isQuantizedDraco=!0}P&&(i.octEncodedRange=(1<<c.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const I={};if(t.batchTableProperties)for(const z of Object.keys(t.batchTableProperties))c.attributes[z]&&c.attributes[z].value&&(I[z.toLowerCase()]=c.attributes[z].value);i.attributes={positions:l,colors:sE(i,_,void 0),normals:v,batchIds:S,...I}}const qy={URI:0,EMBEDDED:1};function oE(i,t,e,r){i.rotateYtoZ=!0;const n=i.byteOffset+i.byteLength-e;if(n===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=w1(t,e,n),i.gltfByteOffset=0,i.gltfByteLength=n,e%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function aE(i,t,e,r){const n=e["3d-tiles"]||{};if(UU(i,t),n.loadGLTF){const{parse:o,fetch:c}=r;i.gltfUrl&&(i.gltfArrayBuffer=await c(i.gltfUrl,e),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await o(i.gltfArrayBuffer,wf,e,r),i.gpuMemoryUsageInBytes=UA(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function UU(i,t,e){switch(t){case qy.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),n=new TextDecoder().decode(r);i.gltfUrl=n.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case qy.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function GU(i,t,e,r,n){var o;e=VU(i,t,e,r),await aE(i,qy.EMBEDDED,r,n);const c=i==null||(o=i.gltf)===null||o===void 0?void 0:o.extensions;return c&&c.CESIUM_RTC&&(i.rtcCenter=c.CESIUM_RTC.center),e}function VU(i,t,e,r,n){e=qg(i,t,e),e=Av(i,t,e),e=Ev(i,t,e),e=oE(i,t,e,r);const o=new Sv(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",dr.FLOAT,3),e}async function qU(i,t,e,r,n){return e=HU(i,t,e,r),await aE(i,i.gltfFormat,r,n),e}function HU(i,t,e,r,n){if(e=qg(i,t,e),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));e=Av(i,t,e);const o=new DataView(t);if(i.gltfFormat=o.getUint32(e,!0),e+=4,e=Ev(i,t,e),e=oE(i,t,e,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const c=new Sv(i.featureTableJson,i.featureTableBinary),l=c.getGlobalProperty("INSTANCES_LENGTH");if(c.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=c.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=c.getGlobalProperty("RTC_CENTER",dr.FLOAT,3);const _=new nE(i.batchTableJson,i.batchTableBinary,l);return WU(i,c,_,l),e}function WU(i,t,e,r){const n={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,o=new Kt;new Kt,new Kt,new Kt;const c=new Cn,l=new _f,_=new Kt,v={},S=new ar,T=[],P=[],I=new Kt,z=new Kt;for(let N=0;N<r;N++){let X;if(t.hasProperty("POSITION"))X=t.getProperty("POSITION",dr.FLOAT,3,N,o);else if(t.hasProperty("POSITION_QUANTIZED")){X=t.getProperty("POSITION_QUANTIZED",dr.UNSIGNED_SHORT,3,N,o);const Ft=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",dr.FLOAT,3,I);if(!Ft)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Mt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",dr.FLOAT,3,z);if(!Mt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const yt=65535;for(let Ut=0;Ut<3;Ut++)X[Ut]=X[Ut]/yt*Mt[Ut]+Ft[Ut]}if(!X)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(X),v.translation=o,i.normalUp=t.getProperty("NORMAL_UP",dr.FLOAT,3,N,T),i.normalRight=t.getProperty("NORMAL_RIGHT",dr.FLOAT,3,N,P),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",dr.UNSIGNED_SHORT,2,T),i.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",dr.UNSIGNED_SHORT,2,P),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(gn.WGS84.eastNorthUpToFixedFrame(o,S),S.getRotationMatrix3(c)):c.identity()}l.fromMatrix3(c),v.rotation=l,_.set(1,1,1);const H=t.getProperty("SCALE",dr.FLOAT,1,N);Number.isFinite(H)&&_.multiplyByScalar(H);const Z=t.getProperty("SCALE_NON_UNIFORM",dr.FLOAT,3,N,T);Z&&_.scale(Z),v.scale=_;let ot=t.getProperty("BATCH_ID",dr.UNSIGNED_SHORT,1,N);ot===void 0&&(ot=N);const gt=new ar().fromQuaternion(v.rotation);S.identity(),S.translate(v.translation),S.multiplyRight(gt),S.scale(v.scale);const Et=S.clone();n[N]={modelMatrix:Et,batchId:ot}}i.instances=n}async function XU(i,t,e,r,n,o){e=qg(i,t,e);const c=new DataView(t);for(i.tilesLength=c.getUint32(e,!0),e+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-e>12;){const l={};i.tiles.push(l),e=await o(t,e,r,n,l)}return e}async function ZU(i,t,e,r){i.rotateYtoZ=!0,i.gltfUpAxis=e["3d-tiles"]&&e["3d-tiles"].assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=r;i.gltf=await n(t,wf,e,r),i.gpuMemoryUsageInBytes=UA(i.gltf)}async function lE(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=t,n.type=hU(i,t),n.type){case Wp.COMPOSITE:return await XU(n,i,t,e,r,lE);case Wp.BATCHED_3D_MODEL:return await GU(n,i,t,e,r);case Wp.GLTF:return await ZU(n,i,e,r);case Wp.INSTANCED_3D_MODEL:return await qU(n,i,t,e,r);case Wp.POINT_CLOUD:return await BU(n,i,t,e,r);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const $U=1952609651,YU=1;async function JU(i,t,e){if(new Uint32Array(i.slice(0,4))[0]!==$U)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==YU)throw new Error("Wrong subtree file verson, must be 1");const r=x5(i.slice(8,16)),n=new Uint8Array(i,24,r),o=new TextDecoder("utf8").decode(n),c=JSON.parse(o),l=x5(i.slice(16,24));let _=new ArrayBuffer(0);return l&&(_=i.slice(24+r)),"bufferView"in c.tileAvailability&&(c.tileAvailability.explicitBitstream=await j_(c,"tileAvailability",_,e)),"bufferView"in c.contentAvailability&&(c.contentAvailability.explicitBitstream=await j_(c,"contentAvailability",_,e)),"bufferView"in c.childSubtreeAvailability&&(c.childSubtreeAvailability.explicitBitstream=await j_(c,"childSubtreeAvailability",_,e)),c}function KU(i,t){if(t.startsWith("http")){const n=new URL(i,t);return decodeURI(n.toString())}const e="http://".concat(t),r=new URL(i,e);return"/".concat(r.host).concat(r.pathname)}async function j_(i,t,e,r){const n=i[t].bufferView,o=i.bufferViews[n],c=i.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(c.uri){const l=KU(c.uri,r==null?void 0:r.url),_=await(await r.fetch(l)).arrayBuffer();return new Uint8Array(_,o.byteOffset,o.byteLength)}return new Uint8Array(e,o.byteOffset,o.byteLength)}function x5(i){const t=new DataView(i),e=t.getUint32(0,!0),r=t.getUint32(4,!0);return e+2**32*r}const cE={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:eE,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:JU,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Za=null;try{Za=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Nr(i,t,e){this.low=i|0,this.high=t|0,this.unsigned=!!e}Nr.prototype.__isLong__;Object.defineProperty(Nr.prototype,"__isLong__",{value:!0});function ro(i){return(i&&i.__isLong__)===!0}function w5(i){var t=Math.clz32(i&-i);return i?31-t:t}Nr.isLong=ro;var S5={},A5={};function qu(i,t){var e,r,n;return t?(i>>>=0,(n=0<=i&&i<256)&&(r=A5[i],r)?r:(e=gr(i,0,!0),n&&(A5[i]=e),e)):(i|=0,(n=-128<=i&&i<128)&&(r=S5[i],r)?r:(e=gr(i,i<0?-1:0,!1),n&&(S5[i]=e),e))}Nr.fromInt=qu;function $a(i,t){if(isNaN(i))return t?eh:wl;if(t){if(i<0)return eh;if(i>=hE)return pE}else{if(i<=-T5)return Vo;if(i+1>=T5)return dE}return i<0?$a(-i,t).neg():gr(i%Qd|0,i/Qd|0,t)}Nr.fromNumber=$a;function gr(i,t,e){return new Nr(i,t,e)}Nr.fromBits=gr;var Tg=Math.pow;function Tv(i,t,e){if(i.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return t?eh:wl;if(e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Tv(i.substring(1),t,e).neg();for(var n=$a(Tg(e,8)),o=wl,c=0;c<i.length;c+=8){var l=Math.min(8,i.length-c),_=parseInt(i.substring(c,c+l),e);if(l<8){var v=$a(Tg(e,l));o=o.mul(v).add($a(_))}else o=o.mul(n),o=o.add($a(_))}return o.unsigned=t,o}Nr.fromString=Tv;function Tl(i,t){return typeof i=="number"?$a(i,t):typeof i=="string"?Tv(i,t):gr(i.low,i.high,typeof t=="boolean"?t:i.unsigned)}Nr.fromValue=Tl;var E5=65536,QU=1<<24,Qd=E5*E5,hE=Qd*Qd,T5=hE/2,C5=qu(QU),wl=qu(0);Nr.ZERO=wl;var eh=qu(0,!0);Nr.UZERO=eh;var Bd=qu(1);Nr.ONE=Bd;var uE=qu(1,!0);Nr.UONE=uE;var Hy=qu(-1);Nr.NEG_ONE=Hy;var dE=gr(-1,2147483647,!1);Nr.MAX_VALUE=dE;var pE=gr(-1,-1,!0);Nr.MAX_UNSIGNED_VALUE=pE;var Vo=gr(0,-2147483648,!1);Nr.MIN_VALUE=Vo;var Re=Nr.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Qd+(this.low>>>0):this.high*Qd+(this.low>>>0)};Re.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Vo)){var t=$a(i),e=this.div(t),r=e.mul(t).sub(this);return e.toString(i)+r.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var n=$a(Tg(i,6),this.unsigned),o=this,c="";;){var l=o.div(n),_=o.sub(l.mul(n)).toInt()>>>0,v=_.toString(i);if(o=l,o.isZero())return v+c;for(;v.length<6;)v="0"+v;c=""+v+c}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vo)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,t=31;t>0&&!(i&1<<t);t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(i){return ro(i)||(i=Tl(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low};Re.eq=Re.equals;Re.notEquals=function(i){return!this.eq(i)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(i){return this.comp(i)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(i){return this.comp(i)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(i){return this.comp(i)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(i){return this.comp(i)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(i){if(ro(i)||(i=Tl(i)),this.eq(i))return 0;var t=this.isNegative(),e=i.isNegative();return t&&!e?-1:!t&&e?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Vo)?Vo:this.not().add(Bd)};Re.neg=Re.negate;Re.add=function(i){ro(i)||(i=Tl(i));var t=this.high>>>16,e=this.high&65535,r=this.low>>>16,n=this.low&65535,o=i.high>>>16,c=i.high&65535,l=i.low>>>16,_=i.low&65535,v=0,S=0,T=0,P=0;return P+=n+_,T+=P>>>16,P&=65535,T+=r+l,S+=T>>>16,T&=65535,S+=e+c,v+=S>>>16,S&=65535,v+=t+o,v&=65535,gr(T<<16|P,v<<16|S,this.unsigned)};Re.subtract=function(i){return ro(i)||(i=Tl(i)),this.add(i.neg())};Re.sub=Re.subtract;Re.multiply=function(i){if(this.isZero())return this;if(ro(i)||(i=Tl(i)),Za){var t=Za.mul(this.low,this.high,i.low,i.high);return gr(t,Za.get_high(),this.unsigned)}if(i.isZero())return this.unsigned?eh:wl;if(this.eq(Vo))return i.isOdd()?Vo:wl;if(i.eq(Vo))return this.isOdd()?Vo:wl;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(C5)&&i.lt(C5))return $a(this.toNumber()*i.toNumber(),this.unsigned);var e=this.high>>>16,r=this.high&65535,n=this.low>>>16,o=this.low&65535,c=i.high>>>16,l=i.high&65535,_=i.low>>>16,v=i.low&65535,S=0,T=0,P=0,I=0;return I+=o*v,P+=I>>>16,I&=65535,P+=n*v,T+=P>>>16,P&=65535,P+=o*_,T+=P>>>16,P&=65535,T+=r*v,S+=T>>>16,T&=65535,T+=n*_,S+=T>>>16,T&=65535,T+=o*l,S+=T>>>16,T&=65535,S+=e*v+r*_+n*l+o*c,S&=65535,gr(P<<16|I,S<<16|T,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(i){if(ro(i)||(i=Tl(i)),i.isZero())throw Error("division by zero");if(Za){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var t=(this.unsigned?Za.div_u:Za.div_s)(this.low,this.high,i.low,i.high);return gr(t,Za.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?eh:wl;var e,r,n;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return eh;if(i.gt(this.shru(1)))return uE;n=eh}else{if(this.eq(Vo)){if(i.eq(Bd)||i.eq(Hy))return Vo;if(i.eq(Vo))return Bd;var o=this.shr(1);return e=o.div(i).shl(1),e.eq(wl)?i.isNegative()?Bd:Hy:(r=this.sub(i.mul(e)),n=e.add(r.div(i)),n)}else if(i.eq(Vo))return this.unsigned?eh:wl;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();n=wl}for(r=this;r.gte(i);){e=Math.max(1,Math.floor(r.toNumber()/i.toNumber()));for(var c=Math.ceil(Math.log(e)/Math.LN2),l=c<=48?1:Tg(2,c-48),_=$a(e),v=_.mul(i);v.isNegative()||v.gt(r);)e-=l,_=$a(e,this.unsigned),v=_.mul(i);_.isZero()&&(_=Bd),n=n.add(_),r=r.sub(v)}return n};Re.div=Re.divide;Re.modulo=function(i){if(ro(i)||(i=Tl(i)),Za){var t=(this.unsigned?Za.rem_u:Za.rem_s)(this.low,this.high,i.low,i.high);return gr(t,Za.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return gr(~this.low,~this.high,this.unsigned)};Re.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Re.clz=Re.countLeadingZeros;Re.countTrailingZeros=function(){return this.low?w5(this.low):w5(this.high)+32};Re.ctz=Re.countTrailingZeros;Re.and=function(i){return ro(i)||(i=Tl(i)),gr(this.low&i.low,this.high&i.high,this.unsigned)};Re.or=function(i){return ro(i)||(i=Tl(i)),gr(this.low|i.low,this.high|i.high,this.unsigned)};Re.xor=function(i){return ro(i)||(i=Tl(i)),gr(this.low^i.low,this.high^i.high,this.unsigned)};Re.shiftLeft=function(i){return ro(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?gr(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):gr(0,this.low<<i-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(i){return ro(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?gr(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):gr(this.high>>i-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(i){return ro(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?gr(this.low>>>i|this.high<<32-i,this.high>>>i,this.unsigned):i===32?gr(this.high,0,this.unsigned):gr(this.high>>>i-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.rotateLeft=function(i){var t;return ro(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?gr(this.high,this.low,this.unsigned):i<32?(t=32-i,gr(this.low<<i|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)):(i-=32,t=32-i,gr(this.high<<i|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned))};Re.rotl=Re.rotateLeft;Re.rotateRight=function(i){var t;return ro(i)&&(i=i.toInt()),(i&=63)===0?this:i===32?gr(this.high,this.low,this.unsigned):i<32?(t=32-i,gr(this.high<<t|this.low>>>i,this.low<<t|this.high>>>i,this.unsigned)):(i-=32,t=32-i,gr(this.low<<t|this.high>>>i,this.high<<t|this.low>>>i,this.unsigned))};Re.rotr=Re.rotateRight;Re.toSigned=function(){return this.unsigned?gr(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:gr(this.low,this.high,!0)};Re.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var i=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]};Re.toBytesBE=function(){var i=this.high,t=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Nr.fromBytes=function(i,t,e){return e?Nr.fromBytesLE(i,t):Nr.fromBytesBE(i,t)};Nr.fromBytesLE=function(i,t){return new Nr(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,t)};Nr.fromBytesBE=function(i,t){return new Nr(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],t)};const tG=16;function fE(i){i==="X"&&(i="");const t=i.padEnd(tG,"0");return Nr.fromString(t,!0,16)}function eG(i){if(i.isZero())return"X";let t=i.countTrailingZeros();const e=t%4;t=(t-e)/4;const r=t;t*=4;const n=i.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-n.length).join("0")+n}function iG(i,t){const e=rG(i).shiftRightUnsigned(2);return i.add(Nr.fromNumber(2*t+1-4).multiply(e))}function rG(i){return i.and(i.not().add(1))}const nG=3,sG=30,oG=2*sG+1,P5=180/Math.PI;function aG(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const t=i.split("/"),e=parseInt(t[0],10),r=t[1],n=r.length;let o=0;const c=[0,0];for(let l=n-1;l>=0;l--){o=n-l;const _=r[l];let v=0,S=0;_==="1"?S=1:_==="2"?(v=1,S=1):_==="3"&&(v=1);const T=Math.pow(2,o-1);cG(T,c,v,S),c[0]+=T*v,c[1]+=T*S}if(e%2===1){const l=c[0];c[0]=c[1],c[1]=l}return{face:e,ij:c,level:o}}function lG(i){if(i.isZero())return"";let t=i.toString(2);for(;t.length<nG+oG;)t="0"+t;const e=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,e),o=n.length/2,c=Nr.fromString(r,!0,2).toString(10);let l="";if(o!==0)for(l=Nr.fromString(n,!0,2).toString(4);l.length<o;)l="0"+l;return"".concat(c,"/").concat(l)}function mE(i,t,e){const r=1<<t;return[(i[0]+e[0])/r,(i[1]+e[1])/r]}function I5(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function gE(i){return[I5(i[0]),I5(i[1])]}function _E(i,t){let[e,r]=t;switch(i){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function yE(i){let[t,e,r]=i;const n=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*P5,n*P5]}function cG(i,t,e,r){if(r===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function hG(i){const t=mE(i.ij,i.level,[.5,.5]),e=gE(t),r=_E(i.face,e);return yE(r)}const uG=100;function L5(i){const{face:t,ij:e,level:r}=i,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(uG*Math.pow(2,-r))),c=new Float64Array(4*o*2+2);let l=0,_=0;for(let v=0;v<4;v++){const S=n[v].slice(0),T=n[v+1],P=(T[0]-S[0])/o,I=(T[1]-S[1])/o;for(let z=0;z<o;z++){S[0]+=P,S[1]+=I;const N=mE(e,r,S),X=gE(N),H=_E(t,X),Z=yE(H);Math.abs(Z[1])>89.999&&(Z[0]=_);const ot=Z[0]-_;Z[0]+=ot>180?-360:ot<-180?360:0,c[l++]=Z[0],c[l++]=Z[1],_=Z[0]}}return c[l++]=c[0],c[l++]=c[1],c}function Cv(i){const t=dG(i);return aG(t)}function dG(i){if(i.indexOf("/")>0)return i;const t=fE(i);return lG(t)}function pG(i){const t=Cv(i);return hG(t)}function fG(i){let t;if(i.face===2||i.face===5){let e=null,r=0;for(let n=0;n<4;n++){const o="".concat(i.face,"/").concat(n),c=Cv(o),l=L5(c);(typeof e>"u"||e===null)&&(e=new Float64Array(4*l.length)),e.set(l,r),r+=l.length}t=M5(e)}else{const e=L5(i);t=M5(e)}return t}function M5(i){if(i.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let r=0;r<i.length;r+=2)t.push(i[r]),e.push(i[r+1]);return t.sort((r,n)=>r-n),e.sort((r,n)=>r-n),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function mG(i,t){const e=(t==null?void 0:t.minimumHeight)||0,r=(t==null?void 0:t.maximumHeight)||0,n=Cv(i),o=fG(n),c=o.west,l=o.south,_=o.east,v=o.north,S=[];return S.push(new Kt(c,v,e)),S.push(new Kt(_,v,e)),S.push(new Kt(_,l,e)),S.push(new Kt(c,l,e)),S.push(new Kt(c,v,r)),S.push(new Kt(_,v,r)),S.push(new Kt(_,l,r)),S.push(new Kt(c,l,r)),S}function vE(i){const t=i.token,e={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=mG(t,e),n=pG(t),o=n[0],c=n[1],l=gn.WGS84.cartographicToCartesian([o,c,e.maximumHeight]),_=new Kt(l[0],l[1],l[2]);r.push(_);const v=GN(r);return[...v.center,...v.halfAxes]}const gG=4,_G=8,yG={QUADTREE:gG,OCTREE:_G};function vG(i,t,e){if(i!=null&&i.box){const r=fE(i.s2VolumeInfo.token),n=iG(r,t),o=eG(n),c={...i.s2VolumeInfo};switch(c.token=o,e){case"OCTREE":const l=i.s2VolumeInfo,_=l.maximumHeight-l.minimumHeight,v=_/2,S=l.minimumHeight+_/2;l.minimumHeight=S-v,l.maximumHeight=S+v;break}return{box:vE(c),s2VolumeInfo:c}}}async function bE(i){const{options:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=i;let{subtree:c,level:l=0}=i;const{subdivisionScheme:_,subtreeLevels:v,maximumLevel:S,contentUrlTemplate:T,subtreesUriTemplate:P,basePath:I}=t,z={children:[],lodMetricValue:0,contentUrl:""},N=yG[_],X=r&1,H=r>>1&1,Z=r>>2&1,ot=(N**l-1)/(N-1);let gt=bu(e.mortonIndex,r),Et=ot+gt,Ft=bu(e.x,X),Mt=bu(e.y,H),yt=bu(e.z,Z),Ut=!1;l+1>v&&(Ut=U_(c.childSubtreeAvailability,gt));const zt=bu(n.x,Ft),at=bu(n.y,Mt),pt=bu(n.z,yt),Lt=l+n.level;if(Ut){const ie="".concat(I,"/").concat(P),re=Wy(ie,Lt,zt,at,pt);c=await Hh(re,cE),n.mortonIndex=gt,n.x=Ft,n.y=Mt,n.z=yt,n.level=l,gt=0,Et=0,Ft=0,Mt=0,yt=0,l=0}if(!U_(c.tileAvailability,Et)||l>S)return z;U_(c.contentAvailability,Et)&&(z.contentUrl=Wy(T,Lt,zt,at,pt));const bt=l+1,ee={mortonIndex:gt,x:Ft,y:Mt,z:yt};for(let ie=0;ie<N;ie++){const re=vG(o,ie,_),Yt=await bE({subtree:c,options:t,parentData:ee,childIndex:ie,level:bt,globalData:n,s2VolumeBox:re});if(Yt.contentUrl||Yt.children.length){const ce=Lt+1,le=bG(Yt,ce,{childTileX:Ft,childTileY:Mt,childTileZ:yt},t,o);z.children.push(le)}}return z}function U_(i,t){return"constant"in i?!!i.constant:i.explicitBitstream?SG(t,i.explicitBitstream):!1}function bG(i,t,e,r,n){const{basePath:o,refine:c,getRefine:l,lodMetricType:_,getTileType:v,rootLodMetricValue:S,rootBoundingVolume:T}=r,P=i.contentUrl&&i.contentUrl.replace("".concat(o,"/"),""),I=S/2**t,z=n!=null&&n.box?{box:n.box}:T,N=xG(t,z,e);return{children:i.children,contentUrl:i.contentUrl,content:{uri:P},id:i.contentUrl,refine:l(c),type:v(i),lodMetricType:_,lodMetricValue:I,geometricError:I,transform:i.transform,boundingVolume:N}}function xG(i,t,e){if(t.region){const{childTileX:r,childTileY:n,childTileZ:o}=e,[c,l,_,v,S,T]=t.region,P=2**i,I=(_-c)/P,z=(v-l)/P,N=(T-S)/P,[X,H]=[c+I*r,c+I*(r+1)],[Z,ot]=[l+z*n,l+z*(n+1)],[gt,Et]=[S+N*o,S+N*(o+1)];return{region:[X,Z,H,ot,gt,Et]}}if(t.box)return t;throw new Error("Unsupported bounding volume type ".concat(t))}function bu(i,t){return parseInt(i.toString(2)+t.toString(2),2)}function Wy(i,t,e,r,n){const o=wG({level:t,x:e,y:r,z:n});return i.replace(/{level}|{x}|{y}|{z}/gi,c=>o[c])}function wG(i){const t={};for(const e in i)t["{".concat(e,"}")]=i[e];return t}function SG(i,t){const e=Math.floor(i/8),r=i%8;return(t[e]>>r&1)===1}function Pv(i){if(!i.contentUrl)return Nd.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Nd.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Nd.SCENEGRAPH;default:return t}}function Iv(i){switch(i){case"REPLACE":case"replace":return rh.REPLACE;case"ADD":case"add":return rh.ADD;default:return i}}function Xy(i,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const e=new URL(i,"".concat(t,"/"));return decodeURI(e.toString())}else if(i.startsWith("/"))return i;return"".concat(t,"/").concat(i)}function B5(i,t){if(!i)return null;if(i.content){const e=i.content.uri||i.content.url;i.contentUrl=Xy(e,t.basePath)}return i.id=i.contentUrl,i.lodMetricType=Gg.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=Pv(i),i.refine=Iv(i.refine),i}async function AG(i,t){const e=i.basePath;let r;const n=k5(i==null?void 0:i.root);n&&i.root?r=await R5(i.root,i,n,t):r=B5(i.root,i);const o=[];for(o.push(r);o.length>0;){const c=(o.pop()||{}).children||[];for(let l of c){const _=k5(l);_?l=await R5(l,i,_,t):B5(l,{basePath:e}),o.push(l)}}return r}async function R5(i,t,e,r){var n,o;const c=t.basePath,{subdivisionScheme:l,maximumLevel:_,subtreeLevels:v,subtrees:{uri:S}}=e,T=Wy(S,0,0,0,0),P=Xy(T,c),I=await Hh(P,cE,r),z=Xy(i.content.uri,c),N=t==null||(n=t.root)===null||n===void 0?void 0:n.refine,X=i.geometricError,H=(o=i.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(H){const gt={box:vE(H),s2VolumeInfo:H};i.boundingVolume=gt}const Z=i.boundingVolume,ot={contentUrlTemplate:z,subtreesUriTemplate:S,subdivisionScheme:l,subtreeLevels:v,maximumLevel:_,refine:N,basePath:c,lodMetricType:Gg.GEOMETRIC_ERROR,rootLodMetricValue:X,rootBoundingVolume:Z,getTileType:Pv,getRefine:Iv};return await EG(i,I,ot)}async function EG(i,t,e){if(!i)return null;i.lodMetricType=Gg.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:n}=await bE({subtree:t,options:e,s2VolumeBox:i});return n&&(i.contentUrl=n,i.content={uri:n.replace("".concat(e.basePath,"/"),"")}),i.refine=Iv(i.refine),i.type=Pv(i),i.children=r,i.id=i.contentUrl,i}function k5(i){var t;return(i==null||(t=i.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const Lv={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:eE,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:IG,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function TG(i){return S1(i.url)}async function CG(i,t,e){const r={content:{featureIds:null}};return await lE(i,0,t,e,r.content),r.content}async function PG(i,t,e){var r;const n=JSON.parse(new TextDecoder().decode(i));return n.loader=t.loader||Lv,n.url=e.url,n.queryString=e.queryString,n.basePath=TG(n),n.root=await AG(n,t),n.type=qa.TILES3D,n.lodMetricType=Gg.GEOMETRIC_ERROR,n.lodMetricValue=((r=n.root)===null||r===void 0?void 0:r.lodMetricValue)||0,n}async function IG(i,t,e){const r=t["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=e.url&&e.url.indexOf(".json")!==-1:n=r.isTileset,n?i=await PG(i,t,e):i=await CG(i,t,e),i}const F5=[0],LG={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Lv,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,t,e)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class Mv extends wA{constructor(){super(...arguments),G(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&hr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var t,e;return!!(!((t=this.state)===null||t===void 0||(e=t.tileset3d)===null||e===void 0)&&e.isLoaded()&&super.isLoaded)}shouldUpdateState(t){let{changeFlags:e}=t;return e.somethingChanged}updateState(t){let{props:e,oldProps:r,changeFlags:n}=t;if(e.data&&e.data!==r.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const c in o)o[c].needsUpdate=!0}}activateViewport(t){const{activeViewports:e,lastUpdatedViewports:r}=this.state;this.internalState.viewport=t,e[t.id]=t;const n=r==null?void 0:r[t.id];(!n||!t.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(t){let{info:e,sourceLayer:r}=t;const n=r&&r.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer(t){let{layer:e,viewport:r}=t;const{tile:n}=e.props,{id:o}=r;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(t){const e=t.sourceTile,r=this.state.layerMap[e==null?void 0:e.id];r&&r.layer&&r.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:e={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...e}};let o=t;if(r.preload){const _=await r.preload(t,e);_.url&&(o=_.url),_.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:_.headers}),Object.assign(n,_)}const c=await Hh(o,r,n.loadOptions),l=new cU(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:l,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(l)}_onTileLoad(t){const{lastUpdatedViewports:e}=this.state;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:e}=this.state,{timeline:r}=this.context,n=Object.keys(t).length;!r||!n||!e||e.selectTiles(Object.values(t)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(t,e){if(!t.content)return null;switch(t.type){case Nd.POINTCLOUD:return this._makePointCloudLayer(t,e);case Nd.SCENEGRAPH:return this._make3DModelLayer(t);case Nd.MESH:return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}_makePointCloudLayer(t,e){const{attributes:r,pointCount:n,constantRGBA:o,cartographicOrigin:c,modelMatrix:l}=t.content,{positions:_,normals:v,colors:S}=r;if(!_)return null;const T=e&&e.props.data||{header:{vertexCount:n},attributes:{POSITION:_,NORMAL:v,COLOR_0:S}},{pointSize:P,getPointColor:I}=this.props,z=this.getSubLayerClass("pointcloud",pv);return new z({pointSize:P},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:T,coordinateSystem:lr.METER_OFFSETS,coordinateOrigin:c,modelMatrix:l,getColor:o||I,_offset:0})}_make3DModelLayer(t){const{gltf:e,instances:r,cartographicOrigin:n,modelMatrix:o}=t.content,c=this.getSubLayerClass("scenegraph",xv);return new c({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:r||F5,scenegraph:e,coordinateSystem:lr.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,e){const r=t.content,{attributes:n,indices:o,modelMatrix:c,cartographicOrigin:l,coordinateSystem:_=lr.METER_OFFSETS,material:v,featureIds:S}=r,{_getMeshColor:T}=this.props,P=e&&e.props.mesh||new cf({drawMode:4,attributes:MG(n),indices:o}),I=this.getSubLayerClass("mesh",wv);return new I(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:P,data:F5,getColor:T(t),pbrMaterial:v,modelMatrix:c,coordinateOrigin:l,coordinateSystem:_,featureIds:S,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:e}=this.state;return t?t.tiles.map(r=>{const n=e[r.id]=e[r.id]||{tile:r};let{layer:o}=n;return r.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(r,o),n.needsUpdate=!1):o=this._getSubLayer(r)),n.layer=o,o}).filter(Boolean):null}}G(Mv,"defaultProps",LG);G(Mv,"layerName","Tile3DLayer");function MG(i){const t={};return t.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(t.normals=i.normals),i.texCoords&&(t.texCoords=i.texCoords),i.colors&&(t.colors=i.colors),i.uvRegions&&(t.uvRegions=i.uvRegions),t}var BG=Object.defineProperty,RG=(i,t,e)=>t in i?BG(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,mr=(i,t,e)=>(RG(i,typeof t!="symbol"?t+"":t,e),e);class kG{constructor(t){mr(this,"map"),mr(this,"width"),mr(this,"height"),mr(this,"svgCanvas"),mr(this,"xLine"),mr(this,"yLine"),mr(this,"color","#535353"),this.map=t,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var t,e;this.width=(t=this.map)==null?void 0:t.getCanvas().clientWidth,this.height=(e=this.map)==null?void 0:e.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const t=this.width/2,e=this.height/2;this.yLine.setAttribute("x1",`${t}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${t}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${e}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${e}px`)}else console.error("element value is null")}createCanvas(t){if(this.width!==void 0&&this.height!==void 0){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.position="relative",e.setAttribute("width",`${this.width}px`),e.setAttribute("height",`${this.height}px`);const r=this.width/2,n=this.height/2;this.yLine=e.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=e.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),t==null||t.appendChild(e),this.svgCanvas=e}}createLine(t,e,r,n,o,c){const l=document.createElementNS("http://www.w3.org/2000/svg","line");return l.setAttribute("x1",t),l.setAttribute("y1",e),l.setAttribute("x2",r),l.setAttribute("y2",n),l.setAttribute("stroke-dasharray","5,5"),l.setAttribute("stroke",o),l.setAttribute("stroke-width",c),l}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}const Zy={72:72,96:96,200:200,300:300,400:400},Jc={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},ef={Landscape:"landscape",Portrait:"portrait"},Iu={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},tp={in:"in",mm:"mm"};class FG{constructor(t){mr(this,"map"),mr(this,"width"),mr(this,"height"),mr(this,"unit"),mr(this,"svgCanvas"),mr(this,"svgPath");var e,r,n;if(this.map=t,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,c=(r=this.map)==null?void 0:r.getCanvas().clientHeight,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.setAttribute("width",`${o}px`),l.setAttribute("height",`${c}px`);const _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttribute("style","fill:#888888;stroke-width:0"),_.setAttribute("fill-opacity","0.5"),l.append(_),(n=this.map)==null||n.getCanvasContainer().appendChild(l),this.svgCanvas=l,this.svgPath=_}mapResize(){this.generateCutOut()}updateArea(t,e){this.width=t,this.height=e,this.unit=tp.mm,this.generateCutOut()}generateCutOut(){var t,e;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),n=this.toPixels(this.height),o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,c=(e=this.map)==null?void 0:e.getCanvas().clientHeight,l=o/2-r/2,_=l+r,v=c/2-n/2,S=v+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${c}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${c} L 0 ${c} M ${l} ${v} L ${l} ${S} L ${_} ${S} L ${_} ${v}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===tp.mm&&(e/=25.4),e*t}}const xE={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},DG={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer",LanguageName:"Franais",LanguageCode:"fr"},OG={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},NG={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},zG={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},jG={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Espaola",LanguageCode:"es"},UG={PageSize:"Mida",PageOrientation:"Orientaci",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},GG={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To",LanguageName:"Ting Vit",LanguageCode:"vi"},VG={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"uk"},qG={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHans"},HG={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:"",LanguageName:"",LanguageCode:"zhHant"},WG={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:"",LanguageName:"",LanguageCode:"ja"},XG={PageSize:"Tamanho da pgina",PageOrientation:"Orientao da pgina",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Portugus",LanguageCode:"pt"},ZG=[xE,DG,OG,NG,zG,jG,UG,GG,VG,qG,HG,WG,XG],$G=i=>ZG.find(t=>t.LanguageCode===i)??xE;(function(i){var t={};function e(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=i,e.c=t,e.d=function(r,n,o){e.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,n){if(1&n&&(r=e(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var c in r)e.d(o,c,(function(l){return r[l]}).bind(null,c));return o},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},e.p="",e(e.s=0)})([function(i,t,e){i.exports=e(1)},function(i,t){function e(n,o){for(var c=0;c<o.length;c++){var l=o[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(n,l.key,l)}}var r=function(){function n(){(function(l,_){if(!(l instanceof _))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,c;return o=n,(c=[{key:"show",value:function(l){this.setOptions(l),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var l=document.getElementById("loading-overlay-stylesheet");l&&(l.disabled=!0,l.parentNode.removeChild(l),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(l){if(l!==void 0)for(var _ in l)this.options[_]=l[_]}},{key:"generateAndAddOverlayElement",value:function(){var l="50%";this.options.offsetX!==0&&(l="calc(50% + "+this.options.offsetX+")");var _="50%";if(this.options.offsetY!==0&&(_="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var v='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(_,"; left: ").concat(l,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),S=document.getElementById(this.options.containerID);return S.style.position="relative",void S.insertAdjacentHTML("beforeend",v)}var T='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(_,"; left: ").concat(l,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",T)}},{key:"generateSpinnerElement",value:function(){var l=this,_=Object.keys(this.numberOfEmptyDivForSpinner).find(function(S){return S===l.options.spinnerIcon}),v=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[_]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(v,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var l=document.createElement("link");l.setAttribute("id","loading-overlay-stylesheet"),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(l)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(l){for(var _="",v=1;v<=l;v++)_+="<div></div>";return _}}])&&e(o.prototype,c),n}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);function Or(i){"@babel/helpers - typeof";return Or=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Or(i)}var qo=Uint8Array,Eo=Uint16Array,Sf=Uint32Array,Hg=new qo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Wg=new qo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$y=new qo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wE=function(i,t){for(var e=new Eo(31),r=0;r<31;++r)e[r]=t+=1<<i[r-1];for(var n=new Sf(e[30]),r=1;r<30;++r)for(var o=e[r];o<e[r+1];++o)n[o]=o-e[r]<<5|r;return[e,n]},SE=wE(Hg,2),AE=SE[0],Yy=SE[1];AE[28]=258,Yy[258]=28;var EE=wE(Wg,0),YG=EE[0],D5=EE[1],Jy=new Eo(32768);for(var ln=0;ln<32768;++ln){var Dh=(ln&43690)>>>1|(ln&21845)<<1;Dh=(Dh&52428)>>>2|(Dh&13107)<<2,Dh=(Dh&61680)>>>4|(Dh&3855)<<4,Jy[ln]=((Dh&65280)>>>8|(Dh&255)<<8)>>>1}var xc=function(i,t,e){for(var r=i.length,n=0,o=new Eo(t);n<r;++n)++o[i[n]-1];var c=new Eo(t);for(n=0;n<t;++n)c[n]=c[n-1]+o[n-1]<<1;var l;if(e){l=new Eo(1<<t);var _=15-t;for(n=0;n<r;++n)if(i[n])for(var v=n<<4|i[n],S=t-i[n],T=c[i[n]-1]++<<S,P=T|(1<<S)-1;T<=P;++T)l[Jy[T]>>>_]=v}else for(l=new Eo(r),n=0;n<r;++n)l[n]=Jy[c[i[n]-1]++]>>>15-i[n];return l},Xh=new qo(288);for(var ln=0;ln<144;++ln)Xh[ln]=8;for(var ln=144;ln<256;++ln)Xh[ln]=9;for(var ln=256;ln<280;++ln)Xh[ln]=7;for(var ln=280;ln<288;++ln)Xh[ln]=8;var Af=new qo(32);for(var ln=0;ln<32;++ln)Af[ln]=5;var JG=xc(Xh,9,0),KG=xc(Xh,9,1),QG=xc(Af,5,0),tV=xc(Af,5,1),G_=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},ml=function(i,t,e){var r=t/8>>0;return(i[r]|i[r+1]<<8)>>>(t&7)&e},V_=function(i,t){var e=t/8>>0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>>(t&7)},Bv=function(i){return(i/8>>0)+(i&7&&1)},TE=function(i,t,e){(e==null||e>i.length)&&(e=i.length);var r=new(i instanceof Eo?Eo:i instanceof Sf?Sf:qo)(e-t);return r.set(i.subarray(t,e)),r},eV=function(i,t,e){var r=i.length,n=!t||e,o=!e||e.i;e||(e={}),t||(t=new qo(r*3));var c=function(qt){var Ht=t.length;if(qt>Ht){var Jt=new qo(Math.max(Ht*2,qt));Jt.set(t),t=Jt}},l=e.f||0,_=e.p||0,v=e.b||0,S=e.l,T=e.d,P=e.m,I=e.n,z=r*8;do{if(!S){e.f=l=ml(i,_,1);var N=ml(i,_+1,3);if(_+=3,N)if(N==1)S=KG,T=tV,P=9,I=5;else if(N==2){var X=ml(i,_,31)+257,H=ml(i,_+10,15)+4,Z=X+ml(i,_+5,31)+1;_+=14;for(var ot=new qo(Z),gt=new qo(19),Et=0;Et<H;++Et)gt[$y[Et]]=ml(i,_+Et*3,7);_+=H*3;var Ft=G_(gt),Mt=(1<<Ft)-1;if(!o&&_+Z*(Ft+7)>z)break;for(var yt=xc(gt,Ft,1),Et=0;Et<Z;){var Ut=yt[ml(i,_,Mt)];_+=Ut&15;var zt=Ut>>>4;if(zt<16)ot[Et++]=zt;else{var at=0,pt=0;for(zt==16?(pt=3+ml(i,_,3),_+=2,at=ot[Et-1]):zt==17?(pt=3+ml(i,_,7),_+=3):zt==18&&(pt=11+ml(i,_,127),_+=7);pt--;)ot[Et++]=at}}var Lt=ot.subarray(0,X),bt=ot.subarray(X);P=G_(Lt),I=G_(bt),S=xc(Lt,P,1),T=xc(bt,I,1)}else throw"invalid block type";else{var zt=Bv(_)+4,ee=i[zt-4]|i[zt-3]<<8,ie=zt+ee;if(ie>r){if(o)throw"unexpected EOF";break}n&&c(v+ee),t.set(i.subarray(zt,ie),v),e.b=v+=ee,e.p=_=ie*8;continue}if(_>z)throw"unexpected EOF"}n&&c(v+131072);for(var re=(1<<P)-1,Yt=(1<<I)-1,ce=P+I+18;o||_+ce<z;){var at=S[V_(i,_)&re],le=at>>>4;if(_+=at&15,_>z)throw"unexpected EOF";if(!at)throw"invalid length/literal";if(le<256)t[v++]=le;else if(le==256){S=null;break}else{var Be=le-254;if(le>264){var Et=le-257,nt=Hg[Et];Be=ml(i,_,(1<<nt)-1)+AE[Et],_+=nt}var St=T[V_(i,_)&Yt],Tt=St>>>4;if(!St)throw"invalid distance";_+=St&15;var bt=YG[Tt];if(Tt>3){var nt=Wg[Tt];bt+=V_(i,_)&(1<<nt)-1,_+=nt}if(_>z)throw"unexpected EOF";n&&c(v+131072);for(var jt=v+Be;v<jt;v+=4)t[v]=t[v-bt],t[v+1]=t[v+1-bt],t[v+2]=t[v+2-bt],t[v+3]=t[v+3-bt];v=jt}}e.l=S,e.p=_,e.b=v,S&&(l=1,e.m=P,e.d=T,e.n=I)}while(!l);return v==t.length?t:TE(t,0,v)},$c=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8},Zp=function(i,t,e){e<<=t&7;var r=t/8>>0;i[r]|=e,i[r+1]|=e>>>8,i[r+2]|=e>>>16},q_=function(i,t){for(var e=[],r=0;r<i.length;++r)i[r]&&e.push({s:r,f:i[r]});var n=e.length,o=e.slice();if(!n)return[new qo(0),0];if(n==1){var c=new qo(e[0].s+1);return c[e[0].s]=1,[c,1]}e.sort(function(Et,Ft){return Et.f-Ft.f}),e.push({s:-1,f:25001});var l=e[0],_=e[1],v=0,S=1,T=2;for(e[0]={s:-1,f:l.f+_.f,l,r:_};S!=n-1;)l=e[e[v].f<e[T].f?v++:T++],_=e[v!=S&&e[v].f<e[T].f?v++:T++],e[S++]={s:-1,f:l.f+_.f,l,r:_};for(var P=o[0].s,r=1;r<n;++r)o[r].s>P&&(P=o[r].s);var I=new Eo(P+1),z=Ky(e[S-1],I,0);if(z>t){var r=0,N=0,X=z-t,H=1<<X;for(o.sort(function(Ft,Mt){return I[Mt.s]-I[Ft.s]||Ft.f-Mt.f});r<n;++r){var Z=o[r].s;if(I[Z]>t)N+=H-(1<<z-I[Z]),I[Z]=t;else break}for(N>>>=X;N>0;){var ot=o[r].s;I[ot]<t?N-=1<<t-I[ot]++-1:++r}for(;r>=0&&N;--r){var gt=o[r].s;I[gt]==t&&(--I[gt],++N)}z=t}return[new qo(I),z]},Ky=function(i,t,e){return i.s==-1?Math.max(Ky(i.l,t,e+1),Ky(i.r,t,e+1)):t[i.s]=e},O5=function(i){for(var t=i.length;t&&!i[--t];);for(var e=new Eo(++t),r=0,n=i[0],o=1,c=function(_){e[r++]=_},l=1;l<=t;++l)if(i[l]==n&&l!=t)++o;else{if(!n&&o>2){for(;o>138;o-=138)c(32754);o>2&&(c(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(c(n),--o;o>6;o-=6)c(8304);o>2&&(c(o-3<<5|8208),o=0)}for(;o--;)c(n);o=1,n=i[l]}return[e.subarray(0,r),t]},$p=function(i,t){for(var e=0,r=0;r<t.length;++r)e+=i[r]*t[r];return e},Qy=function(i,t,e){var r=e.length,n=Bv(t+2);i[n]=r&255,i[n+1]=r>>>8,i[n+2]=i[n]^255,i[n+3]=i[n+1]^255;for(var o=0;o<r;++o)i[n+o+4]=e[o];return(n+4+r)*8},N5=function(i,t,e,r,n,o,c,l,_,v,S){$c(t,S++,e),++n[256];for(var T=q_(n,15),P=T[0],I=T[1],z=q_(o,15),N=z[0],X=z[1],H=O5(P),Z=H[0],ot=H[1],gt=O5(N),Et=gt[0],Ft=gt[1],Mt=new Eo(19),yt=0;yt<Z.length;++yt)Mt[Z[yt]&31]++;for(var yt=0;yt<Et.length;++yt)Mt[Et[yt]&31]++;for(var Ut=q_(Mt,7),zt=Ut[0],at=Ut[1],pt=19;pt>4&&!zt[$y[pt-1]];--pt);var Lt=v+5<<3,bt=$p(n,Xh)+$p(o,Af)+c,ee=$p(n,P)+$p(o,N)+c+14+3*pt+$p(Mt,zt)+(2*Mt[16]+3*Mt[17]+7*Mt[18]);if(Lt<=bt&&Lt<=ee)return Qy(t,S,i.subarray(_,_+v));var ie,re,Yt,ce;if($c(t,S,1+(ee<bt)),S+=2,ee<bt){ie=xc(P,I,0),re=P,Yt=xc(N,X,0),ce=N;var le=xc(zt,at,0);$c(t,S,ot-257),$c(t,S+5,Ft-1),$c(t,S+10,pt-4),S+=14;for(var yt=0;yt<pt;++yt)$c(t,S+3*yt,zt[$y[yt]]);S+=3*pt;for(var Be=[Z,Et],nt=0;nt<2;++nt)for(var St=Be[nt],yt=0;yt<St.length;++yt){var Tt=St[yt]&31;$c(t,S,le[Tt]),S+=zt[Tt],Tt>15&&($c(t,S,St[yt]>>>5&127),S+=St[yt]>>>12)}}else ie=JG,re=Xh,Yt=QG,ce=Af;for(var yt=0;yt<l;++yt)if(r[yt]>255){var Tt=r[yt]>>>18&31;Zp(t,S,ie[Tt+257]),S+=re[Tt+257],Tt>7&&($c(t,S,r[yt]>>>23&31),S+=Hg[Tt]);var jt=r[yt]&31;Zp(t,S,Yt[jt]),S+=ce[jt],jt>3&&(Zp(t,S,r[yt]>>>5&8191),S+=Wg[jt])}else Zp(t,S,ie[r[yt]]),S+=re[r[yt]];return Zp(t,S,ie[256]),S+re[256]},iV=new Sf([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rV=function(i,t,e,r,n,o){var c=i.length,l=new qo(r+c+5*(1+Math.floor(c/7e3))+n),_=l.subarray(r,l.length-n),v=0;if(!t||c<8)for(var S=0;S<=c;S+=65535){var T=S+65535;T<c?v=Qy(_,v,i.subarray(S,T)):(_[S]=o,v=Qy(_,v,i.subarray(S,c)))}else{for(var P=iV[t-1],I=P>>>13,z=P&8191,N=(1<<e)-1,X=new Eo(32768),H=new Eo(N+1),Z=Math.ceil(e/3),ot=2*Z,gt=function(si){return(i[si]^i[si+1]<<Z^i[si+2]<<ot)&N},Et=new Sf(25e3),Ft=new Eo(288),Mt=new Eo(32),yt=0,Ut=0,S=0,zt=0,at=0,pt=0;S<c;++S){var Lt=gt(S),bt=S&32767,ee=H[Lt];if(X[bt]=ee,H[Lt]=bt,at<=S){var ie=c-S;if((yt>7e3||zt>24576)&&ie>423){v=N5(i,_,0,Et,Ft,Mt,Ut,zt,pt,S-pt,v),zt=yt=Ut=0,pt=S;for(var re=0;re<286;++re)Ft[re]=0;for(var re=0;re<30;++re)Mt[re]=0}var Yt=2,ce=0,le=z,Be=bt-ee&32767;if(ie>2&&Lt==gt(S-Be))for(var nt=Math.min(I,ie)-1,St=Math.min(32767,S),Tt=Math.min(258,ie);Be<=St&&--le&&bt!=ee;){if(i[S+Yt]==i[S+Yt-Be]){for(var jt=0;jt<Tt&&i[S+jt]==i[S+jt-Be];++jt);if(jt>Yt){if(Yt=jt,ce=Be,jt>nt)break;for(var qt=Math.min(Be,jt-2),Ht=0,re=0;re<qt;++re){var Jt=S-Be+re+32768&32767,$t=X[Jt],Ae=Jt-$t+32768&32767;Ae>Ht&&(Ht=Ae,ee=Jt)}}}bt=ee,ee=X[bt],Be+=bt-ee+32768&32767}if(ce){Et[zt++]=268435456|Yy[Yt]<<18|D5[ce];var Le=Yy[Yt]&31,Fe=D5[ce]&31;Ut+=Hg[Le]+Wg[Fe],++Ft[257+Le],++Mt[Fe],at=S+Yt,++yt}else Et[zt++]=i[S],++Ft[i[S]]}}v=N5(i,_,o,Et,Ft,Mt,Ut,zt,pt,S-pt,v)}return TE(l,0,r+Bv(v)+n)},nV=function(){var i=1,t=0;return{p:function(e){for(var r=i,n=t,o=e.length,c=0;c!=o;){for(var l=Math.min(c+5552,o);c<l;++c)r+=e[c],n+=r;r%=65521,n%=65521}i=r,t=n},d:function(){return(i>>>8<<16|(t&255)<<8|t>>>8)+((i&255)<<23)*2}}},sV=function(i,t,e,r,n){return rV(i,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+t.mem,e,r,!n)},oV=function(i,t,e){for(;e;++t)i[t]=e,e>>>=8},aV=function(i,t){var e=t.level,r=e==0?0:e<6?1:e==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},lV=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function t1(i,t){t===void 0&&(t={});var e=nV();e.p(i);var r=sV(i,t,2,4);return aV(r,t),oV(r,r.length-4,e.d()),r}function cV(i,t){return eV((lV(i),i.subarray(2,-4)),t)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Bi=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function H_(){Bi.console&&typeof Bi.console.log=="function"&&Bi.console.log.apply(Bi.console,arguments)}var Wr={log:H_,warn:function(i){Bi.console&&(typeof Bi.console.warn=="function"?Bi.console.warn.apply(Bi.console,arguments):H_.call(null,arguments))},error:function(i){Bi.console&&(typeof Bi.console.error=="function"?Bi.console.error.apply(Bi.console,arguments):H_(i))}};function W_(i,t,e){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){Su(r.response,t,e)},r.onerror=function(){Wr.error("could not download file")},r.send()}function z5(i){var t=new XMLHttpRequest;t.open("HEAD",i,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Dm(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(t)}}var uf,e1,Su=Bi.saveAs||((typeof window>"u"?"undefined":Or(window))!=="object"||window!==Bi?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,t,e){var r=Bi.URL||Bi.webkitURL,n=document.createElement("a");t=t||i.name||"download",n.download=t,n.rel="noopener",typeof i=="string"?(n.href=i,n.origin!==location.origin?z5(n.href)?W_(i,t,e):Dm(n,n.target="_blank"):Dm(n)):(n.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){Dm(n)},0))}:"msSaveOrOpenBlob"in navigator?function(i,t,e){if(t=t||i.name||"download",typeof i=="string")if(z5(i))W_(i,t,e);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){Dm(r)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:Or(o)!=="object"&&(Wr.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(i,e),t)}:function(i,t,e,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return W_(i,t,e);var n=i.type==="application/octet-stream",o=/constructor/i.test(Bi.HTMLElement)||Bi.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||n&&o)&&(typeof FileReader>"u"?"undefined":Or(FileReader))==="object"){var l=new FileReader;l.onloadend=function(){var S=l.result;S=c?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=S:location=S,r=null},l.readAsDataURL(i)}else{var _=Bi.URL||Bi.webkitURL,v=_.createObjectURL(i);r?r.location=v:location.href=v,r=null,setTimeout(function(){_.revokeObjectURL(v)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function CE(i){var t;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(l){return[parseInt(l[1]),parseInt(l[2]),parseInt(l[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16)]}}],r=0;r<e.length;r++){var n=e[r].re,o=e[r].process,c=n.exec(i);c&&(t=o(c),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var l=this.r.toString(16),_=this.g.toString(16),v=this.b.toString(16);return l.length==1&&(l="0"+l),_.length==1&&(_="0"+_),v.length==1&&(v="0"+v),"#"+l+_+v}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function X_(i,t){var e=i[0],r=i[1],n=i[2],o=i[3];e=Ys(e,r,n,o,t[0],7,-680876936),o=Ys(o,e,r,n,t[1],12,-389564586),n=Ys(n,o,e,r,t[2],17,606105819),r=Ys(r,n,o,e,t[3],22,-1044525330),e=Ys(e,r,n,o,t[4],7,-176418897),o=Ys(o,e,r,n,t[5],12,1200080426),n=Ys(n,o,e,r,t[6],17,-1473231341),r=Ys(r,n,o,e,t[7],22,-45705983),e=Ys(e,r,n,o,t[8],7,1770035416),o=Ys(o,e,r,n,t[9],12,-1958414417),n=Ys(n,o,e,r,t[10],17,-42063),r=Ys(r,n,o,e,t[11],22,-1990404162),e=Ys(e,r,n,o,t[12],7,1804603682),o=Ys(o,e,r,n,t[13],12,-40341101),n=Ys(n,o,e,r,t[14],17,-1502002290),e=Js(e,r=Ys(r,n,o,e,t[15],22,1236535329),n,o,t[1],5,-165796510),o=Js(o,e,r,n,t[6],9,-1069501632),n=Js(n,o,e,r,t[11],14,643717713),r=Js(r,n,o,e,t[0],20,-373897302),e=Js(e,r,n,o,t[5],5,-701558691),o=Js(o,e,r,n,t[10],9,38016083),n=Js(n,o,e,r,t[15],14,-660478335),r=Js(r,n,o,e,t[4],20,-405537848),e=Js(e,r,n,o,t[9],5,568446438),o=Js(o,e,r,n,t[14],9,-1019803690),n=Js(n,o,e,r,t[3],14,-187363961),r=Js(r,n,o,e,t[8],20,1163531501),e=Js(e,r,n,o,t[13],5,-1444681467),o=Js(o,e,r,n,t[2],9,-51403784),n=Js(n,o,e,r,t[7],14,1735328473),e=Ks(e,r=Js(r,n,o,e,t[12],20,-1926607734),n,o,t[5],4,-378558),o=Ks(o,e,r,n,t[8],11,-2022574463),n=Ks(n,o,e,r,t[11],16,1839030562),r=Ks(r,n,o,e,t[14],23,-35309556),e=Ks(e,r,n,o,t[1],4,-1530992060),o=Ks(o,e,r,n,t[4],11,1272893353),n=Ks(n,o,e,r,t[7],16,-155497632),r=Ks(r,n,o,e,t[10],23,-1094730640),e=Ks(e,r,n,o,t[13],4,681279174),o=Ks(o,e,r,n,t[0],11,-358537222),n=Ks(n,o,e,r,t[3],16,-722521979),r=Ks(r,n,o,e,t[6],23,76029189),e=Ks(e,r,n,o,t[9],4,-640364487),o=Ks(o,e,r,n,t[12],11,-421815835),n=Ks(n,o,e,r,t[15],16,530742520),e=Qs(e,r=Ks(r,n,o,e,t[2],23,-995338651),n,o,t[0],6,-198630844),o=Qs(o,e,r,n,t[7],10,1126891415),n=Qs(n,o,e,r,t[14],15,-1416354905),r=Qs(r,n,o,e,t[5],21,-57434055),e=Qs(e,r,n,o,t[12],6,1700485571),o=Qs(o,e,r,n,t[3],10,-1894986606),n=Qs(n,o,e,r,t[10],15,-1051523),r=Qs(r,n,o,e,t[1],21,-2054922799),e=Qs(e,r,n,o,t[8],6,1873313359),o=Qs(o,e,r,n,t[15],10,-30611744),n=Qs(n,o,e,r,t[6],15,-1560198380),r=Qs(r,n,o,e,t[13],21,1309151649),e=Qs(e,r,n,o,t[4],6,-145523070),o=Qs(o,e,r,n,t[11],10,-1120210379),n=Qs(n,o,e,r,t[2],15,718787259),r=Qs(r,n,o,e,t[9],21,-343485551),i[0]=Uh(e,i[0]),i[1]=Uh(r,i[1]),i[2]=Uh(n,i[2]),i[3]=Uh(o,i[3])}function Xg(i,t,e,r,n,o){return t=Uh(Uh(t,i),Uh(r,o)),Uh(t<<n|t>>>32-n,e)}function Ys(i,t,e,r,n,o,c){return Xg(t&e|~t&r,i,t,n,o,c)}function Js(i,t,e,r,n,o,c){return Xg(t&r|e&~r,i,t,n,o,c)}function Ks(i,t,e,r,n,o,c){return Xg(t^e^r,i,t,n,o,c)}function Qs(i,t,e,r,n,o,c){return Xg(e^(t|~r),i,t,n,o,c)}function PE(i){var t,e=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=i.length;t+=64)X_(r,hV(i.substring(t-64,t)));i=i.substring(t-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i.length;t++)n[t>>2]|=i.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(X_(r,n),t=0;t<16;t++)n[t]=0;return n[14]=8*e,X_(r,n),r}function hV(i){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return e}uf=Bi.atob.bind(Bi),e1=Bi.btoa.bind(Bi);var j5="0123456789abcdef".split("");function uV(i){for(var t="",e=0;e<4;e++)t+=j5[i>>8*e+4&15]+j5[i>>8*e&15];return t}function dV(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function i1(i){return PE(i).map(dV).join("")}var pV=function(i){for(var t=0;t<i.length;t++)i[t]=uV(i[t]);return i.join("")}(PE("hello"))!="5d41402abc4b2a76b9719d911017c592";function Uh(i,t){if(pV){var e=(65535&i)+(65535&t);return(i>>16)+(t>>16)+(e>>16)<<16|65535&e}return i+t&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function r1(i,t){var e,r,n,o;if(i!==e){for(var c=(n=i,o=1+(256/i.length>>0),new Array(o+1).join(n)),l=[],_=0;_<256;_++)l[_]=_;var v=0;for(_=0;_<256;_++){var S=l[_];v=(v+S+c.charCodeAt(_))%256,l[_]=l[v],l[v]=S}e=i,r=l}else l=r;var T=t.length,P=0,I=0,z="";for(_=0;_<T;_++)I=(I+(S=l[P=(P+1)%256]))%256,l[P]=l[I],l[I]=S,c=l[(l[P]+l[I])%256],z+=String.fromCharCode(t.charCodeAt(_)^c);return z}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var U5={print:4,modify:8,copy:16,"annot-forms":32};function Td(i,t,e,r){this.v=1,this.r=2;var n=192;i.forEach(function(l){if(U5.perm!==void 0)throw new Error("Invalid permission: "+l);n+=U5[l]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(t+this.padding).substr(0,32),c=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,c),this.P=-(1+(255^n)),this.encryptionKey=i1(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=r1(this.encryptionKey,this.padding)}function Cd(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var t="",e=i.length,r=0;r<e;r++){var n=i.charCodeAt(r);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?t+="#"+("0"+n.toString(16)).slice(-2):t+=i[r]}return t}function G5(i){if(Or(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,r,n){if(n=n||!1,typeof e!="string"||typeof r!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var o=Math.random().toString(35);return t[e][o]=[r,!!n],o},this.unsubscribe=function(e){for(var r in t)if(t[r][e])return delete t[r][e],Object.keys(t[r]).length===0&&delete t[r],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var r=Array.prototype.slice.call(arguments,1),n=[];for(var o in t[e]){var c=t[e][o];try{c[0].apply(i,r)}catch(l){Bi.console&&Wr.error("jsPDF PubSub Error",l.message,l)}c[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Cg(i){if(!(this instanceof Cg))return new Cg(i);var t="opacity,stroke-opacity".split(",");for(var e in i)i.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=i[e]);this.id="",this.objectNumber=-1}function IE(i,t){this.gState=i,this.matrix=t,this.id="",this.objectNumber=-1}function Tu(i,t,e,r,n){if(!(this instanceof Tu))return new Tu(i,t,e,r,n);this.type=i==="axial"?2:3,this.coords=t,this.colors=e,IE.call(this,r,n)}function Rd(i,t,e,r,n){if(!(this instanceof Rd))return new Rd(i,t,e,r,n);this.boundingBox=i,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,IE.call(this,r,n)}function Mi(i){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],n=arguments[2],o=arguments[3],c=[],l=1,_=16,v="S",S=null;Or(i=i||{})==="object"&&(e=i.orientation,r=i.unit||r,n=i.format||n,o=i.compress||i.compressPdf||o,(S=i.encryption||null)!==null&&(S.userPassword=S.userPassword||"",S.ownerPassword=S.ownerPassword||"",S.userPermissions=S.userPermissions||[]),l=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(t=i.precision),i.floatPrecision!==void 0&&(_=i.floatPrecision),v=i.defaultPathOperation||"S"),c=i.filters||(o===!0?["FlateEncode"]:c),r=r||"mm",e=(""+(e||"P")).toLowerCase();var T=i.putOnlyUsedFonts||!1,P={},I={internal:{},__private__:{}};I.__private__.PubSub=G5;var z="1.3",N=I.__private__.getPdfVersion=function(){return z};I.__private__.setPdfVersion=function(k){z=k};var X={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};I.__private__.getPageFormats=function(){return X};var H=I.__private__.getPageFormat=function(k){return X[k]};n=n||"a4";var Z={COMPAT:"compat",ADVANCED:"advanced"},ot=Z.COMPAT;function gt(){this.saveGraphicsState(),it(new Rt(ke,0,0,-ke,0,Ta()*ke).toString()+" cm"),this.setFontSize(this.getFontSize()/ke),v="n",ot=Z.ADVANCED}function Et(){this.restoreGraphicsState(),v="S",ot=Z.COMPAT}var Ft=I.__private__.combineFontStyleAndFontWeight=function(k,et){if(k=="bold"&&et=="normal"||k=="bold"&&et==400||k=="normal"&&et=="italic"||k=="bold"&&et=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return et&&(k=et==400||et==="normal"?k==="italic"?"italic":"normal":et!=700&&et!=="bold"||k!=="normal"?(et==700?"bold":et)+""+k:"bold"),k};I.advancedAPI=function(k){var et=ot===Z.COMPAT;return et&&gt.call(this),typeof k!="function"||(k(this),et&&Et.call(this)),this},I.compatAPI=function(k){var et=ot===Z.ADVANCED;return et&&Et.call(this),typeof k!="function"||(k(this),et&&gt.call(this)),this},I.isAdvancedAPI=function(){return ot===Z.ADVANCED};var Mt,yt=function(k){if(ot!==Z.ADVANCED)throw new Error(k+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Ut=I.roundToPrecision=I.__private__.roundToPrecision=function(k,et){var At=t||et;if(isNaN(k)||isNaN(At))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return k.toFixed(At).replace(/0+$/,"")};Mt=I.hpf=I.__private__.hpf=typeof _=="number"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return Ut(k,_)}:_==="smart"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return Ut(k,k>-1&&k<1?16:5)}:function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return Ut(k,16)};var zt=I.f2=I.__private__.f2=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f2");return Ut(k,2)},at=I.__private__.f3=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f3");return Ut(k,3)},pt=I.scale=I.__private__.scale=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.scale");return ot===Z.COMPAT?k*ke:ot===Z.ADVANCED?k:void 0},Lt=function(k){return ot===Z.COMPAT?Ta()-k:ot===Z.ADVANCED?k:void 0},bt=function(k){return pt(Lt(k))};I.__private__.setPrecision=I.setPrecision=function(k){typeof parseInt(k,10)=="number"&&(t=parseInt(k,10))};var ee,ie="00000000000000000000000000000000",re=I.__private__.getFileId=function(){return ie},Yt=I.__private__.setFileId=function(k){return ie=k!==void 0&&/^[a-fA-F0-9]{32}$/.test(k)?k.toUpperCase():ie.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),S!==null&&(er=new Td(S.userPermissions,S.userPassword,S.ownerPassword,ie)),ie};I.setFileId=function(k){return Yt(k),this},I.getFileId=function(){return re()};var ce=I.__private__.convertDateToPDFDate=function(k){var et=k.getTimezoneOffset(),At=et<0?"+":"-",Ot=Math.floor(Math.abs(et/60)),Xt=Math.abs(et%60),ae=[At,Tt(Ot),"'",Tt(Xt),"'"].join("");return["D:",k.getFullYear(),Tt(k.getMonth()+1),Tt(k.getDate()),Tt(k.getHours()),Tt(k.getMinutes()),Tt(k.getSeconds()),ae].join("")},le=I.__private__.convertPDFDateToDate=function(k){var et=parseInt(k.substr(2,4),10),At=parseInt(k.substr(6,2),10)-1,Ot=parseInt(k.substr(8,2),10),Xt=parseInt(k.substr(10,2),10),ae=parseInt(k.substr(12,2),10),Ie=parseInt(k.substr(14,2),10);return new Date(et,At,Ot,Xt,ae,Ie,0)},Be=I.__private__.setCreationDate=function(k){var et;if(k===void 0&&(k=new Date),k instanceof Date)et=ce(k);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(k))throw new Error("Invalid argument passed to jsPDF.setCreationDate");et=k}return ee=et},nt=I.__private__.getCreationDate=function(k){var et=ee;return k==="jsDate"&&(et=le(ee)),et};I.setCreationDate=function(k){return Be(k),this},I.getCreationDate=function(k){return nt(k)};var St,Tt=I.__private__.padd2=function(k){return("0"+parseInt(k)).slice(-2)},jt=I.__private__.padd2Hex=function(k){return("00"+(k=k.toString())).substr(k.length)},qt=0,Ht=[],Jt=[],$t=0,Ae=[],Le=[],Fe=!1,Ne=Jt,si=function(){qt=0,$t=0,Jt=[],Ht=[],Ae=[],Li=be(),Qe=be()};I.__private__.setCustomOutputDestination=function(k){Fe=!0,Ne=k};var oe=function(k){Fe||(Ne=k)};I.__private__.resetCustomOutputDestination=function(){Fe=!1,Ne=Jt};var it=I.__private__.out=function(k){return k=k.toString(),$t+=k.length+1,Ne.push(k),Ne},pi=I.__private__.write=function(k){return it(arguments.length===1?k.toString():Array.prototype.join.call(arguments," "))},Ke=I.__private__.getArrayBuffer=function(k){for(var et=k.length,At=new ArrayBuffer(et),Ot=new Uint8Array(At);et--;)Ot[et]=k.charCodeAt(et);return At},de=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];I.__private__.getStandardFonts=function(){return de};var Ee=i.fontSize||16;I.__private__.setFontSize=I.setFontSize=function(k){return Ee=ot===Z.ADVANCED?k/ke:k,this};var Me,De=I.__private__.getFontSize=I.getFontSize=function(){return ot===Z.COMPAT?Ee:Ee*ke},ei=i.R2L||!1;I.__private__.setR2L=I.setR2L=function(k){return ei=k,this},I.__private__.getR2L=I.getR2L=function(){return ei};var Si,vi=I.__private__.setZoomMode=function(k){var et=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(k))Me=k;else if(isNaN(k)){if(et.indexOf(k)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+k+'" is not recognized.');Me=k}else Me=parseInt(k,10)};I.__private__.getZoomMode=function(){return Me};var Ri,zi=I.__private__.setPageMode=function(k){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(k)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+k+'" is not recognized.');Si=k};I.__private__.getPageMode=function(){return Si};var me=I.__private__.setLayoutMode=function(k){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(k)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+k+'" is not recognized.');Ri=k};I.__private__.getLayoutMode=function(){return Ri},I.__private__.setDisplayMode=I.setDisplayMode=function(k,et,At){return vi(k),me(et),zi(At),this};var ci={title:"",subject:"",author:"",keywords:"",creator:""};I.__private__.getDocumentProperty=function(k){if(Object.keys(ci).indexOf(k)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return ci[k]},I.__private__.getDocumentProperties=function(){return ci},I.__private__.setDocumentProperties=I.setProperties=I.setDocumentProperties=function(k){for(var et in ci)ci.hasOwnProperty(et)&&k[et]&&(ci[et]=k[et]);return this},I.__private__.setDocumentProperty=function(k,et){if(Object.keys(ci).indexOf(k)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return ci[k]=et};var bi,ke,_r,ge,yi,Ue={},Vi={},Zr=[],ze={},_n={},ir={},Qr={},tn=null,xt=0,Y=[],K=new G5(I),ct=i.hotfixes||[],_t={},kt={},Gt=[],Rt=function k(et,At,Ot,Xt,ae,Ie){if(!(this instanceof k))return new k(et,At,Ot,Xt,ae,Ie);isNaN(et)&&(et=1),isNaN(At)&&(At=0),isNaN(Ot)&&(Ot=0),isNaN(Xt)&&(Xt=1),isNaN(ae)&&(ae=0),isNaN(Ie)&&(Ie=0),this._matrix=[et,At,Ot,Xt,ae,Ie]};Object.defineProperty(Rt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(Rt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(Rt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(Rt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(Rt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(Rt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(Rt.prototype,"a",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(Rt.prototype,"b",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(Rt.prototype,"c",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(Rt.prototype,"d",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(Rt.prototype,"e",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(Rt.prototype,"f",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(Rt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Rt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Rt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Rt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Rt.prototype.join=function(k){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(Mt).join(k)},Rt.prototype.multiply=function(k){var et=k.sx*this.sx+k.shy*this.shx,At=k.sx*this.shy+k.shy*this.sy,Ot=k.shx*this.sx+k.sy*this.shx,Xt=k.shx*this.shy+k.sy*this.sy,ae=k.tx*this.sx+k.ty*this.shx+this.tx,Ie=k.tx*this.shy+k.ty*this.sy+this.ty;return new Rt(et,At,Ot,Xt,ae,Ie)},Rt.prototype.decompose=function(){var k=this.sx,et=this.shy,At=this.shx,Ot=this.sy,Xt=this.tx,ae=this.ty,Ie=Math.sqrt(k*k+et*et),He=(k/=Ie)*At+(et/=Ie)*Ot;At-=k*He,Ot-=et*He;var gi=Math.sqrt(At*At+Ot*Ot);return He/=gi,k*(Ot/=gi)<et*(At/=gi)&&(k=-k,et=-et,He=-He,Ie=-Ie),{scale:new Rt(Ie,0,0,gi,0,0),translate:new Rt(1,0,0,1,Xt,ae),rotate:new Rt(k,et,-et,k,0,0),skew:new Rt(1,0,He,1,0,0)}},Rt.prototype.toString=function(k){return this.join(" ")},Rt.prototype.inversed=function(){var k=this.sx,et=this.shy,At=this.shx,Ot=this.sy,Xt=this.tx,ae=this.ty,Ie=1/(k*Ot-et*At),He=Ot*Ie,gi=-et*Ie,Ii=-At*Ie,Di=k*Ie;return new Rt(He,gi,Ii,Di,-He*Xt-Ii*ae,-gi*Xt-Di*ae)},Rt.prototype.applyToPoint=function(k){var et=k.x*this.sx+k.y*this.shx+this.tx,At=k.x*this.shy+k.y*this.sy+this.ty;return new ks(et,At)},Rt.prototype.applyToRectangle=function(k){var et=this.applyToPoint(k),At=this.applyToPoint(new ks(k.x+k.w,k.y+k.h));return new jl(et.x,et.y,At.x-et.x,At.y-et.y)},Rt.prototype.clone=function(){var k=this.sx,et=this.shy,At=this.shx,Ot=this.sy,Xt=this.tx,ae=this.ty;return new Rt(k,et,At,Ot,Xt,ae)},I.Matrix=Rt;var Ct=I.matrixMult=function(k,et){return et.multiply(k)},te=new Rt(1,0,0,1,0,0);I.unitMatrix=I.identityMatrix=te;var he=function(k,et){if(!_n[k]){var At=(et instanceof Tu?"Sh":"P")+(Object.keys(ze).length+1).toString(10);et.id=At,_n[k]=At,ze[At]=et,K.publish("addPattern",et)}};I.ShadingPattern=Tu,I.TilingPattern=Rd,I.addShadingPattern=function(k,et){return yt("addShadingPattern()"),he(k,et),this},I.beginTilingPattern=function(k){yt("beginTilingPattern()"),Cc(k.boundingBox[0],k.boundingBox[1],k.boundingBox[2]-k.boundingBox[0],k.boundingBox[3]-k.boundingBox[1],k.matrix)},I.endTilingPattern=function(k,et){yt("endTilingPattern()"),et.stream=Le[St].join(`
`),he(k,et),K.publish("endTilingPattern",et),Gt.pop().restore()};var Wt=I.__private__.newObject=function(){var k=be();return We(k,!0),k},be=I.__private__.newObjectDeferred=function(){return qt++,Ht[qt]=function(){return $t},qt},We=function(k,et){return et=typeof et=="boolean"&&et,Ht[k]=$t,et&&it(k+" 0 obj"),k},Je=I.__private__.newAdditionalObject=function(){var k={objId:be(),content:""};return Ae.push(k),k},Li=be(),Qe=be(),Ci=I.__private__.decodeColorString=function(k){var et=k.split(" ");if(et.length!==2||et[1]!=="g"&&et[1]!=="G")et.length===5&&(et[4]==="k"||et[4]==="K")&&(et=[(1-et[0])*(1-et[3]),(1-et[1])*(1-et[3]),(1-et[2])*(1-et[3]),"r"]);else{var At=parseFloat(et[0]);et=[At,At,At,"r"]}for(var Ot="#",Xt=0;Xt<3;Xt++)Ot+=("0"+Math.floor(255*parseFloat(et[Xt])).toString(16)).slice(-2);return Ot},xi=I.__private__.encodeColorString=function(k){var et;typeof k=="string"&&(k={ch1:k});var At=k.ch1,Ot=k.ch2,Xt=k.ch3,ae=k.ch4,Ie=k.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof At=="string"&&At.charAt(0)!=="#"){var He=new CE(At);if(He.ok)At=He.toHex();else if(!/^\d*\.?\d*$/.test(At))throw new Error('Invalid color "'+At+'" passed to jsPDF.encodeColorString.')}if(typeof At=="string"&&/^#[0-9A-Fa-f]{3}$/.test(At)&&(At="#"+At[1]+At[1]+At[2]+At[2]+At[3]+At[3]),typeof At=="string"&&/^#[0-9A-Fa-f]{6}$/.test(At)){var gi=parseInt(At.substr(1),16);At=gi>>16&255,Ot=gi>>8&255,Xt=255&gi}if(Ot===void 0||ae===void 0&&At===Ot&&Ot===Xt)if(typeof At=="string")et=At+" "+Ie[0];else switch(k.precision){case 2:et=zt(At/255)+" "+Ie[0];break;case 3:default:et=at(At/255)+" "+Ie[0]}else if(ae===void 0||Or(ae)==="object"){if(ae&&!isNaN(ae.a)&&ae.a===0)return et=["1.","1.","1.",Ie[1]].join(" ");if(typeof At=="string")et=[At,Ot,Xt,Ie[1]].join(" ");else switch(k.precision){case 2:et=[zt(At/255),zt(Ot/255),zt(Xt/255),Ie[1]].join(" ");break;default:case 3:et=[at(At/255),at(Ot/255),at(Xt/255),Ie[1]].join(" ")}}else if(typeof At=="string")et=[At,Ot,Xt,ae,Ie[2]].join(" ");else switch(k.precision){case 2:et=[zt(At),zt(Ot),zt(Xt),zt(ae),Ie[2]].join(" ");break;case 3:default:et=[at(At),at(Ot),at(Xt),at(ae),Ie[2]].join(" ")}return et},rr=I.__private__.getFilters=function(){return c},Hi=I.__private__.putStream=function(k){var et=(k=k||{}).data||"",At=k.filters||rr(),Ot=k.alreadyAppliedFilters||[],Xt=k.addLength1||!1,ae=et.length,Ie=k.objectId,He=function(Fn){return Fn};if(S!==null&&Ie===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");S!==null&&(He=er.encryptor(Ie,0));var gi={};At===!0&&(At=["FlateEncode"]);var Ii=k.additionalKeyValues||[],Di=(gi=Mi.API.processDataByFilters!==void 0?Mi.API.processDataByFilters(et,At):{data:et,reverseChain:[]}).reverseChain+(Array.isArray(Ot)?Ot.join(" "):Ot.toString());if(gi.data.length!==0&&(Ii.push({key:"Length",value:gi.data.length}),Xt===!0&&Ii.push({key:"Length1",value:ae})),Di.length!=0)if(Di.split("/").length-1==1)Ii.push({key:"Filter",value:Di});else{Ii.push({key:"Filter",value:"["+Di+"]"});for(var Ui=0;Ui<Ii.length;Ui+=1)if(Ii[Ui].key==="DecodeParms"){for(var Br=[],en=0;en<gi.reverseChain.split("/").length-1;en+=1)Br.push("null");Br.push(Ii[Ui].value),Ii[Ui].value="["+Br.join(" ")+"]"}}it("<<");for(var Oi=0;Oi<Ii.length;Oi++)it("/"+Ii[Oi].key+" "+Ii[Oi].value);it(">>"),gi.data.length!==0&&(it("stream"),it(He(gi.data)),it("endstream"))},hi=I.__private__.putPage=function(k){var et=k.number,At=k.data,Ot=k.objId,Xt=k.contentsObjId;We(Ot,!0),it("<</Type /Page"),it("/Parent "+k.rootDictionaryObjId+" 0 R"),it("/Resources "+k.resourceDictionaryObjId+" 0 R"),it("/MediaBox ["+parseFloat(Mt(k.mediaBox.bottomLeftX))+" "+parseFloat(Mt(k.mediaBox.bottomLeftY))+" "+Mt(k.mediaBox.topRightX)+" "+Mt(k.mediaBox.topRightY)+"]"),k.cropBox!==null&&it("/CropBox ["+Mt(k.cropBox.bottomLeftX)+" "+Mt(k.cropBox.bottomLeftY)+" "+Mt(k.cropBox.topRightX)+" "+Mt(k.cropBox.topRightY)+"]"),k.bleedBox!==null&&it("/BleedBox ["+Mt(k.bleedBox.bottomLeftX)+" "+Mt(k.bleedBox.bottomLeftY)+" "+Mt(k.bleedBox.topRightX)+" "+Mt(k.bleedBox.topRightY)+"]"),k.trimBox!==null&&it("/TrimBox ["+Mt(k.trimBox.bottomLeftX)+" "+Mt(k.trimBox.bottomLeftY)+" "+Mt(k.trimBox.topRightX)+" "+Mt(k.trimBox.topRightY)+"]"),k.artBox!==null&&it("/ArtBox ["+Mt(k.artBox.bottomLeftX)+" "+Mt(k.artBox.bottomLeftY)+" "+Mt(k.artBox.topRightX)+" "+Mt(k.artBox.topRightY)+"]"),typeof k.userUnit=="number"&&k.userUnit!==1&&it("/UserUnit "+k.userUnit),K.publish("putPage",{objId:Ot,pageContext:Y[et],pageNumber:et,page:At}),it("/Contents "+Xt+" 0 R"),it(">>"),it("endobj");var ae=At.join(`
`);return ot===Z.ADVANCED&&(ae+=`
Q`),We(Xt,!0),Hi({data:ae,filters:rr(),objectId:Xt}),it("endobj"),Ot},Fi=I.__private__.putPages=function(){var k,et,At=[];for(k=1;k<=xt;k++)Y[k].objId=be(),Y[k].contentsObjId=be();for(k=1;k<=xt;k++)At.push(hi({number:k,data:Le[k],objId:Y[k].objId,contentsObjId:Y[k].contentsObjId,mediaBox:Y[k].mediaBox,cropBox:Y[k].cropBox,bleedBox:Y[k].bleedBox,trimBox:Y[k].trimBox,artBox:Y[k].artBox,userUnit:Y[k].userUnit,rootDictionaryObjId:Li,resourceDictionaryObjId:Qe}));We(Li,!0),it("<</Type /Pages");var Ot="/Kids [";for(et=0;et<xt;et++)Ot+=At[et]+" 0 R ";it(Ot+"]"),it("/Count "+xt),it(">>"),it("endobj"),K.publish("postPutPages")},Qi=function(k){K.publish("putFont",{font:k,out:it,newObject:Wt,putStream:Hi}),k.isAlreadyPutted!==!0&&(k.objectNumber=Wt(),it("<<"),it("/Type /Font"),it("/BaseFont /"+Cd(k.postScriptName)),it("/Subtype /Type1"),typeof k.encoding=="string"&&it("/Encoding /"+k.encoding),it("/FirstChar 32"),it("/LastChar 255"),it(">>"),it("endobj"))},pr=function(){for(var k in Ue)Ue.hasOwnProperty(k)&&(T===!1||T===!0&&P.hasOwnProperty(k))&&Qi(Ue[k])},Ar=function(k){k.objectNumber=Wt();var et=[];et.push({key:"Type",value:"/XObject"}),et.push({key:"Subtype",value:"/Form"}),et.push({key:"BBox",value:"["+[Mt(k.x),Mt(k.y),Mt(k.x+k.width),Mt(k.y+k.height)].join(" ")+"]"}),et.push({key:"Matrix",value:"["+k.matrix.toString()+"]"});var At=k.pages[1].join(`
`);Hi({data:At,additionalKeyValues:et,objectId:k.objectNumber}),it("endobj")},$r=function(){for(var k in _t)_t.hasOwnProperty(k)&&Ar(_t[k])},so=function(k,et){var At,Ot=[],Xt=1/(et-1);for(At=0;At<1;At+=Xt)Ot.push(At);if(Ot.push(1),k[0].offset!=0){var ae={offset:0,color:k[0].color};k.unshift(ae)}if(k[k.length-1].offset!=1){var Ie={offset:1,color:k[k.length-1].color};k.push(Ie)}for(var He="",gi=0,Ii=0;Ii<Ot.length;Ii++){for(At=Ot[Ii];At>k[gi+1].offset;)gi++;var Di=k[gi].offset,Ui=(At-Di)/(k[gi+1].offset-Di),Br=k[gi].color,en=k[gi+1].color;He+=jt(Math.round((1-Ui)*Br[0]+Ui*en[0]).toString(16))+jt(Math.round((1-Ui)*Br[1]+Ui*en[1]).toString(16))+jt(Math.round((1-Ui)*Br[2]+Ui*en[2]).toString(16))}return He.trim()},$i=function(k,et){et||(et=21);var At=Wt(),Ot=so(k.colors,et),Xt=[];Xt.push({key:"FunctionType",value:"0"}),Xt.push({key:"Domain",value:"[0.0 1.0]"}),Xt.push({key:"Size",value:"["+et+"]"}),Xt.push({key:"BitsPerSample",value:"8"}),Xt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Xt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Hi({data:Ot,additionalKeyValues:Xt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:At}),it("endobj"),k.objectNumber=Wt(),it("<< /ShadingType "+k.type),it("/ColorSpace /DeviceRGB");var ae="/Coords ["+Mt(parseFloat(k.coords[0]))+" "+Mt(parseFloat(k.coords[1]))+" ";k.type===2?ae+=Mt(parseFloat(k.coords[2]))+" "+Mt(parseFloat(k.coords[3])):ae+=Mt(parseFloat(k.coords[2]))+" "+Mt(parseFloat(k.coords[3]))+" "+Mt(parseFloat(k.coords[4]))+" "+Mt(parseFloat(k.coords[5])),it(ae+="]"),k.matrix&&it("/Matrix ["+k.matrix.toString()+"]"),it("/Function "+At+" 0 R"),it("/Extend [true true]"),it(">>"),it("endobj")},yn=function(k,et){var At=be(),Ot=Wt();et.push({resourcesOid:At,objectOid:Ot}),k.objectNumber=Ot;var Xt=[];Xt.push({key:"Type",value:"/Pattern"}),Xt.push({key:"PatternType",value:"1"}),Xt.push({key:"PaintType",value:"1"}),Xt.push({key:"TilingType",value:"1"}),Xt.push({key:"BBox",value:"["+k.boundingBox.map(Mt).join(" ")+"]"}),Xt.push({key:"XStep",value:Mt(k.xStep)}),Xt.push({key:"YStep",value:Mt(k.yStep)}),Xt.push({key:"Resources",value:At+" 0 R"}),k.matrix&&Xt.push({key:"Matrix",value:"["+k.matrix.toString()+"]"}),Hi({data:k.stream,additionalKeyValues:Xt,objectId:k.objectNumber}),it("endobj")},Xn=function(k){var et;for(et in ze)ze.hasOwnProperty(et)&&(ze[et]instanceof Tu?$i(ze[et]):ze[et]instanceof Rd&&yn(ze[et],k))},Ir=function(k){for(var et in k.objectNumber=Wt(),it("<<"),k)switch(et){case"opacity":it("/ca "+zt(k[et]));break;case"stroke-opacity":it("/CA "+zt(k[et]))}it(">>"),it("endobj")},Lr=function(){var k;for(k in ir)ir.hasOwnProperty(k)&&Ir(ir[k])},oo=function(){for(var k in it("/XObject <<"),_t)_t.hasOwnProperty(k)&&_t[k].objectNumber>=0&&it("/"+k+" "+_t[k].objectNumber+" 0 R");K.publish("putXobjectDict"),it(">>")},Mr=function(){er.oid=Wt(),it("<<"),it("/Filter /Standard"),it("/V "+er.v),it("/R "+er.r),it("/U <"+er.toHexString(er.U)+">"),it("/O <"+er.toHexString(er.O)+">"),it("/P "+er.P),it(">>"),it("endobj")},Er=function(){for(var k in it("/Font <<"),Ue)Ue.hasOwnProperty(k)&&(T===!1||T===!0&&P.hasOwnProperty(k))&&it("/"+k+" "+Ue[k].objectNumber+" 0 R");it(">>")},ao=function(){if(Object.keys(ze).length>0){for(var k in it("/Shading <<"),ze)ze.hasOwnProperty(k)&&ze[k]instanceof Tu&&ze[k].objectNumber>=0&&it("/"+k+" "+ze[k].objectNumber+" 0 R");K.publish("putShadingPatternDict"),it(">>")}},Zn=function(k){if(Object.keys(ze).length>0){for(var et in it("/Pattern <<"),ze)ze.hasOwnProperty(et)&&ze[et]instanceof I.TilingPattern&&ze[et].objectNumber>=0&&ze[et].objectNumber<k&&it("/"+et+" "+ze[et].objectNumber+" 0 R");K.publish("putTilingPatternDict"),it(">>")}},yr=function(){if(Object.keys(ir).length>0){var k;for(k in it("/ExtGState <<"),ir)ir.hasOwnProperty(k)&&ir[k].objectNumber>=0&&it("/"+k+" "+ir[k].objectNumber+" 0 R");K.publish("putGStateDict"),it(">>")}},Yi=function(k){We(k.resourcesOid,!0),it("<<"),it("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Er(),ao(),Zn(k.objectOid),yr(),oo(),it(">>"),it("endobj")},un=function(){var k=[];pr(),Lr(),$r(),Xn(k),K.publish("putResources"),k.forEach(Yi),Yi({resourcesOid:Qe,objectOid:Number.MAX_SAFE_INTEGER}),K.publish("postPutResources")},fr=function(){K.publish("putAdditionalObjects");for(var k=0;k<Ae.length;k++){var et=Ae[k];We(et.objId,!0),it(et.content),it("endobj")}K.publish("postPutAdditionalObjects")},lo=function(k){Vi[k.fontName]=Vi[k.fontName]||{},Vi[k.fontName][k.fontStyle]=k.id},dn=function(k,et,At,Ot,Xt){var ae={id:"F"+(Object.keys(Ue).length+1).toString(10),postScriptName:k,fontName:et,fontStyle:At,encoding:Ot,isStandardFont:Xt||!1,metadata:{}};return K.publish("addFont",{font:ae,instance:this}),Ue[ae.id]=ae,lo(ae),ae.id},$o=function(k){for(var et=0,At=de.length;et<At;et++){var Ot=dn.call(this,k[et][0],k[et][1],k[et][2],de[et][3],!0);T===!1&&(P[Ot]=!0);var Xt=k[et][0].split("-");lo({id:Ot,fontName:Xt[0],fontStyle:Xt[1]||""})}K.publish("addFonts",{fonts:Ue,dictionary:Vi})},Tr=function(k){return k.foo=function(){try{return k.apply(this,arguments)}catch(Ot){var et=Ot.stack||"";~et.indexOf(" at ")&&(et=et.split(" at ")[1]);var At="Error in function "+et.split(`
`)[0].split("<")[0]+": "+Ot.message;if(!Bi.console)throw new Error(At);Bi.console.error(At,Ot),Bi.alert&&alert(At)}},k.foo.bar=k,k.foo},$n=function(k,et){var At,Ot,Xt,ae,Ie,He,gi,Ii,Di;if(Xt=(et=et||{}).sourceEncoding||"Unicode",Ie=et.outputEncoding,(et.autoencode||Ie)&&Ue[bi].metadata&&Ue[bi].metadata[Xt]&&Ue[bi].metadata[Xt].encoding&&(ae=Ue[bi].metadata[Xt].encoding,!Ie&&Ue[bi].encoding&&(Ie=Ue[bi].encoding),!Ie&&ae.codePages&&(Ie=ae.codePages[0]),typeof Ie=="string"&&(Ie=ae[Ie]),Ie)){for(gi=!1,He=[],At=0,Ot=k.length;At<Ot;At++)(Ii=Ie[k.charCodeAt(At)])?He.push(String.fromCharCode(Ii)):He.push(k[At]),He[At].charCodeAt(0)>>8&&(gi=!0);k=He.join("")}for(At=k.length;gi===void 0&&At!==0;)k.charCodeAt(At-1)>>8&&(gi=!0),At--;if(!gi)return k;for(He=et.noBOM?[]:[254,255],At=0,Ot=k.length;At<Ot;At++){if((Di=(Ii=k.charCodeAt(At))>>8)>>8)throw new Error("Character at position "+At+" of string '"+k+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");He.push(Di),He.push(Ii-(Di<<8))}return String.fromCharCode.apply(void 0,He)},pn=I.__private__.pdfEscape=I.pdfEscape=function(k,et){return $n(k,et).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},as=I.__private__.beginPage=function(k){Le[++xt]=[],Y[xt]={objId:0,contentsObjId:0,userUnit:Number(l),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(k[0]),topRightY:Number(k[1])}},Aa(xt),oe(Le[St])},Yn=function(k,et){var At,Ot,Xt;switch(e=et||e,typeof k=="string"&&(At=H(k.toLowerCase()),Array.isArray(At)&&(Ot=At[0],Xt=At[1])),Array.isArray(k)&&(Ot=k[0]*ke,Xt=k[1]*ke),isNaN(Ot)&&(Ot=n[0],Xt=n[1]),(Ot>14400||Xt>14400)&&(Wr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),Ot=Math.min(14400,Ot),Xt=Math.min(14400,Xt)),n=[Ot,Xt],e.substr(0,1)){case"l":Xt>Ot&&(n=[Xt,Ot]);break;case"p":Ot>Xt&&(n=[Xt,Ot])}as(n),uh(Qa),it(po),Nl!==0&&it(Nl+" J"),zl!==0&&it(zl+" j"),K.publish("addPage",{pageNumber:xt})},Wi=function(k){k>0&&k<=xt&&(Le.splice(k,1),Y.splice(k,1),xt--,St>xt&&(St=xt),this.setPage(St))},Aa=function(k){k>0&&k<=xt&&(St=k)},Ja=I.__private__.getNumberOfPages=I.getNumberOfPages=function(){return Le.length-1},rt=function(k,et,At){var Ot,Xt=void 0;return At=At||{},k=k!==void 0?k:Ue[bi].fontName,et=et!==void 0?et:Ue[bi].fontStyle,Ot=k.toLowerCase(),Vi[Ot]!==void 0&&Vi[Ot][et]!==void 0?Xt=Vi[Ot][et]:Vi[k]!==void 0&&Vi[k][et]!==void 0?Xt=Vi[k][et]:At.disableWarning===!1&&Wr.warn("Unable to look up font label for font '"+k+"', '"+et+"'. Refer to getFontList() for available fonts."),Xt||At.noFallback||(Xt=Vi.times[et])==null&&(Xt=Vi.times.normal),Xt},mt=I.__private__.putInfo=function(){var k=Wt(),et=function(Ot){return Ot};for(var At in S!==null&&(et=er.encryptor(k,0)),it("<<"),it("/Producer ("+pn(et("jsPDF "+Mi.version))+")"),ci)ci.hasOwnProperty(At)&&ci[At]&&it("/"+At.substr(0,1).toUpperCase()+At.substr(1)+" ("+pn(et(ci[At]))+")");it("/CreationDate ("+pn(et(ee))+")"),it(">>"),it("endobj")},Dt=I.__private__.putCatalog=function(k){var et=(k=k||{}).rootDictionaryObjId||Li;switch(Wt(),it("<<"),it("/Type /Catalog"),it("/Pages "+et+" 0 R"),Me||(Me="fullwidth"),Me){case"fullwidth":it("/OpenAction [3 0 R /FitH null]");break;case"fullheight":it("/OpenAction [3 0 R /FitV null]");break;case"fullpage":it("/OpenAction [3 0 R /Fit]");break;case"original":it("/OpenAction [3 0 R /XYZ null null 1]");break;default:var At=""+Me;At.substr(At.length-1)==="%"&&(Me=parseInt(Me)/100),typeof Me=="number"&&it("/OpenAction [3 0 R /XYZ null null "+zt(Me)+"]")}switch(Ri||(Ri="continuous"),Ri){case"continuous":it("/PageLayout /OneColumn");break;case"single":it("/PageLayout /SinglePage");break;case"two":case"twoleft":it("/PageLayout /TwoColumnLeft");break;case"tworight":it("/PageLayout /TwoColumnRight")}Si&&it("/PageMode /"+Si),K.publish("putCatalog"),it(">>"),it("endobj")},ne=I.__private__.putTrailer=function(){it("trailer"),it("<<"),it("/Size "+(qt+1)),it("/Root "+qt+" 0 R"),it("/Info "+(qt-1)+" 0 R"),S!==null&&it("/Encrypt "+er.oid+" 0 R"),it("/ID [ <"+ie+"> <"+ie+"> ]"),it(">>")},Se=I.__private__.putHeader=function(){it("%PDF-"+z),it("%")},oi=I.__private__.putXRef=function(){var k="0000000000";it("xref"),it("0 "+(qt+1)),it("0000000000 65535 f ");for(var et=1;et<=qt;et++)typeof Ht[et]=="function"?it((k+Ht[et]()).slice(-10)+" 00000 n "):Ht[et]!==void 0?it((k+Ht[et]).slice(-10)+" 00000 n "):it("0000000000 00000 n ")},Pi=I.__private__.buildDocument=function(){si(),oe(Jt),K.publish("buildDocument"),Se(),Fi(),fr(),un(),S!==null&&Mr(),mt(),Dt();var k=$t;return oi(),ne(),it("startxref"),it(""+k),it("%%EOF"),oe(Le[St]),Jt.join(`
`)},cr=I.__private__.getBlob=function(k){return new Blob([Ke(k)],{type:"application/pdf"})},fn=I.output=I.__private__.output=Tr(function(k,et){switch(typeof(et=et||{})=="string"?et={filename:et}:et.filename=et.filename||"generated.pdf",k){case void 0:return Pi();case"save":I.save(et.filename);break;case"arraybuffer":return Ke(Pi());case"blob":return cr(Pi());case"bloburi":case"bloburl":if(Bi.URL!==void 0&&typeof Bi.URL.createObjectURL=="function")return Bi.URL&&Bi.URL.createObjectURL(cr(Pi()))||void 0;Wr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var At="",Ot=Pi();try{At=e1(Ot)}catch{At=e1(unescape(encodeURIComponent(Ot)))}return"data:application/pdf;filename="+et.filename+";base64,"+At;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Bi)==="[object Window]"){var Xt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",ae=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';et.pdfObjectUrl&&(Xt=et.pdfObjectUrl,ae="");var Ie='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Xt+'"'+ae+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(et)+");<\/script></body></html>",He=Bi.open();return He!==null&&He.document.write(Ie),He}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Bi)==="[object Window]"){var gi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(et.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+et.filename+'" width="500px" height="400px" /></body></html>',Ii=Bi.open();if(Ii!==null){Ii.document.write(gi);var Di=this;Ii.document.documentElement.querySelector("#pdfViewer").onload=function(){Ii.document.title=et.filename,Ii.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Di.output("bloburl"))}}return Ii}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Bi)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var Ui='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",et)+'"></iframe></body></html>',Br=Bi.open();if(Br!==null&&(Br.document.write(Ui),Br.document.title=et.filename),Br||typeof safari>"u")return Br;break;case"datauri":case"dataurl":return Bi.document.location.href=this.output("datauristring",et);default:return null}}),vn=function(k){return Array.isArray(ct)===!0&&ct.indexOf(k)>-1};switch(r){case"pt":ke=1;break;case"mm":ke=72/25.4;break;case"cm":ke=72/2.54;break;case"in":ke=72;break;case"px":ke=vn("px_scaling")==1?.75:96/72;break;case"pc":case"em":ke=12;break;case"ex":ke=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);ke=r}var er=null;Be(),Yt();var Ka=function(k){return S!==null?er.encryptor(k,0):function(et){return et}},Pn=I.__private__.getPageInfo=I.getPageInfo=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Y[k].objId,pageNumber:k,pageContext:Y[k]}},ui=I.__private__.getPageInfoByObjId=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var et in Y)if(Y[et].objId===k)break;return Pn(et)},Ll=I.__private__.getCurrentPageInfo=I.getCurrentPageInfo=function(){return{objId:Y[St].objId,pageNumber:St,pageContext:Y[St]}};I.addPage=function(){return Yn.apply(this,arguments),this},I.setPage=function(){return Aa.apply(this,arguments),oe.call(this,Le[St]),this},I.insertPage=function(k){return this.addPage(),this.movePage(St,k),this},I.movePage=function(k,et){var At,Ot;if(k>et){At=Le[k],Ot=Y[k];for(var Xt=k;Xt>et;Xt--)Le[Xt]=Le[Xt-1],Y[Xt]=Y[Xt-1];Le[et]=At,Y[et]=Ot,this.setPage(et)}else if(k<et){At=Le[k],Ot=Y[k];for(var ae=k;ae<et;ae++)Le[ae]=Le[ae+1],Y[ae]=Y[ae+1];Le[et]=At,Y[et]=Ot,this.setPage(et)}return this},I.deletePage=function(){return Wi.apply(this,arguments),this},I.__private__.text=I.text=function(k,et,At,Ot,Xt){var ae,Ie,He,gi,Ii,Di,Ui,Br,en,Oi=(Ot=Ot||{}).scope||this;if(typeof k=="number"&&typeof et=="number"&&(typeof At=="string"||Array.isArray(At))){var Fn=At;At=et,et=k,k=Fn}if(arguments[3]instanceof Rt?(yt("The transform parameter of text() with a Matrix value"),en=Xt):(He=arguments[4],gi=arguments[5],Or(Ui=arguments[3])==="object"&&Ui!==null||(typeof He=="string"&&(gi=He,He=null),typeof Ui=="string"&&(gi=Ui,Ui=null),typeof Ui=="number"&&(He=Ui,Ui=null),Ot={flags:Ui,angle:He,align:gi})),isNaN(et)||isNaN(At)||k==null)throw new Error("Invalid arguments passed to jsPDF.text");if(k.length===0)return Oi;var di="",ls=!1,Xi=typeof Ot.lineHeightFactor=="number"?Ot.lineHeightFactor:Jo,Ji=Oi.internal.scaleFactor;function Io(Cr){return Cr=Cr.split("	").join(Array(Ot.TabLen||9).join(" ")),pn(Cr,Ui)}function Ko(Cr){for(var vr,zr=Cr.concat(),rn=[],Ss=zr.length;Ss--;)typeof(vr=zr.shift())=="string"?rn.push(vr):Array.isArray(Cr)&&(vr.length===1||vr[1]===void 0&&vr[2]===void 0)?rn.push(vr[0]):rn.push([vr[0],vr[1],vr[2]]);return rn}function Qo(Cr,vr){var zr;if(typeof Cr=="string")zr=vr(Cr)[0];else if(Array.isArray(Cr)){for(var rn,Ss,js=Cr.concat(),nn=[],Ro=js.length;Ro--;)typeof(rn=js.shift())=="string"?nn.push(vr(rn)[0]):Array.isArray(rn)&&typeof rn[0]=="string"&&(Ss=vr(rn[0],rn[1],rn[2]),nn.push([Ss[0],Ss[1],Ss[2]]));zr=nn}return zr}var Ca=!1,fo=!0;if(typeof k=="string")Ca=!0;else if(Array.isArray(k)){var Lo=k.concat();Ie=[];for(var In,Dn=Lo.length;Dn--;)(typeof(In=Lo.shift())!="string"||Array.isArray(In)&&typeof In[0]!="string")&&(fo=!1);Ca=fo}if(Ca===!1)throw new Error('Type of text must be string or Array. "'+k+'" is not recognized.');typeof k=="string"&&(k=k.match(/[\r?\n]/)?k.split(/\r\n|\r|\n/g):[k]);var Pa=Ee/Oi.internal.scaleFactor,Ia=Pa*(Xi-1);switch(Ot.baseline){case"bottom":At-=Ia;break;case"top":At+=Pa-Ia;break;case"hanging":At+=Pa-2*Ia;break;case"middle":At+=Pa/2-Ia}if((Di=Ot.maxWidth||0)>0&&(typeof k=="string"?k=Oi.splitTextToSize(k,Di):Object.prototype.toString.call(k)==="[object Array]"&&(k=k.reduce(function(Cr,vr){return Cr.concat(Oi.splitTextToSize(vr,Di))},[]))),ae={text:k,x:et,y:At,options:Ot,mutex:{pdfEscape:pn,activeFontKey:bi,fonts:Ue,activeFontSize:Ee}},K.publish("preProcessText",ae),k=ae.text,He=(Ot=ae.options).angle,!(en instanceof Rt)&&He&&typeof He=="number"){He*=Math.PI/180,Ot.rotationDirection===0&&(He=-He),ot===Z.ADVANCED&&(He=-He);var Fs=Math.cos(He),ta=Math.sin(He);en=new Rt(Fs,ta,-ta,Fs,0,0)}else He&&He instanceof Rt&&(en=He);ot!==Z.ADVANCED||en||(en=te),(Ii=Ot.charSpace||Ea)!==void 0&&(di+=Mt(pt(Ii))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(Br=Ot.horizontalScale)!==void 0&&(di+=Mt(100*Br)+` Tz
`),Ot.lang;var bn=-1,La=Ot.renderingMode!==void 0?Ot.renderingMode:Ot.stroke,ea=Oi.internal.getCurrentPageInfo().pageContext;switch(La){case 0:case!1:case"fill":bn=0;break;case 1:case!0:case"stroke":bn=1;break;case 2:case"fillThenStroke":bn=2;break;case 3:case"invisible":bn=3;break;case 4:case"fillAndAddForClipping":bn=4;break;case 5:case"strokeAndAddPathForClipping":bn=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":bn=6;break;case 7:case"addToPathForClipping":bn=7}var il=ea.usedRenderingMode!==void 0?ea.usedRenderingMode:-1;bn!==-1?di+=bn+` Tr
`:il!==-1&&(di+=`0 Tr
`),bn!==-1&&(ea.usedRenderingMode=bn),gi=Ot.align||"left";var On,Mo=Ee*Xi,fh=Oi.internal.pageSize.getWidth(),Ic=Ue[bi];Ii=Ot.charSpace||Ea,Di=Ot.maxWidth||0,Ui=Object.assign({autoencode:!0,noBOM:!0},Ot.flags);var Ni=[];if(Object.prototype.toString.call(k)==="[object Array]"){var Kn;Ie=Ko(k),gi!=="left"&&(On=Ie.map(function(Cr){return Oi.getStringUnitWidth(Cr,{font:Ic,charSpace:Ii,fontSize:Ee,doKerning:!1})*Ee/Ji}));var mo,ia=0;if(gi==="right"){et-=On[0],k=[],Dn=Ie.length;for(var Qn=0;Qn<Dn;Qn++)Qn===0?(mo=ji(et),Kn=uo(At)):(mo=pt(ia-On[Qn]),Kn=-Mo),k.push([Ie[Qn],mo,Kn]),ia=On[Qn]}else if(gi==="center"){et-=On[0]/2,k=[],Dn=Ie.length;for(var Bo=0;Bo<Dn;Bo++)Bo===0?(mo=ji(et),Kn=uo(At)):(mo=pt((ia-On[Bo])/2),Kn=-Mo),k.push([Ie[Bo],mo,Kn]),ia=On[Bo]}else if(gi==="left"){k=[],Dn=Ie.length;for(var ra=0;ra<Dn;ra++)k.push(Ie[ra])}else{if(gi!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');k=[],Dn=Ie.length,Di=Di!==0?Di:fh;for(var Ds=0;Ds<Dn;Ds++)Kn=Ds===0?uo(At):-Mo,mo=Ds===0?ji(et):0,Ds<Dn-1?Ni.push(Mt(pt((Di-On[Ds])/(Ie[Ds].split(" ").length-1)))):Ni.push(0),k.push([Ie[Ds],mo,Kn])}}var rl=typeof Ot.R2L=="boolean"?Ot.R2L:ei;rl===!0&&(k=Qo(k,function(Cr,vr,zr){return[Cr.split("").reverse().join(""),vr,zr]})),ae={text:k,x:et,y:At,options:Ot,mutex:{pdfEscape:pn,activeFontKey:bi,fonts:Ue,activeFontSize:Ee}},K.publish("postProcessText",ae),k=ae.text,ls=ae.mutex.isHex||!1;var Ma=Ue[bi].encoding;Ma!=="WinAnsiEncoding"&&Ma!=="StandardEncoding"||(k=Qo(k,function(Cr,vr,zr){return[Io(Cr),vr,zr]})),Ie=Ko(k),k=[];for(var go,Nn,cs,Os=0,Ba=1,Ns=Array.isArray(Ie[0])?Ba:Os,zs="",Ra=function(Cr,vr,zr){var rn="";return zr instanceof Rt?(zr=typeof Ot.angle=="number"?Ct(zr,new Rt(1,0,0,1,Cr,vr)):Ct(new Rt(1,0,0,1,Cr,vr),zr),ot===Z.ADVANCED&&(zr=Ct(new Rt(1,0,0,-1,0,0),zr)),rn=zr.join(" ")+` Tm
`):rn=Mt(Cr)+" "+Mt(vr)+` Td
`,rn},ts=0;ts<Ie.length;ts++){switch(zs="",Ns){case Ba:cs=(ls?"<":"(")+Ie[ts][0]+(ls?">":")"),go=parseFloat(Ie[ts][1]),Nn=parseFloat(Ie[ts][2]);break;case Os:cs=(ls?"<":"(")+Ie[ts]+(ls?">":")"),go=ji(et),Nn=uo(At)}Ni!==void 0&&Ni[ts]!==void 0&&(zs=Ni[ts]+` Tw
`),ts===0?k.push(zs+Ra(go,Nn,en)+cs):Ns===Os?k.push(zs+cs):Ns===Ba&&k.push(zs+Ra(go,Nn,en)+cs)}k=Ns===Os?k.join(` Tj
T* `):k.join(` Tj
`),k+=` Tj
`;var _o=`BT
/`;return _o+=bi+" "+Ee+` Tf
`,_o+=Mt(Ee*Xi)+` TL
`,_o+=tl+`
`,_o+=di,_o+=k,it(_o+="ET"),P[bi]=!0,Oi};var Ml=I.__private__.clip=I.clip=function(k){return it(k==="evenodd"?"W*":"W"),this};I.clipEvenOdd=function(){return Ml("evenodd")},I.__private__.discardPath=I.discardPath=function(){return it("n"),this};var xs=I.__private__.isValidStyle=function(k){var et=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(k)!==-1&&(et=!0),et};I.__private__.setDefaultPathOperation=I.setDefaultPathOperation=function(k){return xs(k)&&(v=k),this};var Ac=I.__private__.getStyle=I.getStyle=function(k){var et=v;switch(k){case"D":case"S":et="S";break;case"F":et="f";break;case"FD":case"DF":et="B";break;case"f":case"f*":case"B":case"B*":et=k}return et},Yo=I.close=function(){return it("h"),this};I.stroke=function(){return it("S"),this},I.fill=function(k){return Bl("f",k),this},I.fillEvenOdd=function(k){return Bl("f*",k),this},I.fillStroke=function(k){return Bl("B",k),this},I.fillStrokeEvenOdd=function(k){return Bl("B*",k),this};var Bl=function(k,et){Or(et)==="object"?$h(et,k):it(k)},Rl=function(k){k===null||ot===Z.ADVANCED&&k===void 0||(k=Ac(k),it(k))};function hh(k,et,At,Ot,Xt){var ae=new Rd(et||this.boundingBox,At||this.xStep,Ot||this.yStep,this.gState,Xt||this.matrix);ae.stream=this.stream;var Ie=k+"$$"+this.cloneIndex+++"$$";return he(Ie,ae),ae}var $h=function(k,et){var At=_n[k.key],Ot=ze[At];if(Ot instanceof Tu)it("q"),it(Yh(et)),Ot.gState&&I.setGState(Ot.gState),it(k.matrix.toString()+" cm"),it("/"+At+" sh"),it("Q");else if(Ot instanceof Rd){var Xt=new Rt(1,0,0,-1,0,Ta());k.matrix&&(Xt=Xt.multiply(k.matrix||te),At=hh.call(Ot,k.key,k.boundingBox,k.xStep,k.yStep,Xt).id),it("q"),it("/Pattern cs"),it("/"+At+" scn"),Ot.gState&&I.setGState(Ot.gState),it(et),it("Q")}},Yh=function(k){switch(k){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},kl=I.moveTo=function(k,et){return it(Mt(pt(k))+" "+Mt(bt(et))+" m"),this},co=I.lineTo=function(k,et){return it(Mt(pt(k))+" "+Mt(bt(et))+" l"),this},To=I.curveTo=function(k,et,At,Ot,Xt,ae){return it([Mt(pt(k)),Mt(bt(et)),Mt(pt(At)),Mt(bt(Ot)),Mt(pt(Xt)),Mt(bt(ae)),"c"].join(" ")),this};I.__private__.line=I.line=function(k,et,At,Ot,Xt){if(isNaN(k)||isNaN(et)||isNaN(At)||isNaN(Ot)||!xs(Xt))throw new Error("Invalid arguments passed to jsPDF.line");return ot===Z.COMPAT?this.lines([[At-k,Ot-et]],k,et,[1,1],Xt||"S"):this.lines([[At-k,Ot-et]],k,et,[1,1]).stroke()},I.__private__.lines=I.lines=function(k,et,At,Ot,Xt,ae){var Ie,He,gi,Ii,Di,Ui,Br,en,Oi,Fn,di,ls;if(typeof k=="number"&&(ls=At,At=et,et=k,k=ls),Ot=Ot||[1,1],ae=ae||!1,isNaN(et)||isNaN(At)||!Array.isArray(k)||!Array.isArray(Ot)||!xs(Xt)||typeof ae!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(kl(et,At),Ie=Ot[0],He=Ot[1],Ii=k.length,Fn=et,di=At,gi=0;gi<Ii;gi++)(Di=k[gi]).length===2?(Fn=Di[0]*Ie+Fn,di=Di[1]*He+di,co(Fn,di)):(Ui=Di[0]*Ie+Fn,Br=Di[1]*He+di,en=Di[2]*Ie+Fn,Oi=Di[3]*He+di,Fn=Di[4]*Ie+Fn,di=Di[5]*He+di,To(Ui,Br,en,Oi,Fn,di));return ae&&Yo(),Rl(Xt),this},I.path=function(k){for(var et=0;et<k.length;et++){var At=k[et],Ot=At.c;switch(At.op){case"m":kl(Ot[0],Ot[1]);break;case"l":co(Ot[0],Ot[1]);break;case"c":To.apply(this,Ot);break;case"h":Yo()}}return this},I.__private__.rect=I.rect=function(k,et,At,Ot,Xt){if(isNaN(k)||isNaN(et)||isNaN(At)||isNaN(Ot)||!xs(Xt))throw new Error("Invalid arguments passed to jsPDF.rect");return ot===Z.COMPAT&&(Ot=-Ot),it([Mt(pt(k)),Mt(bt(et)),Mt(pt(At)),Mt(pt(Ot)),"re"].join(" ")),Rl(Xt),this},I.__private__.triangle=I.triangle=function(k,et,At,Ot,Xt,ae,Ie){if(isNaN(k)||isNaN(et)||isNaN(At)||isNaN(Ot)||isNaN(Xt)||isNaN(ae)||!xs(Ie))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[At-k,Ot-et],[Xt-At,ae-Ot],[k-Xt,et-ae]],k,et,[1,1],Ie,!0),this},I.__private__.roundedRect=I.roundedRect=function(k,et,At,Ot,Xt,ae,Ie){if(isNaN(k)||isNaN(et)||isNaN(At)||isNaN(Ot)||isNaN(Xt)||isNaN(ae)||!xs(Ie))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var He=4/3*(Math.SQRT2-1);return Xt=Math.min(Xt,.5*At),ae=Math.min(ae,.5*Ot),this.lines([[At-2*Xt,0],[Xt*He,0,Xt,ae-ae*He,Xt,ae],[0,Ot-2*ae],[0,ae*He,-Xt*He,ae,-Xt,ae],[2*Xt-At,0],[-Xt*He,0,-Xt,-ae*He,-Xt,-ae],[0,2*ae-Ot],[0,-ae*He,Xt*He,-ae,Xt,-ae]],k+Xt,et,[1,1],Ie,!0),this},I.__private__.ellipse=I.ellipse=function(k,et,At,Ot,Xt){if(isNaN(k)||isNaN(et)||isNaN(At)||isNaN(Ot)||!xs(Xt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var ae=4/3*(Math.SQRT2-1)*At,Ie=4/3*(Math.SQRT2-1)*Ot;return kl(k+At,et),To(k+At,et-Ie,k+ae,et-Ot,k,et-Ot),To(k-ae,et-Ot,k-At,et-Ie,k-At,et),To(k-At,et+Ie,k-ae,et+Ot,k,et+Ot),To(k+ae,et+Ot,k+At,et+Ie,k+At,et),Rl(Xt),this},I.__private__.circle=I.circle=function(k,et,At,Ot){if(isNaN(k)||isNaN(et)||isNaN(At)||!xs(Ot))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(k,et,At,At,Ot)},I.setFont=function(k,et,At){return At&&(et=Ft(et,At)),bi=rt(k,et,{disableWarning:!1}),this};var Fl=I.__private__.getFont=I.getFont=function(){return Ue[rt.apply(I,arguments)]};I.__private__.getFontList=I.getFontList=function(){var k,et,At={};for(k in Vi)if(Vi.hasOwnProperty(k))for(et in At[k]=[],Vi[k])Vi[k].hasOwnProperty(et)&&At[k].push(et);return At},I.addFont=function(k,et,At,Ot,Xt){var ae=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&ae.indexOf(arguments[3])!==-1?Xt=arguments[3]:arguments[3]&&ae.indexOf(arguments[3])==-1&&(At=Ft(At,Ot)),Xt=Xt||"Identity-H",dn.call(this,k,et,At,Xt)};var Jo,Qa=i.lineWidth||.200025,Jn=I.__private__.getLineWidth=I.getLineWidth=function(){return Qa},uh=I.__private__.setLineWidth=I.setLineWidth=function(k){return Qa=k,it(Mt(pt(k))+" w"),this};I.__private__.setLineDash=Mi.API.setLineDash=Mi.API.setLineDashPattern=function(k,et){if(k=k||[],et=et||0,isNaN(et)||!Array.isArray(k))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return k=k.map(function(At){return Mt(pt(At))}).join(" "),et=Mt(pt(et)),it("["+k+"] "+et+" d"),this};var Dl=I.__private__.getLineHeight=I.getLineHeight=function(){return Ee*Jo};I.__private__.getLineHeight=I.getLineHeight=function(){return Ee*Jo};var Co=I.__private__.setLineHeightFactor=I.setLineHeightFactor=function(k){return typeof(k=k||1.15)=="number"&&(Jo=k),this},ho=I.__private__.getLineHeightFactor=I.getLineHeightFactor=function(){return Jo};Co(i.lineHeight);var ji=I.__private__.getHorizontalCoordinate=function(k){return pt(k)},uo=I.__private__.getVerticalCoordinate=function(k){return ot===Z.ADVANCED?k:Y[St].mediaBox.topRightY-Y[St].mediaBox.bottomLeftY-pt(k)},Jh=I.__private__.getHorizontalCoordinateString=I.getHorizontalCoordinateString=function(k){return Mt(ji(k))},ws=I.__private__.getVerticalCoordinateString=I.getVerticalCoordinateString=function(k){return Mt(uo(k))},po=i.strokeColor||"0 G";I.__private__.getStrokeColor=I.getDrawColor=function(){return Ci(po)},I.__private__.setStrokeColor=I.setDrawColor=function(k,et,At,Ot){return po=xi({ch1:k,ch2:et,ch3:At,ch4:Ot,pdfColorType:"draw",precision:2}),it(po),this};var Ol=i.fillColor||"0 g";I.__private__.getFillColor=I.getFillColor=function(){return Ci(Ol)},I.__private__.setFillColor=I.setFillColor=function(k,et,At,Ot){return Ol=xi({ch1:k,ch2:et,ch3:At,ch4:Ot,pdfColorType:"fill",precision:2}),it(Ol),this};var tl=i.textColor||"0 g",dh=I.__private__.getTextColor=I.getTextColor=function(){return Ci(tl)};I.__private__.setTextColor=I.setTextColor=function(k,et,At,Ot){return tl=xi({ch1:k,ch2:et,ch3:At,ch4:Ot,pdfColorType:"text",precision:3}),this};var Ea=i.charSpace,ph=I.__private__.getCharSpace=I.getCharSpace=function(){return parseFloat(Ea||0)};I.__private__.setCharSpace=I.setCharSpace=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Ea=k,this};var Nl=0;I.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},I.__private__.setLineCap=I.setLineCap=function(k){var et=I.CapJoinStyles[k];if(et===void 0)throw new Error("Line cap style of '"+k+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Nl=et,it(et+" J"),this};var zl=0;I.__private__.setLineJoin=I.setLineJoin=function(k){var et=I.CapJoinStyles[k];if(et===void 0)throw new Error("Line join style of '"+k+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return zl=et,it(et+" j"),this},I.__private__.setLineMiterLimit=I.__private__.setMiterLimit=I.setLineMiterLimit=I.setMiterLimit=function(k){if(k=k||0,isNaN(k))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return it(Mt(pt(k))+" M"),this},I.GState=Cg,I.setGState=function(k){(k=typeof k=="string"?ir[Qr[k]]:Ec(null,k)).equals(tn)||(it("/"+k.id+" gs"),tn=k)};var Ec=function(k,et){if(!k||!Qr[k]){var At=!1;for(var Ot in ir)if(ir.hasOwnProperty(Ot)&&ir[Ot].equals(et)){At=!0;break}if(At)et=ir[Ot];else{var Xt="GS"+(Object.keys(ir).length+1).toString(10);ir[Xt]=et,et.id=Xt}return k&&(Qr[k]=et.id),K.publish("addGState",et),et}};I.addGState=function(k,et){return Ec(k,et),this},I.saveGraphicsState=function(){return it("q"),Zr.push({key:bi,size:Ee,color:tl}),this},I.restoreGraphicsState=function(){it("Q");var k=Zr.pop();return bi=k.key,Ee=k.size,tl=k.color,tn=null,this},I.setCurrentTransformationMatrix=function(k){return it(k.toString()+" cm"),this},I.comment=function(k){return it("#"+k),this};var ks=function(k,et){var At=k||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return At},set:function(ae){isNaN(ae)||(At=parseFloat(ae))}});var Ot=et||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return Ot},set:function(ae){isNaN(ae)||(Ot=parseFloat(ae))}});var Xt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Xt},set:function(ae){Xt=ae.toString()}}),this},jl=function(k,et,At,Ot){ks.call(this,k,et),this.type="rect";var Xt=At||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Xt},set:function(Ie){isNaN(Ie)||(Xt=parseFloat(Ie))}});var ae=Ot||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return ae},set:function(Ie){isNaN(Ie)||(ae=parseFloat(Ie))}}),this},Tc=function(){this.page=xt,this.currentPage=St,this.pages=Le.slice(0),this.pagesContext=Y.slice(0),this.x=_r,this.y=ge,this.matrix=yi,this.width=Po(St),this.height=Ta(St),this.outputDestination=Ne,this.id="",this.objectNumber=-1};Tc.prototype.restore=function(){xt=this.page,St=this.currentPage,Y=this.pagesContext,Le=this.pages,_r=this.x,ge=this.y,yi=this.matrix,Pc(St,this.width),Gl(St,this.height),Ne=this.outputDestination};var Cc=function(k,et,At,Ot,Xt){Gt.push(new Tc),xt=St=0,Le=[],_r=k,ge=et,yi=Xt,as([At,Ot])},el=function(k){if(kt[k])Gt.pop().restore();else{var et=new Tc,At="Xo"+(Object.keys(_t).length+1).toString(10);et.id=At,kt[k]=At,_t[At]=et,K.publish("addFormObject",et),Gt.pop().restore()}};for(var Ul in I.beginFormObject=function(k,et,At,Ot,Xt){return Cc(k,et,At,Ot,Xt),this},I.endFormObject=function(k){return el(k),this},I.doFormObject=function(k,et){var At=_t[kt[k]];return it("q"),it(et.toString()+" cm"),it("/"+At.id+" Do"),it("Q"),this},I.getFormObject=function(k){var et=_t[kt[k]];return{x:et.x,y:et.y,width:et.width,height:et.height,matrix:et.matrix}},I.save=function(k,et){return k=k||"generated.pdf",(et=et||{}).returnPromise=et.returnPromise||!1,et.returnPromise===!1?(Su(cr(Pi()),k),typeof Su.unload=="function"&&Bi.setTimeout&&setTimeout(Su.unload,911),this):new Promise(function(At,Ot){try{var Xt=Su(cr(Pi()),k);typeof Su.unload=="function"&&Bi.setTimeout&&setTimeout(Su.unload,911),At(Xt)}catch(ae){Ot(ae.message)}})},Mi.API)Mi.API.hasOwnProperty(Ul)&&(Ul==="events"&&Mi.API.events.length?function(k,et){var At,Ot,Xt;for(Xt=et.length-1;Xt!==-1;Xt--)At=et[Xt][0],Ot=et[Xt][1],k.subscribe.apply(k,[At].concat(typeof Ot=="function"?[Ot]:Ot))}(K,Mi.API.events):I[Ul]=Mi.API[Ul]);var Po=I.getPageWidth=function(k){return(Y[k=k||St].mediaBox.topRightX-Y[k].mediaBox.bottomLeftX)/ke},Pc=I.setPageWidth=function(k,et){Y[k].mediaBox.topRightX=et*ke+Y[k].mediaBox.bottomLeftX},Ta=I.getPageHeight=function(k){return(Y[k=k||St].mediaBox.topRightY-Y[k].mediaBox.bottomLeftY)/ke},Gl=I.setPageHeight=function(k,et){Y[k].mediaBox.topRightY=et*ke+Y[k].mediaBox.bottomLeftY};return I.internal={pdfEscape:pn,getStyle:Ac,getFont:Fl,getFontSize:De,getCharSpace:ph,getTextColor:dh,getLineHeight:Dl,getLineHeightFactor:ho,getLineWidth:Jn,write:pi,getHorizontalCoordinate:ji,getVerticalCoordinate:uo,getCoordinateString:Jh,getVerticalCoordinateString:ws,collections:{},newObject:Wt,newAdditionalObject:Je,newObjectDeferred:be,newObjectDeferredBegin:We,getFilters:rr,putStream:Hi,events:K,scaleFactor:ke,pageSize:{getWidth:function(){return Po(St)},setWidth:function(k){Pc(St,k)},getHeight:function(){return Ta(St)},setHeight:function(k){Gl(St,k)}},encryptionOptions:S,encryption:er,getEncryptor:Ka,output:fn,getNumberOfPages:Ja,pages:Le,out:it,f2:zt,f3:at,getPageInfo:Pn,getPageInfoByObjId:ui,getCurrentPageInfo:Ll,getPDFVersion:N,Point:ks,Rectangle:jl,Matrix:Rt,hasHotfix:vn},Object.defineProperty(I.internal.pageSize,"width",{get:function(){return Po(St)},set:function(k){Pc(St,k)},enumerable:!0,configurable:!0}),Object.defineProperty(I.internal.pageSize,"height",{get:function(){return Ta(St)},set:function(k){Gl(St,k)},enumerable:!0,configurable:!0}),$o.call(I,de),bi="F1",Yn(n,e),K.publish("initialized"),I}Td.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},Td.prototype.toHexString=function(i){return i.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Td.prototype.hexToBytes=function(i){for(var t=[],e=0;e<i.length;e+=2)t.push(String.fromCharCode(parseInt(i.substr(e,2),16)));return t.join("")},Td.prototype.processOwnerPassword=function(i,t){return r1(i1(t).substr(0,5),i)},Td.prototype.encryptor=function(i,t){var e=i1(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&t,t>>8&255)).substr(0,10);return function(r){return r1(e,r)}},Cg.prototype.equals=function(i){var t,e="id,objectNumber,equals";if(!i||Or(i)!==Or(this))return!1;var r=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!i.hasOwnProperty(t)||this[t]!==i[t])return!1;r++}for(t in i)i.hasOwnProperty(t)&&e.indexOf(t)<0&&r--;return r===0},Mi.API={events:[]},Mi.version="2.5.1";var Tn=Mi.API,Rv=1,Hu=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},wd=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Gi=function(i){return i.toFixed(2)},Oh=function(i){return i.toFixed(5)};Tn.__acroform__={};var Xo=function(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i},V5=function(i){return i*Rv},fc=function(i){var t=new ME,e=li.internal.getHeight(i)||0,r=li.internal.getWidth(i)||0;return t.BBox=[0,0,Number(Gi(r)),Number(Gi(e))],t},fV=Tn.__acroform__.setBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<t},mV=Tn.__acroform__.clearBit=function(i,t){if(i=i||0,t=t||0,isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<t)},gV=Tn.__acroform__.getBit=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<t?1:0},Bn=Tn.__acroform__.getBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return gV(i,t-1)},Rn=Tn.__acroform__.setBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return fV(i,t-1)},kn=Tn.__acroform__.clearBitForPdf=function(i,t){if(isNaN(i)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return mV(i,t-1)},_V=Tn.__acroform__.calculateCoordinates=function(i,t){var e=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,n=i[0],o=i[1],c=i[2],l=i[3],_={};return _.lowerLeft_X=e(n)||0,_.lowerLeft_Y=r(o+l)||0,_.upperRight_X=e(n+c)||0,_.upperRight_Y=r(o)||0,[Number(Gi(_.lowerLeft_X)),Number(Gi(_.lowerLeft_Y)),Number(Gi(_.upperRight_X)),Number(Gi(_.upperRight_Y))]},yV=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var t=[],e=i._V||i.DV,r=n1(i,e),n=i.scope.internal.getFont(i.fontName,i.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(i.scope.__private__.encodeColorString(i.color)),t.push("/"+n+" "+Gi(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var o=fc(i);return o.scope=i.scope,o.stream=t.join(`
`),o}},n1=function(i,t){var e=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},n=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");n=i.multiline?n.map(function(at){return at.split(`
`)}):n.map(function(at){return[at]});var o=e,c=li.internal.getHeight(i)||0;c=c<0?-c:c;var l=li.internal.getWidth(i)||0;l=l<0?-l:l;var _=function(at,pt,Lt){if(at+1<n.length){var bt=pt+" "+n[at+1][0];return Om(bt,i,Lt).width<=l-4}return!1};o++;t:for(;o>0;){t="",o--;var v,S,T=Om("3",i,o).height,P=i.multiline?c-o:(c-T)/2,I=P+=2,z=0,N=0,X=0;if(o<=0){t=`(...) Tj
`,t+="% Width of Text: "+Om(t,i,o=12).width+", FieldWidth:"+l+`
`;break}for(var H="",Z=0,ot=0;ot<n.length;ot++)if(n.hasOwnProperty(ot)){var gt=!1;if(n[ot].length!==1&&X!==n[ot].length-1){if((T+2)*(Z+2)+2>c)continue t;H+=n[ot][X],gt=!0,N=ot,ot--}else{H=(H+=n[ot][X]+" ").substr(H.length-1)==" "?H.substr(0,H.length-1):H;var Et=parseInt(ot),Ft=_(Et,H,o),Mt=ot>=n.length-1;if(Ft&&!Mt){H+=" ",X=0;continue}if(Ft||Mt){if(Mt)N=Et;else if(i.multiline&&(T+2)*(Z+2)+2>c)continue t}else{if(!i.multiline||(T+2)*(Z+2)+2>c)continue t;N=Et}}for(var yt="",Ut=z;Ut<=N;Ut++){var zt=n[Ut];if(i.multiline){if(Ut===N){yt+=zt[X]+" ",X=(X+1)%zt.length;continue}if(Ut===z){yt+=zt[zt.length-1]+" ";continue}}yt+=zt[0]+" "}switch(yt=yt.substr(yt.length-1)==" "?yt.substr(0,yt.length-1):yt,S=Om(yt,i,o).width,i.textAlign){case"right":v=l-S-2;break;case"center":v=(l-S)/2;break;case"left":default:v=2}t+=Gi(v)+" "+Gi(I)+` Td
`,t+="("+Hu(yt)+`) Tj
`,t+=-Gi(v)+` 0 Td
`,I=-(o+2),S=0,z=gt?N:N+1,Z++,H=""}break}return r.text=t,r.fontSize=o,r},Om=function(i,t,e){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),n=t.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:n}},vV={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},bV=function(i,t){var e={type:"reference",object:i};t.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===e.type&&r.object===e.object})===void 0&&t.internal.getPageInfo(i.page).pageContext.annotations.push(e)},xV=function(i,t){for(var e in i)if(i.hasOwnProperty(e)){var r=e,n=i[e];t.internal.newObjectDeferredBegin(n.objId,!0),Or(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete i[r]}},wV=function(i,t){if(t.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(Cl.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(vV)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Rv=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new BE,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o.objId=void 0,o.hasAnnotation&&bV(o,e)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(e){(function(r,n){var o=!r;for(var c in r||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(c)){var l=r[c],_=[],v=l.Rect;if(l.Rect&&(l.Rect=_V(l.Rect,n)),n.internal.newObjectDeferredBegin(l.objId,!0),l.DA=li.createDefaultAppearanceStream(l),Or(l)==="object"&&typeof l.getKeyValueListForStream=="function"&&(_=l.getKeyValueListForStream()),l.Rect=v,l.hasAppearanceStream&&!l.appearanceStreamContent){var S=yV(l);_.push({key:"AP",value:"<</N "+S+">>"}),n.internal.acroformPlugin.xForms.push(S)}if(l.appearanceStreamContent){var T="";for(var P in l.appearanceStreamContent)if(l.appearanceStreamContent.hasOwnProperty(P)){var I=l.appearanceStreamContent[P];if(T+="/"+P+" ",T+="<<",Object.keys(I).length>=1||Array.isArray(I)){for(var c in I)if(I.hasOwnProperty(c)){var z=I[c];typeof z=="function"&&(z=z.call(n,l)),T+="/"+c+" "+z+" ",n.internal.acroformPlugin.xForms.indexOf(z)>=0||n.internal.acroformPlugin.xForms.push(z)}}else typeof(z=I)=="function"&&(z=z.call(n,l)),T+="/"+c+" "+z,n.internal.acroformPlugin.xForms.indexOf(z)>=0||n.internal.acroformPlugin.xForms.push(z);T+=">>"}_.push({key:"AP",value:`<<
`+T+">>"})}n.internal.putStream({additionalKeyValues:_,objectId:l.objId}),n.internal.out("endobj")}o&&xV(n.internal.acroformPlugin.xForms,n)})(e,i)}),i.internal.acroformPlugin.isInitialized=!0}},LE=Tn.__acroform__.arrayToPdfArray=function(i,t,e){var r=function(c){return c};if(Array.isArray(i)){for(var n="[",o=0;o<i.length;o++)switch(o!==0&&(n+=" "),Or(i[o])){case"boolean":case"number":case"object":n+=i[o].toString();break;case"string":i[o].substr(0,1)!=="/"?(t!==void 0&&e&&(r=e.internal.getEncryptor(t)),n+="("+Hu(r(i[o].toString()))+")"):n+=i[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Z_=function(i,t,e){var r=function(n){return n};return t!==void 0&&e&&(r=e.internal.getEncryptor(t)),(i=i||"").toString(),i="("+Hu(r(i))+")"},bc=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};bc.prototype.toString=function(){return this.objId+" 0 R"},bc.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},bc.prototype.getKeyValueListForStream=function(){var i=[],t=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var r=t[e],n=this[r];n&&(Array.isArray(n)?i.push({key:r,value:LE(n,this.objId,this.scope)}):n instanceof bc?(n.scope=this.scope,i.push({key:r,value:n.objId+" 0 R"})):typeof n!="function"&&i.push({key:r,value:n}))}return i};var ME=function(){bc.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){i=e.trim()},get:function(){return i||null}})};Xo(ME,bc);var BE=function(){bc.call(this);var i,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var e=function(r){return r};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Hu(e(i))+")"}},set:function(e){i=e}})};Xo(BE,bc);var Cl=function i(){bc.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(H){if(isNaN(H))throw new Error('Invalid value "'+H+'" for attribute F supplied.');t=H}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Bn(t,3)},set:function(H){H?this.F=Rn(t,3):this.F=kn(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(H){if(isNaN(H))throw new Error('Invalid value "'+H+'" for attribute Ff supplied.');e=H}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(H){r=H!==void 0?H:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(H){r[0]=H}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(H){r[1]=H}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(H){r[2]=H}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(H){r[3]=H}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(H){switch(H){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=H;break;default:throw new Error('Invalid value "'+H+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof Pg)return;o="FieldObject"+i.FieldNum++}var H=function(Z){return Z};return this.scope&&(H=this.scope.internal.getEncryptor(this.objId)),"("+Hu(H(o))+")"},set:function(H){o=H.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(H){o=H}});var c="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return c},set:function(H){c=H}});var l="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return l},set:function(H){l=H}});var _=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return _},set:function(H){_=H}});var v=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return v===void 0?50/Rv:v},set:function(H){v=H}});var S="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return S},set:function(H){S=H}});var T="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!T||this instanceof Pg||this instanceof ku))return Z_(T,this.objId,this.scope)},set:function(H){H=H.toString(),T=H}});var P=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(P)return this instanceof ys?P:Z_(P,this.objId,this.scope)},set:function(H){H=H.toString(),P=this instanceof ys?H:H.substr(0,1)==="("?wd(H.substr(1,H.length-2)):wd(H)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof ys?wd(P.substr(1,P.length-1)):P},set:function(H){H=H.toString(),P=this instanceof ys?"/"+H:H}});var I=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(I)return I},set:function(H){this.V=H}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(I)return this instanceof ys?I:Z_(I,this.objId,this.scope)},set:function(H){H=H.toString(),I=this instanceof ys?H:H.substr(0,1)==="("?wd(H.substr(1,H.length-2)):wd(H)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof ys?wd(I.substr(1,I.length-1)):I},set:function(H){H=H.toString(),I=this instanceof ys?"/"+H:H}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var z,N=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return N},set:function(H){H=!!H,N=H}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(z)return z},set:function(H){z=H}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,1)},set:function(H){H?this.Ff=Rn(this.Ff,1):this.Ff=kn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,2)},set:function(H){H?this.Ff=Rn(this.Ff,2):this.Ff=kn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,3)},set:function(H){H?this.Ff=Rn(this.Ff,3):this.Ff=kn(this.Ff,3)}});var X=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(X!==null)return X},set:function(H){if([0,1,2].indexOf(H)===-1)throw new Error('Invalid value "'+H+'" for attribute Q supplied.');X=H}}),Object.defineProperty(this,"textAlign",{get:function(){var H;switch(X){case 0:default:H="left";break;case 1:H="center";break;case 2:H="right"}return H},configurable:!0,enumerable:!0,set:function(H){switch(H){case"right":case 2:X=2;break;case"center":case 1:X=1;break;case"left":case 0:default:X=0}}})};Xo(Cl,bc);var zd=function(){Cl.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){i=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return LE(t,this.objId,this.scope)},set:function(e){var r,n;n=[],typeof(r=e)=="string"&&(n=function(o,c,l){l||(l=1);for(var _,v=[];_=c.exec(o);)v.push(_[l]);return v}(r,/\((.*?)\)/g)),t=n}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,r){for(r=r||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,18)},set:function(e){e?this.Ff=Rn(this.Ff,18):this.Ff=kn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Rn(this.Ff,19):this.Ff=kn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,20)},set:function(e){e?(this.Ff=Rn(this.Ff,20),t.sort()):this.Ff=kn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,22)},set:function(e){e?this.Ff=Rn(this.Ff,22):this.Ff=kn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,23)},set:function(e){e?this.Ff=Rn(this.Ff,23):this.Ff=kn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,27)},set:function(e){e?this.Ff=Rn(this.Ff,27):this.Ff=kn(this.Ff,27)}}),this.hasAppearanceStream=!1};Xo(zd,Cl);var jd=function(){zd.call(this),this.fontName="helvetica",this.combo=!1};Xo(jd,zd);var Ud=function(){jd.call(this),this.combo=!0};Xo(Ud,jd);var Km=function(){Ud.call(this),this.edit=!0};Xo(Km,Ud);var ys=function(){Cl.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,15)},set:function(e){e?this.Ff=Rn(this.Ff,15):this.Ff=kn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,16)},set:function(e){e?this.Ff=Rn(this.Ff,16):this.Ff=kn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,17)},set:function(e){e?this.Ff=Rn(this.Ff,17):this.Ff=kn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,26)},set:function(e){e?this.Ff=Rn(this.Ff,26):this.Ff=kn(this.Ff,26)}});var i,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(o){return o};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var r,n=[];for(r in n.push("<<"),t)n.push("/"+r+" ("+Hu(e(t[r]))+")");return n.push(">>"),n.join(`
`)}},set:function(e){Or(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(e){i="/"+e}})};Xo(ys,Cl);var Qm=function(){ys.call(this),this.pushButton=!0};Xo(Qm,ys);var Gd=function(){ys.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t!==void 0?t:[]}})};Xo(Gd,ys);var Pg=function(){var i,t;Cl.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){i=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n}});var e,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(l){return l};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,c=[];for(o in c.push("<<"),r)c.push("/"+o+" ("+Hu(n(r[o]))+")");return c.push(">>"),c.join(`
`)},set:function(n){Or(n)==="object"&&(r=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(n){typeof n=="string"&&(r.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(n){e=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(n){e="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=li.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Xo(Pg,Cl),Gd.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=i.createAppearanceStream(e.optionName),e.caption=i.getCA()}},Gd.prototype.createOption=function(i){var t=new Pg;return t.Parent=this,t.optionName=i,this.Kids.push(t),SV.call(this.scope,t),t};var tg=function(){ys.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=li.CheckBox.createAppearanceStream()};Xo(tg,ys);var ku=function(){Cl.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,13)},set:function(t){t?this.Ff=Rn(this.Ff,13):this.Ff=kn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,21)},set:function(t){t?this.Ff=Rn(this.Ff,21):this.Ff=kn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,23)},set:function(t){t?this.Ff=Rn(this.Ff,23):this.Ff=kn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,24)},set:function(t){t?this.Ff=Rn(this.Ff,24):this.Ff=kn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,25)},set:function(t){t?this.Ff=Rn(this.Ff,25):this.Ff=kn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,26)},set:function(t){t?this.Ff=Rn(this.Ff,26):this.Ff=kn(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){Number.isInteger(t)&&(i=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Xo(ku,Cl);var eg=function(){ku.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Bn(this.Ff,14)},set:function(i){i?this.Ff=Rn(this.Ff,14):this.Ff=kn(this.Ff,14)}}),this.password=!0};Xo(eg,ku);var li={CheckBox:{createAppearanceStream:function(){return{N:{On:li.CheckBox.YesNormal},D:{On:li.CheckBox.YesPushDown,Off:li.CheckBox.OffPushDown}}},YesPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),o=n1(i,i.caption);return e.push("0.749023 g"),e.push("0 0 "+Gi(li.internal.getWidth(i))+" "+Gi(li.internal.getHeight(i))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+r+" "+Gi(o.fontSize)+" Tf "+n),e.push("BT"),e.push(o.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(i){var t=fc(i);t.scope=i.scope;var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),n=[],o=li.internal.getHeight(i),c=li.internal.getWidth(i),l=n1(i,i.caption);return n.push("1 g"),n.push("0 0 "+Gi(c)+" "+Gi(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Gi(c-1)+" "+Gi(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+e+" "+Gi(l.fontSize)+" Tf "+r),n.push(l.text),n.push("ET"),n.push("Q"),t.stream=n.join(`
`),t},OffPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Gi(li.internal.getWidth(i))+" "+Gi(li.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(i){var t={D:{Off:li.RadioButton.Circle.OffPushDown},N:{}};return t.N[i]=li.RadioButton.Circle.YesNormal,t.D[i]=li.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(i){var t=fc(i);t.scope=i.scope;var e=[],r=li.internal.getWidth(i)<=li.internal.getHeight(i)?li.internal.getWidth(i)/4:li.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=li.internal.Bezier_C,o=Number((r*n).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Oh(li.internal.getWidth(i)/2)+" "+Oh(li.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),e.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),e.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),e.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=[],r=li.internal.getWidth(i)<=li.internal.getHeight(i)?li.internal.getWidth(i)/4:li.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*li.internal.Bezier_C).toFixed(5)),c=Number((r*li.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Oh(li.internal.getWidth(i)/2)+" "+Oh(li.internal.getHeight(i)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),e.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),e.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),e.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Oh(li.internal.getWidth(i)/2)+" "+Oh(li.internal.getHeight(i)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+c+" "+c+" "+r+" 0 "+r+" c"),e.push("-"+c+" "+r+" -"+r+" "+c+" -"+r+" 0 c"),e.push("-"+r+" -"+c+" -"+c+" -"+r+" 0 -"+r+" c"),e.push(c+" -"+r+" "+r+" -"+c+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=[],r=li.internal.getWidth(i)<=li.internal.getHeight(i)?li.internal.getWidth(i)/4:li.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*li.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Oh(li.internal.getWidth(i)/2)+" "+Oh(li.internal.getHeight(i)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),e.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),e.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),e.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(i){var t={D:{Off:li.RadioButton.Cross.OffPushDown},N:{}};return t.N[i]=li.RadioButton.Cross.YesNormal,t.D[i]=li.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(i){var t=fc(i);t.scope=i.scope;var e=[],r=li.internal.calculateCross(i);return e.push("q"),e.push("1 1 "+Gi(li.internal.getWidth(i)-2)+" "+Gi(li.internal.getHeight(i)-2)+" re"),e.push("W"),e.push("n"),e.push(Gi(r.x1.x)+" "+Gi(r.x1.y)+" m"),e.push(Gi(r.x2.x)+" "+Gi(r.x2.y)+" l"),e.push(Gi(r.x4.x)+" "+Gi(r.x4.y)+" m"),e.push(Gi(r.x3.x)+" "+Gi(r.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=li.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Gi(li.internal.getWidth(i))+" "+Gi(li.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Gi(li.internal.getWidth(i)-2)+" "+Gi(li.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Gi(e.x1.x)+" "+Gi(e.x1.y)+" m"),r.push(Gi(e.x2.x)+" "+Gi(e.x2.y)+" l"),r.push(Gi(e.x4.x)+" "+Gi(e.x4.y)+" m"),r.push(Gi(e.x3.x)+" "+Gi(e.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join(`
`),t},OffPushDown:function(i){var t=fc(i);t.scope=i.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Gi(li.internal.getWidth(i))+" "+Gi(li.internal.getHeight(i))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(i){var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,e=i.scope.__private__.encodeColorString(i.color);return"/"+t+" "+i.fontSize+" Tf "+e}};li.internal={Bezier_C:.551915024494,calculateCross:function(i){var t=li.internal.getWidth(i),e=li.internal.getHeight(i),r=Math.min(t,e);return{x1:{x:(t-r)/2,y:(e-r)/2+r},x2:{x:(t-r)/2+r,y:(e-r)/2},x3:{x:(t-r)/2,y:(e-r)/2},x4:{x:(t-r)/2+r,y:(e-r)/2+r}}}},li.internal.getWidth=function(i){var t=0;return Or(i)==="object"&&(t=V5(i.Rect[2])),t},li.internal.getHeight=function(i){var t=0;return Or(i)==="object"&&(t=V5(i.Rect[3])),t};var SV=Tn.addField=function(i){if(wV(this,i),!(i instanceof Cl))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=i).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Tn.AcroFormChoiceField=zd,Tn.AcroFormListBox=jd,Tn.AcroFormComboBox=Ud,Tn.AcroFormEditBox=Km,Tn.AcroFormButton=ys,Tn.AcroFormPushButton=Qm,Tn.AcroFormRadioButton=Gd,Tn.AcroFormCheckBox=tg,Tn.AcroFormTextField=ku,Tn.AcroFormPasswordField=eg,Tn.AcroFormAppearance=li,Tn.AcroForm={ChoiceField:zd,ListBox:jd,ComboBox:Ud,EditBox:Km,Button:ys,PushButton:Qm,RadioButton:Gd,CheckBox:tg,TextField:ku,PasswordField:eg,Appearance:li},Mi.AcroForm={ChoiceField:zd,ListBox:jd,ComboBox:Ud,EditBox:Km,Button:ys,PushButton:Qm,RadioButton:Gd,CheckBox:tg,TextField:ku,PasswordField:eg,Appearance:li};function RE(i){return i.reduce(function(t,e,r){return t[e]=r,t},{})}(function(i){i.__addimage__={};var t="UNKNOWN",e={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(at,pt){var Lt,bt,ee,ie,re,Yt=t;if((pt=pt||t)==="RGBA"||at.data!==void 0&&at.data instanceof Uint8ClampedArray&&"height"in at&&"width"in at)return"RGBA";if(Ft(at))for(re in e)for(ee=e[re],Lt=0;Lt<ee.length;Lt+=1){for(ie=!0,bt=0;bt<ee[Lt].length;bt+=1)if(ee[Lt][bt]!==void 0&&ee[Lt][bt]!==at[bt]){ie=!1;break}if(ie===!0){Yt=re;break}}else for(re in e)for(ee=e[re],Lt=0;Lt<ee.length;Lt+=1){for(ie=!0,bt=0;bt<ee[Lt].length;bt+=1)if(ee[Lt][bt]!==void 0&&ee[Lt][bt]!==at.charCodeAt(bt)){ie=!1;break}if(ie===!0){Yt=re;break}}return Yt===t&&pt!==t&&(Yt=pt),Yt},n=function at(pt){for(var Lt=this.internal.write,bt=this.internal.putStream,ee=(0,this.internal.getFilters)();ee.indexOf("FlateEncode")!==-1;)ee.splice(ee.indexOf("FlateEncode"),1);pt.objectId=this.internal.newObject();var ie=[];if(ie.push({key:"Type",value:"/XObject"}),ie.push({key:"Subtype",value:"/Image"}),ie.push({key:"Width",value:pt.width}),ie.push({key:"Height",value:pt.height}),pt.colorSpace===X.INDEXED?ie.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(pt.palette.length/3-1)+" "+("sMask"in pt&&pt.sMask!==void 0?pt.objectId+2:pt.objectId+1)+" 0 R]"}):(ie.push({key:"ColorSpace",value:"/"+pt.colorSpace}),pt.colorSpace===X.DEVICE_CMYK&&ie.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ie.push({key:"BitsPerComponent",value:pt.bitsPerComponent}),"decodeParameters"in pt&&pt.decodeParameters!==void 0&&ie.push({key:"DecodeParms",value:"<<"+pt.decodeParameters+">>"}),"transparency"in pt&&Array.isArray(pt.transparency)){for(var re="",Yt=0,ce=pt.transparency.length;Yt<ce;Yt++)re+=pt.transparency[Yt]+" "+pt.transparency[Yt]+" ";ie.push({key:"Mask",value:"["+re+"]"})}pt.sMask!==void 0&&ie.push({key:"SMask",value:pt.objectId+1+" 0 R"});var le=pt.filter!==void 0?["/"+pt.filter]:void 0;if(bt({data:pt.data,additionalKeyValues:ie,alreadyAppliedFilters:le,objectId:pt.objectId}),Lt("endobj"),"sMask"in pt&&pt.sMask!==void 0){var Be="/Predictor "+pt.predictor+" /Colors 1 /BitsPerComponent "+pt.bitsPerComponent+" /Columns "+pt.width,nt={width:pt.width,height:pt.height,colorSpace:"DeviceGray",bitsPerComponent:pt.bitsPerComponent,decodeParameters:Be,data:pt.sMask};"filter"in pt&&(nt.filter=pt.filter),at.call(this,nt)}if(pt.colorSpace===X.INDEXED){var St=this.internal.newObject();bt({data:yt(new Uint8Array(pt.palette)),objectId:St}),Lt("endobj")}},o=function(){var at=this.internal.collections.addImage_images;for(var pt in at)n.call(this,at[pt])},c=function(){var at,pt=this.internal.collections.addImage_images,Lt=this.internal.write;for(var bt in pt)Lt("/I"+(at=pt[bt]).index,at.objectId,"0","R")},l=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",c))},_=function(){var at=this.internal.collections.addImage_images;return l.call(this),at},v=function(){return Object.keys(this.internal.collections.addImage_images).length},S=function(at){return typeof i["process"+at.toUpperCase()]=="function"},T=function(at){return Or(at)==="object"&&at.nodeType===1},P=function(at,pt){if(at.nodeName==="IMG"&&at.hasAttribute("src")){var Lt=""+at.getAttribute("src");if(Lt.indexOf("data:image/")===0)return uf(unescape(Lt).split("base64,").pop());var bt=i.loadFile(Lt,!0);if(bt!==void 0)return bt}if(at.nodeName==="CANVAS"){if(at.width===0||at.height===0)throw new Error("Given canvas must have data. Canvas width: "+at.width+", height: "+at.height);var ee;switch(pt){case"PNG":ee="image/png";break;case"WEBP":ee="image/webp";break;case"JPEG":case"JPG":default:ee="image/jpeg"}return uf(at.toDataURL(ee,1).split("base64,").pop())}},I=function(at){var pt=this.internal.collections.addImage_images;if(pt){for(var Lt in pt)if(at===pt[Lt].alias)return pt[Lt]}},z=function(at,pt,Lt){return at||pt||(at=-96,pt=-96),at<0&&(at=-1*Lt.width*72/at/this.internal.scaleFactor),pt<0&&(pt=-1*Lt.height*72/pt/this.internal.scaleFactor),at===0&&(at=pt*Lt.width/Lt.height),pt===0&&(pt=at*Lt.height/Lt.width),[at,pt]},N=function(at,pt,Lt,bt,ee,ie){var re=z.call(this,Lt,bt,ee),Yt=this.internal.getCoordinateString,ce=this.internal.getVerticalCoordinateString,le=_.call(this);if(Lt=re[0],bt=re[1],le[ee.index]=ee,ie){ie*=Math.PI/180;var Be=Math.cos(ie),nt=Math.sin(ie),St=function(jt){return jt.toFixed(4)},Tt=[St(Be),St(nt),St(-1*nt),St(Be),0,0,"cm"]}this.internal.write("q"),ie?(this.internal.write([1,"0","0",1,Yt(at),ce(pt+bt),"cm"].join(" ")),this.internal.write(Tt.join(" ")),this.internal.write([Yt(Lt),"0","0",Yt(bt),"0","0","cm"].join(" "))):this.internal.write([Yt(Lt),"0","0",Yt(bt),Yt(at),ce(pt+bt),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+ee.index+" Do"),this.internal.write("Q")},X=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var H=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},Z=i.__addimage__.sHashCode=function(at){var pt,Lt,bt=0;if(typeof at=="string")for(Lt=at.length,pt=0;pt<Lt;pt++)bt=(bt<<5)-bt+at.charCodeAt(pt),bt|=0;else if(Ft(at))for(Lt=at.byteLength/2,pt=0;pt<Lt;pt++)bt=(bt<<5)-bt+at[pt],bt|=0;return bt},ot=i.__addimage__.validateStringAsBase64=function(at){(at=at||"").toString().trim();var pt=!0;return at.length===0&&(pt=!1),at.length%4!=0&&(pt=!1),/^[A-Za-z0-9+/]+$/.test(at.substr(0,at.length-2))===!1&&(pt=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(at.substr(-2))===!1&&(pt=!1),pt},gt=i.__addimage__.extractImageFromDataUrl=function(at){var pt=(at=at||"").split("base64,"),Lt=null;if(pt.length===2){var bt=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(pt[0]);Array.isArray(bt)&&(Lt={mimeType:bt[1],charset:bt[2],data:pt[1]})}return Lt},Et=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(at){return Et()&&at instanceof ArrayBuffer};var Ft=i.__addimage__.isArrayBufferView=function(at){return Et()&&typeof Uint32Array<"u"&&(at instanceof Int8Array||at instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&at instanceof Uint8ClampedArray||at instanceof Int16Array||at instanceof Uint16Array||at instanceof Int32Array||at instanceof Uint32Array||at instanceof Float32Array||at instanceof Float64Array)},Mt=i.__addimage__.binaryStringToUint8Array=function(at){for(var pt=at.length,Lt=new Uint8Array(pt),bt=0;bt<pt;bt++)Lt[bt]=at.charCodeAt(bt);return Lt},yt=i.__addimage__.arrayBufferToBinaryString=function(at){for(var pt="",Lt=Ft(at)?at:new Uint8Array(at),bt=0;bt<Lt.length;bt+=8192)pt+=String.fromCharCode.apply(null,Lt.subarray(bt,bt+8192));return pt};i.addImage=function(){var at,pt,Lt,bt,ee,ie,re,Yt,ce;if(typeof arguments[1]=="number"?(pt=t,Lt=arguments[1],bt=arguments[2],ee=arguments[3],ie=arguments[4],re=arguments[5],Yt=arguments[6],ce=arguments[7]):(pt=arguments[1],Lt=arguments[2],bt=arguments[3],ee=arguments[4],ie=arguments[5],re=arguments[6],Yt=arguments[7],ce=arguments[8]),Or(at=arguments[0])==="object"&&!T(at)&&"imageData"in at){var le=at;at=le.imageData,pt=le.format||pt||t,Lt=le.x||Lt||0,bt=le.y||bt||0,ee=le.w||le.width||ee,ie=le.h||le.height||ie,re=le.alias||re,Yt=le.compression||Yt,ce=le.rotation||le.angle||ce}var Be=this.internal.getFilters();if(Yt===void 0&&Be.indexOf("FlateEncode")!==-1&&(Yt="SLOW"),isNaN(Lt)||isNaN(bt))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var nt=Ut.call(this,at,pt,re,Yt);return N.call(this,Lt,bt,ee,ie,nt,ce),this};var Ut=function(at,pt,Lt,bt){var ee,ie,re;if(typeof at=="string"&&r(at)===t){at=unescape(at);var Yt=zt(at,!1);(Yt!==""||(Yt=i.loadFile(at,!0))!==void 0)&&(at=Yt)}if(T(at)&&(at=P(at,pt)),pt=r(at,pt),!S(pt))throw new Error("addImage does not support files of type '"+pt+"', please ensure that a plugin for '"+pt+"' support is added.");if(((re=Lt)==null||re.length===0)&&(Lt=function(ce){return typeof ce=="string"||Ft(ce)?Z(ce):Ft(ce.data)?Z(ce.data):null}(at)),(ee=I.call(this,Lt))||(Et()&&(at instanceof Uint8Array||pt==="RGBA"||(ie=at,at=Mt(at))),ee=this["process"+pt.toUpperCase()](at,v.call(this),Lt,function(ce){return ce&&typeof ce=="string"&&(ce=ce.toUpperCase()),ce in i.image_compression?ce:H.NONE}(bt),ie)),!ee)throw new Error("An unknown error occurred whilst processing the image.");return ee},zt=i.__addimage__.convertBase64ToBinaryString=function(at,pt){var Lt;pt=typeof pt!="boolean"||pt;var bt,ee="";if(typeof at=="string"){bt=(Lt=gt(at))!==null?Lt.data:at;try{ee=uf(bt)}catch(ie){if(pt)throw ot(bt)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ie.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return ee};i.getImageProperties=function(at){var pt,Lt,bt="";if(T(at)&&(at=P(at)),typeof at=="string"&&r(at)===t&&((bt=zt(at,!1))===""&&(bt=i.loadFile(at)||""),at=bt),Lt=r(at),!S(Lt))throw new Error("addImage does not support files of type '"+Lt+"', please ensure that a plugin for '"+Lt+"' support is added.");if(!Et()||at instanceof Uint8Array||(at=Mt(at)),!(pt=this["process"+Lt.toUpperCase()](at)))throw new Error("An unknown error occurred whilst processing the image");return pt.fileType=Lt,pt}})(Mi.API),function(i){var t=function(e){if(e!==void 0&&e!="")return!0};Mi.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(e){for(var r,n,o,c=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,_=this.internal.getPageInfoByObjId(e.objId),v=e.pageContext.annotations,S=!1,T=0;T<v.length&&!S;T++)switch((r=v[T]).type){case"link":(t(r.options.url)||t(r.options.pageNumber))&&(S=!0);break;case"reference":case"text":case"freetext":S=!0}if(S!=0){this.internal.write("/Annots [");for(var P=0;P<v.length;P++){r=v[P];var I=this.internal.pdfEscape,z=this.internal.getEncryptor(e.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var N=this.internal.newAdditionalObject(),X=this.internal.newAdditionalObject(),H=this.internal.getEncryptor(N.objId),Z=r.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y)+"] ")+"/Contents ("+I(H(r.contents))+")",o+=" /Popup "+X.objId+" 0 R",o+=" /P "+_.objId+" 0 R",o+=" /T ("+I(H(Z))+") >>",N.content=o;var ot=N.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+c(r.bounds.x+30)+" "+l(r.bounds.y+r.bounds.h)+" "+c(r.bounds.x+r.bounds.w+30)+" "+l(r.bounds.y)+"] ")+" /Parent "+ot,r.open&&(o+=" /Open true"),o+=" >>",X.content=o,this.internal.write(N.objId,"0 R",X.objId,"0 R");break;case"freetext":n="/Rect ["+c(r.bounds.x)+" "+l(r.bounds.y)+" "+c(r.bounds.x+r.bounds.w)+" "+l(r.bounds.y+r.bounds.h)+"] ";var gt=r.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+I(z(r.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+gt+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(r.options.name){var Et=this.annotations._nameMap[r.options.name];r.options.pageNumber=Et.page,r.options.top=Et.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",o="",r.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+I(z(r.options.url))+") >>";else if(r.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,o+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var Ft=l(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),o+=" /XYZ "+r.options.left+" "+Ft+" "+r.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),i.createAnnotation=function(e){var r=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":r.pageContext.annotations.push(e)}},i.link=function(e,r,n,o,c){var l=this.internal.getCurrentPageInfo(),_=this.internal.getCoordinateString,v=this.internal.getVerticalCoordinateString;l.pageContext.annotations.push({finalBounds:{x:_(e),y:v(r),w:_(e+n),h:v(r+o)},options:c,type:"link"})},i.textWithLink=function(e,r,n,o){var c,l,_=this.getTextWidth(e),v=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){l=o.maxWidth;var S=this.splitTextToSize(e,l).length;c=Math.ceil(v*S)}else l=_,c=v;return this.text(e,r,n,o),n+=.2*v,o.align==="center"&&(r-=_/2),o.align==="right"&&(r-=_),this.link(r,n-v,l,c,o),_},i.getTextWidth=function(e){var r=this.internal.getFontSize();return this.getStringUnitWidth(e)*r/this.internal.scaleFactor}}(Mi.API),function(i){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];i.__arabicParser__={};var o=i.__arabicParser__.isInArabicSubstitutionA=function(N){return t[N.charCodeAt(0)]!==void 0},c=i.__arabicParser__.isArabicLetter=function(N){return typeof N=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(N)},l=i.__arabicParser__.isArabicEndLetter=function(N){return c(N)&&o(N)&&t[N.charCodeAt(0)].length<=2},_=i.__arabicParser__.isArabicAlfLetter=function(N){return c(N)&&n.indexOf(N.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(N){return c(N)&&o(N)&&t[N.charCodeAt(0)].length>=1};var v=i.__arabicParser__.arabicLetterHasFinalForm=function(N){return c(N)&&o(N)&&t[N.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(N){return c(N)&&o(N)&&t[N.charCodeAt(0)].length>=3};var S=i.__arabicParser__.arabicLetterHasMedialForm=function(N){return c(N)&&o(N)&&t[N.charCodeAt(0)].length==4},T=i.__arabicParser__.resolveLigatures=function(N){var X=0,H=e,Z="",ot=0;for(X=0;X<N.length;X+=1)H[N.charCodeAt(X)]!==void 0?(ot++,typeof(H=H[N.charCodeAt(X)])=="number"&&(Z+=String.fromCharCode(H),H=e,ot=0),X===N.length-1&&(H=e,Z+=N.charAt(X-(ot-1)),X-=ot-1,ot=0)):(H=e,Z+=N.charAt(X-ot),X-=ot,ot=0);return Z};i.__arabicParser__.isArabicDiacritic=function(N){return N!==void 0&&r[N.charCodeAt(0)]!==void 0};var P=i.__arabicParser__.getCorrectForm=function(N,X,H){return c(N)?o(N)===!1?-1:!v(N)||!c(X)&&!c(H)||!c(H)&&l(X)||l(N)&&!c(X)||l(N)&&_(X)||l(N)&&l(X)?0:S(N)&&c(X)&&!l(X)&&c(H)&&v(H)?3:l(N)||!c(H)?1:2:-1},I=function(N){var X=0,H=0,Z=0,ot="",gt="",Et="",Ft=(N=N||"").split("\\s+"),Mt=[];for(X=0;X<Ft.length;X+=1){for(Mt.push(""),H=0;H<Ft[X].length;H+=1)ot=Ft[X][H],gt=Ft[X][H-1],Et=Ft[X][H+1],c(ot)?(Z=P(ot,gt,Et),Mt[X]+=Z!==-1?String.fromCharCode(t[ot.charCodeAt(0)][Z]):ot):Mt[X]+=ot;Mt[X]=T(Mt[X])}return Mt.join(" ")},z=i.__arabicParser__.processArabic=i.processArabic=function(){var N,X=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,H=[];if(Array.isArray(X)){var Z=0;for(H=[],Z=0;Z<X.length;Z+=1)Array.isArray(X[Z])?H.push([I(X[Z][0]),X[Z][1],X[Z][2]]):H.push([I(X[Z])]);N=H}else N=I(X);return typeof arguments[0]=="string"?N:(arguments[0].text=N,arguments[0])};i.events.push(["preProcessText",z])}(Mi.API),Mi.API.autoPrint=function(i){var t;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})}return this},function(i){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(l){e=l}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(l){r=isNaN(l)||Number.isInteger(l)===!1||l<0?150:l,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(l){n=isNaN(l)||Number.isInteger(l)===!1||l<0?300:l,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(l){o=l}});var c={};Object.defineProperty(this,"style",{get:function(){return c},set:function(l){c=l}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,r){var n;if((e=e||"2d")!=="2d")return null;for(n in r)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=r[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(Mi.API),function(i){var t={left:0,top:0,bottom:0,right:0},e=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var _=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return _},set:function(N){_=N}});var v=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return v},set:function(N){v=N}});var S=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return S},set:function(N){S=N}});var T=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return T},set:function(N){T=N}});var P=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return P},set:function(N){P=N}});var I=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return I},set:function(N){I=N}});var z=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return z},set:function(N){z=N}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(_){return r.call(this),this.internal.__cell__.headerFunction=typeof _=="function"?_:void 0,this},i.getTextDimensions=function(_,v){r.call(this);var S=(v=v||{}).fontSize||this.getFontSize(),T=v.font||this.getFont(),P=v.scaleFactor||this.internal.scaleFactor,I=0,z=0,N=0,X=this;if(!Array.isArray(_)&&typeof _!="string"){if(typeof _!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");_=String(_)}var H=v.maxWidth;H>0?typeof _=="string"?_=this.splitTextToSize(_,H):Object.prototype.toString.call(_)==="[object Array]"&&(_=_.reduce(function(ot,gt){return ot.concat(X.splitTextToSize(gt,H))},[])):_=Array.isArray(_)?_:[_];for(var Z=0;Z<_.length;Z++)I<(N=this.getStringUnitWidth(_[Z],{font:T})*S)&&(I=N);return I!==0&&(z=_.length),{w:I/=P,h:Math.max((z*S*this.getLineHeightFactor()-S*(this.getLineHeightFactor()-1))/P,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var _=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new o(_.left,_.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var c=i.cell=function(){var _;_=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var v=this.internal.__cell__.lastCell,S=this.internal.__cell__.padding,T=this.internal.__cell__.margins||t,P=this.internal.__cell__.tableHeaderRow,I=this.internal.__cell__.printHeaders;return v.lineNumber!==void 0&&(v.lineNumber===_.lineNumber?(_.x=(v.x||0)+(v.width||0),_.y=v.y||0):v.y+v.height+_.height+T.bottom>this.getPageHeight()?(this.cellAddPage(),_.y=T.top,I&&P&&(this.printHeaderRow(_.lineNumber,!0),_.y+=P[0].height)):_.y=v.y+v.height||_.y),_.text[0]!==void 0&&(this.rect(_.x,_.y,_.width,_.height,e===!0?"FD":void 0),_.align==="right"?this.text(_.text,_.x+_.width-S,_.y+S,{align:"right",baseline:"top"}):_.align==="center"?this.text(_.text,_.x+_.width/2,_.y+S,{align:"center",baseline:"top",maxWidth:_.width-S-S}):this.text(_.text,_.x+S,_.y+S,{align:"left",baseline:"top",maxWidth:_.width-S-S})),this.internal.__cell__.lastCell=_,this};i.table=function(_,v,S,T,P){if(r.call(this),!S)throw new Error("No data for PDF table.");var I,z,N,X,H=[],Z=[],ot=[],gt={},Et={},Ft=[],Mt=[],yt=(P=P||{}).autoSize||!1,Ut=P.printHeaders!==!1,zt=P.css&&P.css["font-size"]!==void 0?16*P.css["font-size"]:P.fontSize||12,at=P.margins||Object.assign({width:this.getPageWidth()},t),pt=typeof P.padding=="number"?P.padding:3,Lt=P.headerBackgroundColor||"#c8c8c8",bt=P.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=Ut,this.internal.__cell__.margins=at,this.internal.__cell__.table_font_size=zt,this.internal.__cell__.padding=pt,this.internal.__cell__.headerBackgroundColor=Lt,this.internal.__cell__.headerTextColor=bt,this.setFontSize(zt),T==null)Z=H=Object.keys(S[0]),ot=H.map(function(){return"left"});else if(Array.isArray(T)&&Or(T[0])==="object")for(H=T.map(function(le){return le.name}),Z=T.map(function(le){return le.prompt||le.name||""}),ot=T.map(function(le){return le.align||"left"}),I=0;I<T.length;I+=1)Et[T[I].name]=T[I].width*(19.049976/25.4);else Array.isArray(T)&&typeof T[0]=="string"&&(Z=H=T,ot=H.map(function(){return"left"}));if(yt||Array.isArray(T)&&typeof T[0]=="string")for(I=0;I<H.length;I+=1){for(gt[X=H[I]]=S.map(function(le){return le[X]}),this.setFont(void 0,"bold"),Ft.push(this.getTextDimensions(Z[I],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),z=gt[X],this.setFont(void 0,"normal"),N=0;N<z.length;N+=1)Ft.push(this.getTextDimensions(z[N],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);Et[X]=Math.max.apply(null,Ft)+pt+pt,Ft=[]}if(Ut){var ee={};for(I=0;I<H.length;I+=1)ee[H[I]]={},ee[H[I]].text=Z[I],ee[H[I]].align=ot[I];var ie=l.call(this,ee,Et);Mt=H.map(function(le){return new o(_,v,Et[le],ie,ee[le].text,void 0,ee[le].align)}),this.setTableHeaderRow(Mt),this.printHeaderRow(1,!1)}var re=T.reduce(function(le,Be){return le[Be.name]=Be.align,le},{});for(I=0;I<S.length;I+=1){"rowStart"in P&&P.rowStart instanceof Function&&P.rowStart({row:I,data:S[I]},this);var Yt=l.call(this,S[I],Et);for(N=0;N<H.length;N+=1){var ce=S[I][H[N]];"cellStart"in P&&P.cellStart instanceof Function&&P.cellStart({row:I,col:N,data:ce},this),c.call(this,new o(_,v,Et[H[N]],Yt,ce,I+2,re[H[N]]))}}return this.internal.__cell__.table_x=_,this.internal.__cell__.table_y=v,this};var l=function(_,v){var S=this.internal.__cell__.padding,T=this.internal.__cell__.table_font_size,P=this.internal.scaleFactor;return Object.keys(_).map(function(I){var z=_[I];return this.splitTextToSize(z.hasOwnProperty("text")?z.text:z,v[I]-S-S)},this).map(function(I){return this.getLineHeightFactor()*I.length*T/P+S+S},this).reduce(function(I,z){return Math.max(I,z)},0)};i.setTableHeaderRow=function(_){r.call(this),this.internal.__cell__.tableHeaderRow=_},i.printHeaderRow=function(_,v){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var S;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var T=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(T[0],T[1],T[2],T[3],void 0,-1)}this.setFont(void 0,"bold");for(var P=[],I=0;I<this.internal.__cell__.tableHeaderRow.length;I+=1){S=this.internal.__cell__.tableHeaderRow[I].clone(),v&&(S.y=this.internal.__cell__.margins.top||0,P.push(S)),S.lineNumber=_;var z=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),c.call(this,S),this.setTextColor(z)}P.length>0&&this.setTableHeaderRow(P),this.setFont(void 0,"normal"),e=!1}}(Mi.API);var kE={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},FE=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],s1=RE(FE),DE=[100,200,300,400,500,600,700,800,900],AV=RE(DE);function o1(i){var t=i.family.replace(/"|'/g,"").toLowerCase(),e=function(o){return kE[o=o||"normal"]?o:"normal"}(i.style),r=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(i.weight),n=function(o){return typeof s1[o=o||"normal"]=="number"?o:"normal"}(i.stretch);return{family:t,style:e,weight:r,stretch:n,src:i.src||[],ref:i.ref||{name:t,style:[n,e,r].join(" ")}}}function q5(i,t,e,r){var n;for(n=e;n>=0&&n<t.length;n+=r)if(i[t[n]])return i[t[n]];for(n=e;n>=0&&n<t.length;n-=r)if(i[t[n]])return i[t[n]]}var EV={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},H5={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function W5(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function TV(i,t,e){for(var r=(e=e||{}).defaultFontFamily||"times",n=Object.assign({},EV,e.genericFontFamilies||{}),o=null,c=null,l=0;l<t.length;++l)if(n[(o=o1(t[l])).family]&&(o.family=n[o.family]),i.hasOwnProperty(o.family)){c=i[o.family];break}if(!(c=c||i[r]))throw new Error("Could not find a font-family for the rule '"+W5(o)+"' and default family '"+r+"'.");if(c=function(_,v){if(v[_])return v[_];var S=s1[_],T=S<=s1.normal?-1:1,P=q5(v,FE,S,T);if(!P)throw new Error("Could not find a matching font-stretch value for "+_);return P}(o.stretch,c),c=function(_,v){if(v[_])return v[_];for(var S=kE[_],T=0;T<S.length;++T)if(v[S[T]])return v[S[T]];throw new Error("Could not find a matching font-style for "+_)}(o.style,c),!(c=function(_,v){if(v[_])return v[_];if(_===400&&v[500])return v[500];if(_===500&&v[400])return v[400];var S=AV[_],T=q5(v,DE,S,_<400?-1:1);if(!T)throw new Error("Could not find a matching font-weight for value "+_);return T}(o.weight,c)))throw new Error("Failed to resolve a font for the rule '"+W5(o)+"'.");return c}function X5(i){return i.trimLeft()}function CV(i,t){for(var e=0;e<i.length;){if(i.charAt(e)===t)return[i.substring(0,e),i.substring(e+1)];e+=1}return null}function PV(i){var t=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],i.substring(t[0].length)]}var Nm,Z5,$5,Y5=["times"];(function(i){var t,e,r,n,o,c,l,_,v,S=function(nt){return nt=nt||{},this.isStrokeTransparent=nt.isStrokeTransparent||!1,this.strokeOpacity=nt.strokeOpacity||1,this.strokeStyle=nt.strokeStyle||"#000000",this.fillStyle=nt.fillStyle||"#000000",this.isFillTransparent=nt.isFillTransparent||!1,this.fillOpacity=nt.fillOpacity||1,this.font=nt.font||"10px sans-serif",this.textBaseline=nt.textBaseline||"alphabetic",this.textAlign=nt.textAlign||"left",this.lineWidth=nt.lineWidth||1,this.lineJoin=nt.lineJoin||"miter",this.lineCap=nt.lineCap||"butt",this.path=nt.path||[],this.transform=nt.transform!==void 0?nt.transform.clone():new _,this.globalCompositeOperation=nt.globalCompositeOperation||"normal",this.globalAlpha=nt.globalAlpha||1,this.clip_path=nt.clip_path||[],this.currentPoint=nt.currentPoint||new c,this.miterLimit=nt.miterLimit||10,this.lastPoint=nt.lastPoint||new c,this.lineDashOffset=nt.lineDashOffset||0,this.lineDash=nt.lineDash||[],this.margin=nt.margin||[0,0,0,0],this.prevPageLastElemOffset=nt.prevPageLastElemOffset||0,this.ignoreClearRect=typeof nt.ignoreClearRect!="boolean"||nt.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new T(this),t=this.internal.f2,e=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,c=this.internal.Point,l=this.internal.Rectangle,_=this.internal.Matrix,v=new S}]);var T=function(nt){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var St=nt;Object.defineProperty(this,"pdf",{get:function(){return St}});var Tt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Tt},set:function(oe){Tt=!!oe}});var jt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return jt},set:function(oe){jt=!!oe}});var qt=0;Object.defineProperty(this,"posX",{get:function(){return qt},set:function(oe){isNaN(oe)||(qt=oe)}});var Ht=0;Object.defineProperty(this,"posY",{get:function(){return Ht},set:function(oe){isNaN(oe)||(Ht=oe)}}),Object.defineProperty(this,"margin",{get:function(){return v.margin},set:function(oe){var it;typeof oe=="number"?it=[oe,oe,oe,oe]:((it=new Array(4))[0]=oe[0],it[1]=oe.length>=2?oe[1]:it[0],it[2]=oe.length>=3?oe[2]:it[0],it[3]=oe.length>=4?oe[3]:it[1]),v.margin=it}});var Jt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Jt},set:function(oe){Jt=oe}});var $t=0;Object.defineProperty(this,"lastBreak",{get:function(){return $t},set:function(oe){$t=oe}});var Ae=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ae},set:function(oe){Ae=oe}}),Object.defineProperty(this,"ctx",{get:function(){return v},set:function(oe){oe instanceof S&&(v=oe)}}),Object.defineProperty(this,"path",{get:function(){return v.path},set:function(oe){v.path=oe}});var Le=[];Object.defineProperty(this,"ctxStack",{get:function(){return Le},set:function(oe){Le=oe}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(oe){var it;it=P(oe),this.ctx.fillStyle=it.style,this.ctx.isFillTransparent=it.a===0,this.ctx.fillOpacity=it.a,this.pdf.setFillColor(it.r,it.g,it.b,{a:it.a}),this.pdf.setTextColor(it.r,it.g,it.b,{a:it.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(oe){var it=P(oe);this.ctx.strokeStyle=it.style,this.ctx.isStrokeTransparent=it.a===0,this.ctx.strokeOpacity=it.a,it.a===0?this.pdf.setDrawColor(255,255,255):(it.a,this.pdf.setDrawColor(it.r,it.g,it.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(oe){["butt","round","square"].indexOf(oe)!==-1&&(this.ctx.lineCap=oe,this.pdf.setLineCap(oe))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(oe){isNaN(oe)||(this.ctx.lineWidth=oe,this.pdf.setLineWidth(oe))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(oe){["bevel","round","miter"].indexOf(oe)!==-1&&(this.ctx.lineJoin=oe,this.pdf.setLineJoin(oe))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(oe){isNaN(oe)||(this.ctx.miterLimit=oe,this.pdf.setMiterLimit(oe))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(oe){this.ctx.textBaseline=oe}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(oe){["right","end","center","left","start"].indexOf(oe)!==-1&&(this.ctx.textAlign=oe)}});var Fe=null;function Ne(oe,it){if(Fe===null){var pi=function(Ke){var de=[];return Object.keys(Ke).forEach(function(Ee){Ke[Ee].forEach(function(Me){var De=null;switch(Me){case"bold":De={family:Ee,weight:"bold"};break;case"italic":De={family:Ee,style:"italic"};break;case"bolditalic":De={family:Ee,weight:"bold",style:"italic"};break;case"":case"normal":De={family:Ee}}De!==null&&(De.ref={name:Ee,style:Me},de.push(De))})}),de}(oe.getFontList());Fe=function(Ke){for(var de={},Ee=0;Ee<Ke.length;++Ee){var Me=o1(Ke[Ee]),De=Me.family,ei=Me.stretch,Si=Me.style,vi=Me.weight;de[De]=de[De]||{},de[De][ei]=de[De][ei]||{},de[De][ei][Si]=de[De][ei][Si]||{},de[De][ei][Si][vi]=Me}return de}(pi.concat(it))}return Fe}var si=null;Object.defineProperty(this,"fontFaces",{get:function(){return si},set:function(oe){Fe=null,si=oe}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(oe){var it;if(this.ctx.font=oe,(it=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(oe))!==null){var pi=it[1],Ke=(it[2],it[3]),de=it[4],Ee=(it[5],it[6]),Me=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(de)[2];de=Math.floor(Me==="px"?parseFloat(de)*this.pdf.internal.scaleFactor:Me==="em"?parseFloat(de)*this.pdf.getFontSize():parseFloat(de)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(de);var De=function(ci){var bi,ke,_r=[],ge=ci.trim();if(ge==="")return Y5;if(ge in H5)return[H5[ge]];for(;ge!=="";){switch(ke=null,bi=(ge=X5(ge)).charAt(0)){case'"':case"'":ke=CV(ge.substring(1),bi);break;default:ke=PV(ge)}if(ke===null||(_r.push(ke[0]),(ge=X5(ke[1]))!==""&&ge.charAt(0)!==","))return Y5;ge=ge.replace(/^,/,"")}return _r}(Ee);if(this.fontFaces){var ei=TV(Ne(this.pdf,this.fontFaces),De.map(function(ci){return{family:ci,stretch:"normal",weight:Ke,style:pi}}));this.pdf.setFont(ei.ref.name,ei.ref.style)}else{var Si="";(Ke==="bold"||parseInt(Ke,10)>=700||pi==="bold")&&(Si="bold"),pi==="italic"&&(Si+="italic"),Si.length===0&&(Si="normal");for(var vi="",Ri={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},zi=0;zi<De.length;zi++){if(this.pdf.internal.getFont(De[zi],Si,{noFallback:!0,disableWarning:!0})!==void 0){vi=De[zi];break}if(Si==="bolditalic"&&this.pdf.internal.getFont(De[zi],"bold",{noFallback:!0,disableWarning:!0})!==void 0)vi=De[zi],Si="bold";else if(this.pdf.internal.getFont(De[zi],"normal",{noFallback:!0,disableWarning:!0})!==void 0){vi=De[zi],Si="normal";break}}if(vi===""){for(var me=0;me<De.length;me++)if(Ri[De[me]]){vi=Ri[De[me]];break}}vi=vi===""?"Times":vi,this.pdf.setFont(vi,Si)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(oe){this.ctx.globalCompositeOperation=oe}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(oe){this.ctx.globalAlpha=oe}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(oe){this.ctx.lineDashOffset=oe,Be.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(oe){this.ctx.lineDash=oe,Be.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(oe){this.ctx.ignoreClearRect=!!oe}})};T.prototype.setLineDash=function(nt){this.lineDash=nt},T.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},T.prototype.fill=function(){gt.call(this,"fill",!1)},T.prototype.stroke=function(){gt.call(this,"stroke",!1)},T.prototype.beginPath=function(){this.path=[{type:"begin"}]},T.prototype.moveTo=function(nt,St){if(isNaN(nt)||isNaN(St))throw Wr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Tt=this.ctx.transform.applyToPoint(new c(nt,St));this.path.push({type:"mt",x:Tt.x,y:Tt.y}),this.ctx.lastPoint=new c(nt,St)},T.prototype.closePath=function(){var nt=new c(0,0),St=0;for(St=this.path.length-1;St!==-1;St--)if(this.path[St].type==="begin"&&Or(this.path[St+1])==="object"&&typeof this.path[St+1].x=="number"){nt=new c(this.path[St+1].x,this.path[St+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new c(nt.x,nt.y)},T.prototype.lineTo=function(nt,St){if(isNaN(nt)||isNaN(St))throw Wr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Tt=this.ctx.transform.applyToPoint(new c(nt,St));this.path.push({type:"lt",x:Tt.x,y:Tt.y}),this.ctx.lastPoint=new c(Tt.x,Tt.y)},T.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),gt.call(this,null,!0)},T.prototype.quadraticCurveTo=function(nt,St,Tt,jt){if(isNaN(Tt)||isNaN(jt)||isNaN(nt)||isNaN(St))throw Wr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var qt=this.ctx.transform.applyToPoint(new c(Tt,jt)),Ht=this.ctx.transform.applyToPoint(new c(nt,St));this.path.push({type:"qct",x1:Ht.x,y1:Ht.y,x:qt.x,y:qt.y}),this.ctx.lastPoint=new c(qt.x,qt.y)},T.prototype.bezierCurveTo=function(nt,St,Tt,jt,qt,Ht){if(isNaN(qt)||isNaN(Ht)||isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt))throw Wr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Jt=this.ctx.transform.applyToPoint(new c(qt,Ht)),$t=this.ctx.transform.applyToPoint(new c(nt,St)),Ae=this.ctx.transform.applyToPoint(new c(Tt,jt));this.path.push({type:"bct",x1:$t.x,y1:$t.y,x2:Ae.x,y2:Ae.y,x:Jt.x,y:Jt.y}),this.ctx.lastPoint=new c(Jt.x,Jt.y)},T.prototype.arc=function(nt,St,Tt,jt,qt,Ht){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt)||isNaN(qt))throw Wr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Ht=!!Ht,!this.ctx.transform.isIdentity){var Jt=this.ctx.transform.applyToPoint(new c(nt,St));nt=Jt.x,St=Jt.y;var $t=this.ctx.transform.applyToPoint(new c(0,Tt)),Ae=this.ctx.transform.applyToPoint(new c(0,0));Tt=Math.sqrt(Math.pow($t.x-Ae.x,2)+Math.pow($t.y-Ae.y,2))}Math.abs(qt-jt)>=2*Math.PI&&(jt=0,qt=2*Math.PI),this.path.push({type:"arc",x:nt,y:St,radius:Tt,startAngle:jt,endAngle:qt,counterclockwise:Ht})},T.prototype.arcTo=function(nt,St,Tt,jt,qt){throw new Error("arcTo not implemented.")},T.prototype.rect=function(nt,St,Tt,jt){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt))throw Wr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(nt,St),this.lineTo(nt+Tt,St),this.lineTo(nt+Tt,St+jt),this.lineTo(nt,St+jt),this.lineTo(nt,St),this.lineTo(nt+Tt,St),this.lineTo(nt,St)},T.prototype.fillRect=function(nt,St,Tt,jt){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt))throw Wr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!I.call(this)){var qt={};this.lineCap!=="butt"&&(qt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(qt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(nt,St,Tt,jt),this.fill(),qt.hasOwnProperty("lineCap")&&(this.lineCap=qt.lineCap),qt.hasOwnProperty("lineJoin")&&(this.lineJoin=qt.lineJoin)}},T.prototype.strokeRect=function(nt,St,Tt,jt){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt))throw Wr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");z.call(this)||(this.beginPath(),this.rect(nt,St,Tt,jt),this.stroke())},T.prototype.clearRect=function(nt,St,Tt,jt){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt))throw Wr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(nt,St,Tt,jt))},T.prototype.save=function(nt){nt=typeof nt!="boolean"||nt;for(var St=this.pdf.internal.getCurrentPageInfo().pageNumber,Tt=0;Tt<this.pdf.internal.getNumberOfPages();Tt++)this.pdf.setPage(Tt+1),this.pdf.internal.out("q");if(this.pdf.setPage(St),nt){this.ctx.fontSize=this.pdf.internal.getFontSize();var jt=new S(this.ctx);this.ctxStack.push(this.ctx),this.ctx=jt}},T.prototype.restore=function(nt){nt=typeof nt!="boolean"||nt;for(var St=this.pdf.internal.getCurrentPageInfo().pageNumber,Tt=0;Tt<this.pdf.internal.getNumberOfPages();Tt++)this.pdf.setPage(Tt+1),this.pdf.internal.out("Q");this.pdf.setPage(St),nt&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},T.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var P=function(nt){var St,Tt,jt,qt;if(nt.isCanvasGradient===!0&&(nt=nt.getColor()),!nt)return{r:0,g:0,b:0,a:0,style:nt};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(nt))St=0,Tt=0,jt=0,qt=0;else{var Ht=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(nt);if(Ht!==null)St=parseInt(Ht[1]),Tt=parseInt(Ht[2]),jt=parseInt(Ht[3]),qt=1;else if((Ht=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(nt))!==null)St=parseInt(Ht[1]),Tt=parseInt(Ht[2]),jt=parseInt(Ht[3]),qt=parseFloat(Ht[4]);else{if(qt=1,typeof nt=="string"&&nt.charAt(0)!=="#"){var Jt=new CE(nt);nt=Jt.ok?Jt.toHex():"#000000"}nt.length===4?(St=nt.substring(1,2),St+=St,Tt=nt.substring(2,3),Tt+=Tt,jt=nt.substring(3,4),jt+=jt):(St=nt.substring(1,3),Tt=nt.substring(3,5),jt=nt.substring(5,7)),St=parseInt(St,16),Tt=parseInt(Tt,16),jt=parseInt(jt,16)}}return{r:St,g:Tt,b:jt,a:qt,style:nt}},I=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},z=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};T.prototype.fillText=function(nt,St,Tt,jt){if(isNaN(St)||isNaN(Tt)||typeof nt!="string")throw Wr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(jt=isNaN(jt)?void 0:jt,!I.call(this)){var qt=Yt(this.ctx.transform.rotation),Ht=this.ctx.transform.scaleX;pt.call(this,{text:nt,x:St,y:Tt,scale:Ht,angle:qt,align:this.textAlign,maxWidth:jt})}},T.prototype.strokeText=function(nt,St,Tt,jt){if(isNaN(St)||isNaN(Tt)||typeof nt!="string")throw Wr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!z.call(this)){jt=isNaN(jt)?void 0:jt;var qt=Yt(this.ctx.transform.rotation),Ht=this.ctx.transform.scaleX;pt.call(this,{text:nt,x:St,y:Tt,scale:Ht,renderingMode:"stroke",angle:qt,align:this.textAlign,maxWidth:jt})}},T.prototype.measureText=function(nt){if(typeof nt!="string")throw Wr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var St=this.pdf,Tt=this.pdf.internal.scaleFactor,jt=St.internal.getFontSize(),qt=St.getStringUnitWidth(nt)*jt/St.internal.scaleFactor,Ht=function(Jt){var $t=(Jt=Jt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return $t}}),this};return new Ht({width:qt*=Math.round(96*Tt/72*1e4)/1e4})},T.prototype.scale=function(nt,St){if(isNaN(nt)||isNaN(St))throw Wr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Tt=new _(nt,0,0,St,0,0);this.ctx.transform=this.ctx.transform.multiply(Tt)},T.prototype.rotate=function(nt){if(isNaN(nt))throw Wr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var St=new _(Math.cos(nt),Math.sin(nt),-Math.sin(nt),Math.cos(nt),0,0);this.ctx.transform=this.ctx.transform.multiply(St)},T.prototype.translate=function(nt,St){if(isNaN(nt)||isNaN(St))throw Wr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Tt=new _(1,0,0,1,nt,St);this.ctx.transform=this.ctx.transform.multiply(Tt)},T.prototype.transform=function(nt,St,Tt,jt,qt,Ht){if(isNaN(nt)||isNaN(St)||isNaN(Tt)||isNaN(jt)||isNaN(qt)||isNaN(Ht))throw Wr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Jt=new _(nt,St,Tt,jt,qt,Ht);this.ctx.transform=this.ctx.transform.multiply(Jt)},T.prototype.setTransform=function(nt,St,Tt,jt,qt,Ht){nt=isNaN(nt)?1:nt,St=isNaN(St)?0:St,Tt=isNaN(Tt)?0:Tt,jt=isNaN(jt)?1:jt,qt=isNaN(qt)?0:qt,Ht=isNaN(Ht)?0:Ht,this.ctx.transform=new _(nt,St,Tt,jt,qt,Ht)};var N=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};T.prototype.drawImage=function(nt,St,Tt,jt,qt,Ht,Jt,$t,Ae){var Le=this.pdf.getImageProperties(nt),Fe=1,Ne=1,si=1,oe=1;jt!==void 0&&$t!==void 0&&(si=$t/jt,oe=Ae/qt,Fe=Le.width/jt*$t/jt,Ne=Le.height/qt*Ae/qt),Ht===void 0&&(Ht=St,Jt=Tt,St=0,Tt=0),jt!==void 0&&$t===void 0&&($t=jt,Ae=qt),jt===void 0&&$t===void 0&&($t=Le.width,Ae=Le.height);for(var it,pi=this.ctx.transform.decompose(),Ke=Yt(pi.rotate.shx),de=new _,Ee=(de=(de=(de=de.multiply(pi.translate)).multiply(pi.skew)).multiply(pi.scale)).applyToRectangle(new l(Ht-St*si,Jt-Tt*oe,jt*Fe,qt*Ne)),Me=X.call(this,Ee),De=[],ei=0;ei<Me.length;ei+=1)De.indexOf(Me[ei])===-1&&De.push(Me[ei]);if(ot(De),this.autoPaging)for(var Si=De[0],vi=De[De.length-1],Ri=Si;Ri<vi+1;Ri++){this.pdf.setPage(Ri);var zi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],me=Ri===1?this.posY+this.margin[0]:this.margin[0],ci=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],bi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ke=Ri===1?0:ci+(Ri-2)*bi;if(this.ctx.clip_path.length!==0){var _r=this.path;it=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(it,this.posX+this.margin[3],-ke+me+this.ctx.prevPageLastElemOffset),Et.call(this,"fill",!0),this.path=_r}var ge=JSON.parse(JSON.stringify(Ee));ge=Z([ge],this.posX+this.margin[3],-ke+me+this.ctx.prevPageLastElemOffset)[0];var yi=(Ri>Si||Ri<vi)&&N.call(this);yi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],zi,bi,null).clip().discardPath()),this.pdf.addImage(nt,"JPEG",ge.x,ge.y,ge.w,ge.h,null,null,Ke),yi&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(nt,"JPEG",Ee.x,Ee.y,Ee.w,Ee.h,null,null,Ke)};var X=function(nt,St,Tt){var jt=[];St=St||this.pdf.internal.pageSize.width,Tt=Tt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var qt=this.posY+this.ctx.prevPageLastElemOffset;switch(nt.type){default:case"mt":case"lt":jt.push(Math.floor((nt.y+qt)/Tt)+1);break;case"arc":jt.push(Math.floor((nt.y+qt-nt.radius)/Tt)+1),jt.push(Math.floor((nt.y+qt+nt.radius)/Tt)+1);break;case"qct":var Ht=ce(this.ctx.lastPoint.x,this.ctx.lastPoint.y,nt.x1,nt.y1,nt.x,nt.y);jt.push(Math.floor((Ht.y+qt)/Tt)+1),jt.push(Math.floor((Ht.y+Ht.h+qt)/Tt)+1);break;case"bct":var Jt=le(this.ctx.lastPoint.x,this.ctx.lastPoint.y,nt.x1,nt.y1,nt.x2,nt.y2,nt.x,nt.y);jt.push(Math.floor((Jt.y+qt)/Tt)+1),jt.push(Math.floor((Jt.y+Jt.h+qt)/Tt)+1);break;case"rect":jt.push(Math.floor((nt.y+qt)/Tt)+1),jt.push(Math.floor((nt.y+nt.h+qt)/Tt)+1)}for(var $t=0;$t<jt.length;$t+=1)for(;this.pdf.internal.getNumberOfPages()<jt[$t];)H.call(this);return jt},H=function(){var nt=this.fillStyle,St=this.strokeStyle,Tt=this.font,jt=this.lineCap,qt=this.lineWidth,Ht=this.lineJoin;this.pdf.addPage(),this.fillStyle=nt,this.strokeStyle=St,this.font=Tt,this.lineCap=jt,this.lineWidth=qt,this.lineJoin=Ht},Z=function(nt,St,Tt){for(var jt=0;jt<nt.length;jt++)switch(nt[jt].type){case"bct":nt[jt].x2+=St,nt[jt].y2+=Tt;case"qct":nt[jt].x1+=St,nt[jt].y1+=Tt;case"mt":case"lt":case"arc":default:nt[jt].x+=St,nt[jt].y+=Tt}return nt},ot=function(nt){return nt.sort(function(St,Tt){return St-Tt})},gt=function(nt,St){for(var Tt,jt,qt=this.fillStyle,Ht=this.strokeStyle,Jt=this.lineCap,$t=this.lineWidth,Ae=Math.abs($t*this.ctx.transform.scaleX),Le=this.lineJoin,Fe=JSON.parse(JSON.stringify(this.path)),Ne=JSON.parse(JSON.stringify(this.path)),si=[],oe=0;oe<Ne.length;oe++)if(Ne[oe].x!==void 0)for(var it=X.call(this,Ne[oe]),pi=0;pi<it.length;pi+=1)si.indexOf(it[pi])===-1&&si.push(it[pi]);for(var Ke=0;Ke<si.length;Ke++)for(;this.pdf.internal.getNumberOfPages()<si[Ke];)H.call(this);if(ot(si),this.autoPaging)for(var de=si[0],Ee=si[si.length-1],Me=de;Me<Ee+1;Me++){this.pdf.setPage(Me),this.fillStyle=qt,this.strokeStyle=Ht,this.lineCap=Jt,this.lineWidth=Ae,this.lineJoin=Le;var De=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],ei=Me===1?this.posY+this.margin[0]:this.margin[0],Si=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],vi=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ri=Me===1?0:Si+(Me-2)*vi;if(this.ctx.clip_path.length!==0){var zi=this.path;Tt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(Tt,this.posX+this.margin[3],-Ri+ei+this.ctx.prevPageLastElemOffset),Et.call(this,nt,!0),this.path=zi}if(jt=JSON.parse(JSON.stringify(Fe)),this.path=Z(jt,this.posX+this.margin[3],-Ri+ei+this.ctx.prevPageLastElemOffset),St===!1||Me===0){var me=(Me>de||Me<Ee)&&N.call(this);me&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],De,vi,null).clip().discardPath()),Et.call(this,nt,St),me&&this.pdf.restoreGraphicsState()}this.lineWidth=$t}else this.lineWidth=Ae,Et.call(this,nt,St),this.lineWidth=$t;this.path=Fe},Et=function(nt,St){if((nt!=="stroke"||St||!z.call(this))&&(nt==="stroke"||St||!I.call(this))){for(var Tt,jt,qt=[],Ht=this.path,Jt=0;Jt<Ht.length;Jt++){var $t=Ht[Jt];switch($t.type){case"begin":qt.push({begin:!0});break;case"close":qt.push({close:!0});break;case"mt":qt.push({start:$t,deltas:[],abs:[]});break;case"lt":var Ae=qt.length;if(Ht[Jt-1]&&!isNaN(Ht[Jt-1].x)&&(Tt=[$t.x-Ht[Jt-1].x,$t.y-Ht[Jt-1].y],Ae>0)){for(;Ae>=0;Ae--)if(qt[Ae-1].close!==!0&&qt[Ae-1].begin!==!0){qt[Ae-1].deltas.push(Tt),qt[Ae-1].abs.push($t);break}}break;case"bct":Tt=[$t.x1-Ht[Jt-1].x,$t.y1-Ht[Jt-1].y,$t.x2-Ht[Jt-1].x,$t.y2-Ht[Jt-1].y,$t.x-Ht[Jt-1].x,$t.y-Ht[Jt-1].y],qt[qt.length-1].deltas.push(Tt);break;case"qct":var Le=Ht[Jt-1].x+2/3*($t.x1-Ht[Jt-1].x),Fe=Ht[Jt-1].y+2/3*($t.y1-Ht[Jt-1].y),Ne=$t.x+2/3*($t.x1-$t.x),si=$t.y+2/3*($t.y1-$t.y),oe=$t.x,it=$t.y;Tt=[Le-Ht[Jt-1].x,Fe-Ht[Jt-1].y,Ne-Ht[Jt-1].x,si-Ht[Jt-1].y,oe-Ht[Jt-1].x,it-Ht[Jt-1].y],qt[qt.length-1].deltas.push(Tt);break;case"arc":qt.push({deltas:[],abs:[],arc:!0}),Array.isArray(qt[qt.length-1].abs)&&qt[qt.length-1].abs.push($t)}}jt=St?null:nt==="stroke"?"stroke":"fill";for(var pi=!1,Ke=0;Ke<qt.length;Ke++)if(qt[Ke].arc)for(var de=qt[Ke].abs,Ee=0;Ee<de.length;Ee++){var Me=de[Ee];Me.type==="arc"?yt.call(this,Me.x,Me.y,Me.radius,Me.startAngle,Me.endAngle,Me.counterclockwise,void 0,St,!pi):Lt.call(this,Me.x,Me.y),pi=!0}else if(qt[Ke].close===!0)this.pdf.internal.out("h"),pi=!1;else if(qt[Ke].begin!==!0){var De=qt[Ke].start.x,ei=qt[Ke].start.y;bt.call(this,qt[Ke].deltas,De,ei),pi=!0}jt&&Ut.call(this,jt),St&&zt.call(this)}},Ft=function(nt){var St=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Tt=St*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return nt-Tt;case"top":return nt+St-Tt;case"hanging":return nt+St-2*Tt;case"middle":return nt+St/2-Tt;case"ideographic":return nt;case"alphabetic":default:return nt}},Mt=function(nt){return nt+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};T.prototype.createLinearGradient=function(){var nt=function(){};return nt.colorStops=[],nt.addColorStop=function(St,Tt){this.colorStops.push([St,Tt])},nt.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},nt.isCanvasGradient=!0,nt},T.prototype.createPattern=function(){return this.createLinearGradient()},T.prototype.createRadialGradient=function(){return this.createLinearGradient()};var yt=function(nt,St,Tt,jt,qt,Ht,Jt,$t,Ae){for(var Le=ie.call(this,Tt,jt,qt,Ht),Fe=0;Fe<Le.length;Fe++){var Ne=Le[Fe];Fe===0&&(Ae?at.call(this,Ne.x1+nt,Ne.y1+St):Lt.call(this,Ne.x1+nt,Ne.y1+St)),ee.call(this,nt,St,Ne.x2,Ne.y2,Ne.x3,Ne.y3,Ne.x4,Ne.y4)}$t?zt.call(this):Ut.call(this,Jt)},Ut=function(nt){switch(nt){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},zt=function(){this.pdf.clip(),this.pdf.discardPath()},at=function(nt,St){this.pdf.internal.out(e(nt)+" "+r(St)+" m")},pt=function(nt){var St;switch(nt.align){case"right":case"end":St="right";break;case"center":St="center";break;case"left":case"start":default:St="left"}var Tt=this.pdf.getTextDimensions(nt.text),jt=Ft.call(this,nt.y),qt=Mt.call(this,jt)-Tt.h,Ht=this.ctx.transform.applyToPoint(new c(nt.x,jt)),Jt=this.ctx.transform.decompose(),$t=new _;$t=($t=($t=$t.multiply(Jt.translate)).multiply(Jt.skew)).multiply(Jt.scale);for(var Ae,Le,Fe,Ne=this.ctx.transform.applyToRectangle(new l(nt.x,jt,Tt.w,Tt.h)),si=$t.applyToRectangle(new l(nt.x,qt,Tt.w,Tt.h)),oe=X.call(this,si),it=[],pi=0;pi<oe.length;pi+=1)it.indexOf(oe[pi])===-1&&it.push(oe[pi]);if(ot(it),this.autoPaging)for(var Ke=it[0],de=it[it.length-1],Ee=Ke;Ee<de+1;Ee++){this.pdf.setPage(Ee);var Me=Ee===1?this.posY+this.margin[0]:this.margin[0],De=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ei=this.pdf.internal.pageSize.height-this.margin[2],Si=ei-this.margin[0],vi=this.pdf.internal.pageSize.width-this.margin[1],Ri=vi-this.margin[3],zi=Ee===1?0:De+(Ee-2)*Si;if(this.ctx.clip_path.length!==0){var me=this.path;Ae=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=Z(Ae,this.posX+this.margin[3],-1*zi+Me),Et.call(this,"fill",!0),this.path=me}var ci=Z([JSON.parse(JSON.stringify(si))],this.posX+this.margin[3],-zi+Me+this.ctx.prevPageLastElemOffset)[0];nt.scale>=.01&&(Le=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Le*nt.scale),Fe=this.lineWidth,this.lineWidth=Fe*nt.scale);var bi=this.autoPaging!=="text";if(bi||ci.y+ci.h<=ei){if(bi||ci.y>=Me&&ci.x<=vi){var ke=bi?nt.text:this.pdf.splitTextToSize(nt.text,nt.maxWidth||vi-ci.x)[0],_r=Z([JSON.parse(JSON.stringify(Ne))],this.posX+this.margin[3],-zi+Me+this.ctx.prevPageLastElemOffset)[0],ge=bi&&(Ee>Ke||Ee<de)&&N.call(this);ge&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ri,Si,null).clip().discardPath()),this.pdf.text(ke,_r.x,_r.y,{angle:nt.angle,align:St,renderingMode:nt.renderingMode}),ge&&this.pdf.restoreGraphicsState()}}else ci.y<ei&&(this.ctx.prevPageLastElemOffset+=ei-ci.y);nt.scale>=.01&&(this.pdf.setFontSize(Le),this.lineWidth=Fe)}else nt.scale>=.01&&(Le=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Le*nt.scale),Fe=this.lineWidth,this.lineWidth=Fe*nt.scale),this.pdf.text(nt.text,Ht.x+this.posX,Ht.y+this.posY,{angle:nt.angle,align:St,renderingMode:nt.renderingMode,maxWidth:nt.maxWidth}),nt.scale>=.01&&(this.pdf.setFontSize(Le),this.lineWidth=Fe)},Lt=function(nt,St,Tt,jt){Tt=Tt||0,jt=jt||0,this.pdf.internal.out(e(nt+Tt)+" "+r(St+jt)+" l")},bt=function(nt,St,Tt){return this.pdf.lines(nt,St,Tt,null,null)},ee=function(nt,St,Tt,jt,qt,Ht,Jt,$t){this.pdf.internal.out([t(n(Tt+nt)),t(o(jt+St)),t(n(qt+nt)),t(o(Ht+St)),t(n(Jt+nt)),t(o($t+St)),"c"].join(" "))},ie=function(nt,St,Tt,jt){for(var qt=2*Math.PI,Ht=Math.PI/2;St>Tt;)St-=qt;var Jt=Math.abs(Tt-St);Jt<qt&&jt&&(Jt=qt-Jt);for(var $t=[],Ae=jt?-1:1,Le=St;Jt>1e-5;){var Fe=Le+Ae*Math.min(Jt,Ht);$t.push(re.call(this,nt,Le,Fe)),Jt-=Math.abs(Fe-Le),Le=Fe}return $t},re=function(nt,St,Tt){var jt=(Tt-St)/2,qt=nt*Math.cos(jt),Ht=nt*Math.sin(jt),Jt=qt,$t=-Ht,Ae=Jt*Jt+$t*$t,Le=Ae+Jt*qt+$t*Ht,Fe=4/3*(Math.sqrt(2*Ae*Le)-Le)/(Jt*Ht-$t*qt),Ne=Jt-Fe*$t,si=$t+Fe*Jt,oe=Ne,it=-si,pi=jt+St,Ke=Math.cos(pi),de=Math.sin(pi);return{x1:nt*Math.cos(St),y1:nt*Math.sin(St),x2:Ne*Ke-si*de,y2:Ne*de+si*Ke,x3:oe*Ke-it*de,y3:oe*de+it*Ke,x4:nt*Math.cos(Tt),y4:nt*Math.sin(Tt)}},Yt=function(nt){return 180*nt/Math.PI},ce=function(nt,St,Tt,jt,qt,Ht){var Jt=nt+.5*(Tt-nt),$t=St+.5*(jt-St),Ae=qt+.5*(Tt-qt),Le=Ht+.5*(jt-Ht),Fe=Math.min(nt,qt,Jt,Ae),Ne=Math.max(nt,qt,Jt,Ae),si=Math.min(St,Ht,$t,Le),oe=Math.max(St,Ht,$t,Le);return new l(Fe,si,Ne-Fe,oe-si)},le=function(nt,St,Tt,jt,qt,Ht,Jt,$t){var Ae,Le,Fe,Ne,si,oe,it,pi,Ke,de,Ee,Me,De,ei,Si=Tt-nt,vi=jt-St,Ri=qt-Tt,zi=Ht-jt,me=Jt-qt,ci=$t-Ht;for(Le=0;Le<41;Le++)Ke=(it=(Fe=nt+(Ae=Le/40)*Si)+Ae*((si=Tt+Ae*Ri)-Fe))+Ae*(si+Ae*(qt+Ae*me-si)-it),de=(pi=(Ne=St+Ae*vi)+Ae*((oe=jt+Ae*zi)-Ne))+Ae*(oe+Ae*(Ht+Ae*ci-oe)-pi),Le==0?(Ee=Ke,Me=de,De=Ke,ei=de):(Ee=Math.min(Ee,Ke),Me=Math.min(Me,de),De=Math.max(De,Ke),ei=Math.max(ei,de));return new l(Math.round(Ee),Math.round(Me),Math.round(De-Ee),Math.round(ei-Me))},Be=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var nt,St,Tt=(nt=this.ctx.lineDash,St=this.ctx.lineDashOffset,JSON.stringify({lineDash:nt,lineDashOffset:St}));this.prevLineDash!==Tt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Tt)}}})(Mi.API),function(i){var t=function(o){var c,l,_,v,S,T,P,I,z,N;for(l=[],_=0,v=(o+=c="\0\0\0\0".slice(o.length%4||4)).length;v>_;_+=4)(S=(o.charCodeAt(_)<<24)+(o.charCodeAt(_+1)<<16)+(o.charCodeAt(_+2)<<8)+o.charCodeAt(_+3))!==0?(T=(S=((S=((S=((S=(S-(N=S%85))/85)-(z=S%85))/85)-(I=S%85))/85)-(P=S%85))/85)%85,l.push(T+33,P+33,I+33,z+33,N+33)):l.push(122);return function(X,H){for(var Z=H;Z>0;Z--)X.pop()}(l,c.length),String.fromCharCode.apply(String,l)+"~>"},e=function(o){var c,l,_,v,S,T=String,P="length",I=255,z="charCodeAt",N="slice",X="replace";for(o[N](-2),o=o[N](0,-2)[X](/\s/g,"")[X]("z","!!!!!"),_=[],v=0,S=(o+=c="uuuuu"[N](o[P]%5||5))[P];S>v;v+=5)l=52200625*(o[z](v)-33)+614125*(o[z](v+1)-33)+7225*(o[z](v+2)-33)+85*(o[z](v+3)-33)+(o[z](v+4)-33),_.push(I&l>>24,I&l>>16,I&l>>8,I&l);return function(H,Z){for(var ot=Z;ot>0;ot--)H.pop()}(_,c[P]),T.fromCharCode.apply(T,_)},r=function(o){var c=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),c.test(o)===!1)return"";for(var l="",_=0;_<o.length;_+=2)l+=String.fromCharCode("0x"+(o[_]+o[_+1]));return l},n=function(o){for(var c=new Uint8Array(o.length),l=o.length;l--;)c[l]=o.charCodeAt(l);return o=(c=t1(c)).reduce(function(_,v){return _+String.fromCharCode(v)},"")};i.processDataByFilters=function(o,c){var l=0,_=o||"",v=[];for(typeof(c=c||[])=="string"&&(c=[c]),l=0;l<c.length;l+=1)switch(c[l]){case"ASCII85Decode":case"/ASCII85Decode":_=e(_),v.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":_=t(_),v.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":_=r(_),v.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":_=_.split("").map(function(S){return("0"+S.charCodeAt().toString(16)).slice(-2)}).join("")+">",v.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":_=n(_),v.push("/FlateDecode");break;default:throw new Error('The filter: "'+c[l]+'" is not implemented')}return{data:_,reverseChain:v.reverse().join(" ")}}}(Mi.API),function(i){i.loadFile=function(t,e,r){return function(n,o,c){o=o!==!1,c=typeof c=="function"?c:function(){};var l=void 0;try{l=function(_,v,S){var T=new XMLHttpRequest,P=0,I=function(z){var N=z.length,X=[],H=String.fromCharCode;for(P=0;P<N;P+=1)X.push(H(255&z.charCodeAt(P)));return X.join("")};if(T.open("GET",_,!v),T.overrideMimeType("text/plain; charset=x-user-defined"),v===!1&&(T.onload=function(){T.status===200?S(I(this.responseText)):S(void 0)}),T.send(null),v&&T.status===200)return I(T.responseText)}(n,o,c)}catch{}return l}(t,e,r)},i.loadImageFile=i.loadFile}(Mi.API),function(i){function t(){return(Bi.html2canvas?Promise.resolve(Bi.html2canvas):ey(()=>import("./html2canvas.esm-CKxSAI8P-DLLJDLZD-xkYPgEOG.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load html2canvas: "+c))}).then(function(c){return c.default?c.default:c})}function e(){return(Bi.DOMPurify?Promise.resolve(Bi.DOMPurify):ey(()=>import("./purify.es-CLxMp-4V-DQ4yGNUw-D3ozuLpM.js"),[])).catch(function(c){return Promise.reject(new Error("Could not load dompurify: "+c))}).then(function(c){return c.default?c.default:c})}var r=function(c){var l=Or(c);return l==="undefined"?"undefined":l==="string"||c instanceof String?"string":l==="number"||c instanceof Number?"number":l==="function"||c instanceof Function?"function":c&&c.constructor===Array?"array":c&&c.nodeType===1?"element":l==="object"?"object":"unknown"},n=function(c,l){var _=document.createElement(c);for(var v in l.className&&(_.className=l.className),l.innerHTML&&l.dompurify&&(_.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)_.style[v]=l.style[v];return _},o=function c(l){var _=Object.assign(c.convert(Promise.resolve()),JSON.parse(JSON.stringify(c.template))),v=c.convert(Promise.resolve(),_);return v=(v=v.setProgress(1,c,1,[c])).set(l)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(c,l){return c.__proto__=l||o.prototype,c},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(c,l){return this.then(function(){switch(l=l||function(_){switch(r(_)){case"string":return"string";case"element":return _.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(c)){case"string":return this.then(e).then(function(_){return this.set({src:n("div",{innerHTML:c,dompurify:_})})});case"element":return this.set({src:c});case"canvas":return this.set({canvas:c});case"img":return this.set({img:c});default:return this.error("Unknown source type.")}})},o.prototype.to=function(c){switch(c){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var c={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=function _(v,S){for(var T=v.nodeType===3?document.createTextNode(v.nodeValue):v.cloneNode(!1),P=v.firstChild;P;P=P.nextSibling)S!==!0&&P.nodeType===1&&P.nodeName==="SCRIPT"||T.appendChild(_(P,S));return v.nodeType===1&&(v.nodeName==="CANVAS"?(T.width=v.width,T.height=v.height,T.getContext("2d").drawImage(v,0,0)):v.nodeName!=="TEXTAREA"&&v.nodeName!=="SELECT"||(T.value=v.value),T.addEventListener("load",function(){T.scrollTop=v.scrollTop,T.scrollLeft=v.scrollLeft},!0)),T}(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(c.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:c}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var _=Object.assign({},this.opt.html2canvas);return delete _.onrendered,l(this.prop.container,_)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var c=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(c).then(t).then(function(l){var _=this.opt.jsPDF,v=this.opt.fontFaces,S=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,T=Object.assign({async:!0,allowTaint:!0,scale:S,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete T.onrendered,_.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,_.context2d.posX=this.opt.x,_.context2d.posY=this.opt.y,_.context2d.margin=this.opt.margin,_.context2d.fontFaces=v,v)for(var P=0;P<v.length;++P){var I=v[P],z=I.src.find(function(N){return N.format==="truetype"});z&&_.addFont(z.url,I.ref.name,I.ref.style)}return T.windowHeight=T.windowHeight||0,T.windowHeight=T.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):T.windowHeight,_.context2d.save(!0),l(this.prop.container,T)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var c=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=c})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(c,l,_){return(_=_||"pdf").toLowerCase()==="img"||_.toLowerCase()==="image"?this.outputImg(c,l):this.outputPdf(c,l)},o.prototype.outputPdf=function(c,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(c,l)})},o.prototype.outputImg=function(c){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(c){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+c+'" is not supported.'}})},o.prototype.save=function(c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(c?{filename:c}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(c){if(r(c)!=="object")return this;var l=Object.keys(c||{}).map(function(_){if(_ in o.template.prop)return function(){this.prop[_]=c[_]};switch(_){case"margin":return this.setMargin.bind(this,c.margin);case"jsPDF":return function(){return this.opt.jsPDF=c.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,c.pageSize);default:return function(){this.opt[_]=c[_]}}},this);return this.then(function(){return this.thenList(l)})},o.prototype.get=function(c,l){return this.then(function(){var _=c in o.template.prop?this.prop[c]:this.opt[c];return l?l(_):_})},o.prototype.setMargin=function(c){return this.then(function(){switch(r(c)){case"number":c=[c,c,c,c];case"array":if(c.length===2&&(c=[c[0],c[1],c[0],c[1]]),c.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=c}).then(this.setPageSize)},o.prototype.setPageSize=function(c){function l(_,v){return Math.floor(_*v/72*96)}return this.then(function(){(c=c||Mi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(c.inner={width:c.width-this.opt.margin[1]-this.opt.margin[3],height:c.height-this.opt.margin[0]-this.opt.margin[2]},c.inner.px={width:l(c.inner.width,c.k),height:l(c.inner.height,c.k)},c.inner.ratio=c.inner.height/c.inner.width),this.prop.pageSize=c})},o.prototype.setProgress=function(c,l,_,v){return c!=null&&(this.progress.val=c),l!=null&&(this.progress.state=l),_!=null&&(this.progress.n=_),v!=null&&(this.progress.stack=v),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(c,l,_,v){return this.setProgress(c?this.progress.val+c:null,l||null,_?this.progress.n+_:null,v?this.progress.stack.concat(v):null)},o.prototype.then=function(c,l){var _=this;return this.thenCore(c,l,function(v,S){return _.updateProgress(null,null,1,[v]),Promise.prototype.then.call(this,function(T){return _.updateProgress(null,v),T}).then(v,S).then(function(T){return _.updateProgress(1),T})})},o.prototype.thenCore=function(c,l,_){_=_||Promise.prototype.then,c&&(c=c.bind(this)),l&&(l=l.bind(this));var v=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),S=_.call(v,c,l);return o.convert(S,this.__proto__)},o.prototype.thenExternal=function(c,l){return Promise.prototype.then.call(this,c,l)},o.prototype.thenList=function(c){var l=this;return c.forEach(function(_){l=l.thenCore(_)}),l},o.prototype.catch=function(c){c&&(c=c.bind(this));var l=Promise.prototype.catch.call(this,c);return o.convert(l,this)},o.prototype.catchExternal=function(c){return Promise.prototype.catch.call(this,c)},o.prototype.error=function(c){return this.then(function(){throw new Error(c)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Mi.getPageSize=function(c,l,_){if(Or(c)==="object"){var v=c;c=v.orientation,l=v.unit||l,_=v.format||_}l=l||"mm",_=_||"a4",c=(""+(c||"P")).toLowerCase();var S,T=(""+_).toLowerCase(),P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":S=1;break;case"mm":S=72/25.4;break;case"cm":S=72/2.54;break;case"in":S=72;break;case"px":S=.75;break;case"pc":case"em":S=12;break;case"ex":S=6;break;default:throw"Invalid unit: "+l}var I,z=0,N=0;if(P.hasOwnProperty(T))z=P[T][1]/S,N=P[T][0]/S;else try{z=_[1],N=_[0]}catch{throw new Error("Invalid format: "+_)}if(c==="p"||c==="portrait")c="p",N>z&&(I=N,N=z,z=I);else{if(c!=="l"&&c!=="landscape")throw"Invalid orientation: "+c;c="l",z>N&&(I=N,N=z,z=I)}return{width:N,height:z,unit:l,k:S,orientation:c}},i.html=function(c,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(o1):null;var _=new o(l);return l.worker?_:_.from(c).doCallback()}}(Mi.API),Mi.API.addJS=function(i){return $5=i,this.internal.events.subscribe("postPutResources",function(){Nm=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Nm+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Z5=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+$5+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Nm!==void 0&&Z5!==void 0&&this.internal.out("/Names <</JavaScript "+Nm+" 0 R>>")}),this},function(i){var t;i.events.push(["postPutResources",function(){var e=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=e.outline.render().split(/\r\n/),o=0;o<n.length;o++){var c=n[o],l=r.exec(c);if(l!=null){var _=l[1];e.internal.newObjectDeferredBegin(_,!1)}e.internal.write(c)}if(this.outline.createNamedDestinations){var v=this.internal.pages.length,S=[];for(o=0;o<v;o++){var T=e.internal.newObject();S.push(T);var P=e.internal.getPageInfo(o+1);e.internal.write("<< /D["+P.objId+" 0 R /XYZ null null null]>> endobj")}var I=e.internal.newObject();for(e.internal.write("<< /Names [ "),o=0;o<S.length;o++)e.internal.write("(page_"+(o+1)+")"+S[o]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+I+" 0 R"),e.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),i.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(r,n,o){var c={title:n,options:o,children:[]};return r==null&&(r=this.root),r.children.push(c),c},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(r){r.id=e.internal.newObjectDeferred();for(var n=0;n<r.children.length;n++)this.genIds_r(r.children[n])},e.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},e.outline.renderItems=function(r){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<r.children.length;o++){var c=r.children[o];this.objStart(c),this.line("/Title "+this.makeString(c.title)),this.line("/Parent "+this.makeRef(r)),o>0&&this.line("/Prev "+this.makeRef(r.children[o-1])),o<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[o+1])),c.children.length>0&&(this.line("/First "+this.makeRef(c.children[0])),this.line("/Last "+this.makeRef(c.children[c.children.length-1])));var l=this.count=this.count_r({count:0},c);if(l>0&&this.line("/Count "+l),c.options&&c.options.pageNumber){var _=e.internal.getPageInfo(c.options.pageNumber);this.line("/Dest ["+_.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var v=0;v<r.children.length;v++)this.renderItems(r.children[v])},e.outline.line=function(r){this.ctx.val+=r+`\r
`},e.outline.makeRef=function(r){return r.id+" 0 R"},e.outline.makeString=function(r){return"("+e.internal.pdfEscape(r)+")"},e.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(r,n){for(var o=0;o<n.children.length;o++)r.count++,this.count_r(r,n.children[o]);return r.count}}])}(Mi.API),function(i){var t=[192,193,194,195,196,197,198,199];i.processJPEG=function(e,r,n,o,c,l){var _,v=this.decode.DCT_DECODE,S=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=c||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(_=function(T){for(var P,I=256*T.charCodeAt(4)+T.charCodeAt(5),z=T.length,N={width:0,height:0,numcomponents:1},X=4;X<z;X+=2){if(X+=I,t.indexOf(T.charCodeAt(X+1))!==-1){P=256*T.charCodeAt(X+5)+T.charCodeAt(X+6),N={width:256*T.charCodeAt(X+7)+T.charCodeAt(X+8),height:P,numcomponents:T.charCodeAt(X+9)};break}I=256*T.charCodeAt(X+2)+T.charCodeAt(X+3)}return N}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:l=this.color_spaces.DEVICE_GRAY;break;case 4:l=this.color_spaces.DEVICE_CMYK;break;case 3:l=this.color_spaces.DEVICE_RGB}S={data:e,width:_.width,height:_.height,colorSpace:l,bitsPerComponent:8,filter:v,index:r,alias:n}}return S}}(Mi.API);var Sd,zm,J5,K5,Q5,IV=function(){var i,t,e;function r(o){var c,l,_,v,S,T,P,I,z,N,X,H,Z,ot;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},T=null;;){switch(c=this.readUInt32(),z=(function(){var gt,Et;for(Et=[],gt=0;gt<4;++gt)Et.push(String.fromCharCode(this.data[this.pos++]));return Et}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(c);break;case"fcTL":T&&this.animation.frames.push(T),this.pos+=4,T={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},S=this.readUInt16(),v=this.readUInt16()||100,T.delay=1e3*S/v,T.disposeOp=this.data[this.pos++],T.blendOp=this.data[this.pos++],T.data=[];break;case"IDAT":case"fdAT":for(z==="fdAT"&&(this.pos+=4,c-=4),o=(T!=null?T.data:void 0)||this.imgData,H=0;0<=c?H<c:H>c;0<=c?++H:--H)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(_=this.palette.length/3,this.transparency.indexed=this.read(c),this.transparency.indexed.length>_)throw new Error("More transparent colors than palette size");if((N=_-this.transparency.indexed.length)>0)for(Z=0;0<=N?Z<N:Z>N;0<=N?++Z:--Z)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case"tEXt":P=(X=this.read(c)).indexOf(0),I=String.fromCharCode.apply(String,X.slice(0,P)),this.text[I]=String.fromCharCode.apply(String,X.slice(P+1));break;case"IEND":return T&&this.animation.frames.push(T),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(ot=this.colorType)===4||ot===6,l=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*l,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=c}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(o){var c,l;for(l=[],c=0;0<=o?c<o:c>o;0<=o?++c:--c)l.push(this.data[this.pos++]);return l},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(o){var c=this.pixelBitlength/8,l=new Uint8Array(this.width*this.height*c),_=0,v=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function S(T,P,I,z){var N,X,H,Z,ot,gt,Et,Ft,Mt,yt,Ut,zt,at,pt,Lt,bt,ee,ie,re,Yt,ce,le=Math.ceil((v.width-T)/I),Be=Math.ceil((v.height-P)/z),nt=v.width==le&&v.height==Be;for(pt=c*le,zt=nt?l:new Uint8Array(pt*Be),gt=o.length,at=0,X=0;at<Be&&_<gt;){switch(o[_++]){case 0:for(Z=ee=0;ee<pt;Z=ee+=1)zt[X++]=o[_++];break;case 1:for(Z=ie=0;ie<pt;Z=ie+=1)N=o[_++],ot=Z<c?0:zt[X-c],zt[X++]=(N+ot)%256;break;case 2:for(Z=re=0;re<pt;Z=re+=1)N=o[_++],H=(Z-Z%c)/c,Lt=at&&zt[(at-1)*pt+H*c+Z%c],zt[X++]=(Lt+N)%256;break;case 3:for(Z=Yt=0;Yt<pt;Z=Yt+=1)N=o[_++],H=(Z-Z%c)/c,ot=Z<c?0:zt[X-c],Lt=at&&zt[(at-1)*pt+H*c+Z%c],zt[X++]=(N+Math.floor((ot+Lt)/2))%256;break;case 4:for(Z=ce=0;ce<pt;Z=ce+=1)N=o[_++],H=(Z-Z%c)/c,ot=Z<c?0:zt[X-c],at===0?Lt=bt=0:(Lt=zt[(at-1)*pt+H*c+Z%c],bt=H&&zt[(at-1)*pt+(H-1)*c+Z%c]),Et=ot+Lt-bt,Ft=Math.abs(Et-ot),yt=Math.abs(Et-Lt),Ut=Math.abs(Et-bt),Mt=Ft<=yt&&Ft<=Ut?ot:yt<=Ut?Lt:bt,zt[X++]=(N+Mt)%256;break;default:throw new Error("Invalid filter algorithm: "+o[_-1])}if(!nt){var St=((P+at*z)*v.width+T)*c,Tt=at*pt;for(Z=0;Z<le;Z+=1){for(var jt=0;jt<c;jt+=1)l[St++]=zt[Tt++];St+=(I-1)*c}}at++}}return o=cV(o),v.interlaceMethod==1?(S(0,0,8,8),S(4,0,8,8),S(0,4,4,8),S(2,0,4,4),S(0,2,2,4),S(1,0,2,2),S(0,1,1,2)):S(0,0,1,1),l},r.prototype.decodePalette=function(){var o,c,l,_,v,S,T,P,I;for(l=this.palette,S=this.transparency.indexed||[],v=new Uint8Array((S.length||0)+l.length),_=0,o=0,c=T=0,P=l.length;T<P;c=T+=3)v[_++]=l[c],v[_++]=l[c+1],v[_++]=l[c+2],v[_++]=(I=S[o++])!=null?I:255;return v},r.prototype.copyToImageData=function(o,c){var l,_,v,S,T,P,I,z,N,X,H;if(_=this.colors,N=null,l=this.hasAlphaChannel,this.palette.length&&(N=(H=this._decodedPalette)!=null?H:this._decodedPalette=this.decodePalette(),_=4,l=!0),z=(v=o.data||o).length,T=N||c,S=P=0,_===1)for(;S<z;)I=N?4*c[S/4]:P,X=T[I++],v[S++]=X,v[S++]=X,v[S++]=X,v[S++]=l?T[I++]:255,P=I;else for(;S<z;)I=N?4*c[S/4]:P,v[S++]=T[I++],v[S++]=T[I++],v[S++]=T[I++],v[S++]=l?T[I++]:255,P=I},r.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(Bi)==="[object Window]"){try{t=Bi.document.createElement("canvas"),e=t.getContext("2d")}catch{return!1}return!0}return!1};return n(),i=function(o){var c;if(n()===!0)return e.width=o.width,e.height=o.height,e.clearRect(0,0,o.width,o.height),e.putImageData(o,0,0),(c=new Image).src=t.toDataURL(),c;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(o){var c,l,_,v,S,T,P,I;if(this.animation){for(I=[],l=S=0,T=(P=this.animation.frames).length;S<T;l=++S)c=P[l],_=o.createImageData(c.width,c.height),v=this.decodePixels(new Uint8Array(c.data)),this.copyToImageData(_,v),c.imageData=_,I.push(c.image=i(_));return I}},r.prototype.renderFrame=function(o,c){var l,_,v;return l=(_=this.animation.frames)[c],v=_[c-1],c===0&&o.clearRect(0,0,this.width,this.height),(v!=null?v.disposeOp:void 0)===1?o.clearRect(v.xOffset,v.yOffset,v.width,v.height):(v!=null?v.disposeOp:void 0)===2&&o.putImageData(v.imageData,v.xOffset,v.yOffset),l.blendOp===0&&o.clearRect(l.xOffset,l.yOffset,l.width,l.height),o.drawImage(l.image,l.xOffset,l.yOffset)},r.prototype.animate=function(o){var c,l,_,v,S,T,P=this;return l=0,T=this.animation,v=T.numFrames,_=T.frames,S=T.numPlays,(c=function(){var I,z;if(I=l++%v,z=_[I],P.renderFrame(o,I),v>1&&l/v<S)return P.animation._timeout=setTimeout(c,z.delay)})()},r.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},r.prototype.render=function(o){var c,l;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,c=o.getContext("2d"),this.animation?(this.decodeFrames(c),this.animate(c)):(l=c.createImageData(this.width,this.height),this.copyToImageData(l,this.decodePixels()),c.putImageData(l,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function LV(i){var t=0;if(i[t++]!==71||i[t++]!==73||i[t++]!==70||i[t++]!==56||(i[t++]+1&253)!=56||i[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=i[t++]|i[t++]<<8,r=i[t++]|i[t++]<<8,n=i[t++],o=n>>7,c=1<<(7&n)+1;i[t++],i[t++];var l=null,_=null;o&&(l=t,_=c,t+=3*c);var v=!0,S=[],T=0,P=null,I=0,z=null;for(this.width=e,this.height=r;v&&t<i.length;)switch(i[t++]){case 33:switch(i[t++]){case 255:if(i[t]!==11||i[t+1]==78&&i[t+2]==69&&i[t+3]==84&&i[t+4]==83&&i[t+5]==67&&i[t+6]==65&&i[t+7]==80&&i[t+8]==69&&i[t+9]==50&&i[t+10]==46&&i[t+11]==48&&i[t+12]==3&&i[t+13]==1&&i[t+16]==0)t+=14,z=i[t++]|i[t++]<<8,t++;else for(t+=12;;){if(!((at=i[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;case 249:if(i[t++]!==4||i[t+4]!==0)throw new Error("Invalid graphics extension block.");var N=i[t++];T=i[t++]|i[t++]<<8,P=i[t++],!(1&N)&&(P=null),I=N>>2&7,t++;break;case 254:for(;;){if(!((at=i[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}break;default:throw new Error("Unknown graphic control label: 0x"+i[t-1].toString(16))}break;case 44:var X=i[t++]|i[t++]<<8,H=i[t++]|i[t++]<<8,Z=i[t++]|i[t++]<<8,ot=i[t++]|i[t++]<<8,gt=i[t++],Et=gt>>6&1,Ft=1<<(7&gt)+1,Mt=l,yt=_,Ut=!1;gt>>7&&(Ut=!0,Mt=t,yt=Ft,t+=3*Ft);var zt=t;for(t++;;){var at;if(!((at=i[t++])>=0))throw Error("Invalid block size");if(at===0)break;t+=at}S.push({x:X,y:H,width:Z,height:ot,has_local_palette:Ut,palette_offset:Mt,palette_size:yt,data_offset:zt,data_length:t-zt,transparent_index:P,interlaced:!!Et,delay:T,disposal:I});break;case 59:v=!1;break;default:throw new Error("Unknown gif block: 0x"+i[t-1].toString(16))}this.numFrames=function(){return S.length},this.loopCount=function(){return z},this.frameInfo=function(pt){if(pt<0||pt>=S.length)throw new Error("Frame index out of range.");return S[pt]},this.decodeAndBlitFrameBGRA=function(pt,Lt){var bt=this.frameInfo(pt),ee=bt.width*bt.height,ie=new Uint8Array(ee);t3(i,bt.data_offset,ie,ee);var re=bt.palette_offset,Yt=bt.transparent_index;Yt===null&&(Yt=256);var ce=bt.width,le=e-ce,Be=ce,nt=4*(bt.y*e+bt.x),St=4*((bt.y+bt.height)*e+bt.x),Tt=nt,jt=4*le;bt.interlaced===!0&&(jt+=4*e*7);for(var qt=8,Ht=0,Jt=ie.length;Ht<Jt;++Ht){var $t=ie[Ht];if(Be===0&&(Be=ce,(Tt+=jt)>=St&&(jt=4*le+4*e*(qt-1),Tt=nt+(ce+le)*(qt<<1),qt>>=1)),$t===Yt)Tt+=4;else{var Ae=i[re+3*$t],Le=i[re+3*$t+1],Fe=i[re+3*$t+2];Lt[Tt++]=Fe,Lt[Tt++]=Le,Lt[Tt++]=Ae,Lt[Tt++]=255}--Be}},this.decodeAndBlitFrameRGBA=function(pt,Lt){var bt=this.frameInfo(pt),ee=bt.width*bt.height,ie=new Uint8Array(ee);t3(i,bt.data_offset,ie,ee);var re=bt.palette_offset,Yt=bt.transparent_index;Yt===null&&(Yt=256);var ce=bt.width,le=e-ce,Be=ce,nt=4*(bt.y*e+bt.x),St=4*((bt.y+bt.height)*e+bt.x),Tt=nt,jt=4*le;bt.interlaced===!0&&(jt+=4*e*7);for(var qt=8,Ht=0,Jt=ie.length;Ht<Jt;++Ht){var $t=ie[Ht];if(Be===0&&(Be=ce,(Tt+=jt)>=St&&(jt=4*le+4*e*(qt-1),Tt=nt+(ce+le)*(qt<<1),qt>>=1)),$t===Yt)Tt+=4;else{var Ae=i[re+3*$t],Le=i[re+3*$t+1],Fe=i[re+3*$t+2];Lt[Tt++]=Ae,Lt[Tt++]=Le,Lt[Tt++]=Fe,Lt[Tt++]=255}--Be}}}function t3(i,t,e,r){for(var n=i[t++],o=1<<n,c=o+1,l=c+1,_=n+1,v=(1<<_)-1,S=0,T=0,P=0,I=i[t++],z=new Int32Array(4096),N=null;;){for(;S<16&&I!==0;)T|=i[t++]<<S,S+=8,I===1?I=i[t++]:--I;if(S<_)break;var X=T&v;if(T>>=_,S-=_,X!==o){if(X===c)break;for(var H=X<l?X:N,Z=0,ot=H;ot>o;)ot=z[ot]>>8,++Z;var gt=ot;if(P+Z+(H!==X?1:0)>r)return void Wr.log("Warning, gif stream longer than expected.");e[P++]=gt;var Et=P+=Z;for(H!==X&&(e[P++]=gt),ot=H;Z--;)ot=z[ot],e[--Et]=255&ot,ot>>=8;N!==null&&l<4096&&(z[l++]=N<<8|gt,l>=v+1&&_<12&&(++_,v=v<<1|1)),N=X}else l=c+1,v=(1<<(_=n+1))-1,N=null}return P!==r&&Wr.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function $_(i){var t,e,r,n,o,c=Math.floor,l=new Array(64),_=new Array(64),v=new Array(64),S=new Array(64),T=new Array(65535),P=new Array(65535),I=new Array(64),z=new Array(64),N=[],X=0,H=7,Z=new Array(64),ot=new Array(64),gt=new Array(64),Et=new Array(256),Ft=new Array(2048),Mt=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],yt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Ut=[0,1,2,3,4,5,6,7,8,9,10,11],zt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],at=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],pt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Lt=[0,1,2,3,4,5,6,7,8,9,10,11],bt=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],ee=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ie(nt,St){for(var Tt=0,jt=0,qt=new Array,Ht=1;Ht<=16;Ht++){for(var Jt=1;Jt<=nt[Ht];Jt++)qt[St[jt]]=[],qt[St[jt]][0]=Tt,qt[St[jt]][1]=Ht,jt++,Tt++;Tt*=2}return qt}function re(nt){for(var St=nt[0],Tt=nt[1]-1;Tt>=0;)St&1<<Tt&&(X|=1<<H),Tt--,--H<0&&(X==255?(Yt(255),Yt(0)):Yt(X),H=7,X=0)}function Yt(nt){N.push(nt)}function ce(nt){Yt(nt>>8&255),Yt(255&nt)}function le(nt,St,Tt,jt,qt){for(var Ht,Jt=qt[0],$t=qt[240],Ae=function(de,Ee){var Me,De,ei,Si,vi,Ri,zi,me,ci,bi,ke=0;for(ci=0;ci<8;++ci){Me=de[ke],De=de[ke+1],ei=de[ke+2],Si=de[ke+3],vi=de[ke+4],Ri=de[ke+5],zi=de[ke+6];var _r=Me+(me=de[ke+7]),ge=Me-me,yi=De+zi,Ue=De-zi,Vi=ei+Ri,Zr=ei-Ri,ze=Si+vi,_n=Si-vi,ir=_r+ze,Qr=_r-ze,tn=yi+Vi,xt=yi-Vi;de[ke]=ir+tn,de[ke+4]=ir-tn;var Y=.707106781*(xt+Qr);de[ke+2]=Qr+Y,de[ke+6]=Qr-Y;var K=.382683433*((ir=_n+Zr)-(xt=Ue+ge)),ct=.5411961*ir+K,_t=1.306562965*xt+K,kt=.707106781*(tn=Zr+Ue),Gt=ge+kt,Rt=ge-kt;de[ke+5]=Rt+ct,de[ke+3]=Rt-ct,de[ke+1]=Gt+_t,de[ke+7]=Gt-_t,ke+=8}for(ke=0,ci=0;ci<8;++ci){Me=de[ke],De=de[ke+8],ei=de[ke+16],Si=de[ke+24],vi=de[ke+32],Ri=de[ke+40],zi=de[ke+48];var Ct=Me+(me=de[ke+56]),te=Me-me,he=De+zi,Wt=De-zi,be=ei+Ri,We=ei-Ri,Je=Si+vi,Li=Si-vi,Qe=Ct+Je,Ci=Ct-Je,xi=he+be,rr=he-be;de[ke]=Qe+xi,de[ke+32]=Qe-xi;var Hi=.707106781*(rr+Ci);de[ke+16]=Ci+Hi,de[ke+48]=Ci-Hi;var hi=.382683433*((Qe=Li+We)-(rr=Wt+te)),Fi=.5411961*Qe+hi,Qi=1.306562965*rr+hi,pr=.707106781*(xi=We+Wt),Ar=te+pr,$r=te-pr;de[ke+40]=$r+Fi,de[ke+24]=$r-Fi,de[ke+8]=Ar+Qi,de[ke+56]=Ar-Qi,ke++}for(ci=0;ci<64;++ci)bi=de[ci]*Ee[ci],I[ci]=bi>0?bi+.5|0:bi-.5|0;return I}(nt,St),Le=0;Le<64;++Le)z[Mt[Le]]=Ae[Le];var Fe=z[0]-Tt;Tt=z[0],Fe==0?re(jt[0]):(re(jt[P[Ht=32767+Fe]]),re(T[Ht]));for(var Ne=63;Ne>0&&z[Ne]==0;)Ne--;if(Ne==0)return re(Jt),Tt;for(var si,oe=1;oe<=Ne;){for(var it=oe;z[oe]==0&&oe<=Ne;)++oe;var pi=oe-it;if(pi>=16){si=pi>>4;for(var Ke=1;Ke<=si;++Ke)re($t);pi&=15}Ht=32767+z[oe],re(qt[(pi<<4)+P[Ht]]),re(T[Ht]),oe++}return Ne!=63&&re(Jt),Tt}function Be(nt){nt=Math.min(Math.max(nt,1),100),o!=nt&&(function(St){for(var Tt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],jt=0;jt<64;jt++){var qt=c((Tt[jt]*St+50)/100);qt=Math.min(Math.max(qt,1),255),l[Mt[jt]]=qt}for(var Ht=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Jt=0;Jt<64;Jt++){var $t=c((Ht[Jt]*St+50)/100);$t=Math.min(Math.max($t,1),255),_[Mt[Jt]]=$t}for(var Ae=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Le=0,Fe=0;Fe<8;Fe++)for(var Ne=0;Ne<8;Ne++)v[Le]=1/(l[Mt[Le]]*Ae[Fe]*Ae[Ne]*8),S[Le]=1/(_[Mt[Le]]*Ae[Fe]*Ae[Ne]*8),Le++}(nt<50?Math.floor(5e3/nt):Math.floor(200-2*nt)),o=nt)}this.encode=function(nt,St){St&&Be(St),N=new Array,X=0,H=7,ce(65496),ce(65504),ce(16),Yt(74),Yt(70),Yt(73),Yt(70),Yt(0),Yt(1),Yt(1),Yt(0),ce(1),ce(1),Yt(0),Yt(0),function(){ce(65499),ce(132),Yt(0);for(var De=0;De<64;De++)Yt(l[De]);Yt(1);for(var ei=0;ei<64;ei++)Yt(_[ei])}(),function(De,ei){ce(65472),ce(17),Yt(8),ce(ei),ce(De),Yt(3),Yt(1),Yt(17),Yt(0),Yt(2),Yt(17),Yt(1),Yt(3),Yt(17),Yt(1)}(nt.width,nt.height),function(){ce(65476),ce(418),Yt(0);for(var De=0;De<16;De++)Yt(yt[De+1]);for(var ei=0;ei<=11;ei++)Yt(Ut[ei]);Yt(16);for(var Si=0;Si<16;Si++)Yt(zt[Si+1]);for(var vi=0;vi<=161;vi++)Yt(at[vi]);Yt(1);for(var Ri=0;Ri<16;Ri++)Yt(pt[Ri+1]);for(var zi=0;zi<=11;zi++)Yt(Lt[zi]);Yt(17);for(var me=0;me<16;me++)Yt(bt[me+1]);for(var ci=0;ci<=161;ci++)Yt(ee[ci])}(),ce(65498),ce(12),Yt(3),Yt(1),Yt(0),Yt(2),Yt(17),Yt(3),Yt(17),Yt(0),Yt(63),Yt(0);var Tt=0,jt=0,qt=0;X=0,H=7,this.encode.displayName="_encode_";for(var Ht,Jt,$t,Ae,Le,Fe,Ne,si,oe,it=nt.data,pi=nt.width,Ke=nt.height,de=4*pi,Ee=0;Ee<Ke;){for(Ht=0;Ht<de;){for(Le=de*Ee+Ht,Ne=-1,si=0,oe=0;oe<64;oe++)Fe=Le+(si=oe>>3)*de+(Ne=4*(7&oe)),Ee+si>=Ke&&(Fe-=de*(Ee+1+si-Ke)),Ht+Ne>=de&&(Fe-=Ht+Ne-de+4),Jt=it[Fe++],$t=it[Fe++],Ae=it[Fe++],Z[oe]=(Ft[Jt]+Ft[$t+256>>0]+Ft[Ae+512>>0]>>16)-128,ot[oe]=(Ft[Jt+768>>0]+Ft[$t+1024>>0]+Ft[Ae+1280>>0]>>16)-128,gt[oe]=(Ft[Jt+1280>>0]+Ft[$t+1536>>0]+Ft[Ae+1792>>0]>>16)-128;Tt=le(Z,v,Tt,t,r),jt=le(ot,S,jt,e,n),qt=le(gt,S,qt,e,n),Ht+=32}Ee+=8}if(H>=0){var Me=[];Me[1]=H+1,Me[0]=(1<<H+1)-1,re(Me)}return ce(65497),new Uint8Array(N)},i=i||50,function(){for(var nt=String.fromCharCode,St=0;St<256;St++)Et[St]=nt(St)}(),t=ie(yt,Ut),e=ie(pt,Lt),r=ie(zt,at),n=ie(bt,ee),function(){for(var nt=1,St=2,Tt=1;Tt<=15;Tt++){for(var jt=nt;jt<St;jt++)P[32767+jt]=Tt,T[32767+jt]=[],T[32767+jt][1]=Tt,T[32767+jt][0]=jt;for(var qt=-(St-1);qt<=-nt;qt++)P[32767+qt]=Tt,T[32767+qt]=[],T[32767+qt][1]=Tt,T[32767+qt][0]=St-1+qt;nt<<=1,St<<=1}}(),function(){for(var nt=0;nt<256;nt++)Ft[nt]=19595*nt,Ft[nt+256>>0]=38470*nt,Ft[nt+512>>0]=7471*nt+32768,Ft[nt+768>>0]=-11059*nt,Ft[nt+1024>>0]=-21709*nt,Ft[nt+1280>>0]=32768*nt+8421375,Ft[nt+1536>>0]=-27439*nt,Ft[nt+1792>>0]=-5329*nt}(),Be(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function gl(i,t){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function e3(i){function t(yt){if(!yt)throw Error("assert :P")}function e(yt,Ut,zt){for(var at=0;4>at;at++)if(yt[Ut+at]!=zt.charCodeAt(at))return!0;return!1}function r(yt,Ut,zt,at,pt){for(var Lt=0;Lt<pt;Lt++)yt[Ut+Lt]=zt[at+Lt]}function n(yt,Ut,zt,at){for(var pt=0;pt<at;pt++)yt[Ut+pt]=zt}function o(yt){return new Int32Array(yt)}function c(yt,Ut){for(var zt=[],at=0;at<yt;at++)zt.push(new Ut);return zt}function l(yt,Ut){var zt=[];return function at(pt,Lt,bt){for(var ee=bt[Lt],ie=0;ie<ee&&(pt.push(bt.length>Lt+1?[]:new Ut),!(bt.length<Lt+1));ie++)at(pt[ie],Lt+1,bt)}(zt,0,yt),zt}var _=function(){var yt=this;function Ut(w,M){for(var m=1<<M-1>>>0;w&m;)m>>>=1;return m?(w&m-1)+m:w}function zt(w,M,m,s,u){t(!(s%m));do w[M+(s-=m)]=u;while(0<s)}function at(w,M,m,s,u){if(t(2328>=u),512>=u)var f=o(512);else if((f=o(u))==null)return 0;return function(g,y,A,C,B,F){var j,O,W=y,$=1<<A,q=o(16),Q=o(16);for(t(B!=0),t(C!=null),t(g!=null),t(0<A),O=0;O<B;++O){if(15<C[O])return 0;++q[C[O]]}if(q[0]==B)return 0;for(Q[1]=0,j=1;15>j;++j){if(q[j]>1<<j)return 0;Q[j+1]=Q[j]+q[j]}for(O=0;O<B;++O)j=C[O],0<C[O]&&(F[Q[j]++]=O);if(Q[15]==1)return(C=new pt).g=0,C.value=F[0],zt(g,W,1,$,C),$;var lt,ht=-1,ft=$-1,ut=0,vt=1,Bt=1,It=1<<A;for(O=0,j=1,B=2;j<=A;++j,B<<=1){if(vt+=Bt<<=1,0>(Bt-=q[j]))return 0;for(;0<q[j];--q[j])(C=new pt).g=j,C.value=F[O++],zt(g,W+ut,B,It,C),ut=Ut(ut,j)}for(j=A+1,B=2;15>=j;++j,B<<=1){if(vt+=Bt<<=1,0>(Bt-=q[j]))return 0;for(;0<q[j];--q[j]){if(C=new pt,(ut&ft)!=ht){for(W+=It,lt=1<<(ht=j)-A;15>ht&&!(0>=(lt-=q[ht]));)++ht,lt<<=1;$+=It=1<<(lt=ht-A),g[y+(ht=ut&ft)].g=lt+A,g[y+ht].value=W-y-ht}C.g=j-A,C.value=F[O++],zt(g,W+(ut>>A),B,It,C),ut=Ut(ut,j)}}return vt!=2*Q[15]-1?0:$}(w,M,m,s,u,f)}function pt(){this.value=this.g=0}function Lt(){this.value=this.g=0}function bt(){this.G=c(5,pt),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=c(Dn,Lt)}function ee(w,M,m,s){t(w!=null),t(M!=null),t(2147483648>s),w.Ca=254,w.I=0,w.b=-8,w.Ka=0,w.oa=M,w.pa=m,w.Jd=M,w.Yc=m+s,w.Zc=4<=s?m+s-4+1:m,Ht(w)}function ie(w,M){for(var m=0;0<M--;)m|=$t(w,128)<<M;return m}function re(w,M){var m=ie(w,M);return Jt(w)?-m:m}function Yt(w,M,m,s){var u,f=0;for(t(w!=null),t(M!=null),t(4294967288>s),w.Sb=s,w.Ra=0,w.u=0,w.h=0,4<s&&(s=4),u=0;u<s;++u)f+=M[m+u]<<8*u;w.Ra=f,w.bb=s,w.oa=M,w.pa=m}function ce(w){for(;8<=w.u&&w.bb<w.Sb;)w.Ra>>>=8,w.Ra+=w.oa[w.pa+w.bb]<<Fs-8>>>0,++w.bb,w.u-=8;Tt(w)&&(w.h=1,w.u=0)}function le(w,M){if(t(0<=M),!w.h&&M<=Ia){var m=St(w)&Pa[M];return w.u+=M,ce(w),m}return w.h=1,w.u=0}function Be(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function nt(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function St(w){return w.Ra>>>(w.u&Fs-1)>>>0}function Tt(w){return t(w.bb<=w.Sb),w.h||w.bb==w.Sb&&w.u>Fs}function jt(w,M){w.u=M,w.h=Tt(w)}function qt(w){w.u>=ta&&(t(w.u>=ta),ce(w))}function Ht(w){t(w!=null&&w.oa!=null),w.pa<w.Zc?(w.I=(w.oa[w.pa++]|w.I<<8)>>>0,w.b+=8):(t(w!=null&&w.oa!=null),w.pa<w.Yc?(w.b+=8,w.I=w.oa[w.pa++]|w.I<<8):w.Ka?w.b=0:(w.I<<=8,w.b+=8,w.Ka=1))}function Jt(w){return ie(w,1)}function $t(w,M){var m=w.Ca;0>w.b&&Ht(w);var s=w.b,u=m*M>>>8,f=(w.I>>>s>u)+0;for(f?(m-=u,w.I-=u+1<<s>>>0):m=u+1,s=m,u=0;256<=s;)u+=8,s>>=8;return s=7^u+bn[s],w.b-=s,w.Ca=(m<<s)-1,f}function Ae(w,M,m){w[M+0]=m>>24&255,w[M+1]=m>>16&255,w[M+2]=m>>8&255,w[M+3]=m>>0&255}function Le(w,M){return w[M+0]<<0|w[M+1]<<8}function Fe(w,M){return Le(w,M)|w[M+2]<<16}function Ne(w,M){return Le(w,M)|Le(w,M+2)<<16}function si(w,M){var m=1<<M;return t(w!=null),t(0<M),w.X=o(m),w.X==null?0:(w.Mb=32-M,w.Xa=M,1)}function oe(w,M){t(w!=null),t(M!=null),t(w.Xa==M.Xa),r(M.X,0,w.X,0,1<<M.Xa)}function it(){this.X=[],this.Xa=this.Mb=0}function pi(w,M,m,s){t(m!=null),t(s!=null);var u=m[0],f=s[0];return u==0&&(u=(w*f+M/2)/M),f==0&&(f=(M*u+w/2)/w),0>=u||0>=f?0:(m[0]=u,s[0]=f,1)}function Ke(w,M){return w+(1<<M)-1>>>M}function de(w,M){return((4278255360&w)+(4278255360&M)>>>0&4278255360)+((16711935&w)+(16711935&M)>>>0&16711935)>>>0}function Ee(w,M){yt[M]=function(m,s,u,f,g,y,A){var C;for(C=0;C<g;++C){var B=yt[w](y[A+C-1],u,f+C);y[A+C]=de(m[s+C],B)}}}function Me(){this.ud=this.hd=this.jd=0}function De(w,M){return((4278124286&(w^M))>>>1)+(w&M)>>>0}function ei(w){return 0<=w&&256>w?w:0>w?0:255<w?255:void 0}function Si(w,M){return ei(w+(w-M+.5>>1))}function vi(w,M,m){return Math.abs(M-m)-Math.abs(w-m)}function Ri(w,M,m,s,u,f,g){for(s=f[g-1],m=0;m<u;++m)f[g+m]=s=de(w[M+m],s)}function zi(w,M,m,s,u){var f;for(f=0;f<m;++f){var g=w[M+f],y=g>>8&255,A=16711935&(A=(A=16711935&g)+((y<<16)+y));s[u+f]=(4278255360&g)+A>>>0}}function me(w,M){M.jd=w>>0&255,M.hd=w>>8&255,M.ud=w>>16&255}function ci(w,M,m,s,u,f){var g;for(g=0;g<s;++g){var y=M[m+g],A=y>>>8,C=y,B=255&(B=(B=y>>>16)+((w.jd<<24>>24)*(A<<24>>24)>>>5));C=255&(C=(C=C+((w.hd<<24>>24)*(A<<24>>24)>>>5))+((w.ud<<24>>24)*(B<<24>>24)>>>5)),u[f+g]=(4278255360&y)+(B<<16)+C}}function bi(w,M,m,s,u){yt[M]=function(f,g,y,A,C,B,F,j,O){for(A=F;A<j;++A)for(F=0;F<O;++F)C[B++]=u(y[s(f[g++])])},yt[w]=function(f,g,y,A,C,B,F){var j=8>>f.b,O=f.Ea,W=f.K[0],$=f.w;if(8>j)for(f=(1<<f.b)-1,$=(1<<j)-1;g<y;++g){var q,Q=0;for(q=0;q<O;++q)q&f||(Q=s(A[C++])),B[F++]=u(W[Q&$]),Q>>=j}else yt["VP8LMapColor"+m](A,C,W,$,B,F,g,y,O)}}function ke(w,M,m,s,u){for(m=M+m;M<m;){var f=w[M++];s[u++]=f>>16&255,s[u++]=f>>8&255,s[u++]=f>>0&255}}function _r(w,M,m,s,u){for(m=M+m;M<m;){var f=w[M++];s[u++]=f>>16&255,s[u++]=f>>8&255,s[u++]=f>>0&255,s[u++]=f>>24&255}}function ge(w,M,m,s,u){for(m=M+m;M<m;){var f=(g=w[M++])>>16&240|g>>12&15,g=g>>0&240|g>>28&15;s[u++]=f,s[u++]=g}}function yi(w,M,m,s,u){for(m=M+m;M<m;){var f=(g=w[M++])>>16&248|g>>13&7,g=g>>5&224|g>>3&31;s[u++]=f,s[u++]=g}}function Ue(w,M,m,s,u){for(m=M+m;M<m;){var f=w[M++];s[u++]=f>>0&255,s[u++]=f>>8&255,s[u++]=f>>16&255}}function Vi(w,M,m,s,u,f){if(f==0)for(m=M+m;M<m;)Ae(s,((f=w[M++])[0]>>24|f[1]>>8&65280|f[2]<<8&16711680|f[3]<<24)>>>0),u+=32;else r(s,u,w,M,m)}function Zr(w,M){yt[M][0]=yt[w+"0"],yt[M][1]=yt[w+"1"],yt[M][2]=yt[w+"2"],yt[M][3]=yt[w+"3"],yt[M][4]=yt[w+"4"],yt[M][5]=yt[w+"5"],yt[M][6]=yt[w+"6"],yt[M][7]=yt[w+"7"],yt[M][8]=yt[w+"8"],yt[M][9]=yt[w+"9"],yt[M][10]=yt[w+"10"],yt[M][11]=yt[w+"11"],yt[M][12]=yt[w+"12"],yt[M][13]=yt[w+"13"],yt[M][14]=yt[w+"0"],yt[M][15]=yt[w+"0"]}function ze(w){return w==Wl||w==al||w==Xl||w==Bc}function _n(){this.eb=[],this.size=this.A=this.fb=0}function ir(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Qr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new _n,this.f.kb=new ir,this.sd=null}function tn(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function xt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Y(w){return alert("todo:WebPSamplerProcessPlane"),w.T}function K(w,M){var m=w.T,s=M.ba.f.RGBA,u=s.eb,f=s.fb+w.ka*s.A,g=Ti[M.ba.S],y=w.y,A=w.O,C=w.f,B=w.N,F=w.ea,j=w.W,O=M.cc,W=M.dc,$=M.Mc,q=M.Nc,Q=w.ka,lt=w.ka+w.T,ht=w.U,ft=ht+1>>1;for(Q==0?g(y,A,null,null,C,B,F,j,C,B,F,j,u,f,null,null,ht):(g(M.ec,M.fc,y,A,O,W,$,q,C,B,F,j,u,f-s.A,u,f,ht),++m);Q+2<lt;Q+=2)O=C,W=B,$=F,q=j,B+=w.Rc,j+=w.Rc,f+=2*s.A,g(y,(A+=2*w.fa)-w.fa,y,A,O,W,$,q,C,B,F,j,u,f-s.A,u,f,ht);return A+=w.fa,w.j+lt<w.o?(r(M.ec,M.fc,y,A,ht),r(M.cc,M.dc,C,B,ft),r(M.Mc,M.Nc,F,j,ft),m--):1&lt||g(y,A,null,null,C,B,F,j,C,B,F,j,u,f+s.A,null,null,ht),m}function ct(w,M,m){var s=w.F,u=[w.J];if(s!=null){var f=w.U,g=M.ba.S,y=g==Hl||g==Xl;M=M.ba.f.RGBA;var A=[0],C=w.ka;A[0]=w.T,w.Kb&&(C==0?--A[0]:(--C,u[0]-=w.width),w.j+w.ka+w.T==w.o&&(A[0]=w.o-w.j-C));var B=M.eb;C=M.fb+C*M.A,w=Ro(s,u[0],w.width,f,A,B,C+(y?0:3),M.A),t(m==A),w&&ze(g)&&js(B,C,y,f,A,M.A)}return 0}function _t(w){var M=w.ma,m=M.ba.S,s=11>m,u=m==sl||m==ol||m==Hl||m==Mc||m==12||ze(m);if(M.memory=null,M.Ib=null,M.Jb=null,M.Nd=null,!fo(M.Oa,w,u?11:12))return 0;if(u&&ze(m)&&Ie(),w.da)alert("todo:use_scaling");else{if(s){if(M.Ib=Y,w.Kb){if(m=w.U+1>>1,M.memory=o(w.U+2*m),M.memory==null)return 0;M.ec=M.memory,M.fc=0,M.cc=M.ec,M.dc=M.fc+w.U,M.Mc=M.cc,M.Nc=M.dc+m,M.Ib=K,Ie()}}else alert("todo:EmitYUV");u&&(M.Jb=ct,s&&Xt())}if(s&&!br){for(w=0;256>w;++w)Jl[w]=89858*(w-128)+_h>>Fc,Yu[w]=-22014*(w-128)+_h,vh[w]=-45773*(w-128),yh[w]=113618*(w-128)+_h>>Fc;for(w=hl;w<lu;++w)M=76283*(w-16)+_h>>Fc,Dc[w-hl]=Xi(M,255),Oc[w-hl]=Xi(M+8>>4,15);br=1}return 1}function kt(w){var M=w.ma,m=w.U,s=w.T;return t(!(1&w.ka)),0>=m||0>=s?0:(m=M.Ib(w,M),M.Jb!=null&&M.Jb(w,M,m),M.Dc+=m,1)}function Gt(w){w.ma.memory=null}function Rt(w,M,m,s){return le(w,8)!=47?0:(M[0]=le(w,14)+1,m[0]=le(w,14)+1,s[0]=le(w,1),le(w,3)!=0?0:!w.h)}function Ct(w,M){if(4>w)return w+1;var m=w-2>>1;return(2+(1&w)<<m)+le(M,m)+1}function te(w,M){return 120<M?M-120:1<=(m=((m=Gs[M-1])>>4)*w+(8-(15&m)))?m:1;var m}function he(w,M,m){var s=St(m),u=w[M+=255&s].g-8;return 0<u&&(jt(m,m.u+8),s=St(m),M+=w[M].value,M+=s&(1<<u)-1),jt(m,m.u+w[M].g),w[M].value}function Wt(w,M,m){return m.g+=w.g,m.value+=w.value<<M>>>0,t(8>=m.g),w.g}function be(w,M,m){var s=w.xc;return t((M=s==0?0:w.vc[w.md*(m>>s)+(M>>s)])<w.Wb),w.Ya[M]}function We(w,M,m,s){var u=w.ab,f=w.c*M,g=w.C;M=g+M;var y=m,A=s;for(s=w.Ta,m=w.Ua;0<u--;){var C=w.gc[u],B=g,F=M,j=y,O=A,W=(A=s,y=m,C.Ea);switch(t(B<F),t(F<=C.nc),C.hc){case 2:il(j,O,(F-B)*W,A,y);break;case 0:var $=B,q=F,Q=A,lt=y,ht=(It=C).Ea;$==0&&(La(j,O,null,null,1,Q,lt),Ri(j,O+1,0,0,ht-1,Q,lt+1),O+=ht,lt+=ht,++$);for(var ft=1<<It.b,ut=ft-1,vt=Ke(ht,It.b),Bt=It.K,It=It.w+($>>It.b)*vt;$<q;){var Qt=Bt,pe=It,_e=1;for(ea(j,O,Q,lt-ht,1,Q,lt);_e<ht;){var xe=(_e&~ut)+ft;xe>ht&&(xe=ht),(0,Ni[Qt[pe++]>>8&15])(j,O+ +_e,Q,lt+_e-ht,xe-_e,Q,lt+_e),_e=xe}O+=ht,lt+=ht,++$&ut||(It+=vt)}F!=C.nc&&r(A,y-W,A,y+(F-B-1)*W,W);break;case 1:for(W=j,q=O,ht=(j=C.Ea)-(lt=j&~(Q=(O=1<<C.b)-1)),$=Ke(j,C.b),ft=C.K,C=C.w+(B>>C.b)*$;B<F;){for(ut=ft,vt=C,Bt=new Me,It=q+lt,Qt=q+j;q<It;)me(ut[vt++],Bt),Kn(Bt,W,q,O,A,y),q+=O,y+=O;q<Qt&&(me(ut[vt++],Bt),Kn(Bt,W,q,ht,A,y),q+=ht,y+=ht),++B&Q||(C+=$)}break;case 3:if(j==A&&O==y&&0<C.b){for(q=A,j=W=y+(F-B)*W-(lt=(F-B)*Ke(C.Ea,C.b)),O=A,Q=y,$=[],lt=(ht=lt)-1;0<=lt;--lt)$[lt]=O[Q+lt];for(lt=ht-1;0<=lt;--lt)q[j+lt]=$[lt];On(C,B,F,A,W,A,y)}else On(C,B,F,j,O,A,y)}y=s,A=m}A!=m&&r(s,m,y,A,f)}function Je(w,M){var m=w.V,s=w.Ba+w.c*w.C,u=M-w.C;if(t(M<=w.l.o),t(16>=u),0<u){var f=w.l,g=w.Ta,y=w.Ua,A=f.width;if(We(w,u,m,s),u=y=[y],t((m=w.C)<(s=M)),t(f.v<f.va),s>f.o&&(s=f.o),m<f.j){var C=f.j-m;m=f.j,u[0]+=C*A}if(m>=s?m=0:(u[0]+=4*f.v,f.ka=m-f.j,f.U=f.va-f.v,f.T=s-m,m=1),m){if(y=y[0],11>(m=w.ca).S){var B=m.f.RGBA,F=(s=m.S,u=f.U,f=f.T,C=B.eb,B.A),j=f;for(B=B.fb+w.Ma*B.A;0<j--;){var O=g,W=y,$=u,q=C,Q=B;switch(s){case ql:mo(O,W,$,q,Q);break;case sl:ia(O,W,$,q,Q);break;case Wl:ia(O,W,$,q,Q),js(q,Q,0,$,1,0);break;case mh:ra(O,W,$,q,Q);break;case ol:Vi(O,W,$,q,Q,1);break;case al:Vi(O,W,$,q,Q,1),js(q,Q,0,$,1,0);break;case Hl:Vi(O,W,$,q,Q,0);break;case Xl:Vi(O,W,$,q,Q,0),js(q,Q,1,$,1,0);break;case Mc:Qn(O,W,$,q,Q);break;case Bc:Qn(O,W,$,q,Q),nn(q,Q,$,1,0);break;case ka:Bo(O,W,$,q,Q);break;default:t(0)}y+=A,B+=F}w.Ma+=f}else alert("todo:EmitRescaledRowsYUVA");t(w.Ma<=m.height)}}w.C=M,t(w.C<=w.i)}function Li(w){var M;if(0<w.ua)return 0;for(M=0;M<w.Wb;++M){var m=w.Ya[M].G,s=w.Ya[M].H;if(0<m[1][s[1]+0].g||0<m[2][s[2]+0].g||0<m[3][s[3]+0].g)return 0}return 1}function Qe(w,M,m,s,u,f){if(w.Z!=0){var g=w.qd,y=w.rd;for(t(Do[w.Z]!=null);M<m;++M)Do[w.Z](g,y,s,u,s,u,f),g=s,y=u,u+=f;w.qd=g,w.rd=y}}function Ci(w,M){var m=w.l.ma,s=m.Z==0||m.Z==1?w.l.j:w.C;if(s=w.C<s?s:w.C,t(M<=w.l.o),M>s){var u=w.l.width,f=m.ca,g=m.tb+u*s,y=w.V,A=w.Ba+w.c*s,C=w.gc;t(w.ab==1),t(C[0].hc==3),fh(C[0],s,M,y,A,f,g),Qe(m,s,M,f,g,u)}w.C=w.Ma=M}function xi(w,M,m,s,u,f,g){var y=w.$/s,A=w.$%s,C=w.m,B=w.s,F=m+w.$,j=F;u=m+s*u;var O=m+s*f,W=280+B.ua,$=w.Pb?y:16777216,q=0<B.ua?B.Wa:null,Q=B.wc,lt=F<O?be(B,A,y):null;t(w.C<f),t(O<=u);var ht=!1;t:for(;;){for(;ht||F<O;){var ft=0;if(y>=$){var ut=F-m;t(($=w).Pb),$.wd=$.m,$.xd=ut,0<$.s.ua&&oe($.s.Wa,$.s.vb),$=y+iu}if(A&Q||(lt=be(B,A,y)),t(lt!=null),lt.Qb&&(M[F]=lt.qb,ht=!0),!ht)if(qt(C),lt.jc){ft=C,ut=M;var vt=F,Bt=lt.pd[St(ft)&Dn-1];t(lt.jc),256>Bt.g?(jt(ft,ft.u+Bt.g),ut[vt]=Bt.value,ft=0):(jt(ft,ft.u+Bt.g-256),t(256<=Bt.value),ft=Bt.value),ft==0&&(ht=!0)}else ft=he(lt.G[0],lt.H[0],C);if(C.h)break;if(ht||256>ft){if(!ht)if(lt.nd)M[F]=(lt.qb|ft<<8)>>>0;else{if(qt(C),ht=he(lt.G[1],lt.H[1],C),qt(C),ut=he(lt.G[2],lt.H[2],C),vt=he(lt.G[3],lt.H[3],C),C.h)break;M[F]=(vt<<24|ht<<16|ft<<8|ut)>>>0}if(ht=!1,++F,++A>=s&&(A=0,++y,g!=null&&y<=f&&!(y%16)&&g(w,y),q!=null))for(;j<F;)ft=M[j++],q.X[(506832829*ft&4294967295)>>>q.Mb]=ft}else if(280>ft){if(ft=Ct(ft-256,C),ut=he(lt.G[4],lt.H[4],C),qt(C),ut=te(s,ut=Ct(ut,C)),C.h)break;if(F-m<ut||u-F<ft)break t;for(vt=0;vt<ft;++vt)M[F+vt]=M[F+vt-ut];for(F+=ft,A+=ft;A>=s;)A-=s,++y,g!=null&&y<=f&&!(y%16)&&g(w,y);if(t(F<=u),A&Q&&(lt=be(B,A,y)),q!=null)for(;j<F;)ft=M[j++],q.X[(506832829*ft&4294967295)>>>q.Mb]=ft}else{if(!(ft<W))break t;for(ht=ft-280,t(q!=null);j<F;)ft=M[j++],q.X[(506832829*ft&4294967295)>>>q.Mb]=ft;ft=F,t(!(ht>>>(ut=q).Xa)),M[ft]=ut.X[ht],ht=!0}ht||t(C.h==Tt(C))}if(w.Pb&&C.h&&F<u)t(w.m.h),w.a=5,w.m=w.wd,w.$=w.xd,0<w.s.ua&&oe(w.s.vb,w.s.Wa);else{if(C.h)break t;g!=null&&g(w,y>f?f:y),w.a=0,w.$=F-m}return 1}return w.a=3,0}function rr(w){t(w!=null),w.vc=null,w.yc=null,w.Ya=null;var M=w.Wa;M!=null&&(M.X=null),w.vb=null,t(w!=null)}function Hi(){var w=new el;return w==null?null:(w.a=0,w.xb=ll,Zr("Predictor","VP8LPredictors"),Zr("Predictor","VP8LPredictors_C"),Zr("PredictorAdd","VP8LPredictorsAdd"),Zr("PredictorAdd","VP8LPredictorsAdd_C"),il=zi,Kn=ci,mo=ke,ia=_r,Qn=ge,Bo=yi,ra=Ue,yt.VP8LMapColor32b=Mo,yt.VP8LMapColor8b=Ic,w)}function hi(w,M,m,s,u){var f=1,g=[w],y=[M],A=s.m,C=s.s,B=null,F=0;t:for(;;){if(m)for(;f&&le(A,1);){var j=g,O=y,W=s,$=1,q=W.m,Q=W.gc[W.ab],lt=le(q,2);if(W.Oc&1<<lt)f=0;else{switch(W.Oc|=1<<lt,Q.hc=lt,Q.Ea=j[0],Q.nc=O[0],Q.K=[null],++W.ab,t(4>=W.ab),lt){case 0:case 1:Q.b=le(q,3)+2,$=hi(Ke(Q.Ea,Q.b),Ke(Q.nc,Q.b),0,W,Q.K),Q.K=Q.K[0];break;case 3:var ht,ft=le(q,8)+1,ut=16<ft?0:4<ft?1:2<ft?2:3;if(j[0]=Ke(Q.Ea,ut),Q.b=ut,ht=$=hi(ft,1,0,W,Q.K)){var vt,Bt=ft,It=Q,Qt=1<<(8>>It.b),pe=o(Qt);if(pe==null)ht=0;else{var _e=It.K[0],xe=It.w;for(pe[0]=It.K[0][0],vt=1;vt<1*Bt;++vt)pe[vt]=de(_e[xe+vt],pe[vt-1]);for(;vt<4*Qt;++vt)pe[vt]=0;It.K[0]=null,It.K[0]=pe,ht=1}}$=ht;break;case 2:break;default:t(0)}f=$}}if(g=g[0],y=y[0],f&&le(A,1)&&!(f=1<=(F=le(A,4))&&11>=F)){s.a=3;break t}var ve;if(ve=f)e:{var ye,we,$e,Ce=s,Pe=g,ii=y,wi=F,_i=m,Ai=Ce.m,ki=Ce.s,nr=[null],Rr=1,Ki=0,Hr=ko[wi];i:for(;;){if(_i&&le(Ai,1)){var sr=le(Ai,3)+2,jr=Ke(Pe,sr),sn=Ke(ii,sr),es=jr*sn;if(!hi(jr,sn,0,Ce,nr))break i;for(nr=nr[0],ki.xc=sr,ye=0;ye<es;++ye){var Cs=nr[ye]>>8&65535;nr[ye]=Cs,Cs>=Rr&&(Rr=Cs+1)}}if(Ai.h)break i;for(we=0;5>we;++we){var kr=Rc[we];!we&&0<wi&&(kr+=1<<wi),Ki<kr&&(Ki=kr)}var Da=c(Rr*Hr,pt),Ps=Rr,zc=c(Ps,bt);if(zc==null)var Kl=null;else t(65536>=Ps),Kl=zc;var zn=o(Ki);if(Kl==null||zn==null||Da==null){Ce.a=1;break i}var is=Da;for(ye=$e=0;ye<Rr;++ye){var wn=Kl[ye],jn=wn.G,Yr=wn.H,Ln=0,Un=1,qi=0;for(we=0;5>we;++we){kr=Rc[we],jn[we]=is,Yr[we]=$e,!we&&0<wi&&(kr+=1<<wi);n:{var Oo,Oa=kr,sa=Ce,Ql=zn,hp=is,Ju=$e,No=0,oa=sa.m,bh=le(oa,1);if(n(Ql,0,0,Oa),bh){var jc=le(oa,1)+1,xh=le(oa,1),Uc=le(oa,xh==0?1:8);Ql[Uc]=1,jc==2&&(Ql[Uc=le(oa,8)]=1);var aa=1}else{var tc=o(19),cu=le(oa,4)+4;if(19<cu){sa.a=3;var hu=0;break n}for(Oo=0;Oo<cu;++Oo)tc[Wu[Oo]]=le(oa,3);var Ku=void 0,uu=void 0,Qu=sa,du=tc,ul=Oa,Na=Ql,bo=0,Is=Qu.m,up=8,ec=c(128,pt);r:for(;at(ec,0,7,du,19);){if(le(Is,1)){var e0=2+2*le(Is,3);if((Ku=2+le(Is,e0))>ul)break r}else Ku=ul;for(uu=0;uu<ul&&Ku--;){qt(Is);var dp=ec[0+(127&St(Is))];jt(Is,Is.u+dp.g);var Fr=dp.value;if(16>Fr)Na[uu++]=Fr,Fr!=0&&(up=Fr);else{var pp=Fr==16,fp=Fr-16,Gc=eu[fp],ic=le(Is,tu[fp])+Gc;if(uu+ic>ul)break r;for(var td=pp?up:0;0<ic--;)Na[uu++]=td}}bo=1;break r}bo||(Qu.a=3),aa=bo}(aa=aa&&!oa.h)&&(No=at(hp,Ju,8,Ql,Oa)),aa&&No!=0?hu=No:(sa.a=3,hu=0)}if(hu==0)break i;if(Un&&Zl[we]==1&&(Un=is[$e].g==0),Ln+=is[$e].g,$e+=hu,3>=we){var Vc,ed=zn[0];for(Vc=1;Vc<kr;++Vc)zn[Vc]>ed&&(ed=zn[Vc]);qi+=ed}}if(wn.nd=Un,wn.Qb=0,Un&&(wn.qb=(jn[3][Yr[3]+0].value<<24|jn[1][Yr[1]+0].value<<16|jn[2][Yr[2]+0].value)>>>0,Ln==0&&256>jn[0][Yr[0]+0].value&&(wn.Qb=1,wn.qb+=jn[0][Yr[0]+0].value<<8)),wn.jc=!wn.Qb&&6>qi,wn.jc){var id,za=wn;for(id=0;id<Dn;++id){var rc=id,ja=za.pd[rc],rd=za.G[0][za.H[0]+rc];256<=rd.value?(ja.g=rd.g+256,ja.value=rd.value):(ja.g=0,ja.value=0,rc>>=Wt(rd,8,ja),rc>>=Wt(za.G[1][za.H[1]+rc],16,ja),rc>>=Wt(za.G[2][za.H[2]+rc],0,ja),Wt(za.G[3][za.H[3]+rc],24,ja))}}}ki.vc=nr,ki.Wb=Rr,ki.Ya=Kl,ki.yc=Da,ve=1;break e}ve=0}if(!(f=ve)){s.a=3;break t}if(0<F){if(C.ua=1<<F,!si(C.Wa,F)){s.a=1,f=0;break t}}else C.ua=0;var pu=s,mp=g,qf=y,nc=pu.s,gp=nc.xc;if(pu.c=mp,pu.i=qf,nc.md=Ke(mp,gp),nc.wc=gp==0?-1:(1<<gp)-1,m){s.xb=Yl;break t}if((B=o(g*y))==null){s.a=1,f=0;break t}f=(f=xi(s,B,0,g,y,y,null))&&!A.h;break t}return f?(u!=null?u[0]=B:(t(B==null),t(m)),s.$=0,m||rr(C)):rr(C),f}function Fi(w,M){var m=w.c*w.i,s=m+M+16*M;return t(w.c<=M),w.V=o(s),w.V==null?(w.Ta=null,w.Ua=0,w.a=1,0):(w.Ta=w.V,w.Ua=w.Ba+m+M,1)}function Qi(w,M){var m=w.C,s=M-m,u=w.V,f=w.Ba+w.c*m;for(t(M<=w.l.o);0<s;){var g=16<s?16:s,y=w.l.ma,A=w.l.width,C=A*g,B=y.ca,F=y.tb+A*m,j=w.Ta,O=w.Ua;We(w,g,u,f),Kh(j,O,B,F,C),Qe(y,m,m+g,B,F,A),s-=g,u+=g*w.c,m+=g}t(m==M),w.C=w.Ma=M}function pr(){this.ub=this.yd=this.td=this.Rb=0}function Ar(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function $r(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function so(){this.Yb=function(){var w=[];return function M(m,s,u){for(var f=u[s],g=0;g<f&&(m.push(u.length>s+1?[]:0),!(u.length<s+1));g++)M(m[g],s+1,u)}(w,0,[3,11]),w}()}function $i(){this.jb=o(3),this.Wc=l([4,8],so),this.Xc=l([4,17],so)}function yn(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function Xn(){this.ld=this.La=this.dd=this.tc=0}function Ir(){this.Na=this.la=0}function Lr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function oo(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Mr(){this.uc=this.M=this.Nb=0,this.wa=Array(new Xn),this.Y=0,this.ya=Array(new oo),this.aa=0,this.l=new Zn}function Er(){this.y=o(16),this.f=o(8),this.ea=o(8)}function ao(){this.cb=this.a=0,this.sc="",this.m=new Be,this.Od=new pr,this.Kc=new Ar,this.ed=new yn,this.Qa=new $r,this.Ic=this.$c=this.Aa=0,this.D=new Mr,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=c(8,Be),this.ia=0,this.pb=c(4,Lr),this.Pa=new $i,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Er),this.Hd=0,this.rb=Array(new Ir),this.sb=0,this.wa=Array(new Xn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new oo),this.L=this.aa=0,this.gd=l([4,2],Xn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Zn(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function yr(){var w=new ao;return w!=null&&(w.a=0,w.sc="OK",w.cb=0,w.Xb=0,kc||(kc=lo)),w}function Yi(w,M,m){return w.a==0&&(w.a=M,w.sc=m,w.cb=0),0}function un(w,M,m){return 3<=m&&w[M+0]==157&&w[M+1]==1&&w[M+2]==42}function fr(w,M){if(w==null)return 0;if(w.a=0,w.sc="OK",M==null)return Yi(w,2,"null VP8Io passed to VP8GetHeaders()");var m=M.data,s=M.w,u=M.ha;if(4>u)return Yi(w,7,"Truncated header.");var f=m[s+0]|m[s+1]<<8|m[s+2]<<16,g=w.Od;if(g.Rb=!(1&f),g.td=f>>1&7,g.yd=f>>4&1,g.ub=f>>5,3<g.td)return Yi(w,3,"Incorrect keyframe parameters.");if(!g.yd)return Yi(w,4,"Frame not displayable.");s+=3,u-=3;var y=w.Kc;if(g.Rb){if(7>u)return Yi(w,7,"cannot parse picture header");if(!un(m,s,u))return Yi(w,3,"Bad code word");y.c=16383&(m[s+4]<<8|m[s+3]),y.Td=m[s+4]>>6,y.i=16383&(m[s+6]<<8|m[s+5]),y.Ud=m[s+6]>>6,s+=7,u-=7,w.za=y.c+15>>4,w.Ub=y.i+15>>4,M.width=y.c,M.height=y.i,M.Da=0,M.j=0,M.v=0,M.va=M.width,M.o=M.height,M.da=0,M.ib=M.width,M.hb=M.height,M.U=M.width,M.T=M.height,n((f=w.Pa).jb,0,255,f.jb.length),t((f=w.Qa)!=null),f.Cb=0,f.Bb=0,f.Fb=1,n(f.Zb,0,0,f.Zb.length),n(f.Lb,0,0,f.Lb)}if(g.ub>u)return Yi(w,7,"bad partition length");ee(f=w.m,m,s,g.ub),s+=g.ub,u-=g.ub,g.Rb&&(y.Ld=Jt(f),y.Kd=Jt(f)),y=w.Qa;var A,C=w.Pa;if(t(f!=null),t(y!=null),y.Cb=Jt(f),y.Cb){if(y.Bb=Jt(f),Jt(f)){for(y.Fb=Jt(f),A=0;4>A;++A)y.Zb[A]=Jt(f)?re(f,7):0;for(A=0;4>A;++A)y.Lb[A]=Jt(f)?re(f,6):0}if(y.Bb)for(A=0;3>A;++A)C.jb[A]=Jt(f)?ie(f,8):255}else y.Bb=0;if(f.Ka)return Yi(w,3,"cannot parse segment header");if((y=w.ed).zd=Jt(f),y.Tb=ie(f,6),y.wb=ie(f,3),y.Pc=Jt(f),y.Pc&&Jt(f)){for(C=0;4>C;++C)Jt(f)&&(y.vd[C]=re(f,6));for(C=0;4>C;++C)Jt(f)&&(y.od[C]=re(f,6))}if(w.L=y.Tb==0?0:y.zd?1:2,f.Ka)return Yi(w,3,"cannot parse filter header");var B=u;if(u=A=s,s=A+B,y=B,w.Xb=(1<<ie(w.m,2))-1,B<3*(C=w.Xb))m=7;else{for(A+=3*C,y-=3*C,B=0;B<C;++B){var F=m[u+0]|m[u+1]<<8|m[u+2]<<16;F>y&&(F=y),ee(w.Jc[+B],m,A,F),A+=F,y-=F,u+=3}ee(w.Jc[+C],m,A,y),m=A<s?0:5}if(m!=0)return Yi(w,m,"cannot parse partitions");for(m=ie(A=w.m,7),u=Jt(A)?re(A,4):0,s=Jt(A)?re(A,4):0,y=Jt(A)?re(A,4):0,C=Jt(A)?re(A,4):0,A=Jt(A)?re(A,4):0,B=w.Qa,F=0;4>F;++F){if(B.Cb){var j=B.Zb[F];B.Fb||(j+=m)}else{if(0<F){w.pb[F]=w.pb[0];continue}j=m}var O=w.pb[F];O.Sc[0]=As[Xi(j+u,127)],O.Sc[1]=na[Xi(j+0,127)],O.Eb[0]=2*As[Xi(j+s,127)],O.Eb[1]=101581*na[Xi(j+y,127)]>>16,8>O.Eb[1]&&(O.Eb[1]=8),O.Qc[0]=As[Xi(j+C,117)],O.Qc[1]=na[Xi(j+A,127)],O.lc=j+A}if(!g.Rb)return Yi(w,4,"Not a key frame.");for(Jt(f),g=w.Pa,m=0;4>m;++m){for(u=0;8>u;++u)for(s=0;3>s;++s)for(y=0;11>y;++y)C=$t(f,Vs[m][u][s][y])?ie(f,8):nu[m][u][s][y],g.Wc[m][u].Yb[s][y]=C;for(u=0;17>u;++u)g.Xc[m][u]=g.Wc[m][Ve[u]]}return w.kc=Jt(f),w.kc&&(w.Bd=ie(f,8)),w.cb=1}function lo(w,M,m,s,u,f,g){var y=M[u].Yb[m];for(m=0;16>u;++u){if(!$t(w,y[m+0]))return u;for(;!$t(w,y[m+1]);)if(y=M[++u].Yb[0],m=0,u==16)return 16;var A=M[u+1].Yb;if($t(w,y[m+2])){var C=w,B=0;if($t(C,(j=y)[(F=m)+3]))if($t(C,j[F+6])){for(y=0,F=2*(B=$t(C,j[F+8]))+(j=$t(C,j[F+9+B])),B=0,j=lp[F];j[y];++y)B+=B+$t(C,j[y]);B+=3+(8<<F)}else $t(C,j[F+7])?(B=7+2*$t(C,165),B+=$t(C,145)):B=5+$t(C,159);else B=$t(C,j[F+4])?3+$t(C,j[F+5]):2;y=A[2]}else B=1,y=A[1];A=g+Xu[u],0>(C=w).b&&Ht(C);var F,j=C.b,O=(F=C.Ca>>1)-(C.I>>j)>>31;--C.b,C.Ca+=O,C.Ca|=1,C.I-=(F+1&O)<<j,f[A]=((B^O)-O)*s[(0<u)+0]}return 16}function dn(w){var M=w.rb[w.sb-1];M.la=0,M.Na=0,n(w.zc,0,0,w.zc.length),w.ja=0}function $o(w,M){if(w==null)return 0;if(M==null)return Yi(w,2,"NULL VP8Io parameter in VP8Decode().");if(!w.cb&&!fr(w,M))return 0;if(t(w.cb),M.ac==null||M.ac(M)){M.ob&&(w.L=0);var m=Fa[w.L];if(w.L==2?(w.yb=0,w.zb=0):(w.yb=M.v-m>>4,w.zb=M.j-m>>4,0>w.yb&&(w.yb=0),0>w.zb&&(w.zb=0)),w.Va=M.o+15+m>>4,w.Hb=M.va+15+m>>4,w.Hb>w.za&&(w.Hb=w.za),w.Va>w.Ub&&(w.Va=w.Ub),0<w.L){var s=w.ed;for(m=0;4>m;++m){var u;if(w.Qa.Cb){var f=w.Qa.Lb[m];w.Qa.Fb||(f+=s.Tb)}else f=s.Tb;for(u=0;1>=u;++u){var g=w.gd[m][u],y=f;if(s.Pc&&(y+=s.vd[0],u&&(y+=s.od[0])),0<(y=0>y?0:63<y?63:y)){var A=y;0<s.wb&&(A=4<s.wb?A>>2:A>>1)>9-s.wb&&(A=9-s.wb),1>A&&(A=1),g.dd=A,g.tc=2*y+A,g.ld=40<=y?2:15<=y?1:0}else g.tc=0;g.La=u}}}m=0}else Yi(w,6,"Frame setup failed"),m=w.a;if(m=m==0){if(m){w.$c=0,0<w.Aa||(w.Ic=fi);t:{m=w.Ic,s=4*(A=w.za);var C=32*A,B=A+1,F=0<w.L?A*(0<w.Aa?2:1):0,j=(w.Aa==2?2:1)*A;if((g=s+832+(u=3*(16*m+Fa[w.L])/2*C)+(f=w.Fa!=null&&0<w.Fa.length?w.Kc.c*w.Kc.i:0))!=g)m=0;else{if(g>w.Vb){if(w.Vb=0,w.Ec=o(g),w.Fc=0,w.Ec==null){m=Yi(w,1,"no memory during frame initialization.");break t}w.Vb=g}g=w.Ec,y=w.Fc,w.Ac=g,w.Bc=y,y+=s,w.Gd=c(C,Er),w.Hd=0,w.rb=c(B+1,Ir),w.sb=1,w.wa=F?c(F,Xn):null,w.Y=0,w.D.Nb=0,w.D.wa=w.wa,w.D.Y=w.Y,0<w.Aa&&(w.D.Y+=A),t(!0),w.oc=g,w.pc=y,y+=832,w.ya=c(j,oo),w.aa=0,w.D.ya=w.ya,w.D.aa=w.aa,w.Aa==2&&(w.D.aa+=A),w.R=16*A,w.B=8*A,A=(C=Fa[w.L])*w.R,C=C/2*w.B,w.sa=g,w.ta=y+A,w.qa=w.sa,w.ra=w.ta+16*m*w.R+C,w.Ha=w.qa,w.Ia=w.ra+8*m*w.B+C,w.$c=0,y+=u,w.mb=f?g:null,w.nb=f?y:null,t(y+f<=w.Fc+w.Vb),dn(w),n(w.Ac,w.Bc,0,s),m=1}}if(m){if(M.ka=0,M.y=w.sa,M.O=w.ta,M.f=w.qa,M.N=w.ra,M.ea=w.Ha,M.Vd=w.Ia,M.fa=w.R,M.Rc=w.B,M.F=null,M.J=0,!Vl){for(m=-255;255>=m;++m)Qh[255+m]=0>m?-m:m;for(m=-1020;1020>=m;++m)qr[1020+m]=-128>m?-128:127<m?127:m;for(m=-112;112>=m;++m)Us[112+m]=-16>m?-16:15<m?15:m;for(m=-255;510>=m;++m)hs[255+m]=0>m?0:255<m?255:m;Vl=1}Ds=mt,rl=Wi,go=Aa,Nn=Ja,cs=rt,Ma=Yn,Os=Ol,Ba=tl,Ns=ph,zs=Nl,Ra=dh,ts=Ea,_o=zl,Cr=Ec,vr=ho,zr=ji,rn=uo,Ss=Jh,Es[0]=xs,Es[1]=ne,Es[2]=Ll,Es[3]=Ml,Es[4]=Ac,Es[5]=Bl,Es[6]=Yo,Es[7]=Rl,Es[8]=$h,Es[9]=hh,yo[0]=vn,yo[1]=oi,yo[2]=Pi,yo[3]=cr,yo[4]=er,yo[5]=Ka,yo[6]=Pn,Fo[0]=To,Fo[1]=Se,Fo[2]=Yh,Fo[3]=kl,Fo[4]=Jo,Fo[5]=Fl,Fo[6]=Qa,m=1}else m=0}m&&(m=function(O,W){for(O.M=0;O.M<O.Va;++O.M){var $,q=O.Jc[O.M&O.Xb],Q=O.m,lt=O;for($=0;$<lt.za;++$){var ht=Q,ft=lt,ut=ft.Ac,vt=ft.Bc+4*$,Bt=ft.zc,It=ft.ya[ft.aa+$];if(ft.Qa.Bb?It.$b=$t(ht,ft.Pa.jb[0])?2+$t(ht,ft.Pa.jb[2]):$t(ht,ft.Pa.jb[1]):It.$b=0,ft.kc&&(It.Ad=$t(ht,ft.Bd)),It.Za=!$t(ht,145)+0,It.Za){var Qt=It.Ob,pe=0;for(ft=0;4>ft;++ft){var _e,xe=Bt[0+ft];for(_e=0;4>_e;++_e){xe=$l[ut[vt+_e]][xe];for(var ve=ru[$t(ht,xe[0])];0<ve;)ve=ru[2*ve+$t(ht,xe[ve])];xe=-ve,ut[vt+_e]=xe}r(Qt,pe,ut,vt,4),pe+=4,Bt[0+ft]=xe}}else xe=$t(ht,156)?$t(ht,128)?1:3:$t(ht,163)?2:0,It.Ob[0]=xe,n(ut,vt,xe,4),n(Bt,0,xe,4);It.Dd=$t(ht,142)?$t(ht,114)?$t(ht,183)?1:3:2:0}if(lt.m.Ka)return Yi(O,7,"Premature end-of-partition0 encountered.");for(;O.ja<O.za;++O.ja){if(lt=q,ht=(Q=O).rb[Q.sb-1],ut=Q.rb[Q.sb+Q.ja],$=Q.ya[Q.aa+Q.ja],vt=Q.kc?$.Ad:0)ht.la=ut.la=0,$.Za||(ht.Na=ut.Na=0),$.Hc=0,$.Gc=0,$.ia=0;else{var ye,we;if(ht=ut,ut=lt,vt=Q.Pa.Xc,Bt=Q.ya[Q.aa+Q.ja],It=Q.pb[Bt.$b],ft=Bt.ad,Qt=0,pe=Q.rb[Q.sb-1],xe=_e=0,n(ft,Qt,0,384),Bt.Za)var $e=0,Ce=vt[3];else{ve=o(16);var Pe=ht.Na+pe.Na;if(Pe=kc(ut,vt[1],Pe,It.Eb,0,ve,0),ht.Na=pe.Na=(0<Pe)+0,1<Pe)Ds(ve,0,ft,Qt);else{var ii=ve[0]+3>>3;for(ve=0;256>ve;ve+=16)ft[Qt+ve]=ii}$e=1,Ce=vt[0]}var wi=15&ht.la,_i=15&pe.la;for(ve=0;4>ve;++ve){var Ai=1&_i;for(ii=we=0;4>ii;++ii)wi=wi>>1|(Ai=(Pe=kc(ut,Ce,Pe=Ai+(1&wi),It.Sc,$e,ft,Qt))>$e)<<7,we=we<<2|(3<Pe?3:1<Pe?2:ft[Qt+0]!=0),Qt+=16;wi>>=4,_i=_i>>1|Ai<<7,_e=(_e<<8|we)>>>0}for(Ce=wi,$e=_i>>4,ye=0;4>ye;ye+=2){for(we=0,wi=ht.la>>4+ye,_i=pe.la>>4+ye,ve=0;2>ve;++ve){for(Ai=1&_i,ii=0;2>ii;++ii)Pe=Ai+(1&wi),wi=wi>>1|(Ai=0<(Pe=kc(ut,vt[2],Pe,It.Qc,0,ft,Qt)))<<3,we=we<<2|(3<Pe?3:1<Pe?2:ft[Qt+0]!=0),Qt+=16;wi>>=2,_i=_i>>1|Ai<<5}xe|=we<<4*ye,Ce|=wi<<4<<ye,$e|=(240&_i)<<ye}ht.la=Ce,pe.la=$e,Bt.Hc=_e,Bt.Gc=xe,Bt.ia=43690&xe?0:It.ia,vt=!(_e|xe)}if(0<Q.L&&(Q.wa[Q.Y+Q.ja]=Q.gd[$.$b][$.Za],Q.wa[Q.Y+Q.ja].La|=!vt),lt.Ka)return Yi(O,7,"Premature end-of-file encountered.")}if(dn(O),Q=W,lt=1,$=(q=O).D,ht=0<q.L&&q.M>=q.zb&&q.M<=q.Va,q.Aa==0)t:{if($.M=q.M,$.uc=ht,Qo(q,$),lt=1,$=(we=q.D).Nb,ht=(xe=Fa[q.L])*q.R,ut=xe/2*q.B,ve=16*$*q.R,ii=8*$*q.B,vt=q.sa,Bt=q.ta-ht+ve,It=q.qa,ft=q.ra-ut+ii,Qt=q.Ha,pe=q.Ia-ut+ii,_i=(wi=we.M)==0,_e=wi>=q.Va-1,q.Aa==2&&Qo(q,we),we.uc)for(Ai=(Pe=q).D.M,t(Pe.D.uc),we=Pe.yb;we<Pe.Hb;++we){$e=we,Ce=Ai;var ki=(nr=(kr=Pe).D).Nb;ye=kr.R;var nr=nr.wa[nr.Y+$e],Rr=kr.sa,Ki=kr.ta+16*ki*ye+16*$e,Hr=nr.dd,sr=nr.tc;if(sr!=0)if(t(3<=sr),kr.L==1)0<$e&&zr(Rr,Ki,ye,sr+4),nr.La&&Ss(Rr,Ki,ye,sr),0<Ce&&vr(Rr,Ki,ye,sr+4),nr.La&&rn(Rr,Ki,ye,sr);else{var jr=kr.B,sn=kr.qa,es=kr.ra+8*ki*jr+8*$e,Cs=kr.Ha,kr=kr.Ia+8*ki*jr+8*$e;ki=nr.ld,0<$e&&(Ba(Rr,Ki,ye,sr+4,Hr,ki),zs(sn,es,Cs,kr,jr,sr+4,Hr,ki)),nr.La&&(ts(Rr,Ki,ye,sr,Hr,ki),Cr(sn,es,Cs,kr,jr,sr,Hr,ki)),0<Ce&&(Os(Rr,Ki,ye,sr+4,Hr,ki),Ns(sn,es,Cs,kr,jr,sr+4,Hr,ki)),nr.La&&(Ra(Rr,Ki,ye,sr,Hr,ki),_o(sn,es,Cs,kr,jr,sr,Hr,ki))}}if(q.ia&&alert("todo:DitherRow"),Q.put!=null){if(we=16*wi,wi=16*(wi+1),_i?(Q.y=q.sa,Q.O=q.ta+ve,Q.f=q.qa,Q.N=q.ra+ii,Q.ea=q.Ha,Q.W=q.Ia+ii):(we-=xe,Q.y=vt,Q.O=Bt,Q.f=It,Q.N=ft,Q.ea=Qt,Q.W=pe),_e||(wi-=xe),wi>Q.o&&(wi=Q.o),Q.F=null,Q.J=null,q.Fa!=null&&0<q.Fa.length&&we<wi&&(Q.J=Gl(q,Q,we,wi-we),Q.F=q.mb,Q.F==null&&Q.F.length==0)){lt=Yi(q,3,"Could not decode alpha data.");break t}we<Q.j&&(xe=Q.j-we,we=Q.j,t(!(1&xe)),Q.O+=q.R*xe,Q.N+=q.B*(xe>>1),Q.W+=q.B*(xe>>1),Q.F!=null&&(Q.J+=Q.width*xe)),we<wi&&(Q.O+=Q.v,Q.N+=Q.v>>1,Q.W+=Q.v>>1,Q.F!=null&&(Q.J+=Q.v),Q.ka=we-Q.j,Q.U=Q.va-Q.v,Q.T=wi-we,lt=Q.put(Q))}$+1!=q.Ic||_e||(r(q.sa,q.ta-ht,vt,Bt+16*q.R,ht),r(q.qa,q.ra-ut,It,ft+8*q.B,ut),r(q.Ha,q.Ia-ut,Qt,pe+8*q.B,ut))}if(!lt)return Yi(O,6,"Output aborted.")}return 1}(w,M)),M.bc!=null&&M.bc(M),m&=1}return m?(w.cb=0,m):0}function Tr(w,M,m,s,u){u=w[M+m+32*s]+(u>>3),w[M+m+32*s]=-256&u?0>u?0:255:u}function $n(w,M,m,s,u,f){Tr(w,M,0,m,s+u),Tr(w,M,1,m,s+f),Tr(w,M,2,m,s-f),Tr(w,M,3,m,s-u)}function pn(w){return(20091*w>>16)+w}function as(w,M,m,s){var u,f=0,g=o(16);for(u=0;4>u;++u){var y=w[M+0]+w[M+8],A=w[M+0]-w[M+8],C=(35468*w[M+4]>>16)-pn(w[M+12]),B=pn(w[M+4])+(35468*w[M+12]>>16);g[f+0]=y+B,g[f+1]=A+C,g[f+2]=A-C,g[f+3]=y-B,f+=4,M++}for(u=f=0;4>u;++u)y=(w=g[f+0]+4)+g[f+8],A=w-g[f+8],C=(35468*g[f+4]>>16)-pn(g[f+12]),Tr(m,s,0,0,y+(B=pn(g[f+4])+(35468*g[f+12]>>16))),Tr(m,s,1,0,A+C),Tr(m,s,2,0,A-C),Tr(m,s,3,0,y-B),f++,s+=32}function Yn(w,M,m,s){var u=w[M+0]+4,f=35468*w[M+4]>>16,g=pn(w[M+4]),y=35468*w[M+1]>>16;$n(m,s,0,u+g,w=pn(w[M+1]),y),$n(m,s,1,u+f,w,y),$n(m,s,2,u-f,w,y),$n(m,s,3,u-g,w,y)}function Wi(w,M,m,s,u){as(w,M,m,s),u&&as(w,M+16,m,s+4)}function Aa(w,M,m,s){rl(w,M+0,m,s,1),rl(w,M+32,m,s+128,1)}function Ja(w,M,m,s){var u;for(w=w[M+0]+4,u=0;4>u;++u)for(M=0;4>M;++M)Tr(m,s,M,u,w)}function rt(w,M,m,s){w[M+0]&&Nn(w,M+0,m,s),w[M+16]&&Nn(w,M+16,m,s+4),w[M+32]&&Nn(w,M+32,m,s+128),w[M+48]&&Nn(w,M+48,m,s+128+4)}function mt(w,M,m,s){var u,f=o(16);for(u=0;4>u;++u){var g=w[M+0+u]+w[M+12+u],y=w[M+4+u]+w[M+8+u],A=w[M+4+u]-w[M+8+u],C=w[M+0+u]-w[M+12+u];f[0+u]=g+y,f[8+u]=g-y,f[4+u]=C+A,f[12+u]=C-A}for(u=0;4>u;++u)g=(w=f[0+4*u]+3)+f[3+4*u],y=f[1+4*u]+f[2+4*u],A=f[1+4*u]-f[2+4*u],C=w-f[3+4*u],m[s+0]=g+y>>3,m[s+16]=C+A>>3,m[s+32]=g-y>>3,m[s+48]=C-A>>3,s+=64}function Dt(w,M,m){var s,u=M-32,f=xn,g=255-w[u-1];for(s=0;s<m;++s){var y,A=f,C=g+w[M-1];for(y=0;y<m;++y)w[M+y]=A[C+w[u+y]];M+=32}}function ne(w,M){Dt(w,M,4)}function Se(w,M){Dt(w,M,8)}function oi(w,M){Dt(w,M,16)}function Pi(w,M){var m;for(m=0;16>m;++m)r(w,M+32*m,w,M-32,16)}function cr(w,M){var m;for(m=16;0<m;--m)n(w,M,w[M-1],16),M+=32}function fn(w,M,m){var s;for(s=0;16>s;++s)n(M,m+32*s,w,16)}function vn(w,M){var m,s=16;for(m=0;16>m;++m)s+=w[M-1+32*m]+w[M+m-32];fn(s>>5,w,M)}function er(w,M){var m,s=8;for(m=0;16>m;++m)s+=w[M-1+32*m];fn(s>>4,w,M)}function Ka(w,M){var m,s=8;for(m=0;16>m;++m)s+=w[M+m-32];fn(s>>4,w,M)}function Pn(w,M){fn(128,w,M)}function ui(w,M,m){return w+2*M+m+2>>2}function Ll(w,M){var m,s=M-32;for(s=new Uint8Array([ui(w[s-1],w[s+0],w[s+1]),ui(w[s+0],w[s+1],w[s+2]),ui(w[s+1],w[s+2],w[s+3]),ui(w[s+2],w[s+3],w[s+4])]),m=0;4>m;++m)r(w,M+32*m,s,0,s.length)}function Ml(w,M){var m=w[M-1],s=w[M-1+32],u=w[M-1+64],f=w[M-1+96];Ae(w,M+0,16843009*ui(w[M-1-32],m,s)),Ae(w,M+32,16843009*ui(m,s,u)),Ae(w,M+64,16843009*ui(s,u,f)),Ae(w,M+96,16843009*ui(u,f,f))}function xs(w,M){var m,s=4;for(m=0;4>m;++m)s+=w[M+m-32]+w[M-1+32*m];for(s>>=3,m=0;4>m;++m)n(w,M+32*m,s,4)}function Ac(w,M){var m=w[M-1+0],s=w[M-1+32],u=w[M-1+64],f=w[M-1-32],g=w[M+0-32],y=w[M+1-32],A=w[M+2-32],C=w[M+3-32];w[M+0+96]=ui(s,u,w[M-1+96]),w[M+1+96]=w[M+0+64]=ui(m,s,u),w[M+2+96]=w[M+1+64]=w[M+0+32]=ui(f,m,s),w[M+3+96]=w[M+2+64]=w[M+1+32]=w[M+0+0]=ui(g,f,m),w[M+3+64]=w[M+2+32]=w[M+1+0]=ui(y,g,f),w[M+3+32]=w[M+2+0]=ui(A,y,g),w[M+3+0]=ui(C,A,y)}function Yo(w,M){var m=w[M+1-32],s=w[M+2-32],u=w[M+3-32],f=w[M+4-32],g=w[M+5-32],y=w[M+6-32],A=w[M+7-32];w[M+0+0]=ui(w[M+0-32],m,s),w[M+1+0]=w[M+0+32]=ui(m,s,u),w[M+2+0]=w[M+1+32]=w[M+0+64]=ui(s,u,f),w[M+3+0]=w[M+2+32]=w[M+1+64]=w[M+0+96]=ui(u,f,g),w[M+3+32]=w[M+2+64]=w[M+1+96]=ui(f,g,y),w[M+3+64]=w[M+2+96]=ui(g,y,A),w[M+3+96]=ui(y,A,A)}function Bl(w,M){var m=w[M-1+0],s=w[M-1+32],u=w[M-1+64],f=w[M-1-32],g=w[M+0-32],y=w[M+1-32],A=w[M+2-32],C=w[M+3-32];w[M+0+0]=w[M+1+64]=f+g+1>>1,w[M+1+0]=w[M+2+64]=g+y+1>>1,w[M+2+0]=w[M+3+64]=y+A+1>>1,w[M+3+0]=A+C+1>>1,w[M+0+96]=ui(u,s,m),w[M+0+64]=ui(s,m,f),w[M+0+32]=w[M+1+96]=ui(m,f,g),w[M+1+32]=w[M+2+96]=ui(f,g,y),w[M+2+32]=w[M+3+96]=ui(g,y,A),w[M+3+32]=ui(y,A,C)}function Rl(w,M){var m=w[M+0-32],s=w[M+1-32],u=w[M+2-32],f=w[M+3-32],g=w[M+4-32],y=w[M+5-32],A=w[M+6-32],C=w[M+7-32];w[M+0+0]=m+s+1>>1,w[M+1+0]=w[M+0+64]=s+u+1>>1,w[M+2+0]=w[M+1+64]=u+f+1>>1,w[M+3+0]=w[M+2+64]=f+g+1>>1,w[M+0+32]=ui(m,s,u),w[M+1+32]=w[M+0+96]=ui(s,u,f),w[M+2+32]=w[M+1+96]=ui(u,f,g),w[M+3+32]=w[M+2+96]=ui(f,g,y),w[M+3+64]=ui(g,y,A),w[M+3+96]=ui(y,A,C)}function hh(w,M){var m=w[M-1+0],s=w[M-1+32],u=w[M-1+64],f=w[M-1+96];w[M+0+0]=m+s+1>>1,w[M+2+0]=w[M+0+32]=s+u+1>>1,w[M+2+32]=w[M+0+64]=u+f+1>>1,w[M+1+0]=ui(m,s,u),w[M+3+0]=w[M+1+32]=ui(s,u,f),w[M+3+32]=w[M+1+64]=ui(u,f,f),w[M+3+64]=w[M+2+64]=w[M+0+96]=w[M+1+96]=w[M+2+96]=w[M+3+96]=f}function $h(w,M){var m=w[M-1+0],s=w[M-1+32],u=w[M-1+64],f=w[M-1+96],g=w[M-1-32],y=w[M+0-32],A=w[M+1-32],C=w[M+2-32];w[M+0+0]=w[M+2+32]=m+g+1>>1,w[M+0+32]=w[M+2+64]=s+m+1>>1,w[M+0+64]=w[M+2+96]=u+s+1>>1,w[M+0+96]=f+u+1>>1,w[M+3+0]=ui(y,A,C),w[M+2+0]=ui(g,y,A),w[M+1+0]=w[M+3+32]=ui(m,g,y),w[M+1+32]=w[M+3+64]=ui(s,m,g),w[M+1+64]=w[M+3+96]=ui(u,s,m),w[M+1+96]=ui(f,u,s)}function Yh(w,M){var m;for(m=0;8>m;++m)r(w,M+32*m,w,M-32,8)}function kl(w,M){var m;for(m=0;8>m;++m)n(w,M,w[M-1],8),M+=32}function co(w,M,m){var s;for(s=0;8>s;++s)n(M,m+32*s,w,8)}function To(w,M){var m,s=8;for(m=0;8>m;++m)s+=w[M+m-32]+w[M-1+32*m];co(s>>4,w,M)}function Fl(w,M){var m,s=4;for(m=0;8>m;++m)s+=w[M+m-32];co(s>>3,w,M)}function Jo(w,M){var m,s=4;for(m=0;8>m;++m)s+=w[M-1+32*m];co(s>>3,w,M)}function Qa(w,M){co(128,w,M)}function Jn(w,M,m){var s=w[M-m],u=w[M+0],f=3*(u-s)+Lc[1020+w[M-2*m]-w[M+m]],g=nl[112+(f+4>>3)];w[M-m]=xn[255+s+nl[112+(f+3>>3)]],w[M+0]=xn[255+u-g]}function uh(w,M,m,s){var u=w[M+0],f=w[M+m];return cn[255+w[M-2*m]-w[M-m]]>s||cn[255+f-u]>s}function Dl(w,M,m,s){return 4*cn[255+w[M-m]-w[M+0]]+cn[255+w[M-2*m]-w[M+m]]<=s}function Co(w,M,m,s,u){var f=w[M-3*m],g=w[M-2*m],y=w[M-m],A=w[M+0],C=w[M+m],B=w[M+2*m],F=w[M+3*m];return 4*cn[255+y-A]+cn[255+g-C]>s?0:cn[255+w[M-4*m]-f]<=u&&cn[255+f-g]<=u&&cn[255+g-y]<=u&&cn[255+F-B]<=u&&cn[255+B-C]<=u&&cn[255+C-A]<=u}function ho(w,M,m,s){var u=2*s+1;for(s=0;16>s;++s)Dl(w,M+s,m,u)&&Jn(w,M+s,m)}function ji(w,M,m,s){var u=2*s+1;for(s=0;16>s;++s)Dl(w,M+s*m,1,u)&&Jn(w,M+s*m,1)}function uo(w,M,m,s){var u;for(u=3;0<u;--u)ho(w,M+=4*m,m,s)}function Jh(w,M,m,s){var u;for(u=3;0<u;--u)ji(w,M+=4,m,s)}function ws(w,M,m,s,u,f,g,y){for(f=2*f+1;0<u--;){if(Co(w,M,m,f,g))if(uh(w,M,m,y))Jn(w,M,m);else{var A=w,C=M,B=m,F=A[C-2*B],j=A[C-B],O=A[C+0],W=A[C+B],$=A[C+2*B],q=27*(lt=Lc[1020+3*(O-j)+Lc[1020+F-W]])+63>>7,Q=18*lt+63>>7,lt=9*lt+63>>7;A[C-3*B]=xn[255+A[C-3*B]+lt],A[C-2*B]=xn[255+F+Q],A[C-B]=xn[255+j+q],A[C+0]=xn[255+O-q],A[C+B]=xn[255+W-Q],A[C+2*B]=xn[255+$-lt]}M+=s}}function po(w,M,m,s,u,f,g,y){for(f=2*f+1;0<u--;){if(Co(w,M,m,f,g))if(uh(w,M,m,y))Jn(w,M,m);else{var A=w,C=M,B=m,F=A[C-B],j=A[C+0],O=A[C+B],W=nl[112+(($=3*(j-F))+4>>3)],$=nl[112+($+3>>3)],q=W+1>>1;A[C-2*B]=xn[255+A[C-2*B]+q],A[C-B]=xn[255+F+$],A[C+0]=xn[255+j-W],A[C+B]=xn[255+O-q]}M+=s}}function Ol(w,M,m,s,u,f){ws(w,M,m,1,16,s,u,f)}function tl(w,M,m,s,u,f){ws(w,M,1,m,16,s,u,f)}function dh(w,M,m,s,u,f){var g;for(g=3;0<g;--g)po(w,M+=4*m,m,1,16,s,u,f)}function Ea(w,M,m,s,u,f){var g;for(g=3;0<g;--g)po(w,M+=4,1,m,16,s,u,f)}function ph(w,M,m,s,u,f,g,y){ws(w,M,u,1,8,f,g,y),ws(m,s,u,1,8,f,g,y)}function Nl(w,M,m,s,u,f,g,y){ws(w,M,1,u,8,f,g,y),ws(m,s,1,u,8,f,g,y)}function zl(w,M,m,s,u,f,g,y){po(w,M+4*u,u,1,8,f,g,y),po(m,s+4*u,u,1,8,f,g,y)}function Ec(w,M,m,s,u,f,g,y){po(w,M+4,1,u,8,f,g,y),po(m,s+4,1,u,8,f,g,y)}function ks(){this.ba=new Qr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new xt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function jl(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Tc(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Cc(){this.ua=0,this.Wa=new it,this.vb=new it,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new bt,this.yc=new pt}function el(){this.xb=this.a=0,this.l=new Zn,this.ca=new Qr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new nt,this.Pb=0,this.wd=new nt,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Cc,this.ab=0,this.gc=c(4,Tc),this.Oc=0}function Ul(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Zn,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function Po(w,M,m,s,u,f,g){for(w=w==null?0:w[M+0],M=0;M<g;++M)u[f+M]=w+m[s+M]&255,w=u[f+M]}function Pc(w,M,m,s,u,f,g){var y;if(w==null)Po(null,null,m,s,u,f,g);else for(y=0;y<g;++y)u[f+y]=w[M+y]+m[s+y]&255}function Ta(w,M,m,s,u,f,g){if(w==null)Po(null,null,m,s,u,f,g);else{var y,A=w[M+0],C=A,B=A;for(y=0;y<g;++y)C=B+(A=w[M+y])-C,B=m[s+y]+(-256&C?0>C?0:255:C)&255,C=A,u[f+y]=B}}function Gl(w,M,m,s){var u=M.width,f=M.o;if(t(w!=null&&M!=null),0>m||0>=s||m+s>f)return null;if(!w.Cc){if(w.ga==null){var g;if(w.ga=new Ul,(g=w.ga==null)||(g=M.width*M.o,t(w.Gb.length==0),w.Gb=o(g),w.Uc=0,w.Gb==null?g=0:(w.mb=w.Gb,w.nb=w.Uc,w.rc=null,g=1),g=!g),!g){g=w.ga;var y=w.Fa,A=w.P,C=w.qc,B=w.mb,F=w.nb,j=A+1,O=C-1,W=g.l;if(t(y!=null&&B!=null&&M!=null),Do[0]=null,Do[1]=Po,Do[2]=Pc,Do[3]=Ta,g.ca=B,g.tb=F,g.c=M.width,g.i=M.height,t(0<g.c&&0<g.i),1>=C)M=0;else if(g.$a=y[A+0]>>0&3,g.Z=y[A+0]>>2&3,g.Lc=y[A+0]>>4&3,A=y[A+0]>>6&3,0>g.$a||1<g.$a||4<=g.Z||1<g.Lc||A)M=0;else if(W.put=kt,W.ac=_t,W.bc=Gt,W.ma=g,W.width=M.width,W.height=M.height,W.Da=M.Da,W.v=M.v,W.va=M.va,W.j=M.j,W.o=M.o,g.$a)t:{t(g.$a==1),M=Hi();e:for(;;){if(M==null){M=0;break t}if(t(g!=null),g.mc=M,M.c=g.c,M.i=g.i,M.l=g.l,M.l.ma=g,M.l.width=g.c,M.l.height=g.i,M.a=0,Yt(M.m,y,j,O),!hi(g.c,g.i,1,M,null)||(M.ab==1&&M.gc[0].hc==3&&Li(M.s)?(g.ic=1,y=M.c*M.i,M.Ta=null,M.Ua=0,M.V=o(y),M.Ba=0,M.V==null?(M.a=1,M=0):M=1):(g.ic=0,M=Fi(M,g.c)),!M))break e;M=1;break t}g.mc=null,M=0}else M=O>=g.c*g.i;g=!M}if(g)return null;w.ga.Lc!=1?w.Ga=0:s=f-m}t(w.ga!=null),t(m+s<=f);t:{if(M=(y=w.ga).c,f=y.l.o,y.$a==0){if(j=w.rc,O=w.Vc,W=w.Fa,A=w.P+1+m*M,C=w.mb,B=w.nb+m*M,t(A<=w.P+w.qc),y.Z!=0)for(t(Do[y.Z]!=null),g=0;g<s;++g)Do[y.Z](j,O,W,A,C,B,M),j=C,O=B,B+=M,A+=M;else for(g=0;g<s;++g)r(C,B,W,A,M),j=C,O=B,B+=M,A+=M;w.rc=j,w.Vc=O}else{if(t(y.mc!=null),M=m+s,t((g=y.mc)!=null),t(M<=g.i),g.C>=M)M=1;else if(y.ic||Xt(),y.ic){y=g.V,j=g.Ba,O=g.c;var $=g.i,q=(W=1,A=g.$/O,C=g.$%O,B=g.m,F=g.s,g.$),Q=O*$,lt=O*M,ht=F.wc,ft=q<lt?be(F,C,A):null;t(q<=Q),t(M<=$),t(Li(F));e:for(;;){for(;!B.h&&q<lt;){if(C&ht||(ft=be(F,C,A)),t(ft!=null),qt(B),256>($=he(ft.G[0],ft.H[0],B)))y[j+q]=$,++q,++C>=O&&(C=0,++A<=M&&!(A%16)&&Ci(g,A));else{if(!(280>$)){W=0;break e}$=Ct($-256,B);var ut,vt=he(ft.G[4],ft.H[4],B);if(qt(B),!(q>=(vt=te(O,vt=Ct(vt,B)))&&Q-q>=$)){W=0;break e}for(ut=0;ut<$;++ut)y[j+q+ut]=y[j+q+ut-vt];for(q+=$,C+=$;C>=O;)C-=O,++A<=M&&!(A%16)&&Ci(g,A);q<lt&&C&ht&&(ft=be(F,C,A))}t(B.h==Tt(B))}Ci(g,A>M?M:A);break e}!W||B.h&&q<Q?(W=0,g.a=B.h?5:3):g.$=q,M=W}else M=xi(g,g.V,g.Ba,g.c,g.i,M,Qi);if(!M){s=0;break t}}m+s>=f&&(w.Cc=1),s=1}if(!s)return null;if(w.Cc&&((s=w.ga)!=null&&(s.mc=null),w.ga=null,0<w.Ga))return alert("todo:WebPDequantizeLevels"),null}return w.nb+m*u}function k(w,M,m,s,u,f){for(;0<u--;){var g,y=w,A=M+(m?1:0),C=w,B=M+(m?0:3);for(g=0;g<s;++g){var F=C[B+4*g];F!=255&&(F*=32897,y[A+4*g+0]=y[A+4*g+0]*F>>23,y[A+4*g+1]=y[A+4*g+1]*F>>23,y[A+4*g+2]=y[A+4*g+2]*F>>23)}M+=f}}function et(w,M,m,s,u){for(;0<s--;){var f;for(f=0;f<m;++f){var g=w[M+2*f+0],y=15&(C=w[M+2*f+1]),A=4369*y,C=(240&C|C>>4)*A>>16;w[M+2*f+0]=(240&g|g>>4)*A>>16&240|(15&g|g<<4)*A>>16>>4&15,w[M+2*f+1]=240&C|y}M+=u}}function At(w,M,m,s,u,f,g,y){var A,C,B=255;for(C=0;C<u;++C){for(A=0;A<s;++A){var F=w[M+A];f[g+4*A]=F,B&=F}M+=m,g+=y}return B!=255}function Ot(w,M,m,s,u){var f;for(f=0;f<u;++f)m[s+f]=w[M+f]>>8}function Xt(){js=k,nn=et,Ro=At,Kh=Ot}function ae(w,M,m){yt[w]=function(s,u,f,g,y,A,C,B,F,j,O,W,$,q,Q,lt,ht){var ft,ut=ht-1>>1,vt=y[A+0]|C[B+0]<<16,Bt=F[j+0]|O[W+0]<<16;t(s!=null);var It=3*vt+Bt+131074>>2;for(M(s[u+0],255&It,It>>16,$,q),f!=null&&(It=3*Bt+vt+131074>>2,M(f[g+0],255&It,It>>16,Q,lt)),ft=1;ft<=ut;++ft){var Qt=y[A+ft]|C[B+ft]<<16,pe=F[j+ft]|O[W+ft]<<16,_e=vt+Qt+Bt+pe+524296,xe=_e+2*(Qt+Bt)>>3;It=xe+vt>>1,vt=(_e=_e+2*(vt+pe)>>3)+Qt>>1,M(s[u+2*ft-1],255&It,It>>16,$,q+(2*ft-1)*m),M(s[u+2*ft-0],255&vt,vt>>16,$,q+(2*ft-0)*m),f!=null&&(It=_e+Bt>>1,vt=xe+pe>>1,M(f[g+2*ft-1],255&It,It>>16,Q,lt+(2*ft-1)*m),M(f[g+2*ft+0],255&vt,vt>>16,Q,lt+(2*ft+0)*m)),vt=Qt,Bt=pe}1&ht||(It=3*vt+Bt+131074>>2,M(s[u+ht-1],255&It,It>>16,$,q+(ht-1)*m),f!=null&&(It=3*Bt+vt+131074>>2,M(f[g+ht-1],255&It,It>>16,Q,lt+(ht-1)*m)))}}function Ie(){Ti[ql]=su,Ti[sl]=gh,Ti[mh]=cp,Ti[ol]=Zu,Ti[Hl]=cl,Ti[Mc]=ou,Ti[ka]=au,Ti[Wl]=gh,Ti[al]=Zu,Ti[Xl]=cl,Ti[Bc]=ou}function He(w){return w&~Ts?0>w?0:255:w>>$u}function gi(w,M){return He((19077*w>>8)+(26149*M>>8)-14234)}function Ii(w,M,m){return He((19077*w>>8)-(6419*M>>8)-(13320*m>>8)+8708)}function Di(w,M){return He((19077*w>>8)+(33050*M>>8)-17685)}function Ui(w,M,m,s,u){s[u+0]=gi(w,m),s[u+1]=Ii(w,M,m),s[u+2]=Di(w,M)}function Br(w,M,m,s,u){s[u+0]=Di(w,M),s[u+1]=Ii(w,M,m),s[u+2]=gi(w,m)}function en(w,M,m,s,u){var f=Ii(w,M,m);M=f<<3&224|Di(w,M)>>3,s[u+0]=248&gi(w,m)|f>>5,s[u+1]=M}function Oi(w,M,m,s,u){var f=240&Di(w,M)|15;s[u+0]=240&gi(w,m)|Ii(w,M,m)>>4,s[u+1]=f}function Fn(w,M,m,s,u){s[u+0]=255,Ui(w,M,m,s,u+1)}function di(w,M,m,s,u){Br(w,M,m,s,u),s[u+3]=255}function ls(w,M,m,s,u){Ui(w,M,m,s,u),s[u+3]=255}function Xi(w,M){return 0>w?0:w>M?M:w}function Ji(w,M,m){yt[w]=function(s,u,f,g,y,A,C,B,F){for(var j=B+(-2&F)*m;B!=j;)M(s[u+0],f[g+0],y[A+0],C,B),M(s[u+1],f[g+0],y[A+0],C,B+m),u+=2,++g,++A,B+=2*m;1&F&&M(s[u+0],f[g+0],y[A+0],C,B)}}function Io(w,M,m){return m==0?w==0?M==0?6:5:M==0?4:0:m}function Ko(w,M,m,s,u){switch(w>>>30){case 3:rl(M,m,s,u,0);break;case 2:Ma(M,m,s,u);break;case 1:Nn(M,m,s,u)}}function Qo(w,M){var m,s,u=M.M,f=M.Nb,g=w.oc,y=w.pc+40,A=w.oc,C=w.pc+584,B=w.oc,F=w.pc+600;for(m=0;16>m;++m)g[y+32*m-1]=129;for(m=0;8>m;++m)A[C+32*m-1]=129,B[F+32*m-1]=129;for(0<u?g[y-1-32]=A[C-1-32]=B[F-1-32]=129:(n(g,y-32-1,127,21),n(A,C-32-1,127,9),n(B,F-32-1,127,9)),s=0;s<w.za;++s){var j=M.ya[M.aa+s];if(0<s){for(m=-1;16>m;++m)r(g,y+32*m-4,g,y+32*m+12,4);for(m=-1;8>m;++m)r(A,C+32*m-4,A,C+32*m+4,4),r(B,F+32*m-4,B,F+32*m+4,4)}var O=w.Gd,W=w.Hd+s,$=j.ad,q=j.Hc;if(0<u&&(r(g,y-32,O[W].y,0,16),r(A,C-32,O[W].f,0,8),r(B,F-32,O[W].ea,0,8)),j.Za){var Q=g,lt=y-32+16;for(0<u&&(s>=w.za-1?n(Q,lt,O[W].y[15],4):r(Q,lt,O[W+1].y,0,4)),m=0;4>m;m++)Q[lt+128+m]=Q[lt+256+m]=Q[lt+384+m]=Q[lt+0+m];for(m=0;16>m;++m,q<<=2)Q=g,lt=y+vo[m],Es[j.Ob[m]](Q,lt),Ko(q,$,16*+m,Q,lt)}else if(Q=Io(s,u,j.Ob[0]),yo[Q](g,y),q!=0)for(m=0;16>m;++m,q<<=2)Ko(q,$,16*+m,g,y+vo[m]);for(m=j.Gc,Q=Io(s,u,j.Dd),Fo[Q](A,C),Fo[Q](B,F),q=$,Q=A,lt=C,255&(j=m>>0)&&(170&j?go(q,256,Q,lt):cs(q,256,Q,lt)),j=B,q=F,255&(m>>=8)&&(170&m?go($,320,j,q):cs($,320,j,q)),u<w.Ub-1&&(r(O[W].y,0,g,y+480,16),r(O[W].f,0,A,C+224,8),r(O[W].ea,0,B,F+224,8)),m=8*f*w.B,O=w.sa,W=w.ta+16*s+16*f*w.R,$=w.qa,j=w.ra+8*s+m,q=w.Ha,Q=w.Ia+8*s+m,m=0;16>m;++m)r(O,W+m*w.R,g,y+32*m,16);for(m=0;8>m;++m)r($,j+m*w.B,A,C+32*m,8),r(q,Q+m*w.B,B,F+32*m,8)}}function Ca(w,M,m,s,u,f,g,y,A){var C=[0],B=[0],F=0,j=A!=null?A.kd:0,O=A??new jl;if(w==null||12>m)return 7;O.data=w,O.w=M,O.ha=m,M=[M],m=[m],O.gb=[O.gb];t:{var W=M,$=m,q=O.gb;if(t(w!=null),t($!=null),t(q!=null),q[0]=0,12<=$[0]&&!e(w,W[0],"RIFF")){if(e(w,W[0]+8,"WEBP")){q=3;break t}var Q=Ne(w,W[0]+4);if(12>Q||4294967286<Q){q=3;break t}if(j&&Q>$[0]-8){q=7;break t}q[0]=Q,W[0]+=12,$[0]-=12}q=0}if(q!=0)return q;for(Q=0<O.gb[0],m=m[0];;){t:{var lt=w;$=M,q=m;var ht=C,ft=B,ut=W=[0];if((It=F=[F])[0]=0,8>q[0])q=7;else{if(!e(lt,$[0],"VP8X")){if(Ne(lt,$[0]+4)!=10){q=3;break t}if(18>q[0]){q=7;break t}var vt=Ne(lt,$[0]+8),Bt=1+Fe(lt,$[0]+12);if(2147483648<=Bt*(lt=1+Fe(lt,$[0]+15))){q=3;break t}ut!=null&&(ut[0]=vt),ht!=null&&(ht[0]=Bt),ft!=null&&(ft[0]=lt),$[0]+=18,q[0]-=18,It[0]=1}q=0}}if(F=F[0],W=W[0],q!=0)return q;if($=!!(2&W),!Q&&F)return 3;if(f!=null&&(f[0]=!!(16&W)),g!=null&&(g[0]=$),y!=null&&(y[0]=0),g=C[0],W=B[0],F&&$&&A==null){q=0;break}if(4>m){q=7;break}if(Q&&F||!Q&&!F&&!e(w,M[0],"ALPH")){m=[m],O.na=[O.na],O.P=[O.P],O.Sa=[O.Sa];t:{vt=w,q=M,Q=m;var It=O.gb;ht=O.na,ft=O.P,ut=O.Sa,Bt=22,t(vt!=null),t(Q!=null),lt=q[0];var Qt=Q[0];for(t(ht!=null),t(ut!=null),ht[0]=null,ft[0]=null,ut[0]=0;;){if(q[0]=lt,Q[0]=Qt,8>Qt){q=7;break t}var pe=Ne(vt,lt+4);if(4294967286<pe){q=3;break t}var _e=8+pe+1&-2;if(Bt+=_e,0<It&&Bt>It){q=3;break t}if(!e(vt,lt,"VP8 ")||!e(vt,lt,"VP8L")){q=0;break t}if(Qt[0]<_e){q=7;break t}e(vt,lt,"ALPH")||(ht[0]=vt,ft[0]=lt+8,ut[0]=pe),lt+=_e,Qt-=_e}}if(m=m[0],O.na=O.na[0],O.P=O.P[0],O.Sa=O.Sa[0],q!=0)break}m=[m],O.Ja=[O.Ja],O.xa=[O.xa];t:if(It=w,q=M,Q=m,ht=O.gb[0],ft=O.Ja,ut=O.xa,vt=q[0],lt=!e(It,vt,"VP8 "),Bt=!e(It,vt,"VP8L"),t(It!=null),t(Q!=null),t(ft!=null),t(ut!=null),8>Q[0])q=7;else{if(lt||Bt){if(It=Ne(It,vt+4),12<=ht&&It>ht-12){q=3;break t}if(j&&It>Q[0]-8){q=7;break t}ft[0]=It,q[0]+=8,Q[0]-=8,ut[0]=Bt}else ut[0]=5<=Q[0]&&It[vt+0]==47&&!(It[vt+4]>>5),ft[0]=Q[0];q=0}if(m=m[0],O.Ja=O.Ja[0],O.xa=O.xa[0],M=M[0],q!=0)break;if(4294967286<O.Ja)return 3;if(y==null||$||(y[0]=O.xa?2:1),g=[g],W=[W],O.xa){if(5>m){q=7;break}y=g,j=W,$=f,w==null||5>m?w=0:5<=m&&w[M+0]==47&&!(w[M+4]>>5)?(Q=[0],It=[0],ht=[0],Yt(ft=new nt,w,M,m),Rt(ft,Q,It,ht)?(y!=null&&(y[0]=Q[0]),j!=null&&(j[0]=It[0]),$!=null&&($[0]=ht[0]),w=1):w=0):w=0}else{if(10>m){q=7;break}y=W,w==null||10>m||!un(w,M+3,m-3)?w=0:(j=w[M+0]|w[M+1]<<8|w[M+2]<<16,$=16383&(w[M+7]<<8|w[M+6]),w=16383&(w[M+9]<<8|w[M+8]),1&j||3<(j>>1&7)||!(j>>4&1)||j>>5>=O.Ja||!$||!w?w=0:(g&&(g[0]=$),y&&(y[0]=w),w=1))}if(!w||(g=g[0],W=W[0],F&&(C[0]!=g||B[0]!=W)))return 3;A!=null&&(A[0]=O,A.offset=M-A.w,t(4294967286>M-A.w),t(A.offset==A.ha-m));break}return q==0||q==7&&F&&A==null?(f!=null&&(f[0]|=O.na!=null&&0<O.na.length),s!=null&&(s[0]=g),u!=null&&(u[0]=W),0):q}function fo(w,M,m){var s=M.width,u=M.height,f=0,g=0,y=s,A=u;if(M.Da=w!=null&&0<w.Da,M.Da&&(y=w.cd,A=w.bd,f=w.v,g=w.j,11>m||(f&=-2,g&=-2),0>f||0>g||0>=y||0>=A||f+y>s||g+A>u))return 0;if(M.v=f,M.j=g,M.va=f+y,M.o=g+A,M.U=y,M.T=A,M.da=w!=null&&0<w.da,M.da){if(!pi(y,A,m=[w.ib],f=[w.hb]))return 0;M.ib=m[0],M.hb=f[0]}return M.ob=w!=null&&w.ob,M.Kb=w==null||!w.Sd,M.da&&(M.ob=M.ib<3*s/4&&M.hb<3*u/4,M.Kb=0),1}function Lo(w){if(w==null)return 2;if(11>w.S){var M=w.f.RGBA;M.fb+=(w.height-1)*M.A,M.A=-M.A}else M=w.f.kb,w=w.height,M.O+=(w-1)*M.fa,M.fa=-M.fa,M.N+=(w-1>>1)*M.Ab,M.Ab=-M.Ab,M.W+=(w-1>>1)*M.Db,M.Db=-M.Db,M.F!=null&&(M.J+=(w-1)*M.lb,M.lb=-M.lb);return 0}function In(w,M,m,s){if(s==null||0>=w||0>=M)return 2;if(m!=null){if(m.Da){var u=m.cd,f=m.bd,g=-2&m.v,y=-2&m.j;if(0>g||0>y||0>=u||0>=f||g+u>w||y+f>M)return 2;w=u,M=f}if(m.da){if(!pi(w,M,u=[m.ib],f=[m.hb]))return 2;w=u[0],M=f[0]}}s.width=w,s.height=M;t:{var A=s.width,C=s.height;if(w=s.S,0>=A||0>=C||!(w>=ql&&13>w))w=2;else{if(0>=s.Rd&&s.sd==null){g=f=u=M=0;var B=(y=A*Nc[w])*C;if(11>w||(f=(C+1)/2*(M=(A+1)/2),w==12&&(g=(u=A)*C)),(C=o(B+2*f+g))==null){w=1;break t}s.sd=C,11>w?((A=s.f.RGBA).eb=C,A.fb=0,A.A=y,A.size=B):((A=s.f.kb).y=C,A.O=0,A.fa=y,A.Fd=B,A.f=C,A.N=0+B,A.Ab=M,A.Cd=f,A.ea=C,A.W=0+B+f,A.Db=M,A.Ed=f,w==12&&(A.F=C,A.J=0+B+2*f),A.Tc=g,A.lb=u)}if(M=1,u=s.S,f=s.width,g=s.height,u>=ql&&13>u)if(11>u)w=s.f.RGBA,M&=(y=Math.abs(w.A))*(g-1)+f<=w.size,M&=y>=f*Nc[u],M&=w.eb!=null;else{w=s.f.kb,y=(f+1)/2,B=(g+1)/2,A=Math.abs(w.fa),C=Math.abs(w.Ab);var F=Math.abs(w.Db),j=Math.abs(w.lb),O=j*(g-1)+f;M&=A*(g-1)+f<=w.Fd,M&=C*(B-1)+y<=w.Cd,M=(M&=F*(B-1)+y<=w.Ed)&A>=f&C>=y&F>=y,M&=w.y!=null,M&=w.f!=null,M&=w.ea!=null,u==12&&(M&=j>=f,M&=O<=w.Tc,M&=w.F!=null)}else M=0;w=M?0:2}}return w!=0||m!=null&&m.fd&&(w=Lo(s)),w}var Dn=64,Pa=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Ia=24,Fs=32,ta=8,bn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];Ee("Predictor0","PredictorAdd0"),yt.Predictor0=function(){return 4278190080},yt.Predictor1=function(w){return w},yt.Predictor2=function(w,M,m){return M[m+0]},yt.Predictor3=function(w,M,m){return M[m+1]},yt.Predictor4=function(w,M,m){return M[m-1]},yt.Predictor5=function(w,M,m){return De(De(w,M[m+1]),M[m+0])},yt.Predictor6=function(w,M,m){return De(w,M[m-1])},yt.Predictor7=function(w,M,m){return De(w,M[m+0])},yt.Predictor8=function(w,M,m){return De(M[m-1],M[m+0])},yt.Predictor9=function(w,M,m){return De(M[m+0],M[m+1])},yt.Predictor10=function(w,M,m){return De(De(w,M[m-1]),De(M[m+0],M[m+1]))},yt.Predictor11=function(w,M,m){var s=M[m+0];return 0>=vi(s>>24&255,w>>24&255,(M=M[m-1])>>24&255)+vi(s>>16&255,w>>16&255,M>>16&255)+vi(s>>8&255,w>>8&255,M>>8&255)+vi(255&s,255&w,255&M)?s:w},yt.Predictor12=function(w,M,m){var s=M[m+0];return(ei((w>>24&255)+(s>>24&255)-((M=M[m-1])>>24&255))<<24|ei((w>>16&255)+(s>>16&255)-(M>>16&255))<<16|ei((w>>8&255)+(s>>8&255)-(M>>8&255))<<8|ei((255&w)+(255&s)-(255&M)))>>>0},yt.Predictor13=function(w,M,m){var s=M[m-1];return(Si((w=De(w,M[m+0]))>>24&255,s>>24&255)<<24|Si(w>>16&255,s>>16&255)<<16|Si(w>>8&255,s>>8&255)<<8|Si(w>>0&255,s>>0&255))>>>0};var La=yt.PredictorAdd0;yt.PredictorAdd1=Ri,Ee("Predictor2","PredictorAdd2"),Ee("Predictor3","PredictorAdd3"),Ee("Predictor4","PredictorAdd4"),Ee("Predictor5","PredictorAdd5"),Ee("Predictor6","PredictorAdd6"),Ee("Predictor7","PredictorAdd7"),Ee("Predictor8","PredictorAdd8"),Ee("Predictor9","PredictorAdd9"),Ee("Predictor10","PredictorAdd10"),Ee("Predictor11","PredictorAdd11"),Ee("Predictor12","PredictorAdd12"),Ee("Predictor13","PredictorAdd13");var ea=yt.PredictorAdd2;bi("ColorIndexInverseTransform","MapARGB","32b",function(w){return w>>8&255},function(w){return w}),bi("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(w){return w},function(w){return w>>8&255});var il,On=yt.ColorIndexInverseTransform,Mo=yt.MapARGB,fh=yt.VP8LColorIndexInverseTransformAlpha,Ic=yt.MapAlpha,Ni=yt.VP8LPredictorsAdd=[];Ni.length=16,(yt.VP8LPredictors=[]).length=16,(yt.VP8LPredictorsAdd_C=[]).length=16,(yt.VP8LPredictors_C=[]).length=16;var Kn,mo,ia,Qn,Bo,ra,Ds,rl,Ma,go,Nn,cs,Os,Ba,Ns,zs,Ra,ts,_o,Cr,vr,zr,rn,Ss,js,nn,Ro,Kh,Qh=o(511),qr=o(2041),Us=o(225),hs=o(767),Vl=0,Lc=qr,nl=Us,xn=hs,cn=Qh,ql=0,sl=1,mh=2,ol=3,Hl=4,Mc=5,ka=6,Wl=7,al=8,Xl=9,Bc=10,tu=[2,3,7],eu=[3,3,11],Rc=[280,256,256,256,40],Zl=[0,1,1,1,0],Wu=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Gs=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ko=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],iu=8,As=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],na=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],kc=null,lp=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Xu=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ru=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],nu=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],$l=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Vs=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Ve=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],yo=[],Es=[],Fo=[],Yl=1,ll=2,Do=[],Ti=[];ae("UpsampleRgbLinePair",Ui,3),ae("UpsampleBgrLinePair",Br,3),ae("UpsampleRgbaLinePair",ls,4),ae("UpsampleBgraLinePair",di,4),ae("UpsampleArgbLinePair",Fn,4),ae("UpsampleRgba4444LinePair",Oi,2),ae("UpsampleRgb565LinePair",en,2);var su=yt.UpsampleRgbLinePair,cp=yt.UpsampleBgrLinePair,gh=yt.UpsampleRgbaLinePair,Zu=yt.UpsampleBgraLinePair,cl=yt.UpsampleArgbLinePair,ou=yt.UpsampleRgba4444LinePair,au=yt.UpsampleRgb565LinePair,Fc=16,_h=1<<Fc-1,hl=-227,lu=482,$u=6,Ts=(256<<$u)-1,br=0,Jl=o(256),yh=o(256),vh=o(256),Yu=o(256),Dc=o(lu-hl),Oc=o(lu-hl);Ji("YuvToRgbRow",Ui,3),Ji("YuvToBgrRow",Br,3),Ji("YuvToRgbaRow",ls,4),Ji("YuvToBgraRow",di,4),Ji("YuvToArgbRow",Fn,4),Ji("YuvToRgba4444Row",Oi,2),Ji("YuvToRgb565Row",en,2);var vo=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Fa=[0,2,8],Ye=[8,7,6,4,4,2,2,2,1,1,1,1],fi=1;this.WebPDecodeRGBA=function(w,M,m,s,u){var f=sl,g=new ks,y=new Qr;g.ba=y,y.S=f,y.width=[y.width],y.height=[y.height];var A=y.width,C=y.height,B=new tn;if(B==null||w==null)var F=2;else t(B!=null),F=Ca(w,M,m,B.width,B.height,B.Pd,B.Qd,B.format,null);if(F!=0?A=0:(A!=null&&(A[0]=B.width[0]),C!=null&&(C[0]=B.height[0]),A=1),A){y.width=y.width[0],y.height=y.height[0],s!=null&&(s[0]=y.width),u!=null&&(u[0]=y.height);t:{if(s=new Zn,(u=new jl).data=w,u.w=M,u.ha=m,u.kd=1,M=[0],t(u!=null),((w=Ca(u.data,u.w,u.ha,null,null,null,M,null,u))==0||w==7)&&M[0]&&(w=4),(M=w)==0){if(t(g!=null),s.data=u.data,s.w=u.w+u.offset,s.ha=u.ha-u.offset,s.put=kt,s.ac=_t,s.bc=Gt,s.ma=g,u.xa){if((w=Hi())==null){g=1;break t}if(function(j,O){var W=[0],$=[0],q=[0];e:for(;;){if(j==null)return 0;if(O==null)return j.a=2,0;if(j.l=O,j.a=0,Yt(j.m,O.data,O.w,O.ha),!Rt(j.m,W,$,q)){j.a=3;break e}if(j.xb=ll,O.width=W[0],O.height=$[0],!hi(W[0],$[0],1,j,null))break e;return 1}return t(j.a!=0),0}(w,s)){if(s=(M=In(s.width,s.height,g.Oa,g.ba))==0){e:{s=w;i:for(;;){if(s==null){s=0;break e}if(t(s.s.yc!=null),t(s.s.Ya!=null),t(0<s.s.Wb),t((m=s.l)!=null),t((u=m.ma)!=null),s.xb!=0){if(s.ca=u.ba,s.tb=u.tb,t(s.ca!=null),!fo(u.Oa,m,ol)){s.a=2;break i}if(!Fi(s,m.width)||m.da)break i;if((m.da||ze(s.ca.S))&&Xt(),11>s.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),s.ca.f.kb.F!=null&&Xt()),s.Pb&&0<s.s.ua&&s.s.vb.X==null&&!si(s.s.vb,s.s.Wa.Xa)){s.a=1;break i}s.xb=0}if(!xi(s,s.V,s.Ba,s.c,s.i,m.o,Je))break i;u.Dc=s.Ma,s=1;break e}t(s.a!=0),s=0}s=!s}s&&(M=w.a)}else M=w.a}else{if((w=new yr)==null){g=1;break t}if(w.Fa=u.na,w.P=u.P,w.qc=u.Sa,fr(w,s)){if((M=In(s.width,s.height,g.Oa,g.ba))==0){if(w.Aa=0,m=g.Oa,t((u=w)!=null),m!=null){if(0<(A=0>(A=m.Md)?0:100<A?255:255*A/100)){for(C=B=0;4>C;++C)12>(F=u.pb[C]).lc&&(F.ia=A*Ye[0>F.lc?0:F.lc]>>3),B|=F.ia;B&&(alert("todo:VP8InitRandom"),u.ia=1)}u.Ga=m.Id,100<u.Ga?u.Ga=100:0>u.Ga&&(u.Ga=0)}$o(w,s)||(M=w.a)}}else M=w.a}M==0&&g.Oa!=null&&g.Oa.fd&&(M=Lo(g.ba))}g=M}f=g!=0?null:11>f?y.f.RGBA.eb:y.f.kb.y}else f=null;return f};var Nc=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function v(yt,Ut){for(var zt="",at=0;at<4;at++)zt+=String.fromCharCode(yt[Ut++]);return zt}function S(yt,Ut){return(yt[Ut+0]<<0|yt[Ut+1]<<8|yt[Ut+2]<<16)>>>0}function T(yt,Ut){return(yt[Ut+0]<<0|yt[Ut+1]<<8|yt[Ut+2]<<16|yt[Ut+3]<<24)>>>0}new _;var P=[0],I=[0],z=[],N=new _,X=i,H=function(yt,Ut){var zt={},at=0,pt=!1,Lt=0,bt=0;if(zt.frames=[],!function(St,Tt,jt,qt){for(var Ht=0;Ht<qt;Ht++)if(St[Tt+Ht]!=jt.charCodeAt(Ht))return!0;return!1}(yt,Ut,"RIFF",4)){var ee,ie;for(T(yt,Ut+=4),Ut+=8;Ut<yt.length;){var re=v(yt,Ut),Yt=T(yt,Ut+=4);Ut+=4;var ce=Yt+(1&Yt);switch(re){case"VP8 ":case"VP8L":zt.frames[at]===void 0&&(zt.frames[at]={}),(nt=zt.frames[at]).src_off=pt?bt:Ut-8,nt.src_size=Lt+Yt+8,at++,pt&&(pt=!1,Lt=0,bt=0);break;case"VP8X":(nt=zt.header={}).feature_flags=yt[Ut];var le=Ut+4;nt.canvas_width=1+S(yt,le),le+=3,nt.canvas_height=1+S(yt,le),le+=3;break;case"ALPH":pt=!0,Lt=ce+8,bt=Ut-8;break;case"ANIM":(nt=zt.header).bgcolor=T(yt,Ut),le=Ut+4,nt.loop_count=(ee=yt)[(ie=le)+0]<<0|ee[ie+1]<<8,le+=2;break;case"ANMF":var Be,nt;(nt=zt.frames[at]={}).offset_x=2*S(yt,Ut),Ut+=3,nt.offset_y=2*S(yt,Ut),Ut+=3,nt.width=1+S(yt,Ut),Ut+=3,nt.height=1+S(yt,Ut),Ut+=3,nt.duration=S(yt,Ut),Ut+=3,Be=yt[Ut++],nt.dispose=1&Be,nt.blend=Be>>1&1}re!="ANMF"&&(Ut+=ce)}return zt}}(X,0);H.response=X,H.rgbaoutput=!0,H.dataurl=!1;var Z=H.header?H.header:null,ot=H.frames?H.frames:null;if(Z){Z.loop_counter=Z.loop_count,P=[Z.canvas_height],I=[Z.canvas_width];for(var gt=0;gt<ot.length&&ot[gt].blend!=0;gt++);}var Et=ot[0],Ft=N.WebPDecodeRGBA(X,Et.src_off,Et.src_size,I,P);Et.rgba=Ft,Et.imgwidth=I[0],Et.imgheight=P[0];for(var Mt=0;Mt<I[0]*P[0]*4;Mt++)z[Mt]=Ft[Mt];return this.width=I,this.height=P,this.data=z,this}(function(i){var t=function(){return typeof t1=="function"},e=function(P,I,z,N){var X=4,H=c;switch(N){case i.image_compression.FAST:X=1,H=o;break;case i.image_compression.MEDIUM:X=6,H=l;break;case i.image_compression.SLOW:X=9,H=_}P=r(P,I,z,H);var Z=t1(P,{level:X});return i.__addimage__.arrayBufferToBinaryString(Z)},r=function(P,I,z,N){for(var X,H,Z,ot=P.length/I,gt=new Uint8Array(P.length+ot),Et=S(),Ft=0;Ft<ot;Ft+=1){if(Z=Ft*I,X=P.subarray(Z,Z+I),N)gt.set(N(X,z,H),Z+Ft);else{for(var Mt,yt=Et.length,Ut=[];Mt<yt;Mt+=1)Ut[Mt]=Et[Mt](X,z,H);var zt=T(Ut.concat());gt.set(Ut[zt],Z+Ft)}H=X}return gt},n=function(P){var I=Array.apply([],P);return I.unshift(0),I},o=function(P,I){var z,N=[],X=P.length;N[0]=1;for(var H=0;H<X;H+=1)z=P[H-I]||0,N[H+1]=P[H]-z+256&255;return N},c=function(P,I,z){var N,X=[],H=P.length;X[0]=2;for(var Z=0;Z<H;Z+=1)N=z&&z[Z]||0,X[Z+1]=P[Z]-N+256&255;return X},l=function(P,I,z){var N,X,H=[],Z=P.length;H[0]=3;for(var ot=0;ot<Z;ot+=1)N=P[ot-I]||0,X=z&&z[ot]||0,H[ot+1]=P[ot]+256-(N+X>>>1)&255;return H},_=function(P,I,z){var N,X,H,Z,ot=[],gt=P.length;ot[0]=4;for(var Et=0;Et<gt;Et+=1)N=P[Et-I]||0,X=z&&z[Et]||0,H=z&&z[Et-I]||0,Z=v(N,X,H),ot[Et+1]=P[Et]-Z+256&255;return ot},v=function(P,I,z){if(P===I&&I===z)return P;var N=Math.abs(I-z),X=Math.abs(P-z),H=Math.abs(P+I-z-z);return N<=X&&N<=H?P:X<=H?I:z},S=function(){return[n,o,c,l,_]},T=function(P){var I=P.map(function(z){return z.reduce(function(N,X){return N+Math.abs(X)},0)});return I.indexOf(Math.min.apply(null,I))};i.processPNG=function(P,I,z,N){var X,H,Z,ot,gt,Et,Ft,Mt,yt,Ut,zt,at,pt,Lt,bt,ee=this.decode.FLATE_DECODE,ie="";if(this.__addimage__.isArrayBuffer(P)&&(P=new Uint8Array(P)),this.__addimage__.isArrayBufferView(P)){if(P=(Z=new IV(P)).imgData,H=Z.bits,X=Z.colorSpace,gt=Z.colors,[4,6].indexOf(Z.colorType)!==-1){if(Z.bits===8){yt=(Mt=Z.pixelBitlength==32?new Uint32Array(Z.decodePixels().buffer):Z.pixelBitlength==16?new Uint16Array(Z.decodePixels().buffer):new Uint8Array(Z.decodePixels().buffer)).length,zt=new Uint8Array(yt*Z.colors),Ut=new Uint8Array(yt);var re,Yt=Z.pixelBitlength-Z.bits;for(Lt=0,bt=0;Lt<yt;Lt++){for(pt=Mt[Lt],re=0;re<Yt;)zt[bt++]=pt>>>re&255,re+=Z.bits;Ut[Lt]=pt>>>re&255}}if(Z.bits===16){yt=(Mt=new Uint32Array(Z.decodePixels().buffer)).length,zt=new Uint8Array(yt*(32/Z.pixelBitlength)*Z.colors),Ut=new Uint8Array(yt*(32/Z.pixelBitlength)),at=Z.colors>1,Lt=0,bt=0;for(var ce=0;Lt<yt;)pt=Mt[Lt++],zt[bt++]=pt>>>0&255,at&&(zt[bt++]=pt>>>16&255,pt=Mt[Lt++],zt[bt++]=pt>>>0&255),Ut[ce++]=pt>>>16&255;H=8}N!==i.image_compression.NONE&&t()?(P=e(zt,Z.width*Z.colors,Z.colors,N),Ft=e(Ut,Z.width,1,N)):(P=zt,Ft=Ut,ee=void 0)}if(Z.colorType===3&&(X=this.color_spaces.INDEXED,Et=Z.palette,Z.transparency.indexed)){var le=Z.transparency.indexed,Be=0;for(Lt=0,yt=le.length;Lt<yt;++Lt)Be+=le[Lt];if((Be/=255)===yt-1&&le.indexOf(0)!==-1)ot=[le.indexOf(0)];else if(Be!==yt){for(Mt=Z.decodePixels(),Ut=new Uint8Array(Mt.length),Lt=0,yt=Mt.length;Lt<yt;Lt++)Ut[Lt]=le[Mt[Lt]];Ft=e(Ut,Z.width,1)}}var nt=function(St){var Tt;switch(St){case i.image_compression.FAST:Tt=11;break;case i.image_compression.MEDIUM:Tt=13;break;case i.image_compression.SLOW:Tt=14;break;default:Tt=12}return Tt}(N);return ee===this.decode.FLATE_DECODE&&(ie="/Predictor "+nt+" "),ie+="/Colors "+gt+" /BitsPerComponent "+H+" /Columns "+Z.width,(this.__addimage__.isArrayBuffer(P)||this.__addimage__.isArrayBufferView(P))&&(P=this.__addimage__.arrayBufferToBinaryString(P)),(Ft&&this.__addimage__.isArrayBuffer(Ft)||this.__addimage__.isArrayBufferView(Ft))&&(Ft=this.__addimage__.arrayBufferToBinaryString(Ft)),{alias:z,data:P,index:I,filter:ee,decodeParameters:ie,transparency:ot,palette:Et,sMask:Ft,predictor:nt,width:Z.width,height:Z.height,bitsPerComponent:H,colorSpace:X}}}})(Mi.API),function(i){i.processGIF89A=function(t,e,r,n){var o=new LV(t),c=o.width,l=o.height,_=[];o.decodeAndBlitFrameRGBA(0,_);var v={data:_,width:c,height:l},S=new $_(100).encode(v,100);return i.processJPEG.call(this,S,e,r,n)},i.processGIF87A=i.processGIF89A}(Mi.API),gl.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var t=0;t<i;t++){var e=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:n,green:r,blue:e,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},gl.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[i]()}catch(e){Wr.log("bit decode error:"+e)}},gl.prototype.bit1=function(){var i,t=Math.ceil(this.width/8),e=t%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,n=0;n<t;n++)for(var o=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+8*n*4,l=0;l<8&&8*n+l<this.width;l++){var _=this.palette[o>>7-l&1];this.data[c+4*l]=_.blue,this.data[c+4*l+1]=_.green,this.data[c+4*l+2]=_.red,this.data[c+4*l+3]=255}e!==0&&(this.pos+=4-e)}},gl.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),t=i%4,e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,n=0;n<i;n++){var o=this.datav.getUint8(this.pos++,!0),c=r*this.width*4+2*n*4,l=o>>4,_=15&o,v=this.palette[l];if(this.data[c]=v.blue,this.data[c+1]=v.green,this.data[c+2]=v.red,this.data[c+3]=255,2*n+1>=this.width)break;v=this.palette[_],this.data[c+4]=v.blue,this.data[c+4+1]=v.green,this.data[c+4+2]=v.red,this.data[c+4+3]=255}t!==0&&(this.pos+=4-t)}},gl.prototype.bit8=function(){for(var i=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*r;if(n<this.palette.length){var c=this.palette[n];this.data[o]=c.red,this.data[o+1]=c.green,this.data[o+2]=c.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}i!==0&&(this.pos+=4-i)}},gl.prototype.bit15=function(){for(var i=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var c=(o&t)/t*255|0,l=(o>>5&t)/t*255|0,_=(o>>10&t)/t*255|0,v=o>>15?255:0,S=r*this.width*4+4*n;this.data[S]=_,this.data[S+1]=l,this.data[S+2]=c,this.data[S+3]=v}this.pos+=i}},gl.prototype.bit16=function(){for(var i=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var c=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(c&t)/t*255|0,_=(c>>5&e)/e*255|0,v=(c>>11)/t*255|0,S=n*this.width*4+4*o;this.data[S]=v,this.data[S+1]=_,this.data[S+2]=l,this.data[S+3]=255}this.pos+=i}},gl.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),c=t*this.width*4+4*e;this.data[c]=o,this.data[c+1]=n,this.data[c+2]=r,this.data[c+3]=255}this.pos+=this.width%4}},gl.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var t=this.bottom_up?i:this.height-1-i,e=0;e<this.width;e++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),c=this.datav.getUint8(this.pos++,!0),l=t*this.width*4+4*e;this.data[l]=o,this.data[l+1]=n,this.data[l+2]=r,this.data[l+3]=c}},gl.prototype.getData=function(){return this.data},function(i){i.processBMP=function(t,e,r,n){var o=new gl(t,!1),c=o.width,l=o.height,_={data:o.getData(),width:c,height:l},v=new $_(100).encode(_,100);return i.processJPEG.call(this,v,e,r,n)}}(Mi.API),e3.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(t,e,r,n){var o=new e3(t),c=o.width,l=o.height,_={data:o.getData(),width:c,height:l},v=new $_(100).encode(_,100);return i.processJPEG.call(this,v,e,r,n)}}(Mi.API),Mi.API.processRGBA=function(i,t,e){for(var r=i.data,n=r.length,o=new Uint8Array(n/4*3),c=new Uint8Array(n/4),l=0,_=0,v=0;v<n;v+=4){var S=r[v],T=r[v+1],P=r[v+2],I=r[v+3];o[l++]=S,o[l++]=T,o[l++]=P,c[_++]=I}var z=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(c),data:z,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},Mi.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Sd=Mi.API,zm=Sd.getCharWidthsArray=function(i,t){var e,r,n=(t=t||{}).font||this.internal.getFont(),o=t.fontSize||this.internal.getFontSize(),c=t.charSpace||this.internal.getCharSpace(),l=t.widths?t.widths:n.metadata.Unicode.widths,_=l.fof?l.fof:1,v=t.kerning?t.kerning:n.metadata.Unicode.kerning,S=v.fof?v.fof:1,T=t.doKerning!==!1,P=0,I=i.length,z=0,N=l[0]||_,X=[];for(e=0;e<I;e++)r=i.charCodeAt(e),typeof n.metadata.widthOfString=="function"?X.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(r))+c*(1e3/o)||0)/1e3):(P=T&&Or(v[r])==="object"&&!isNaN(parseInt(v[r][z],10))?v[r][z]/S:0,X.push((l[r]||N)/_+P)),z=r;return X},J5=Sd.getStringUnitWidth=function(i,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),n=t.charSpace||this.internal.getCharSpace();return Sd.processArabic&&(i=Sd.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,e,n)/e:zm.apply(this,arguments).reduce(function(o,c){return o+c},0)},K5=function(i,t,e,r){for(var n=[],o=0,c=i.length,l=0;o!==c&&l+t[o]<e;)l+=t[o],o++;n.push(i.slice(0,o));var _=o;for(l=0;o!==c;)l+t[o]>r&&(n.push(i.slice(_,o)),l=0,_=o),l+=t[o],o++;return _!==o&&n.push(i.slice(_,o)),n},Q5=function(i,t,e){e||(e={});var r,n,o,c,l,_,v,S=[],T=[S],P=e.textIndent||0,I=0,z=0,N=i.split(" "),X=zm.apply(this,[" ",e])[0];if(_=e.lineIndent===-1?N[0].length+2:e.lineIndent||0){var H=Array(_).join(" "),Z=[];N.map(function(gt){(gt=gt.split(/\s*\n/)).length>1?Z=Z.concat(gt.map(function(Et,Ft){return(Ft&&Et.length?`
`:"")+Et})):Z.push(gt[0])}),N=Z,_=J5.apply(this,[H,e])}for(o=0,c=N.length;o<c;o++){var ot=0;if(r=N[o],_&&r[0]==`
`&&(r=r.substr(1),ot=1),P+I+(z=(n=zm.apply(this,[r,e])).reduce(function(gt,Et){return gt+Et},0))>t||ot){if(z>t){for(l=K5.apply(this,[r,n,t-(P+I),t]),S.push(l.shift()),S=[l.pop()];l.length;)T.push([l.shift()]);z=n.slice(r.length-(S[0]?S[0].length:0)).reduce(function(gt,Et){return gt+Et},0)}else S=[r];T.push(S),P=z+_,I=X}else S.push(r),P+=I+z,I=X}return v=_?function(gt,Et){return(Et?H:"")+gt.join(" ")}:function(gt){return gt.join(" ")},T.map(v)},Sd.splitTextToSize=function(i,t,e){var r,n=(e=e||{}).fontSize||this.internal.getFontSize(),o=(function(S){if(S.widths&&S.kerning)return{widths:S.widths,kerning:S.kerning};var T=this.internal.getFont(S.fontName,S.fontStyle);return T.metadata.Unicode?{widths:T.metadata.Unicode.widths||{0:1},kerning:T.metadata.Unicode.kerning||{}}:{font:T.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var c=1*this.internal.scaleFactor*t/n;o.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=e.lineIndent;var l,_,v=[];for(l=0,_=r.length;l<_;l++)v=v.concat(Q5.apply(this,[r[l],c,o]));return v},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",e={},r={},n=0;n<t.length;n++)e[t[n]]="0123456789abcdef"[n],r["0123456789abcdef"[n]]=t[n];var o=function(T){return"0x"+parseInt(T,10).toString(16)},c=i.__fontmetrics__.compress=function(T){var P,I,z,N,X=["{"];for(var H in T){if(P=T[H],isNaN(parseInt(H,10))?I="'"+H+"'":(H=parseInt(H,10),I=(I=o(H).slice(2)).slice(0,-1)+r[I.slice(-1)]),typeof P=="number")P<0?(z=o(P).slice(3),N="-"):(z=o(P).slice(2),N=""),z=N+z.slice(0,-1)+r[z.slice(-1)];else{if(Or(P)!=="object")throw new Error("Don't know what to do with value type "+Or(P)+".");z=c(P)}X.push(I+z)}return X.push("}"),X.join("")},l=i.__fontmetrics__.uncompress=function(T){if(typeof T!="string")throw new Error("Invalid argument passed to uncompress.");for(var P,I,z,N,X={},H=1,Z=X,ot=[],gt="",Et="",Ft=T.length-1,Mt=1;Mt<Ft;Mt+=1)(N=T[Mt])=="'"?P?(z=P.join(""),P=void 0):P=[]:P?P.push(N):N=="{"?(ot.push([Z,z]),Z={},z=void 0):N=="}"?((I=ot.pop())[0][I[1]]=Z,z=void 0,Z=I[0]):N=="-"?H=-1:z===void 0?e.hasOwnProperty(N)?(gt+=e[N],z=parseInt(gt,16)*H,H=1,gt=""):gt+=N:e.hasOwnProperty(N)?(Et+=e[N],Z[z]=parseInt(Et,16)*H,H=1,z=void 0,Et=""):Et+=N;return X},_={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},v={Unicode:{Courier:_,"Courier-Bold":_,"Courier-BoldOblique":_,"Courier-Oblique":_,Helvetica:_,"Helvetica-Bold":_,"Helvetica-BoldOblique":_,"Helvetica-Oblique":_,"Times-Roman":_,"Times-Bold":_,"Times-BoldItalic":_,"Times-Italic":_}},S={Unicode:{"Courier-Oblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":l("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":l("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":l("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":l("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(T){var P=T.font,I=S.Unicode[P.postScriptName];I&&(P.metadata.Unicode={},P.metadata.Unicode.widths=I.widths,P.metadata.Unicode.kerning=I.kerning);var z=v.Unicode[P.postScriptName];z&&(P.metadata.Unicode.encoding=z,P.encoding=z.codePages[0])}])}(Mi.API),function(i){var t=function(e){for(var r=e.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=e.charCodeAt(o);return n};i.API.events.push(["addFont",function(e){var r=void 0,n=e.font,o=e.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(r=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(c,l){l=/^\x00\x01\x00\x00/.test(l)?t(l):t(uf(l)),c.metadata=i.API.TTFFont.open(l),c.metadata.Unicode=c.metadata.Unicode||{encoding:{},kerning:{},widths:[]},c.metadata.glyIdsUsed=[0]})(n,r)}}])}(Mi),function(i){function t(){return(Bi.canvg?Promise.resolve(Bi.canvg):ey(()=>import("./index.es-BWyxJuJN-HCk0JDTR-grL4vibL.js"),[])).catch(function(e){return Promise.reject(new Error("Could not load canvg: "+e))}).then(function(e){return e.default?e.default:e})}Mi.API.addSvgAsImage=function(e,r,n,o,c,l,_,v){if(isNaN(r)||isNaN(n))throw Wr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(c))throw Wr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var S=document.createElement("canvas");S.width=o,S.height=c;var T=S.getContext("2d");T.fillStyle="#fff",T.fillRect(0,0,S.width,S.height);var P={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},I=this;return t().then(function(z){return z.fromString(T,e,P)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(z){return z.render(P)}).then(function(){I.addImage(S.toDataURL("image/jpeg",1),r,n,o,c,_,v)})}}(),Mi.API.putTotalPages=function(i){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(i,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(t,e);return this},Mi.API.viewerPreferences=function(i,t){var e;i=i||{},t=t||!1;var r,n,o,c={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},l=Object.keys(c),_=[],v=0,S=0,T=0;function P(z,N){var X,H=!1;for(X=0;X<z.length;X+=1)z[X]===N&&(H=!0);return H}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(c)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,i==="reset"||t===!0){var I=l.length;for(T=0;T<I;T+=1)e[l[T]].value=e[l[T]].defaultValue,e[l[T]].explicitSet=!1}if(Or(i)==="object"){for(n in i)if(o=i[n],P(l,n)&&o!==void 0){if(e[n].type==="boolean"&&typeof o=="boolean")e[n].value=o;else if(e[n].type==="name"&&P(e[n].valueSet,o))e[n].value=o;else if(e[n].type==="integer"&&Number.isInteger(o))e[n].value=o;else if(e[n].type==="array"){for(v=0;v<o.length;v+=1)if(r=!0,o[v].length===1&&typeof o[v][0]=="number")_.push(String(o[v]-1));else if(o[v].length>1){for(S=0;S<o[v].length;S+=1)typeof o[v][S]!="number"&&(r=!1);r===!0&&_.push([o[v][0]-1,o[v][1]-1].join(" "))}e[n].value="["+_.join(" ")+"]"}else e[n].value=e[n].defaultValue;e[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var z,N=[];for(z in e)e[z].explicitSet===!0&&(e[z].type==="name"?N.push("/"+z+" /"+e[z].value):N.push("/"+z+" "+e[z].value));N.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+N.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(i){var t=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(r)),c=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),l=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),_=unescape(encodeURIComponent("</x:xmpmeta>")),v=o.length+c.length+l.length+n.length+_.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+v+" >>"),this.internal.write("stream"),this.internal.write(n+o+c+l+_),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}}(Mi.API),function(i){var t=i.API,e=t.pdfEscape16=function(o,c){for(var l,_=c.metadata.Unicode.widths,v=["","0","00","000","0000"],S=[""],T=0,P=o.length;T<P;++T){if(l=c.metadata.characterToGlyph(o.charCodeAt(T)),c.metadata.glyIdsUsed.push(l),c.metadata.toUnicode[l]=o.charCodeAt(T),_.indexOf(l)==-1&&(_.push(l),_.push([parseInt(c.metadata.widthOfGlyph(l),10)])),l=="0")return S.join("");l=l.toString(16),S.push(v[4-l.length],l)}return S.join("")},r=function(o){var c,l,_,v,S,T,P;for(S=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,_=[],T=0,P=(l=Object.keys(o).sort(function(I,z){return I-z})).length;T<P;T++)c=l[T],_.length>=100&&(S+=`
`+_.length+` beginbfchar
`+_.join(`
`)+`
endbfchar`,_=[]),o[c]!==void 0&&o[c]!==null&&typeof o[c].toString=="function"&&(v=("0000"+o[c].toString(16)).slice(-4),c=("0000"+(+c).toString(16)).slice(-4),_.push("<"+c+"><"+v+">"));return _.length&&(S+=`
`+_.length+` beginbfchar
`+_.join(`
`)+`
endbfchar
`),S+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(o){(function(c){var l=c.font,_=c.out,v=c.newObject,S=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="Identity-H"){for(var T=l.metadata.Unicode.widths,P=l.metadata.subset.encode(l.metadata.glyIdsUsed,1),I="",z=0;z<P.length;z++)I+=String.fromCharCode(P[z]);var N=v();S({data:I,addLength1:!0,objectId:N}),_("endobj");var X=v();S({data:r(l.metadata.toUnicode),addLength1:!0,objectId:X}),_("endobj");var H=v();_("<<"),_("/Type /FontDescriptor"),_("/FontName /"+Cd(l.fontName)),_("/FontFile2 "+N+" 0 R"),_("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),_("/Flags "+l.metadata.flags),_("/StemV "+l.metadata.stemV),_("/ItalicAngle "+l.metadata.italicAngle),_("/Ascent "+l.metadata.ascender),_("/Descent "+l.metadata.decender),_("/CapHeight "+l.metadata.capHeight),_(">>"),_("endobj");var Z=v();_("<<"),_("/Type /Font"),_("/BaseFont /"+Cd(l.fontName)),_("/FontDescriptor "+H+" 0 R"),_("/W "+i.API.PDFObject.convert(T)),_("/CIDToGIDMap /Identity"),_("/DW 1000"),_("/Subtype /CIDFontType2"),_("/CIDSystemInfo"),_("<<"),_("/Supplement 0"),_("/Registry (Adobe)"),_("/Ordering ("+l.encoding+")"),_(">>"),_(">>"),_("endobj"),l.objectNumber=v(),_("<<"),_("/Type /Font"),_("/Subtype /Type0"),_("/ToUnicode "+X+" 0 R"),_("/BaseFont /"+Cd(l.fontName)),_("/Encoding /"+l.encoding),_("/DescendantFonts ["+Z+" 0 R]"),_(">>"),_("endobj"),l.isAlreadyPutted=!0}})(o)}]),t.events.push(["putFont",function(o){(function(c){var l=c.font,_=c.out,v=c.newObject,S=c.putStream;if(l.metadata instanceof i.API.TTFFont&&l.encoding==="WinAnsiEncoding"){for(var T=l.metadata.rawData,P="",I=0;I<T.length;I++)P+=String.fromCharCode(T[I]);var z=v();S({data:P,addLength1:!0,objectId:z}),_("endobj");var N=v();S({data:r(l.metadata.toUnicode),addLength1:!0,objectId:N}),_("endobj");var X=v();_("<<"),_("/Descent "+l.metadata.decender),_("/CapHeight "+l.metadata.capHeight),_("/StemV "+l.metadata.stemV),_("/Type /FontDescriptor"),_("/FontFile2 "+z+" 0 R"),_("/Flags 96"),_("/FontBBox "+i.API.PDFObject.convert(l.metadata.bbox)),_("/FontName /"+Cd(l.fontName)),_("/ItalicAngle "+l.metadata.italicAngle),_("/Ascent "+l.metadata.ascender),_(">>"),_("endobj"),l.objectNumber=v();for(var H=0;H<l.metadata.hmtx.widths.length;H++)l.metadata.hmtx.widths[H]=parseInt(l.metadata.hmtx.widths[H]*(1e3/l.metadata.head.unitsPerEm));_("<</Subtype/TrueType/Type/Font/ToUnicode "+N+" 0 R/BaseFont/"+Cd(l.fontName)+"/FontDescriptor "+X+" 0 R/Encoding/"+l.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(l.metadata.hmtx.widths)+">>"),_("endobj"),l.isAlreadyPutted=!0}})(o)}]);var n=function(o){var c,l=o.text||"",_=o.x,v=o.y,S=o.options||{},T=o.mutex||{},P=T.pdfEscape,I=T.activeFontKey,z=T.fonts,N=I,X="",H=0,Z="",ot=z[N].encoding;if(z[N].encoding!=="Identity-H")return{text:l,x:_,y:v,options:S,mutex:T};for(Z=l,N=I,Array.isArray(l)&&(Z=l[0]),H=0;H<Z.length;H+=1)z[N].metadata.hasOwnProperty("cmap")&&(c=z[N].metadata.cmap.unicode.codeMap[Z[H].charCodeAt(0)]),c||Z[H].charCodeAt(0)<256&&z[N].metadata.hasOwnProperty("Unicode")?X+=Z[H]:X+="";var gt="";return parseInt(N.slice(1))<14||ot==="WinAnsiEncoding"?gt=P(X,N).split("").map(function(Et){return Et.charCodeAt(0).toString(16)}).join(""):ot==="Identity-H"&&(gt=e(X,z[N])),T.isHex=!0,{text:gt,x:_,y:v,options:S,mutex:T}};t.events.push(["postProcessText",function(o){var c=o.text||"",l=[],_={text:c,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(c)){var v=0;for(v=0;v<c.length;v+=1)Array.isArray(c[v])&&c[v].length===3?l.push([n(Object.assign({},_,{text:c[v][0]})).text,c[v][1],c[v][2]]):l.push(n(Object.assign({},_,{text:c[v]})).text);o.text=l}else o.text=n(Object.assign({},_,{text:c})).text}])}(Mi),function(i){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},i.addFileToVFS=function(e,r){return t.call(this),this.internal.vFS[e]=r,this},i.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(Mi.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var n,o,c,l,_,v,S,T=t,P=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],I=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],z={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},N={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},X=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],H=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),Z=!1,ot=0;this.__bidiEngine__={};var gt=function(at){var pt=at.charCodeAt(),Lt=pt>>8,bt=N[Lt];return bt!==void 0?T[256*bt+(255&pt)]:Lt===252||Lt===253?"AL":H.test(Lt)?"L":Lt===8?"R":"N"},Et=function(at){for(var pt,Lt=0;Lt<at.length;Lt++){if((pt=gt(at.charAt(Lt)))==="L")return!1;if(pt==="R")return!0}return!1},Ft=function(at,pt,Lt,bt){var ee,ie,re,Yt,ce=pt[bt];switch(ce){case"L":case"R":Z=!1;break;case"N":case"AN":break;case"EN":Z&&(ce="AN");break;case"AL":Z=!0,ce="R";break;case"WS":ce="N";break;case"CS":bt<1||bt+1>=pt.length||(ee=Lt[bt-1])!=="EN"&&ee!=="AN"||(ie=pt[bt+1])!=="EN"&&ie!=="AN"?ce="N":Z&&(ie="AN"),ce=ie===ee?ie:"N";break;case"ES":ce=(ee=bt>0?Lt[bt-1]:"B")==="EN"&&bt+1<pt.length&&pt[bt+1]==="EN"?"EN":"N";break;case"ET":if(bt>0&&Lt[bt-1]==="EN"){ce="EN";break}if(Z){ce="N";break}for(re=bt+1,Yt=pt.length;re<Yt&&pt[re]==="ET";)re++;ce=re<Yt&&pt[re]==="EN"?"EN":"N";break;case"NSM":if(c&&!l){for(Yt=pt.length,re=bt+1;re<Yt&&pt[re]==="NSM";)re++;if(re<Yt){var le=at[bt],Be=le>=1425&&le<=2303||le===64286;if(ee=pt[re],Be&&(ee==="R"||ee==="AL")){ce="R";break}}}ce=bt<1||(ee=pt[bt-1])==="B"?"N":Lt[bt-1];break;case"B":Z=!1,n=!0,ce=ot;break;case"S":o=!0,ce="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":Z=!1;break;case"BN":ce="N"}return ce},Mt=function(at,pt,Lt){var bt=at.split("");return Lt&&yt(bt,Lt,{hiLevel:ot}),bt.reverse(),pt&&pt.reverse(),bt.join("")},yt=function(at,pt,Lt){var bt,ee,ie,re,Yt,ce=-1,le=at.length,Be=0,nt=[],St=ot?I:P,Tt=[];for(Z=!1,n=!1,o=!1,ee=0;ee<le;ee++)Tt[ee]=gt(at[ee]);for(ie=0;ie<le;ie++){if(Yt=Be,nt[ie]=Ft(at,Tt,nt,ie),bt=240&(Be=St[Yt][z[nt[ie]]]),Be&=15,pt[ie]=re=St[Be][5],bt>0)if(bt===16){for(ee=ce;ee<ie;ee++)pt[ee]=1;ce=-1}else ce=-1;if(St[Be][6])ce===-1&&(ce=ie);else if(ce>-1){for(ee=ce;ee<ie;ee++)pt[ee]=re;ce=-1}Tt[ie]==="B"&&(pt[ie]=0),Lt.hiLevel|=re}o&&function(jt,qt,Ht){for(var Jt=0;Jt<Ht;Jt++)if(jt[Jt]==="S"){qt[Jt]=ot;for(var $t=Jt-1;$t>=0&&jt[$t]==="WS";$t--)qt[$t]=ot}}(Tt,pt,le)},Ut=function(at,pt,Lt,bt,ee){if(!(ee.hiLevel<at)){if(at===1&&ot===1&&!n)return pt.reverse(),void(Lt&&Lt.reverse());for(var ie,re,Yt,ce,le=pt.length,Be=0;Be<le;){if(bt[Be]>=at){for(Yt=Be+1;Yt<le&&bt[Yt]>=at;)Yt++;for(ce=Be,re=Yt-1;ce<re;ce++,re--)ie=pt[ce],pt[ce]=pt[re],pt[re]=ie,Lt&&(ie=Lt[ce],Lt[ce]=Lt[re],Lt[re]=ie);Be=Yt}Be++}}},zt=function(at,pt,Lt){var bt=at.split(""),ee={hiLevel:ot};return Lt||(Lt=[]),yt(bt,Lt,ee),function(ie,re,Yt){if(Yt.hiLevel!==0&&S)for(var ce,le=0;le<ie.length;le++)re[le]===1&&(ce=X.indexOf(ie[le]))>=0&&(ie[le]=X[ce+1])}(bt,Lt,ee),Ut(2,bt,pt,Lt,ee),Ut(1,bt,pt,Lt,ee),bt.join("")};return this.__bidiEngine__.doBidiReorder=function(at,pt,Lt){if(function(ee,ie){if(ie)for(var re=0;re<ee.length;re++)ie[re]=re;l===void 0&&(l=Et(ee)),v===void 0&&(v=Et(ee))}(at,pt),c||!_||v)if(c&&_&&l^v)ot=l?1:0,at=Mt(at,pt,Lt);else if(!c&&_&&v)ot=l?1:0,at=zt(at,pt,Lt),at=Mt(at,pt);else if(!c||l||_||v){if(c&&!_&&l^v)at=Mt(at,pt),l?(ot=0,at=zt(at,pt,Lt)):(ot=1,at=zt(at,pt,Lt),at=Mt(at,pt));else if(c&&l&&!_&&v)ot=1,at=zt(at,pt,Lt),at=Mt(at,pt);else if(!c&&!_&&l^v){var bt=S;l?(ot=1,at=zt(at,pt,Lt),ot=0,S=!1,at=zt(at,pt,Lt),S=bt):(ot=0,at=zt(at,pt,Lt),at=Mt(at,pt),ot=1,S=!1,at=zt(at,pt,Lt),S=bt,at=Mt(at,pt))}}else ot=0,at=zt(at,pt,Lt);else ot=l?1:0,at=zt(at,pt,Lt);return at},this.__bidiEngine__.setOptions=function(at){at&&(c=at.isInputVisual,_=at.isOutputVisual,l=at.isInputRtl,v=at.isOutputRtl,S=at.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var n=r.text,o=(r.x,r.y,r.options||{}),c=(r.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,e.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var l=0;for(c=[],l=0;l<n.length;l+=1)Object.prototype.toString.call(n[l])==="[object Array]"?c.push([e.doBidiReorder(n[l][0]),n[l][1],n[l][2]]):c.push([e.doBidiReorder(n[l])]);r.text=c}else r.text=e.doBidiReorder(n);e.setOptions({isInputVisual:!0})}])}(Mi),Mi.API.TTFFont=function(){function i(t){var e;if(this.rawData=t,e=this.contents=new Zh(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new HV(this),this.registerTTF()}return i.open=function(t){return new i(t)},i.prototype.parse=function(){return this.directory=new MV(this.contents),this.head=new RV(this),this.name=new NV(this),this.cmap=new OE(this),this.toUnicode={},this.hhea=new kV(this),this.maxp=new zV(this),this.hmtx=new jV(this),this.post=new DV(this),this.os2=new FV(this),this.loca=new qV(this),this.glyf=new UV(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var t,e,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var c,l,_,v;for(v=[],c=0,l=(_=this.bbox).length;c<l;c++)t=_[c],v.push(Math.round(t*this.scaleFactor));return v}).call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(e=n>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},i.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},i.prototype.widthOfString=function(t,e,r){var n,o,c,l;for(c=0,o=0,l=(t=""+t).length;0<=l?o<l:o>l;o=0<=l?++o:--o)n=t.charCodeAt(o),c+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/e)||0;return c*(e/1e3)},i.prototype.lineHeight=function(t,e){var r;return e==null&&(e=!1),r=e?this.lineGap:0,(this.ascender+r-this.decender)/1e3*t},i}();var Pl,Zh=function(){function i(t){this.data=t??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(t){return this.data[this.pos++]=t},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},i.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},i.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},i.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},i.prototype.readString=function(t){var e,r;for(r=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)r[e]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(t){var e,r,n;for(n=[],e=0,r=t.length;0<=r?e<r:e>r;e=0<=r?++e:--e)n.push(this.writeByte(t.charCodeAt(e)));return n},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(t){return this.writeInt16(t)},i.prototype.readLongLong=function(){var t,e,r,n,o,c,l,_;return t=this.readByte(),e=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),c=this.readByte(),l=this.readByte(),_=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^c)+256*(255^l)+(255^_)+1):72057594037927940*t+281474976710656*e+1099511627776*r+4294967296*n+16777216*o+65536*c+256*l+_},i.prototype.writeLongLong=function(t){var e,r;return e=Math.floor(t/4294967296),r=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(t){return this.writeInt32(t)},i.prototype.read=function(t){var e,r;for(e=[],r=0;0<=t?r<t:r>t;r=0<=t?++r:--r)e.push(this.readByte());return e},i.prototype.write=function(t){var e,r,n,o;for(o=[],r=0,n=t.length;r<n;r++)e=t[r],o.push(this.writeByte(e));return o},i}(),MV=function(){var i;function t(e){var r,n,o;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)r={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[r.tag]=r}return t.prototype.encode=function(e){var r,n,o,c,l,_,v,S,T,P,I,z,N;for(N in I=Object.keys(e).length,_=Math.log(2),T=16*Math.floor(Math.log(I)/_),c=Math.floor(T/_),S=16*I-T,(n=new Zh).writeInt(this.scalarType),n.writeShort(I),n.writeShort(T),n.writeShort(c),n.writeShort(S),o=16*I,v=n.pos+o,l=null,z=[],e)for(P=e[N],n.writeString(N),n.writeInt(i(P)),n.writeInt(v),n.writeInt(P.length),z=z.concat(P),N==="head"&&(l=v),v+=P.length;v%4;)z.push(0),v++;return n.write(z),r=2981146554-i(n.data),n.pos=l+8,n.writeUInt32(r),n.data},i=function(e){var r,n,o,c;for(e=NE.call(e);e.length%4;)e.push(0);for(o=new Zh(e),n=0,r=0,c=e.length;r<c;r=r+=4)n+=o.readUInt32();return 4294967295&n},t}(),BV={}.hasOwnProperty,Sc=function(i,t){for(var e in t)BV.call(t,e)&&(i[e]=t[e]);function r(){this.constructor=i}return r.prototype=t.prototype,i.prototype=new r,i.__super__=t.prototype,i};Pl=function(){function i(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var RV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="head",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},t.prototype.encode=function(e){var r;return(r=new Zh).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(e),r.writeShort(this.glyphDataFormat),r.data},t}(),i3=function(){function i(t,e){var r,n,o,c,l,_,v,S,T,P,I,z,N,X,H,Z,ot;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),T=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(_=0;_<256;++_)this.codeMap[_]=t.readByte();break;case 4:for(I=t.readUInt16(),P=I/2,t.pos+=6,o=function(){var gt,Et;for(Et=[],_=gt=0;0<=P?gt<P:gt>P;_=0<=P?++gt:--gt)Et.push(t.readUInt16());return Et}(),t.pos+=2,N=function(){var gt,Et;for(Et=[],_=gt=0;0<=P?gt<P:gt>P;_=0<=P?++gt:--gt)Et.push(t.readUInt16());return Et}(),v=function(){var gt,Et;for(Et=[],_=gt=0;0<=P?gt<P:gt>P;_=0<=P?++gt:--gt)Et.push(t.readUInt16());return Et}(),S=function(){var gt,Et;for(Et=[],_=gt=0;0<=P?gt<P:gt>P;_=0<=P?++gt:--gt)Et.push(t.readUInt16());return Et}(),n=(this.length-t.pos+this.offset)/2,l=function(){var gt,Et;for(Et=[],_=gt=0;0<=n?gt<n:gt>n;_=0<=n?++gt:--gt)Et.push(t.readUInt16());return Et}(),_=H=0,ot=o.length;H<ot;_=++H)for(X=o[_],r=Z=z=N[_];z<=X?Z<=X:Z>=X;r=z<=X?++Z:--Z)S[_]===0?c=r+v[_]:(c=l[S[_]/2+(r-z)-(P-_)]||0)!==0&&(c+=v[_]),this.codeMap[r]=65535&c}t.pos=T}return i.encode=function(t,e){var r,n,o,c,l,_,v,S,T,P,I,z,N,X,H,Z,ot,gt,Et,Ft,Mt,yt,Ut,zt,at,pt,Lt,bt,ee,ie,re,Yt,ce,le,Be,nt,St,Tt,jt,qt,Ht,Jt,$t,Ae,Le,Fe;switch(bt=new Zh,c=Object.keys(t).sort(function(Ne,si){return Ne-si}),e){case"macroman":for(N=0,X=function(){var Ne=[];for(z=0;z<256;++z)Ne.push(0);return Ne}(),Z={0:0},o={},ee=0,ce=c.length;ee<ce;ee++)Z[$t=t[n=c[ee]]]==null&&(Z[$t]=++N),o[n]={old:t[n],new:Z[t[n]]},X[n]=Z[t[n]];return bt.writeUInt16(1),bt.writeUInt16(0),bt.writeUInt32(12),bt.writeUInt16(0),bt.writeUInt16(262),bt.writeUInt16(0),bt.write(X),{charMap:o,subtable:bt.data,maxGlyphID:N+1};case"unicode":for(pt=[],T=[],ot=0,Z={},r={},H=v=null,ie=0,le=c.length;ie<le;ie++)Z[Et=t[n=c[ie]]]==null&&(Z[Et]=++ot),r[n]={old:Et,new:Z[Et]},l=Z[Et]-n,H!=null&&l===v||(H&&T.push(H),pt.push(n),v=l),H=n;for(H&&T.push(H),T.push(65535),pt.push(65535),zt=2*(Ut=pt.length),yt=2*Math.pow(Math.log(Ut)/Math.LN2,2),P=Math.log(yt/2)/Math.LN2,Mt=2*Ut-yt,_=[],Ft=[],I=[],z=re=0,Be=pt.length;re<Be;z=++re){if(at=pt[z],S=T[z],at===65535){_.push(0),Ft.push(0);break}if(at-(Lt=r[at].new)>=32768)for(_.push(0),Ft.push(2*(I.length+Ut-z)),n=Yt=at;at<=S?Yt<=S:Yt>=S;n=at<=S?++Yt:--Yt)I.push(r[n].new);else _.push(Lt-at),Ft.push(0)}for(bt.writeUInt16(3),bt.writeUInt16(1),bt.writeUInt32(12),bt.writeUInt16(4),bt.writeUInt16(16+8*Ut+2*I.length),bt.writeUInt16(0),bt.writeUInt16(zt),bt.writeUInt16(yt),bt.writeUInt16(P),bt.writeUInt16(Mt),Ht=0,nt=T.length;Ht<nt;Ht++)n=T[Ht],bt.writeUInt16(n);for(bt.writeUInt16(0),Jt=0,St=pt.length;Jt<St;Jt++)n=pt[Jt],bt.writeUInt16(n);for(Ae=0,Tt=_.length;Ae<Tt;Ae++)l=_[Ae],bt.writeUInt16(l);for(Le=0,jt=Ft.length;Le<jt;Le++)gt=Ft[Le],bt.writeUInt16(gt);for(Fe=0,qt=I.length;Fe<qt;Fe++)N=I[Fe],bt.writeUInt16(N);return{charMap:r,subtable:bt.data,maxGlyphID:ot+1}}},i}(),OE=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="cmap",t.prototype.parse=function(e){var r,n,o;for(e.pos=this.offset,this.version=e.readUInt16(),o=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)r=new i3(e,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},t.encode=function(e,r){var n,o;return r==null&&(r="macroman"),n=i3.encode(e,r),(o=new Zh).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},t}(),kV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="hhea",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},t}(),FV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="OS/2",t.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(e.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},t}(),DV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="post",t.prototype.parse=function(e){var r,n,o;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:break;case 131072:var c;for(n=e.readUInt16(),this.glyphNameIndex=[],c=0;0<=n?c<n:c>n;c=0<=n?++c:--c)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],o=[];e.pos<this.offset+this.length;)r=e.readByte(),o.push(this.names.push(e.readString(r)));return o;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 196608:break;case 262144:return this.map=(function(){var l,_,v;for(v=[],c=l=0,_=this.file.maxp.numGlyphs;0<=_?l<_:l>_;c=0<=_?++l:--l)v.push(e.readUInt32());return v}).call(this)}},t}(),OV=function(i,t){this.raw=i,this.length=i.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},NV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="name",t.prototype.parse=function(e){var r,n,o,c,l,_,v,S,T,P,I;for(e.pos=this.offset,e.readShort(),r=e.readShort(),_=e.readShort(),n=[],c=0;0<=r?c<r:c>r;c=0<=r?++c:--c)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+_+e.readShort()});for(v={},c=T=0,P=n.length;T<P;c=++T)o=n[c],e.pos=o.offset,S=e.readString(o.length),l=new OV(S,o),v[I=o.nameID]==null&&(v[I]=[]),v[o.nameID].push(l);this.strings=v,this.copyright=v[0],this.fontFamily=v[1],this.fontSubfamily=v[2],this.uniqueSubfamily=v[3],this.fontName=v[4],this.version=v[5];try{this.postscriptName=v[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=v[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=v[7],this.manufacturer=v[8],this.designer=v[9],this.description=v[10],this.vendorUrl=v[11],this.designerUrl=v[12],this.license=v[13],this.licenseUrl=v[14],this.preferredFamily=v[15],this.preferredSubfamily=v[17],this.compatibleFull=v[18],this.sampleText=v[19]},t}(),zV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="maxp",t.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},t}(),jV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="hmtx",t.prototype.parse=function(e){var r,n,o,c,l,_,v;for(e.pos=this.offset,this.metrics=[],r=0,_=this.file.hhea.numberOfMetrics;0<=_?r<_:r>_;r=0<=_?++r:--r)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var S,T;for(T=[],r=S=0;0<=o?S<o:S>o;r=0<=o?++S:--S)T.push(e.readInt16());return T}(),this.widths=(function(){var S,T,P,I;for(I=[],S=0,T=(P=this.metrics).length;S<T;S++)c=P[S],I.push(c.advance);return I}).call(this),n=this.widths[this.widths.length-1],v=[],r=l=0;0<=o?l<o:l>o;r=0<=o?++l:--l)v.push(this.widths.push(n));return v},t.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},t}(),NE=[].slice,UV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(e){var r,n,o,c,l,_,v,S,T,P;return e in this.cache?this.cache[e]:(c=this.file.loca,r=this.file.contents,n=c.indexOf(e),(o=c.lengthOf(e))===0?this.cache[e]=null:(r.pos=this.offset+n,l=(_=new Zh(r.read(o))).readShort(),S=_.readShort(),P=_.readShort(),v=_.readShort(),T=_.readShort(),this.cache[e]=l===-1?new VV(_,S,P,v,T):new GV(_,l,S,P,v,T),this.cache[e]))},t.prototype.encode=function(e,r,n){var o,c,l,_,v;for(l=[],c=[],_=0,v=r.length;_<v;_++)o=e[r[_]],c.push(l.length),o&&(l=l.concat(o.encode(n)));return c.push(l.length),{table:l,offsets:c}},t}(),GV=function(){function i(t,e,r,n,o,c){this.raw=t,this.numberOfContours=e,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=c,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),VV=function(){function i(t,e,r,n,o){var c,l;for(this.raw=t,this.xMin=e,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],c=this.raw;l=c.readShort(),this.glyphOffsets.push(c.pos),this.glyphIDs.push(c.readUInt16()),32&l;)c.pos+=1&l?4:2,128&l?c.pos+=8:64&l?c.pos+=4:8&l&&(c.pos+=2)}return i.prototype.encode=function(){var t,e,r;for(e=new Zh(NE.call(this.raw.data)),t=0,r=this.glyphIDs.length;t<r;++t)e.pos=this.glyphOffsets[t];return e.data},i}(),qV=function(i){function t(){return t.__super__.constructor.apply(this,arguments)}return Sc(t,Pl),t.prototype.tag="loca",t.prototype.parse=function(e){var r,n;return e.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var o,c;for(c=[],n=0,o=this.length;n<o;n+=2)c.push(2*e.readUInt16());return c}).call(this):(function(){var o,c;for(c=[],n=0,o=this.length;n<o;n+=4)c.push(e.readUInt32());return c}).call(this)},t.prototype.indexOf=function(e){return this.offsets[e]},t.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},t.prototype.encode=function(e,r){for(var n=new Uint32Array(this.offsets.length),o=0,c=0,l=0;l<n.length;++l)if(n[l]=o,c<r.length&&r[c]==l){++c,n[l]=o;var _=this.offsets[l],v=this.offsets[l+1]-_;v>0&&(o+=v)}for(var S=new Array(4*n.length),T=0;T<n.length;++T)S[4*T+3]=255&n[T],S[4*T+2]=(65280&n[T])>>8,S[4*T+1]=(16711680&n[T])>>16,S[4*T]=(4278190080&n[T])>>24;return S},t}(),HV=function(){function i(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var t,e,r,n,o;for(e in n=this.font.cmap.tables[0].codeMap,t={},o=this.subset)r=o[e],t[e]=n[r];return t},i.prototype.glyphsFor=function(t){var e,r,n,o,c,l,_;for(n={},c=0,l=t.length;c<l;c++)n[o=t[c]]=this.font.glyf.glyphFor(o);for(o in e=[],n)(r=n[o])!=null&&r.compound&&e.push.apply(e,r.glyphIDs);if(e.length>0)for(o in _=this.glyphsFor(e))r=_[o],n[o]=r;return n},i.prototype.encode=function(t,e){var r,n,o,c,l,_,v,S,T,P,I,z,N,X,H;for(n in r=OE.encode(this.generateCmap(),"unicode"),c=this.glyphsFor(t),I={0:0},H=r.charMap)I[(_=H[n]).old]=_.new;for(z in P=r.maxGlyphID,c)z in I||(I[z]=P++);return S=function(Z){var ot,gt;for(ot in gt={},Z)gt[Z[ot]]=ot;return gt}(I),T=Object.keys(S).sort(function(Z,ot){return Z-ot}),N=function(){var Z,ot,gt;for(gt=[],Z=0,ot=T.length;Z<ot;Z++)l=T[Z],gt.push(S[l]);return gt}(),o=this.font.glyf.encode(c,N,I),v=this.font.loca.encode(o.offsets,N),X={cmap:this.font.cmap.raw(),glyf:o.table,loca:v,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(X["OS/2"]=this.font.os2.raw()),this.font.directory.encode(X)},i}();Mi.API.PDFObject=function(){var i;function t(){}return i=function(e,r){return(Array(r+1).join("0")+e).slice(-r)},t.convert=function(e){var r,n,o,c;if(Array.isArray(e))return"["+function(){var l,_,v;for(v=[],l=0,_=e.length;l<_;l++)r=e[l],v.push(t.convert(r));return v}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+i(e.getUTCFullYear(),4)+i(e.getUTCMonth(),2)+i(e.getUTCDate(),2)+i(e.getUTCHours(),2)+i(e.getUTCMinutes(),2)+i(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(n in o=["<<"],e)c=e[n],o.push("/"+n+" "+t.convert(c));return o.push(">>"),o.join(`
`)}return""+e},t}();const kv={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Fv={textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]};class WV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Iu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Jc.PNG,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:tp.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:"maplibregl-marker",_=arguments.length>7&&arguments[7]!==void 0?arguments[7]:kv,v=arguments.length>8&&arguments[8]!==void 0?arguments[8]:"maplibregl-ctrl-attrib-inner",S=arguments.length>9&&arguments[9]!==void 0?arguments[9]:Fv;mr(this,"map"),mr(this,"width"),mr(this,"height"),mr(this,"dpi"),mr(this,"format"),mr(this,"unit"),mr(this,"fileName"),mr(this,"markerClassName"),mr(this,"markerCirclePaint"),mr(this,"attributionClassName"),mr(this,"attributionStyle"),this.map=t,this.width=e[0],this.height=e[1],this.dpi=r,this.format=n,this.unit=o,this.fileName=c,this.markerClassName=l,this.markerCirclePaint=_,this.attributionClassName=v,this.attributionStyle=S}renderMapPost(t){return t}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(t){const e=this.getMarkers();for(let r=0;r<e.length;r++){const n=e.item(r);if(!n)continue;const o=n.getAttribute("style");if(!o)continue;const c=/translate\(([^,]+)px,\s*([^,]+)px\)/,l=o.match(c);if(!l)continue;const _=parseInt(l[1]),v=parseInt(l[2]),S=this.map.unproject([_,v]),T=`point${r}`;t.addSource(T,{type:"geojson",data:{type:"Point",coordinates:[S.lng,S.lat]}}),t.addLayer({id:T,source:T,type:"circle",paint:this.markerCirclePaint})}return t}generate(){const t=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const e=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return t.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),r.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const l=o.sources;Object.keys(l).forEach(_=>{const v=l[_];Object.keys(v).forEach(S=>{v[S]||delete v[S]})})}let c=this.getRenderedMap(n,o);c.once("idle",()=>{this.addAttributions(c)?c.once("idle",()=>{c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,r,e):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,r,e)}))}):(c=this.renderMapPost(c),this.getMarkers().length===0?this.exportImage(c,r,e):(c=this.renderMarkers(c),c.once("idle",()=>{this.exportImage(c,r,e)})))})}stripHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}addAttributions(t){if(!this.map.getStyle().glyphs)return!1;const e=t.getContainer(),r=parseInt(e.style.width.replace("px",""))-5,n=parseInt(e.style.height.replace("px",""))-5,o=[r,n],c=t.unproject(o),l=e.getElementsByClassName(this.attributionClassName),_=[];if((l==null?void 0:l.length)>0){const I=l.item(0);if(I)for(let z=0;z<I.children.length;z++){const N=I.children.item(z);N&&_.push(this.stripHtml(N.outerHTML))}}else{const I=this.map.getStyle().sources;Object.keys(I).forEach(z=>{const N=I[z];if("attribution"in N){const X=N.attribution;_.push(this.stripHtml(X))}})}if(_.length===0)return!1;const v=_.join(" | "),S="attribution";t.addSource(S,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[c.lng,c.lat]},properties:{attribution:v}}});const T=this.map.getStyle().layers.filter(I=>I.type==="symbol"&&I.layout&&"text-font"in I.layout),P=T.length>0&&T[0].layout?T[0].layout["text-font"]:this.attributionStyle.fallbackTextFont;return t.addLayer({id:S,source:S,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":P,"text-max-width":parseInt(`${r/this.attributionStyle.textSize}`),"text-anchor":"bottom-right","text-justify":"right","text-size":this.attributionStyle.textSize},paint:{"text-halo-color":this.attributionStyle.textHaloColor,"text-halo-width":this.attributionStyle.textHaloWidth,"text-color":this.attributionStyle.textColor}}),!0}exportImage(t,e,r){var n;const o=t.getCanvas(),c=`${this.fileName}.${this.format}`;switch(this.format){case Jc.PNG:this.toPNG(o,c);break;case Jc.JPEG:this.toJPEG(o,c);break;case Jc.PDF:this.toPDF(t,c);break;case Jc.SVG:this.toSVG(o,c);break;default:console.error(`Invalid file format: ${this.format}`);break}t.remove(),(n=e.parentNode)==null||n.removeChild(e),Object.defineProperty(window,"devicePixelRatio",{get(){return r}}),e.remove(),JsLoadingOverlay.hide()}toPNG(t,e){const r=document.createElement("a");r.href=t.toDataURL(),r.download=e,r.click(),r.remove()}toJPEG(t,e){const r=t.toDataURL("image/jpeg",.85),n=document.createElement("a");n.href=r,n.download=e,n.click(),n.remove()}toPDF(t,e){const r=t.getCanvas(),n=new Mi({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:c}=t.getCenter();n.setProperties({title:t.getStyle().name,subject:`center: [${o}, ${c}], zoom: ${t.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(e)}toSVG(t,e){const r=t.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),c=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${n}" height="${o}"></image>
    </svg>`,l=document.createElement("a");l.href=`data:application/xml,${encodeURIComponent(c)}`,l.download=e,l.click(),l.remove()}toPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===tp.mm&&(e/=25.4),`${e*t}px`}}class XV extends WV{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Iu.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Jc.PNG,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:tp.mm,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map",l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:kv,_=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Fv;super(t,e,r,n,o,c,"maplibregl-marker",l,"maplibregl-ctrl-attrib-inner",_)}getRenderedMap(t,e){const r=new E3.Map({container:t,style:e,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(r.setMaxPitch(85),r.setPitch(this.map.getPitch()));const n=(this.map.style.imageManager||{}).images||[];return Object.keys(n).forEach(o=>{r.addImage(o,n[o].data)}),r}renderMapPost(t){const e=this.map.getTerrain();return e&&t.setTerrain({source:e.source,exaggeration:e.exaggeration}),t}}class ZV{constructor(t){mr(this,"controlContainer"),mr(this,"exportContainer"),mr(this,"crosshair"),mr(this,"printableArea"),mr(this,"map"),mr(this,"exportButton"),mr(this,"options",{PageSize:Iu.A4,PageOrientation:ef.Landscape,Format:Jc.PDF,DPI:Zy[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Iu),Filename:"map",markerCirclePaint:kv,attributionStyle:Fv}),mr(this,"MAPLIB_CSS_PREFIX","maplibregl"),t&&(this.options=Object.assign(this.options,t)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const t=this.options.Local??"en";return $G(t)}onAdd(t){var e;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const n={};(e=this.options.AllowedSizes)==null||e.forEach(S=>{Iu[S]&&(n[S]=Iu[S])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(S,T)=>JSON.stringify(S[T]));r.appendChild(o);const c=this.createSelection(ef,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(S,T)=>S[T]);r.appendChild(c);const l=this.createSelection(Jc,this.getTranslation().Format,"format-type",this.options.Format,(S,T)=>S[T]);r.appendChild(l);const _=this.createSelection(Zy,this.getTranslation().DPI,"dpi-type",this.options.DPI,(S,T)=>S[T]);r.appendChild(_),this.exportContainer.appendChild(r);const v=document.createElement("button");return v.type="button",v.textContent=this.getTranslation().Generate,v.classList.add("generate-button"),v.addEventListener("click",()=>{const S=document.getElementById("mapbox-gl-export-page-size"),T=document.getElementById("mapbox-gl-export-page-orientation"),P=document.getElementById("mapbox-gl-export-format-type"),I=document.getElementById("mapbox-gl-export-dpi-type"),z=T.value;let N=JSON.parse(S.value);z===ef.Portrait&&(N=N.reverse()),this.generateMap(t,N,Number(I.value),P.value,tp.mm,this.options.Filename)}),this.exportContainer.appendChild(v),this.controlContainer}generateMap(t,e,r,n,o,c){new XV(t,e,r,n,o,c,this.options.markerCirclePaint,this.options.attributionStyle).generate()}createSelection(t,e,r,n,o){const c=document.createElement("label");c.textContent=e;const l=document.createElement("select");l.setAttribute("id",`mapbox-gl-export-${r}`),l.style.width="100%",Object.keys(t).forEach(T=>{const P=document.createElement("option");P.setAttribute("value",o(t,T)),P.appendChild(document.createTextNode(T)),P.setAttribute("name",r),n===t[T]&&(P.selected=!0),l.appendChild(P)}),l.addEventListener("change",()=>{this.updatePrintableArea()});const _=document.createElement("TR"),v=document.createElement("TD"),S=document.createElement("TD");return v.appendChild(c),S.appendChild(l),_.appendChild(v),_.appendChild(S),_}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(t){this.options.Crosshair===!0&&(t===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new kG(this.map),this.crosshair.create()))}togglePrintableArea(t){this.options.PrintableArea===!0&&(t===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new FG(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const t=document.getElementById("mapbox-gl-export-page-size"),e=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(t.value);e===ef.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}}var zE=YV,$V=Object.prototype.hasOwnProperty;function YV(){for(var i={},t=0;t<arguments.length;t++){var e=arguments[t];for(var r in e)$V.call(e,r)&&(i[r]=e[r])}return i}var jE={exports:{}};(function(i,t){(function(){var e={};i.exports=e,e.simpleFilter=function(r,n){return n.filter(function(o){return e.test(r,o)})},e.test=function(r,n){return e.match(r,n)!==null},e.match=function(r,n,o){o=o||{};var c=0,l=[],_=n.length,v=0,S=0,T=o.pre||"",P=o.post||"",I=o.caseSensitive&&n||n.toLowerCase(),z;r=o.caseSensitive&&r||r.toLowerCase();for(var N=0;N<_;N++)z=n[N],I[N]===r[c]?(z=T+z+P,c+=1,S+=1+S):S=0,v+=S,l[l.length]=z;return c===r.length?(v=I===r?1/0:v,{rendered:l.join(""),score:v}):null},e.filter=function(r,n,o){return!n||n.length===0?[]:typeof r!="string"?n:(o=o||{},n.reduce(function(c,l,_,v){var S=l;o.extract&&(S=o.extract(l));var T=e.match(r,S,o);return T!=null&&(c[c.length]={string:T.rendered,score:T.score,index:_,original:l}),c},[]).sort(function(c,l){var _=l.score-c.score;return _||c.index-l.index}))}})()})(jE);var JV=jE.exports,Zo=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Zo.prototype.show=function(){this.element.style.display="block"};Zo.prototype.hide=function(){this.element.style.display="none"};Zo.prototype.add=function(i){this.items.push(i)};Zo.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0};Zo.prototype.isEmpty=function(){return!this.items.length};Zo.prototype.isVisible=function(){return this.element.style.display==="block"};Zo.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()};Zo.prototype.drawItem=function(i,t){var e=document.createElement("li"),r=document.createElement("a");t&&(e.className+=" active"),r.innerHTML=i.string,e.appendChild(r),this.element.appendChild(e),e.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),e.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))};Zo.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()};Zo.prototype.move=function(i){this.active=i,this.draw()};Zo.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)};Zo.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)};Zo.prototype.drawError=function(i){var t=document.createElement("li");t.innerHTML=i,this.element.appendChild(t),this.show()};var KV=Zo,QV=zE,tq=JV,eq=KV,no=function(i,t,e){return e=e||{},this.options=QV({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},e),this.el=i,this.data=t||[],this.list=new eq(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};no.prototype.handleKeyUp=function(i,t){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),t.stopPropagation());return}this.handleInputChange(this.el.value)}};no.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};no.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};no.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(i.target.value)},100)}};no.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}).bind(this))};no.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};no.prototype.update=function(i){this.data=i,this.handleKeyUp()};no.prototype.clear=function(){this.data=[],this.list.clear()};no.prototype.normalize=function(i){return i=i.toLowerCase(),i};no.prototype.match=function(i,t){return i.indexOf(t)>-1};no.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};no.prototype.getCandidates=function(i){var t={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},e;this.options.filter?(e=tq.filter(this.query,this.data,t),e=e.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):e=this.data.map((function(r){var n=this.render(r);return{original:r,string:n}}).bind(this)),i(e)};no.prototype.getItemValue=function(i){return i};no.prototype.render=function(i,t){if(t)return t;for(var e=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(e),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;e=e.slice(0,n)+"<strong>"+e.slice(n,o)+"</strong>"+e.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return e};no.prototype.renderError=function(i){this.list.drawError(i)};var iq=no,UE=iq,rq=UE;typeof window<"u"&&(window.Suggestions=UE);var nq="Expected a function",r3=NaN,sq="[object Symbol]",oq=/^\s+|\s+$/g,aq=/^[-+]0x[0-9a-f]+$/i,lq=/^0b[01]+$/i,cq=/^0o[0-7]+$/i,hq=parseInt,uq=typeof Pd=="object"&&Pd&&Pd.Object===Object&&Pd,dq=typeof self=="object"&&self&&self.Object===Object&&self,pq=uq||dq||Function("return this")(),fq=Object.prototype,mq=fq.toString,gq=Math.max,_q=Math.min,Y_=function(){return pq.Date.now()};function yq(i,t,e){var r,n,o,c,l,_,v=0,S=!1,T=!1,P=!0;if(typeof i!="function")throw new TypeError(nq);t=n3(t)||0,a1(e)&&(S=!!e.leading,T="maxWait"in e,o=T?gq(n3(e.maxWait)||0,t):o,P="trailing"in e?!!e.trailing:P);function I(Ft){var Mt=r,yt=n;return r=n=void 0,v=Ft,c=i.apply(yt,Mt),c}function z(Ft){return v=Ft,l=setTimeout(H,t),S?I(Ft):c}function N(Ft){var Mt=Ft-_,yt=Ft-v,Ut=t-Mt;return T?_q(Ut,o-yt):Ut}function X(Ft){var Mt=Ft-_,yt=Ft-v;return _===void 0||Mt>=t||Mt<0||T&&yt>=o}function H(){var Ft=Y_();if(X(Ft))return Z(Ft);l=setTimeout(H,N(Ft))}function Z(Ft){return l=void 0,P&&r?I(Ft):(r=n=void 0,c)}function ot(){l!==void 0&&clearTimeout(l),v=0,r=_=n=l=void 0}function gt(){return l===void 0?c:Z(Y_())}function Et(){var Ft=Y_(),Mt=X(Ft);if(r=arguments,n=this,_=Ft,Mt){if(l===void 0)return z(_);if(T)return l=setTimeout(H,t),I(_)}return l===void 0&&(l=setTimeout(H,t)),c}return Et.cancel=ot,Et.flush=gt,Et}function a1(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function vq(i){return!!i&&typeof i=="object"}function bq(i){return typeof i=="symbol"||vq(i)&&mq.call(i)==sq}function n3(i){if(typeof i=="number")return i;if(bq(i))return r3;if(a1(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=a1(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(oq,"");var e=lq.test(i);return e||cq.test(i)?hq(i.slice(2),e?2:8):aq.test(i)?r3:+i}var xq=yq,Dv={exports:{}},Vd=typeof Reflect=="object"?Reflect:null,s3=Vd&&typeof Vd.apply=="function"?Vd.apply:function(i,t,e){return Function.prototype.apply.call(i,t,e)},ig;Vd&&typeof Vd.ownKeys=="function"?ig=Vd.ownKeys:Object.getOwnPropertySymbols?ig=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:ig=function(i){return Object.getOwnPropertyNames(i)};function wq(i){console&&console.warn&&console.warn(i)}var GE=Number.isNaN||function(i){return i!==i};function Vr(){Vr.init.call(this)}Dv.exports=Vr;Dv.exports.once=Tq;Vr.EventEmitter=Vr;Vr.prototype._events=void 0;Vr.prototype._eventsCount=0;Vr.prototype._maxListeners=void 0;var o3=10;function Zg(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Vr,"defaultMaxListeners",{enumerable:!0,get:function(){return o3},set:function(i){if(typeof i!="number"||i<0||GE(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");o3=i}});Vr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Vr.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||GE(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function VE(i){return i._maxListeners===void 0?Vr.defaultMaxListeners:i._maxListeners}Vr.prototype.getMaxListeners=function(){return VE(this)};Vr.prototype.emit=function(i){for(var t=[],e=1;e<arguments.length;e++)t.push(arguments[e]);var r=i==="error",n=this._events;if(n!==void 0)r=r&&n.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var l=n[i];if(l===void 0)return!1;if(typeof l=="function")s3(l,this,t);else for(var _=l.length,v=ZE(l,_),e=0;e<_;++e)s3(v[e],this,t);return!0};function qE(i,t,e,r){var n,o,c;if(Zg(e),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",t,e.listener?e.listener:e),o=i._events),c=o[t]),c===void 0)c=o[t]=e,++i._eventsCount;else if(typeof c=="function"?c=o[t]=r?[e,c]:[c,e]:r?c.unshift(e):c.push(e),n=VE(i),n>0&&c.length>n&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=i,l.type=t,l.count=c.length,wq(l)}return i}Vr.prototype.addListener=function(i,t){return qE(this,i,t,!1)};Vr.prototype.on=Vr.prototype.addListener;Vr.prototype.prependListener=function(i,t){return qE(this,i,t,!0)};function Sq(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function HE(i,t,e){var r={fired:!1,wrapFn:void 0,target:i,type:t,listener:e},n=Sq.bind(r);return n.listener=e,r.wrapFn=n,n}Vr.prototype.once=function(i,t){return Zg(t),this.on(i,HE(this,i,t)),this};Vr.prototype.prependOnceListener=function(i,t){return Zg(t),this.prependListener(i,HE(this,i,t)),this};Vr.prototype.removeListener=function(i,t){var e,r,n,o,c;if(Zg(t),r=this._events,r===void 0)return this;if(e=r[i],e===void 0)return this;if(e===t||e.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[i],r.removeListener&&this.emit("removeListener",i,e.listener||t));else if(typeof e!="function"){for(n=-1,o=e.length-1;o>=0;o--)if(e[o]===t||e[o].listener===t){c=e[o].listener,n=o;break}if(n<0)return this;n===0?e.shift():Aq(e,n),e.length===1&&(r[i]=e[0]),r.removeListener!==void 0&&this.emit("removeListener",i,c||t)}return this};Vr.prototype.off=Vr.prototype.removeListener;Vr.prototype.removeAllListeners=function(i){var t,e,r;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[i]),this;if(arguments.length===0){var n=Object.keys(e),o;for(r=0;r<n.length;++r)o=n[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=e[i],typeof t=="function")this.removeListener(i,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(i,t[r]);return this};function WE(i,t,e){var r=i._events;if(r===void 0)return[];var n=r[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?Eq(n):ZE(n,n.length)}Vr.prototype.listeners=function(i){return WE(this,i,!0)};Vr.prototype.rawListeners=function(i){return WE(this,i,!1)};Vr.listenerCount=function(i,t){return typeof i.listenerCount=="function"?i.listenerCount(t):XE.call(i,t)};Vr.prototype.listenerCount=XE;function XE(i){var t=this._events;if(t!==void 0){var e=t[i];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}Vr.prototype.eventNames=function(){return this._eventsCount>0?ig(this._events):[]};function ZE(i,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=i[r];return e}function Aq(i,t){for(;t+1<i.length;t++)i[t]=i[t+1];i.pop()}function Eq(i){for(var t=new Array(i.length),e=0;e<t.length;++e)t[e]=i[e].listener||i[e];return t}function Tq(i,t){return new Promise(function(e,r){function n(c){i.removeListener(t,o),r(c)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),e([].slice.call(arguments))}$E(i,t,o,{once:!0}),t!=="error"&&Cq(i,n,{once:!0})})}function Cq(i,t,e){typeof i.on=="function"&&$E(i,"error",t,e)}function $E(i,t,e,r){if(typeof i.on=="function")r.once?i.once(t,e):i.on(t,e);else if(typeof i.addEventListener=="function")i.addEventListener(t,function n(o){r.once&&i.removeEventListener(t,n),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var YE=Dv.exports,Pq={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Iq={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Lq={placeholder:Iq},JE={exports:{}};(function(i){(function(t,e,r){i.exports?i.exports=r():t[e]=r()})(Pd,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(_){return _.match(e)||[]}function n(_){return r(_).filter(function(v,S){return v&&S})}function o(_){return _=r(_),{language:_[1]||t,extlang:_[2]||t,script:_[3]||t,region:_[4]||t}}function c(_,v,S){Object.defineProperty(_,v,{value:S,enumerable:!0})}function l(_,v,S){function T(P){return r(P)[_]||t}c(T,"pattern",v),c(o,S,T)}return l(1,/^[a-zA-Z]{2,3}$/,"language"),l(2,/^[a-zA-Z]{3}$/,"extlang"),l(3,/^[a-zA-Z]{4}$/,"script"),l(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(o,"split",n),o})})(JE);var Mq=JE.exports,Bq=rq,Rq=xq,_a=zE,kq=YE.EventEmitter,a3=Pq,Fq=Lq,Dq=Mq;function KE(i,t){this._eventEmitter=new kq,this.options=_a({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}KE.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+t.splice(1,t.length).join(",")+"</div></div></div>"}else{var e=i.text,r=e.toLowerCase().indexOf(this.query.toLowerCase()),n=this.query.length,o=e.substring(0,r),c=e.substring(r,r+n),l=e.substring(r+n);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+o+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+c+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var t=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function t(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=r.onAdd();n.appendChild(o)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)t(this,i);else if(typeof i=="string"){var e=document.querySelectorAll(i);if(e.length===0)throw new Error("Element ",i,"not found.");if(e.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,e[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var e=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Rq(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(e),t.appendChild(this._inputEl),t.appendChild(r),this._typeahead=new Bq(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t},createIcon:function(i,t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),e.setAttribute("viewBox","0 0 18 18"),e.setAttribute("xml:space","preserve"),e.setAttribute("width",18),e.setAttribute("height",18),"innerHTML"in e)e.innerHTML=t;else{var r=document.createElement("div");r.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";var n=r.firstChild,o=n.firstChild;e.appendChild(o)}return e},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var t=(i.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)},_onKeyDown:function(i){var t=27,e=9;if(i.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,n=r?r.value:"";if(!n)return this.fresh=!0,i.keyCode!==e&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[e,t,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var t;if(this._removeResultMarkers(),i.properties&&a3[i.properties.short_code])t=_a({},this.options.flyTo),this._map&&this._map.fitBounds(a3[i.properties.short_code].bbox,t);else if(i.bbox){var e=i.bbox;t=_a({},this.options.flyTo),this._map&&this._map.fitBounds([[e[0],e[1]],[e[2],e[3]]],t)}else{var r={zoom:this.options.zoom};t=_a({},r,this.options.flyTo),i.center?t.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(t.center=i.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],t=this,e=i.reduce(function(r,n){return t.options[n]&&(["countries","types","language"].indexOf(n)>-1?r[n]=t.options[n].split(/[\s,]+/):r[n]=t.options[n],n==="proximity"&&t.options[n]&&typeof t.options[n].longitude=="number"&&typeof t.options[n].latitude=="number"&&(r[n]=[t.options[n].longitude,t.options[n].latitude])),r},{});return e},_geocode:function(i,t,e){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var c=i.split(/[\s(,)?]+/).map(function(v){return parseFloat(v,10)}).reverse();n.types&&n.types[0],n=_a(n,{query:c,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=_a(n,{query:i}),this.geocoderApi.getSuggestions?t?this.geocoderApi.searchByPlaceId&&e?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var l=[];this.options.localGeocoder&&(l=this.options.localGeocoder(i),l||(l=[]));var _=[];return o.catch((function(v){r=v}).bind(this)).then((function(v){this._loadingEl.style.display="none";var S={};return v?S=v:S={type:"FeatureCollection",features:[]},S.config=n,this.fresh&&(this.fresh=!1),S.features=S.features?l.concat(S.features):l,this.options.externalGeocoder?(_=this.options.externalGeocoder(i,S.features,n)||[],_.then(function(T){return S.features=S.features?T.concat(S.features):T,S},function(){return S})):S}).bind(this)).then((function(v){if(r)throw r;this.options.filter&&v.features.length&&(v.features=v.features.filter(this.options.filter));var S=[];v.suggestions?S=v.suggestions:v.place?S=[v.place]:S=v.features,S.length?(this._clearEl.style.display="block",this._typeahead.update(S),(!this.options.showResultsWhileTyping||t)&&this.options.showResultMarkers&&(v.features.length>0||v.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",v)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",v))}).bind(this)).catch((function(v){this._loadingEl.style.display="none",l.length&&this.options.localGeocoder||_.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(l)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:l}),this._eventEmitter.emit("error",{error:v})}).bind(this)),o},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var t=this;i.relatedTarget&&t._clear(i)},_onQueryResult:function(i){var t=i;if(t.features.length){var e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],t=Dq.language(i),e=Fq.placeholder[t];if(e)return e}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var t={padding:100},e=_a({},t,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(n){r.extend(n.geometry.coordinates)}),this._map.fitBounds(r.toArray(),e)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var t={color:"#4668F2"},e=_a({},t,this.options.marker);this.mapMarker=new this._maplibregl.Marker(e);var r;if(this.options.popup){var n={},o=_a({},n,this.options.popup);r=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var t={color:"#4668F2"},e=_a({},t,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);e=_a(e,{element:n})}var o=new this._maplibregl.Marker(_a({},e,{element:n})),c;if(this.options.popup){var l={},_=_a({},l,this.options.popup);c=new this._maplibregl.Popup(_).setHTML(this.options.popupRender(r))}r.center?(o.setLngLat(r.center).addTo(this._map),this.options.popup&&o.setPopup(c)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(o.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(c)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,t){return this._eventEmitter.on(i,t),this},off:function(i,t){return this._eventEmitter.removeListener(i,t),this}};var Oq=KE;const Nq=Mg(Oq),zq={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100,logoOpacity:.6},logoGencatOptions:{logoUrlColor:"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png",logoUrlWhite:"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100,logoOpacity:.6},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://eines.icgc.cat/recursos//images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTO3D",url:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{key:"ORTOHYBRID",url:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{key:"RASTER",substyles:{TOPO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},ADMIN:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},LIGHT:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},STANDARD:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},Simplified:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},ORTO:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},ORTOGREY:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},ORTOHYBRID:{url:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png",image:"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2023",key:"ortofoto_color_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2023",key:"ortofoto_infraroig_2023",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensals2023",key:"districtes_censals_2023"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensals2023",key:"seccions_censals_2023"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},jq={TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Uq={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Gq={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2023:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensals2023:"districtes_censals_2023",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensals2023:"seccions_censals_2023",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},Lu={defaultOptions:zq,Styles:jq,Terrains:Uq,Layers:Gq};class Vq{constructor(t){this.options=t||{}}onAdd(t){let e=Lu.defaultOptions;return this._map=t,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?e.logoIcgcOptions.logoUrlColor:e.logoIcgcOptions.logoUrlWhite,this._img1.width=e.logoIcgcOptions.logoWidth,this._img1.title=e.logoIcgcOptions.logoTitle,this._img1.style.opacity=e.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=e.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${e.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?e.logoGencatOptions.logoUrlColor:e.logoGencatOptions.logoUrlWhite,this._img2.width=e.logoGencatOptions.logoWidth,this._img2.title=e.logoGencatOptions.logoTitle,this._img2.style.opacity=e.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=e.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${e.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class qq{constructor(t){this.options=t||{}}onAdd(t){this._map=t,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const e=document.createElement("label");return e.classList.add("maplibregl-legend-title-label"),e.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(e),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var sp=QE.prototype,l1="WGS 84";function QE(i){i!==void 0&&(l1=i),this.setEllipsoid(l1)}sp.convertLatLngToUtm=function(i,t,e){var r;if(this.status)return"No ecclipsoid data associated with unknown datum: "+l1;if(!Number.isInteger(e))return"Precision is not integer number.";i=parseFloat(i),t=parseFloat(t);var n=t,o=this.toRadians(i),c=this.toRadians(n);n>=8&&n<=13&&i>54.5&&i<58||i>=56&&i<64&&n>=3&&n<12?r=32:(r=(n+180)/6+1,i>=72&&i<84&&(n>=0&&n<9?r=31:n>=9&&n<21?r=33:n>=21&&n<33?r=35:n>=33&&n<42&&(r=37))),r=parseInt(r);var l=(r-1)*6-180+3,_=this.toRadians(l),v=this.getUtmLetterDesignator(i),S=this.eccSquared/(1-this.eccSquared),T=this.a/Math.sqrt(1-this.eccSquared*Math.sin(o)*Math.sin(o)),P=Math.tan(o)*Math.tan(o),I=S*Math.cos(o)*Math.cos(o),z=Math.cos(o)*(c-_),N=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*o-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*o)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*o)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*o)),X=parseFloat(.9996*T*(z+(1-P+I)*z*z*z/6+(5-18*P+P*P+72*I-58*S)*z*z*z*z*z/120)+5e5),H=parseFloat(.9996*(N+T*Math.tan(o)*(z*z/2+(5-P+9*I+4*I*I)*z*z*z*z/24+(61-58*P+P*P+600*I-330*S)*z*z*z*z*z*z/720)));return i<0&&(H+=1e7),H=l3(H,e),X=l3(X,e),{Easting:X,Northing:H,ZoneNumber:parseInt(r),ZoneLetter:v}};sp.convertUtmToLatLng=function(i,t,e,r){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),o=i-5e5,c=t,l=e,_=r;if(i===void 0)return"Please pass the UTMEasting!";if(t===void 0)return"Please pass the UTMNorthing!";if(e===void 0)return"Please pass the UTMZoneNumber!";if(r===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(_)!==-1||(c-=1e7);var v=(l-1)*6-180+3,S=this.eccSquared/(1-this.eccSquared),T=c/.9996,P=T/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),I=P+(3*n/2-27*n*n*n/32)*Math.sin(2*P)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*P)+151*n*n*n/96*Math.sin(6*P);this.toDegrees(I);var z=this.a/Math.sqrt(1-this.eccSquared*Math.sin(I)*Math.sin(I)),N=Math.tan(I)*Math.tan(I),X=S*Math.cos(I)*Math.cos(I),H=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(I)*Math.sin(I),1.5),Z=o/(z*.9996),ot=I-z*Math.tan(I)/H*(Z*Z/2-(5+3*N+10*X-4*X*X-9*S)*Z*Z*Z*Z/24+(61+90*N+298*X+45*N*N-252*S-3*X*X)*Z*Z*Z*Z*Z*Z/720);ot=this.toDegrees(ot);var gt=(Z-(1+2*N+X)*Z*Z*Z/6+(5-2*X+28*N-3*X*X+8*S+24*N*N)*Z*Z*Z*Z*Z/120)/Math.cos(I);return gt=v+this.toDegrees(gt),{lat:ot,lng:gt}};sp.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"};sp.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}};sp.toDegrees=function(i){return i/Math.PI*180};sp.toRadians=function(i){return i*Math.PI/180};function l3(i,t){var e=Math.pow(10,t);return Math.round(i*e)/e}var Hq=QE;const Wq=Mg(Hq);class Xq{constructor(t){this.options=t||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(t){const e=new Wq;return this._map=t,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",r=>{const n=r.lngLat.lat,o=r.lngLat.lng;let c="",l="";const _=e.convertLatLngToUtm(n,o,2),v=n>0?"N":"S";this.options.utm&&(c=`ETRS89 UTM ${_.ZoneNumber}${v} X:<b> ${_.Easting}</b> Y:<b> ${_.Northing}</b> <br>`),this.options.lonlat&&(l=`WGS 84 Lon:<b> ${o.toFixed(5)}</b>  Lat:<b> ${n.toFixed(5)}</b>`);const S=`${c}${l}`;this._container.innerHTML=S}),this._container}_lookUTM31(t,e){var r=0,n=0,o=6,c=84;return t>=r&&t<=o&&e>=n&&e<=c}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function tT(i,t){return function(){return i.apply(t,arguments)}}const{toString:Zq}=Object.prototype,{getPrototypeOf:Ov}=Object,$g=(i=>t=>{const e=Zq.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),Il=i=>(i=i.toLowerCase(),t=>$g(t)===i),Yg=i=>t=>typeof t===i,{isArray:op}=Array,Ef=Yg("undefined");function $q(i){return i!==null&&!Ef(i)&&i.constructor!==null&&!Ef(i.constructor)&&wa(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const eT=Il("ArrayBuffer");function Yq(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&eT(i.buffer),t}const Jq=Yg("string"),wa=Yg("function"),iT=Yg("number"),Jg=i=>i!==null&&typeof i=="object",Kq=i=>i===!0||i===!1,rg=i=>{if($g(i)!=="object")return!1;const t=Ov(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},Qq=Il("Date"),tH=Il("File"),eH=Il("Blob"),iH=Il("FileList"),rH=i=>Jg(i)&&wa(i.pipe),nH=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||wa(i.append)&&((t=$g(i))==="formdata"||t==="object"&&wa(i.toString)&&i.toString()==="[object FormData]"))},sH=Il("URLSearchParams"),[oH,aH,lH,cH]=["ReadableStream","Request","Response","Headers"].map(Il),hH=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gf(i,t){let{allOwnKeys:e=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(i===null||typeof i>"u")return;let r,n;if(typeof i!="object"&&(i=[i]),op(i))for(r=0,n=i.length;r<n;r++)t.call(null,i[r],r,i);else{const o=e?Object.getOwnPropertyNames(i):Object.keys(i),c=o.length;let l;for(r=0;r<c;r++)l=o[r],t.call(null,i[l],l,i)}}function rT(i,t){t=t.toLowerCase();const e=Object.keys(i);let r=e.length,n;for(;r-- >0;)if(n=e[r],t===n.toLowerCase())return n;return null}const Mu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,nT=i=>!Ef(i)&&i!==Mu;function c1(){const{caseless:i}=nT(this)&&this||{},t={},e=(r,n)=>{const o=i&&rT(t,n)||n;rg(t[o])&&rg(r)?t[o]=c1(t[o],r):rg(r)?t[o]=c1({},r):op(r)?t[o]=r.slice():t[o]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&Gf(arguments[r],e);return t}const uH=function(i,t,e){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Gf(t,(n,o)=>{e&&wa(n)?i[o]=tT(n,e):i[o]=n},{allOwnKeys:r}),i},dH=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),pH=(i,t,e,r)=>{i.prototype=Object.create(t.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},fH=(i,t,e,r)=>{let n,o,c;const l={};if(t=t||{},i==null)return t;do{for(n=Object.getOwnPropertyNames(i),o=n.length;o-- >0;)c=n[o],(!r||r(c,i,t))&&!l[c]&&(t[c]=i[c],l[c]=!0);i=e!==!1&&Ov(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},mH=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const r=i.indexOf(t,e);return r!==-1&&r===e},gH=i=>{if(!i)return null;if(op(i))return i;let t=i.length;if(!iT(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},_H=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&Ov(Uint8Array)),yH=(i,t)=>{const e=(i&&i[Symbol.iterator]).call(i);let r;for(;(r=e.next())&&!r.done;){const n=r.value;t.call(i,n[0],n[1])}},vH=(i,t)=>{let e;const r=[];for(;(e=i.exec(t))!==null;)r.push(e);return r},bH=Il("HTMLFormElement"),xH=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,e,r){return e.toUpperCase()+r}),c3=(i=>{let{hasOwnProperty:t}=i;return(e,r)=>t.call(e,r)})(Object.prototype),wH=Il("RegExp"),sT=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),r={};Gf(e,(n,o)=>{let c;(c=t(n,o,i))!==!1&&(r[o]=c||n)}),Object.defineProperties(i,r)},SH=i=>{sT(i,(t,e)=>{if(wa(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const r=i[e];if(wa(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},AH=(i,t)=>{const e={},r=n=>{n.forEach(o=>{e[o]=!0})};return op(i)?r(i):r(String(i).split(t)),e},EH=()=>{},TH=(i,t)=>i!=null&&Number.isFinite(i=+i)?i:t,J_="abcdefghijklmnopqrstuvwxyz",h3="0123456789",oT={DIGIT:h3,ALPHA:J_,ALPHA_DIGIT:J_+J_.toUpperCase()+h3},CH=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:oT.ALPHA_DIGIT,e="";const{length:r}=t;for(;i--;)e+=t[Math.random()*r|0];return e};function PH(i){return!!(i&&wa(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const IH=i=>{const t=new Array(10),e=(r,n)=>{if(Jg(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[n]=r;const o=op(r)?[]:{};return Gf(r,(c,l)=>{const _=e(c,n+1);!Ef(_)&&(o[l]=_)}),t[n]=void 0,o}}return r};return e(i,0)},LH=Il("AsyncFunction"),MH=i=>i&&(Jg(i)||wa(i))&&wa(i.then)&&wa(i.catch),aT=((i,t)=>i?setImmediate:t?((e,r)=>(Mu.addEventListener("message",n=>{let{source:o,data:c}=n;o===Mu&&c===e&&r.length&&r.shift()()},!1),n=>{r.push(n),Mu.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",wa(Mu.postMessage)),BH=typeof queueMicrotask<"u"?queueMicrotask.bind(Mu):typeof process<"u"&&process.nextTick||aT,ue={isArray:op,isArrayBuffer:eT,isBuffer:$q,isFormData:nH,isArrayBufferView:Yq,isString:Jq,isNumber:iT,isBoolean:Kq,isObject:Jg,isPlainObject:rg,isReadableStream:oH,isRequest:aH,isResponse:lH,isHeaders:cH,isUndefined:Ef,isDate:Qq,isFile:tH,isBlob:eH,isRegExp:wH,isFunction:wa,isStream:rH,isURLSearchParams:sH,isTypedArray:_H,isFileList:iH,forEach:Gf,merge:c1,extend:uH,trim:hH,stripBOM:dH,inherits:pH,toFlatObject:fH,kindOf:$g,kindOfTest:Il,endsWith:mH,toArray:gH,forEachEntry:yH,matchAll:vH,isHTMLForm:bH,hasOwnProperty:c3,hasOwnProp:c3,reduceDescriptors:sT,freezeMethods:SH,toObjectSet:AH,toCamelCase:xH,noop:EH,toFiniteNumber:TH,findKey:rT,global:Mu,isContextDefined:nT,ALPHABET:oT,generateString:CH,isSpecCompliantForm:PH,toJSONObject:IH,isAsyncFn:LH,isThenable:MH,setImmediate:aT,asap:BH};function Zi(i,t,e,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}ue.inherits(Zi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ue.toJSONObject(this.config),code:this.code,status:this.status}}});const lT=Zi.prototype,cT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{cT[i]={value:i}});Object.defineProperties(Zi,cT);Object.defineProperty(lT,"isAxiosError",{value:!0});Zi.from=(i,t,e,r,n,o)=>{const c=Object.create(lT);return ue.toFlatObject(i,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Zi.call(c,i.message,t,e,r,n),c.cause=i,c.name=i.name,o&&Object.assign(c,o),c};const RH=null;function h1(i){return ue.isPlainObject(i)||ue.isArray(i)}function hT(i){return ue.endsWith(i,"[]")?i.slice(0,-2):i}function u3(i,t,e){return i?i.concat(t).map(function(r,n){return r=hT(r),!e&&n?"["+r+"]":r}).join(e?".":""):t}function kH(i){return ue.isArray(i)&&!i.some(h1)}const FH=ue.toFlatObject(ue,{},null,function(i){return/^is[A-Z]/.test(i)});function Kg(i,t,e){if(!ue.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=ue.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(I,z){return!ue.isUndefined(z[I])});const r=e.metaTokens,n=e.visitor||v,o=e.dots,c=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&ue.isSpecCompliantForm(t);if(!ue.isFunction(n))throw new TypeError("visitor must be a function");function _(I){if(I===null)return"";if(ue.isDate(I))return I.toISOString();if(!l&&ue.isBlob(I))throw new Zi("Blob is not supported. Use a Buffer instead.");return ue.isArrayBuffer(I)||ue.isTypedArray(I)?l&&typeof Blob=="function"?new Blob([I]):Buffer.from(I):I}function v(I,z,N){let X=I;if(I&&!N&&typeof I=="object"){if(ue.endsWith(z,"{}"))z=r?z:z.slice(0,-2),I=JSON.stringify(I);else if(ue.isArray(I)&&kH(I)||(ue.isFileList(I)||ue.endsWith(z,"[]"))&&(X=ue.toArray(I)))return z=hT(z),X.forEach(function(H,Z){!(ue.isUndefined(H)||H===null)&&t.append(c===!0?u3([z],Z,o):c===null?z:z+"[]",_(H))}),!1}return h1(I)?!0:(t.append(u3(N,z,o),_(I)),!1)}const S=[],T=Object.assign(FH,{defaultVisitor:v,convertValue:_,isVisitable:h1});function P(I,z){if(!ue.isUndefined(I)){if(S.indexOf(I)!==-1)throw Error("Circular reference detected in "+z.join("."));S.push(I),ue.forEach(I,function(N,X){(!(ue.isUndefined(N)||N===null)&&n.call(t,N,ue.isString(X)?X.trim():X,z,T))===!0&&P(N,z?z.concat(X):[X])}),S.pop()}}if(!ue.isObject(i))throw new TypeError("data must be an object");return P(i),t}function d3(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Nv(i,t){this._pairs=[],i&&Kg(i,this,t)}const uT=Nv.prototype;uT.append=function(i,t){this._pairs.push([i,t])};uT.toString=function(i){const t=i?function(e){return i.call(this,e,d3)}:d3;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};function DH(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function dT(i,t,e){if(!t)return i;const r=e&&e.encode||DH;ue.isFunction(e)&&(e={serialize:e});const n=e&&e.serialize;let o;if(n?o=n(t,e):o=ue.isURLSearchParams(t)?t.toString():new Nv(t,e).toString(r),o){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+o}return i}class p3{constructor(){this.handlers=[]}use(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ue.forEach(this.handlers,function(e){e!==null&&t(e)})}}const pT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},OH=typeof URLSearchParams<"u"?URLSearchParams:Nv,NH=typeof FormData<"u"?FormData:null,zH=typeof Blob<"u"?Blob:null,jH={isBrowser:!0,classes:{URLSearchParams:OH,FormData:NH,Blob:zH},protocols:["http","https","file","blob","url","data"]},zv=typeof window<"u"&&typeof document<"u",u1=typeof navigator=="object"&&navigator||void 0,UH=zv&&(!u1||["ReactNative","NativeScript","NS"].indexOf(u1.product)<0),GH=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",VH=zv&&window.location.href||"http://localhost",qH=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:zv,hasStandardBrowserEnv:UH,hasStandardBrowserWebWorkerEnv:GH,navigator:u1,origin:VH},Symbol.toStringTag,{value:"Module"})),io={...qH,...jH};function HH(i,t){return Kg(i,new io.classes.URLSearchParams,Object.assign({visitor:function(e,r,n,o){return io.isNode&&ue.isBuffer(e)?(this.append(r,e.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}function WH(i){return ue.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function XH(i){const t={},e=Object.keys(i);let r;const n=e.length;let o;for(r=0;r<n;r++)o=e[r],t[o]=i[o];return t}function fT(i){function t(e,r,n,o){let c=e[o++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),_=o>=e.length;return c=!c&&ue.isArray(n)?n.length:c,_?(ue.hasOwnProp(n,c)?n[c]=[n[c],r]:n[c]=r,!l):((!n[c]||!ue.isObject(n[c]))&&(n[c]=[]),t(e,r,n[c],o)&&ue.isArray(n[c])&&(n[c]=XH(n[c])),!l)}if(ue.isFormData(i)&&ue.isFunction(i.entries)){const e={};return ue.forEachEntry(i,(r,n)=>{t(WH(r),n,e,0)}),e}return null}function ZH(i,t,e){if(ue.isString(i))try{return(t||JSON.parse)(i),ue.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(i)}const Vf={transitional:pT,adapter:["xhr","http","fetch"],transformRequest:[function(i,t){const e=t.getContentType()||"",r=e.indexOf("application/json")>-1,n=ue.isObject(i);if(n&&ue.isHTMLForm(i)&&(i=new FormData(i)),ue.isFormData(i))return r?JSON.stringify(fT(i)):i;if(ue.isArrayBuffer(i)||ue.isBuffer(i)||ue.isStream(i)||ue.isFile(i)||ue.isBlob(i)||ue.isReadableStream(i))return i;if(ue.isArrayBufferView(i))return i.buffer;if(ue.isURLSearchParams(i))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let o;if(n){if(e.indexOf("application/x-www-form-urlencoded")>-1)return HH(i,this.formSerializer).toString();if((o=ue.isFileList(i))||e.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Kg(o?{"files[]":i}:i,c&&new c,this.formSerializer)}}return n||r?(t.setContentType("application/json",!1),ZH(i)):i}],transformResponse:[function(i){const t=this.transitional||Vf.transitional,e=t&&t.forcedJSONParsing,r=this.responseType==="json";if(ue.isResponse(i)||ue.isReadableStream(i))return i;if(i&&ue.isString(i)&&(e&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(i)}catch(o){if(n)throw o.name==="SyntaxError"?Zi.from(o,Zi.ERR_BAD_RESPONSE,this,null,this.response):o}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ue.forEach(["delete","get","head","post","put","patch"],i=>{Vf.headers[i]={}});const $H=ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),YH=i=>{const t={};let e,r,n;return i&&i.split(`
`).forEach(function(o){n=o.indexOf(":"),e=o.substring(0,n).trim().toLowerCase(),r=o.substring(n+1).trim(),!(!e||t[e]&&$H[e])&&(e==="set-cookie"?t[e]?t[e].push(r):t[e]=[r]:t[e]=t[e]?t[e]+", "+r:r)}),t},f3=Symbol("internals");function Yp(i){return i&&String(i).trim().toLowerCase()}function ng(i){return i===!1||i==null?i:ue.isArray(i)?i.map(ng):String(i)}function JH(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=e.exec(i);)t[r[1]]=r[2];return t}const KH=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function K_(i,t,e,r,n){if(ue.isFunction(r))return r.call(this,t,e);if(n&&(t=e),!!ue.isString(t)){if(ue.isString(r))return t.indexOf(r)!==-1;if(ue.isRegExp(r))return r.test(t)}}function QH(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,r)=>e.toUpperCase()+r)}function tW(i,t){const e=ue.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+e,{value:function(n,o,c){return this[r].call(this,t,n,o,c)},configurable:!0})})}class Ho{constructor(t){t&&this.set(t)}set(t,e,r){const n=this;function o(l,_,v){const S=Yp(_);if(!S)throw new Error("header name must be a non-empty string");const T=ue.findKey(n,S);(!T||n[T]===void 0||v===!0||v===void 0&&n[T]!==!1)&&(n[T||_]=ng(l))}const c=(l,_)=>ue.forEach(l,(v,S)=>o(v,S,_));if(ue.isPlainObject(t)||t instanceof this.constructor)c(t,e);else if(ue.isString(t)&&(t=t.trim())&&!KH(t))c(YH(t),e);else if(ue.isHeaders(t))for(const[l,_]of t.entries())o(_,l,r);else t!=null&&o(e,t,r);return this}get(t,e){if(t=Yp(t),t){const r=ue.findKey(this,t);if(r){const n=this[r];if(!e)return n;if(e===!0)return JH(n);if(ue.isFunction(e))return e.call(this,n,r);if(ue.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Yp(t),t){const r=ue.findKey(this,t);return!!(r&&this[r]!==void 0&&(!e||K_(this,this[r],r,e)))}return!1}delete(t,e){const r=this;let n=!1;function o(c){if(c=Yp(c),c){const l=ue.findKey(r,c);l&&(!e||K_(r,r[l],l,e))&&(delete r[l],n=!0)}}return ue.isArray(t)?t.forEach(o):o(t),n}clear(t){const e=Object.keys(this);let r=e.length,n=!1;for(;r--;){const o=e[r];(!t||K_(this,this[o],o,t,!0))&&(delete this[o],n=!0)}return n}normalize(t){const e=this,r={};return ue.forEach(this,(n,o)=>{const c=ue.findKey(r,o);if(c){e[c]=ng(n),delete e[o];return}const l=t?QH(o):String(o).trim();l!==o&&delete e[o],e[l]=ng(n),r[l]=!0}),this}concat(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.constructor.concat(this,...e)}toJSON(t){const e=Object.create(null);return ue.forEach(this,(r,n)=>{r!=null&&r!==!1&&(e[n]=t&&ue.isArray(r)?r.join(", "):r)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[e,r]=t;return e+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const e=new this(t);for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return n.forEach(c=>e.set(c)),e}static accessor(t){const e=(this[f3]=this[f3]={accessors:{}}).accessors,r=this.prototype;function n(o){const c=Yp(o);e[c]||(tW(r,o),e[c]=!0)}return ue.isArray(t)?t.forEach(n):n(t),this}}Ho.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ue.reduceDescriptors(Ho.prototype,(i,t)=>{let{value:e}=i,r=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(n){this[r]=n}}});ue.freezeMethods(Ho);function Q_(i,t){const e=this||Vf,r=t||e,n=Ho.from(r.headers);let o=r.data;return ue.forEach(i,function(c){o=c.call(e,o,n.normalize(),t?t.status:void 0)}),n.normalize(),o}function mT(i){return!!(i&&i.__CANCEL__)}function ap(i,t,e){Zi.call(this,i??"canceled",Zi.ERR_CANCELED,t,e),this.name="CanceledError"}ue.inherits(ap,Zi,{__CANCEL__:!0});function gT(i,t,e){const r=e.config.validateStatus;!e.status||!r||r(e.status)?i(e):t(new Zi("Request failed with status code "+e.status,[Zi.ERR_BAD_REQUEST,Zi.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function eW(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function iW(i,t){i=i||10;const e=new Array(i),r=new Array(i);let n=0,o=0,c;return t=t!==void 0?t:1e3,function(l){const _=Date.now(),v=r[o];c||(c=_),e[n]=l,r[n]=_;let S=o,T=0;for(;S!==n;)T+=e[S++],S=S%i;if(n=(n+1)%i,n===o&&(o=(o+1)%i),_-c<t)return;const P=v&&_-v;return P?Math.round(T*1e3/P):void 0}}function rW(i,t){let e=0,r=1e3/t,n,o;const c=function(l){e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),n=null,o&&(clearTimeout(o),o=null),i.apply(null,l)};return[function(){const l=Date.now(),_=l-e;for(var v=arguments.length,S=new Array(v),T=0;T<v;T++)S[T]=arguments[T];_>=r?c(S,l):(n=S,o||(o=setTimeout(()=>{o=null,c(n)},r-_)))},()=>n&&c(n)]}const Ig=function(i,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const n=iW(50,250);return rW(o=>{const c=o.loaded,l=o.lengthComputable?o.total:void 0,_=c-r,v=n(_),S=c<=l;r=c;const T={loaded:c,total:l,progress:l?c/l:void 0,bytes:_,rate:v||void 0,estimated:v&&l&&S?(l-c)/v:void 0,event:o,lengthComputable:l!=null,[t?"download":"upload"]:!0};i(T)},e)},m3=(i,t)=>{const e=i!=null;return[r=>t[0]({lengthComputable:e,total:i,loaded:r}),t[1]]},g3=i=>function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return ue.asap(()=>i(...e))},nW=io.hasStandardBrowserEnv?((i,t)=>e=>(e=new URL(e,io.origin),i.protocol===e.protocol&&i.host===e.host&&(t||i.port===e.port)))(new URL(io.origin),io.navigator&&/(msie|trident)/i.test(io.navigator.userAgent)):()=>!0,sW=io.hasStandardBrowserEnv?{write(i,t,e,r,n,o){const c=[i+"="+encodeURIComponent(t)];ue.isNumber(e)&&c.push("expires="+new Date(e).toGMTString()),ue.isString(r)&&c.push("path="+r),ue.isString(n)&&c.push("domain="+n),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function oW(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function aW(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function _T(i,t){return i&&!oW(t)?aW(i,t):t}const _3=i=>i instanceof Ho?{...i}:i;function ju(i,t){t=t||{};const e={};function r(v,S,T,P){return ue.isPlainObject(v)&&ue.isPlainObject(S)?ue.merge.call({caseless:P},v,S):ue.isPlainObject(S)?ue.merge({},S):ue.isArray(S)?S.slice():S}function n(v,S,T,P){if(ue.isUndefined(S)){if(!ue.isUndefined(v))return r(void 0,v,T,P)}else return r(v,S,T,P)}function o(v,S){if(!ue.isUndefined(S))return r(void 0,S)}function c(v,S){if(ue.isUndefined(S)){if(!ue.isUndefined(v))return r(void 0,v)}else return r(void 0,S)}function l(v,S,T){if(T in t)return r(v,S);if(T in i)return r(void 0,v)}const _={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(v,S,T)=>n(_3(v),_3(S),T,!0)};return ue.forEach(Object.keys(Object.assign({},i,t)),function(v){const S=_[v]||n,T=S(i[v],t[v],v);ue.isUndefined(T)&&S!==l||(e[v]=T)}),e}const yT=i=>{const t=ju({},i);let{data:e,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:o,headers:c,auth:l}=t;t.headers=c=Ho.from(c),t.url=dT(_T(t.baseURL,t.url),i.params,i.paramsSerializer),l&&c.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let _;if(ue.isFormData(e)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((_=c.getContentType())!==!1){const[v,...S]=_?_.split(";").map(T=>T.trim()).filter(Boolean):[];c.setContentType([v||"multipart/form-data",...S].join("; "))}}if(io.hasStandardBrowserEnv&&(r&&ue.isFunction(r)&&(r=r(t)),r||r!==!1&&nW(t.url))){const v=n&&o&&sW.read(o);v&&c.set(n,v)}return t},lW=typeof XMLHttpRequest<"u",cW=lW&&function(i){return new Promise(function(t,e){const r=yT(i);let n=r.data;const o=Ho.from(r.headers).normalize();let{responseType:c,onUploadProgress:l,onDownloadProgress:_}=r,v,S,T,P,I;function z(){P&&P(),I&&I(),r.cancelToken&&r.cancelToken.unsubscribe(v),r.signal&&r.signal.removeEventListener("abort",v)}let N=new XMLHttpRequest;N.open(r.method.toUpperCase(),r.url,!0),N.timeout=r.timeout;function X(){if(!N)return;const Z=Ho.from("getAllResponseHeaders"in N&&N.getAllResponseHeaders()),ot={data:!c||c==="text"||c==="json"?N.responseText:N.response,status:N.status,statusText:N.statusText,headers:Z,config:i,request:N};gT(function(gt){t(gt),z()},function(gt){e(gt),z()},ot),N=null}"onloadend"in N?N.onloadend=X:N.onreadystatechange=function(){!N||N.readyState!==4||N.status===0&&!(N.responseURL&&N.responseURL.indexOf("file:")===0)||setTimeout(X)},N.onabort=function(){N&&(e(new Zi("Request aborted",Zi.ECONNABORTED,i,N)),N=null)},N.onerror=function(){e(new Zi("Network Error",Zi.ERR_NETWORK,i,N)),N=null},N.ontimeout=function(){let Z=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ot=r.transitional||pT;r.timeoutErrorMessage&&(Z=r.timeoutErrorMessage),e(new Zi(Z,ot.clarifyTimeoutError?Zi.ETIMEDOUT:Zi.ECONNABORTED,i,N)),N=null},n===void 0&&o.setContentType(null),"setRequestHeader"in N&&ue.forEach(o.toJSON(),function(Z,ot){N.setRequestHeader(ot,Z)}),ue.isUndefined(r.withCredentials)||(N.withCredentials=!!r.withCredentials),c&&c!=="json"&&(N.responseType=r.responseType),_&&([T,I]=Ig(_,!0),N.addEventListener("progress",T)),l&&N.upload&&([S,P]=Ig(l),N.upload.addEventListener("progress",S),N.upload.addEventListener("loadend",P)),(r.cancelToken||r.signal)&&(v=Z=>{N&&(e(!Z||Z.type?new ap(null,i,N):Z),N.abort(),N=null)},r.cancelToken&&r.cancelToken.subscribe(v),r.signal&&(r.signal.aborted?v():r.signal.addEventListener("abort",v)));const H=eW(r.url);if(H&&io.protocols.indexOf(H)===-1){e(new Zi("Unsupported protocol "+H+":",Zi.ERR_BAD_REQUEST,i));return}N.send(n||null)})},hW=(i,t)=>{const{length:e}=i=i?i.filter(Boolean):[];if(t||e){let r=new AbortController,n;const o=function(v){if(!n){n=!0,l();const S=v instanceof Error?v:this.reason;r.abort(S instanceof Zi?S:new ap(S instanceof Error?S.message:S))}};let c=t&&setTimeout(()=>{c=null,o(new Zi(`timeout ${t} of ms exceeded`,Zi.ETIMEDOUT))},t);const l=()=>{i&&(c&&clearTimeout(c),c=null,i.forEach(v=>{v.unsubscribe?v.unsubscribe(o):v.removeEventListener("abort",o)}),i=null)};i.forEach(v=>v.addEventListener("abort",o));const{signal:_}=r;return _.unsubscribe=()=>ue.asap(l),_}},uW=function*(i,t){let e=i.byteLength;if(e<t){yield i;return}let r=0,n;for(;r<e;)n=r+t,yield i.slice(r,n),r=n},dW=async function*(i,t){for await(const e of pW(i))yield*uW(e,t)},pW=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const t=i.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},y3=(i,t,e,r)=>{const n=dW(i,t);let o=0,c,l=_=>{c||(c=!0,r&&r(_))};return new ReadableStream({async pull(_){try{const{done:v,value:S}=await n.next();if(v){l(),_.close();return}let T=S.byteLength;if(e){let P=o+=T;e(P)}_.enqueue(new Uint8Array(S))}catch(v){throw l(v),v}},cancel(_){return l(_),n.return()}},{highWaterMark:2})},Qg=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",vT=Qg&&typeof ReadableStream=="function",fW=Qg&&(typeof TextEncoder=="function"?(i=>t=>i.encode(t))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),bT=function(i){try{for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return!!i(...e)}catch{return!1}},mW=vT&&bT(()=>{let i=!1;const t=new Request(io.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!t}),v3=64*1024,d1=vT&&bT(()=>ue.isReadableStream(new Response("").body)),Lg={stream:d1&&(i=>i.body)};Qg&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Lg[t]&&(Lg[t]=ue.isFunction(i[t])?e=>e[t]():(e,r)=>{throw new Zi(`Response type '${t}' is not supported`,Zi.ERR_NOT_SUPPORT,r)})})})(new Response);const gW=async i=>{if(i==null)return 0;if(ue.isBlob(i))return i.size;if(ue.isSpecCompliantForm(i))return(await new Request(io.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(ue.isArrayBufferView(i)||ue.isArrayBuffer(i))return i.byteLength;if(ue.isURLSearchParams(i)&&(i=i+""),ue.isString(i))return(await fW(i)).byteLength},_W=async(i,t)=>ue.toFiniteNumber(i.getContentLength())??gW(t),yW=Qg&&(async i=>{let{url:t,method:e,data:r,signal:n,cancelToken:o,timeout:c,onDownloadProgress:l,onUploadProgress:_,responseType:v,headers:S,withCredentials:T="same-origin",fetchOptions:P}=yT(i);v=v?(v+"").toLowerCase():"text";let I=hW([n,o&&o.toAbortSignal()],c),z;const N=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let X;try{if(_&&mW&&e!=="get"&&e!=="head"&&(X=await _W(S,r))!==0){let Et=new Request(t,{method:"POST",body:r,duplex:"half"}),Ft;if(ue.isFormData(r)&&(Ft=Et.headers.get("content-type"))&&S.setContentType(Ft),Et.body){const[Mt,yt]=m3(X,Ig(g3(_)));r=y3(Et.body,v3,Mt,yt)}}ue.isString(T)||(T=T?"include":"omit");const H="credentials"in Request.prototype;z=new Request(t,{...P,signal:I,method:e.toUpperCase(),headers:S.normalize().toJSON(),body:r,duplex:"half",credentials:H?T:void 0});let Z=await fetch(z);const ot=d1&&(v==="stream"||v==="response");if(d1&&(l||ot&&N)){const Et={};["status","statusText","headers"].forEach(Ut=>{Et[Ut]=Z[Ut]});const Ft=ue.toFiniteNumber(Z.headers.get("content-length")),[Mt,yt]=l&&m3(Ft,Ig(g3(l),!0))||[];Z=new Response(y3(Z.body,v3,Mt,()=>{yt&&yt(),N&&N()}),Et)}v=v||"text";let gt=await Lg[ue.findKey(Lg,v)||"text"](Z,i);return!ot&&N&&N(),await new Promise((Et,Ft)=>{gT(Et,Ft,{data:gt,headers:Ho.from(Z.headers),status:Z.status,statusText:Z.statusText,config:i,request:z})})}catch(H){throw N&&N(),H&&H.name==="TypeError"&&/fetch/i.test(H.message)?Object.assign(new Zi("Network Error",Zi.ERR_NETWORK,i,z),{cause:H.cause||H}):Zi.from(H,H&&H.code,i,z)}}),p1={http:RH,xhr:cW,fetch:yW};ue.forEach(p1,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const b3=i=>`- ${i}`,vW=i=>ue.isFunction(i)||i===null||i===!1,xT={getAdapter:i=>{i=ue.isArray(i)?i:[i];const{length:t}=i;let e,r;const n={};for(let o=0;o<t;o++){e=i[o];let c;if(r=e,!vW(e)&&(r=p1[(c=String(e)).toLowerCase()],r===void 0))throw new Zi(`Unknown adapter '${c}'`);if(r)break;n[c||"#"+o]=r}if(!r){const o=Object.entries(n).map(l=>{let[_,v]=l;return`adapter ${_} `+(v===!1?"is not supported by the environment":"is not available in the build")});let c=t?o.length>1?`since :
`+o.map(b3).join(`
`):" "+b3(o[0]):"as no adapter specified";throw new Zi("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return r},adapters:p1};function ty(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new ap(null,i)}function x3(i){return ty(i),i.headers=Ho.from(i.headers),i.data=Q_.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),xT.getAdapter(i.adapter||Vf.adapter)(i).then(function(t){return ty(i),t.data=Q_.call(i,i.transformResponse,t),t.headers=Ho.from(t.headers),t},function(t){return mT(t)||(ty(i),t&&t.response&&(t.response.data=Q_.call(i,i.transformResponse,t.response),t.response.headers=Ho.from(t.response.headers))),Promise.reject(t)})}const wT="1.7.9",t0={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{t0[i]=function(e){return typeof e===i||"a"+(t<1?"n ":" ")+i}});const w3={};t0.transitional=function(i,t,e){function r(n,o){return"[Axios v"+wT+"] Transitional option '"+n+"'"+o+(e?". "+e:"")}return(n,o,c)=>{if(i===!1)throw new Zi(r(o," has been removed"+(t?" in "+t:"")),Zi.ERR_DEPRECATED);return t&&!w3[o]&&(w3[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),i?i(n,o,c):!0}};t0.spelling=function(i){return(t,e)=>(console.warn(`${e} is likely a misspelling of ${i}`),!0)};function bW(i,t,e){if(typeof i!="object")throw new Zi("options must be an object",Zi.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let n=r.length;for(;n-- >0;){const o=r[n],c=t[o];if(c){const l=i[o],_=l===void 0||c(l,o,i);if(_!==!0)throw new Zi("option "+o+" must be "+_,Zi.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new Zi("Unknown option "+o,Zi.ERR_BAD_OPTION)}}const sg={assertOptions:bW,validators:t0},dc=sg.validators;class Fu{constructor(t){this.defaults=t,this.interceptors={request:new p3,response:new p3}}async request(t,e){try{return await this._request(t,e)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=ju(this.defaults,e);const{transitional:r,paramsSerializer:n,headers:o}=e;r!==void 0&&sg.assertOptions(r,{silentJSONParsing:dc.transitional(dc.boolean),forcedJSONParsing:dc.transitional(dc.boolean),clarifyTimeoutError:dc.transitional(dc.boolean)},!1),n!=null&&(ue.isFunction(n)?e.paramsSerializer={serialize:n}:sg.assertOptions(n,{encode:dc.function,serialize:dc.function},!0)),sg.assertOptions(e,{baseUrl:dc.spelling("baseURL"),withXsrfToken:dc.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let c=o&&ue.merge(o.common,o[e.method]);o&&ue.forEach(["delete","get","head","post","put","patch","common"],z=>{delete o[z]}),e.headers=Ho.concat(c,o);const l=[];let _=!0;this.interceptors.request.forEach(function(z){typeof z.runWhen=="function"&&z.runWhen(e)===!1||(_=_&&z.synchronous,l.unshift(z.fulfilled,z.rejected))});const v=[];this.interceptors.response.forEach(function(z){v.push(z.fulfilled,z.rejected)});let S,T=0,P;if(!_){const z=[x3.bind(this),void 0];for(z.unshift.apply(z,l),z.push.apply(z,v),P=z.length,S=Promise.resolve(e);T<P;)S=S.then(z[T++],z[T++]);return S}P=l.length;let I=e;for(T=0;T<P;){const z=l[T++],N=l[T++];try{I=z(I)}catch(X){N.call(this,X);break}}try{S=x3.call(this,I)}catch(z){return Promise.reject(z)}for(T=0,P=v.length;T<P;)S=S.then(v[T++],v[T++]);return S}getUri(t){t=ju(this.defaults,t);const e=_T(t.baseURL,t.url);return dT(e,t.params,t.paramsSerializer)}}ue.forEach(["delete","get","head","options"],function(i){Fu.prototype[i]=function(t,e){return this.request(ju(e||{},{method:i,url:t,data:(e||{}).data}))}});ue.forEach(["post","put","patch"],function(i){function t(e){return function(r,n,o){return this.request(ju(o||{},{method:i,headers:e?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}Fu.prototype[i]=t(),Fu.prototype[i+"Form"]=t(!0)});class jv{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(n){e=n});const r=this;this.promise.then(n=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](n);r._listeners=null}),this.promise.then=n=>{let o;const c=new Promise(l=>{r.subscribe(l),o=l}).then(n);return c.cancel=function(){r.unsubscribe(o)},c},t(function(n,o,c){r.reason||(r.reason=new ap(n,o,c),e(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=r=>{t.abort(r)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new jv(function(e){t=e}),cancel:t}}}function xW(i){return function(t){return i.apply(null,t)}}function wW(i){return ue.isObject(i)&&i.isAxiosError===!0}const f1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(f1).forEach(i=>{let[t,e]=i;f1[e]=t});function ST(i){const t=new Fu(i),e=tT(Fu.prototype.request,t);return ue.extend(e,Fu.prototype,t,{allOwnKeys:!0}),ue.extend(e,t,null,{allOwnKeys:!0}),e.create=function(r){return ST(ju(i,r))},e}const Wn=ST(Vf);Wn.Axios=Fu;Wn.CanceledError=ap;Wn.CancelToken=jv;Wn.isCancel=mT;Wn.VERSION=wT;Wn.toFormData=Kg;Wn.AxiosError=Zi;Wn.Cancel=Wn.CanceledError;Wn.all=function(i){return Promise.all(i)};Wn.spread=xW;Wn.isAxiosError=wW;Wn.mergeConfig=ju;Wn.AxiosHeaders=Ho;Wn.formToJSON=i=>fT(ue.isHTMLForm(i)?new FormData(i):i);Wn.getAdapter=xT.getAdapter;Wn.HttpStatusCode=f1;Wn.default=Wn;const SW="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",AW=5e3;class AT{static async getConfigICGC(){try{const t=await Wn.get(SW,{timeout:AW});return t.data?t.data:(console.log("Resposta sense dades:",t),Lu)}catch(t){return t.response?(console.error("Error de resposta:",t.response.data),console.error("Codi d'estat:",t.response.status)):t.request?console.error("No s'ha rebut resposta del servidor:",t.request):console.error("Error:",t.message),Lu}}}const EW={"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]},TW={cobertesSol:EW},CW="lines",jm="labels";let xu,Jp,An,ur,PW=class{constructor(i){AT.getConfigICGC().then(t=>{xu={...t.Styles},An={...t.Layers},Jp={...t.Terrains},ur={...t.defaultOptions},this.initTheMap(i)}).catch(t=>{console.info("Configuracio per defecte",t),xu={...Lu.Styles},An={...Lu.Layers},Jp={...Lu.Terrains},ur={...Lu.defaultOptions},this.initTheMap(i)})}initTheMap(i){if(!i)i=ur.mapOptions;else for(const e in ur.mapOptions){let r=[ur.mapOptions.center[0],ur.mapOptions.center[1]];ur.mapOptions.center=r,i.hasOwnProperty(e)||(i[e]=ur.mapOptions[e])}i.maxPitch=85,i.maplibreLogo=!1,i.attributionControl=!1;const t=i.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");t?(this.map=new ms.Map({container:i.container,center:i.center,zoom:i.zoom,pitch:i.pitch||0,hash:i.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[i.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new ms.Map(i),this.map.on("load",()=>{if(!t){const e=this.map.getStyle().name,r=i.style;this.map.addControl(new Vq({color:r.indexOf("orto")===-1,defaultOptions:ur}),"bottom-left"),this._dealOrto3dStyle(e)}})}addGeocoderICGC(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"top-right";try{i={collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:ms,showResultsWhileTyping:!0,minLength:2,...i};const e={forwardGeocode:async n=>{const o=[];try{const c=ur.geocoder.peliasUrl1+encodeURIComponent(n.query)+ur.geocoder.peliasUrl2,l=await(await fetch(c)).json();for(const _ of l.features){const v=_.geometry.coordinates,S={type:"Feature",geometry:{type:"Point",coordinates:v},place_name:_.properties.etiqueta,properties:_.properties,text:_.properties.etiqueta,place_type:["place"],center:v};o.push(S)}}catch(c){console.error(`Failed to forwardGeocode with error: ${c}`)}return{features:o}}};this.map.addControl(new Nq(e,i),t);let r=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");r[0].attributes[2].nodeValue="Cerca...",r[0].addEventListener("input",function(n){n.target.value.length>3})}catch(e){console.error(`Error adding ICGC geocoder: ${e.message}`)}}async loadImage(i){try{return this.map.loadImage(i)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}getConfigStyles(){try{let i=[];for(const t of xu)i.push(t.name);return i}catch(i){console.error(`Error retrieving base styles: ${i.message}`)}}getConfigWMSLayers(){try{let i=[];for(const t in An.WMS)An.WMS.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving WMS layers: ${i.message}`)}}getConfigOrtoLayers(){try{let i=[];for(const t in An.Orto)An.Orto.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving orto image layers: ${i.message}`)}}getConfigVectorLayers(){try{let i=[];for(const t in An.Vector)An.Vector.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vector layers: ${i.message}`)}}getConfigVectorAdminLayers(){try{let i=[];for(const t in An.VectorAdmin)An.VectorAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving vectorAdmin layers: ${i.message}`)}}getConfigFGBAdminLayers(){try{let i=[];for(const t in An.FGBAdmin)An.FGBAdmin.hasOwnProperty(t)&&i.push(t);return i}catch(i){console.error(`Error retrieving FGBAdmin layers: ${i.message}`)}}async fetchData(i,t,e){try{(!e||e===void 0)&&(e={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let r=e.layerPosition;if(i.includes(".fgb"))this.addFGBLayerICGC(i,t,e);else{const n=await(await fetch(i)).json();let o=t,c=this._dealOrderLayer(r),l=n.features[0].geometry.type;l.includes("ine")&&(e!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:n},layout:e.layout||{},paint:e.paint||{}},c):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},c)),l.includes("olygon")&&(e!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:n},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},c)),l.includes("oint")&&(e!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:n},layout:e.layout,paint:e.paint},c):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:n},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},c))}}catch(r){console.error(`Error fetching data: ${r.message}`)}}async fetchDataAndMenu(i,t,e,r){try{let n;r!==null?n=r.layerPosition:n=jm;let o,c=document.getElementById("map");if(document.getElementById("menu-group")?o=document.getElementById("menu-group"):(o=document.createElement("nav"),o.id="menu-group",o.classList.add="filter-group",c.appendChild(o)),o!==null){let l="visible",_=this._dealOrderLayer(n),v;if(i.includes(".fgb")){let T=this._getKeyByUrlFGB(i);T===null&&(T="userFGB");const P=await fetch(i),I={type:"FeatureCollection",features:[]};for await(const N of A2(P.body))I.features.push(N);v=I;let z=t;if(this.map.addSource(z,{type:"geojson",data:I}),i.includes("text"))r!==void 0?this.map.addLayer({id:t,type:"symbol",source:z,layout:r.layout,paint:r.paint},_):this.map.addLayer({id:t,type:"symbol",source:z,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},_);else{let N=t+"Text";this.map.addLayer({id:N,type:"symbol",source:z,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:l,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},_)}}else v=await(await fetch(i)).json();if(e!=="all"){const T=document.createElement("div");T.id="titleDivMenu",T.textContent=t,o.appendChild(T);const P=document.createElement("div");P.id="titleDivMenuSub",P.textContent=` ${e}`,o.appendChild(P)}let S;if(r.type?S=r.type:S=v.features[0].geometry.type,e==="all")S.includes("ine")&&(r!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:v},layout:r.layout,paint:r.paint},_):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},_)),S.includes("olygon")&&(r!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:v},layout:r.layout,paint:r.paint},_):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},_)),S.includes("oint")&&(r!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:v},layout:r.layout,paint:r.paint},_):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},_)),S.includes("ymbol")&&(r!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:v},layout:r.layout,paint:r.paint},_):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:v},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},_)),this.addMenuItem(t);else{let T=e;const P={};v.features.forEach(I=>{const z=I.properties[T],N=z+"-userFieldFilter-"+t;z!==null&&(P[N]||(S.includes("ine")&&(r!==void 0?this.map.addLayer({id:N,type:"line",source:{type:"geojson",data:v},layout:r.layout,paint:r.paint,filter:["==",`${T}`,z]},_):this.map.addLayer({id:N,type:"line",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${T}`,z],paint:{"line-color":"black","line-width":2,"line-opacity":1}},_)),S.includes("olygon")&&(r!==void 0?this.map.addLayer({id:N,type:"fill",source:{type:"geojson",data:v},filter:["==",`${T}`,z],layout:r.layout,paint:r.paint},_):this.map.addLayer({id:N,type:"fill",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${T}`,z],paint:{"fill-color":"blue","fill-opacity":.6}},_)),S.includes("oint")&&(r!==void 0?this.map.addLayer({id:N,type:"circle",source:{type:"geojson",data:v},filter:["==",`${T}`,z],layout:r.layout,paint:r.paint},_):this.map.addLayer({id:N,type:"circle",source:{type:"geojson",data:v},layout:{visibility:"visible"},filter:["==",`${T}`,z],paint:{"circle-color":"red","circle-opacity":.85}},_)),P[N]=!0,this.addMenuItem(N)))})}}}catch(n){console.error(`Error fetching data: ${n.message}`)}}on(i,t){setTimeout(()=>{try{return this.map.on(i,t)}catch(e){console.error(`Error adding event ON listener: ${e.message}`)}},100)}setStyle(i,t){try{t!==void 0?this.map.setStyle(i,t):this.map.setStyle(i),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var e=window.document.querySelector(".maplibregl-compact-show");e.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(e){console.error(`Error setting style: ${e.message}`)}}addControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(i,t)}catch(e){console.error(`Error adding control: ${e.message}`)}}setSky(i){try{i===void 0&&(this.map.style.stylesheet.id.includes("orto")?i={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?i={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?i={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?i={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:i={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(i)}catch(t){console.error(`Error setting sky properties: ${t.message}`)}}addMouseCoordControl(i){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Xq(i),t)}catch(e){console.error(`Error adding mouse coordinate control: ${e.message}`)}}addGeolocateControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new ms.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new ms.GeolocateControl(i),t)}catch(e){console.error(`Error adding geolocate control: ${e.message}`)}}addFullscreenControl(i,t){try{t===void 0&&(t="top-right"),i===void 0?this.map.addControl(new ms.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new ms.FullscreenControl(i),t)}catch(e){console.error(`Error adding fullscreen control: ${e.message}`)}}addLayer(i,t){try{this.map.addLayer(i,t)}catch(e){console.error(`Error adding layer: ${e.message}`)}}addImage(i,t,e){try{this.map.addImage(i,t,e)}catch(r){console.error(`Error adding image: ${r.message}`)}return this}addSource(i,t){try{this.map.addSource(i,t)}catch(e){console.error(`Error adding source: ${e.message}`)}return this}addSprite(i,t,e){try{this.map.addSprite(i,t,e)}catch(r){console.error(`Error adding sprite: ${r.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(i,t){return this.map.cameraForBounds(i,t)}easeTo(i,t){return this.map.easeTo(i,t),this}fitBounds(i,t,e){return this.map.fitBounds(i,t,e),this}fitScreenCoordinates(i,t,e,r,n){return this.map.fitScreenCoordinates(i,t,e,r,n),this}flyTo(i,t){return this.map.flyTo(i,t),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(i){return this.map.getFeatureState(i)}getFilter(i){return this.map.getFilter(i)}getGlyphs(){return this.map.getGlyphs()}getImage(i){return this.map.getImage(i)}getLayer(i){return this.map.getLayer(i)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(i,t){return this.map.getLayoutProperty(i,t)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(i,t){return this.map.getPaintProperty(i,t)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(i){return this.map.getSource(i)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(i){return this.map.hasControl(i)}hasImage(i){return this.map.hasImage(i)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(i){return this.map.isSourceLoaded(i)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(i,t){return this.map.jumpTo(i,t)}listImages(){return this.map.listImages()}listens(i){return this.map.listens(i)}loadImage(i){return this.map.loadImage(i)}loaded(){return this.map.loaded()}LngLatBounds(i,t){return new ms.LngLatBounds(i,t)}addProtocol(i,t){return this.map.addProtocol(i,t)}moveLayer(i,t){return this.map.moveLayer(i,t)}panBy(i,t,e){return this.map.panBy(i,t,e)}panTo(i,t,e){return this.map.panTo(i,t,e)}project(i){return this.map.project(i)}queryRenderedFeatures(i,t){return this.map.queryRenderedFeatures(i,t)}querySourceFeatures(i,t){return this.map.querySourceFeatures(i,t)}queryTerrainElevation(i){return this.map.queryTerrainElevation(i)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(i){return this.map.removeControl(i)}removeFeatureState(i,t){return this.map.removeFeatureState(i,t)}removeImage(i){return this.map.removeImage(i)}removeLayer(i){try{this.map.removeLayer(i)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(i){try{this.map.removeSource(i)}catch(t){console.error(`Error removing source: ${t.message}`)}}removeSprite(i){return this.map.removeSprite(i)}resetNorth(i,t){return this.map.resetNorth(i,t)}resetNorthPitch(i,t){return this.map.resetNorthPitch(i,t)}resize(i){return this.map.resize(i)}rotateTo(i,t,e){return this.map.rotateTo(i,t,e)}setBearing(i,t){return this.map.setBearing(i,t)}setCenter(i,t){return this.map.setCenter(i,t)}setEventedParent(i,t){return this.map.setEventedParent(i,t)}setFeatureState(i,t){return this.map.setFeatureState(i,t)}setFilter(i,t,e){return this.map.setFilter(i,t,e)}setGlyphs(i,t){return this.map.setGlyphs(i,t)}setLayerZoomRange(i,t,e){return this.map.setLayerZoomRange(i,t,e)}setLayoutProperty(i,t,e,r){return this.map.setLayoutProperty(i,t,e,r)}setLight(i,t){return this.map.setLight(i,t)}setMaxBounds(i){return this.map.setMaxBounds(i)}setMaxPitch(i){return this.map.setMaxPitch(i)}setMaxZoom(i){return this.map.setMaxZoom(i)}setMinPitch(i){return this.map.setMinPitch(i)}setMinZoom(i){return this.map.setMinZoom(i)}setPadding(i,t){return this.map.setPadding(i,t)}setPaintProperty(i,t,e,r){return this.map.setPaintProperty(i,t,e,r)}setPitch(i,t){return this.map.setPitch(i,t)}setPixelRatio(i){return this.map.setPixelRatio(i)}setRenderWorldCopies(i){return this.map.setRenderWorldCopies(i)}setSprite(i,t){return this.map.setSprite(i,t)}setTerrain(i){return this.map.setTerrain(i)}setTransformRequest(i){return this.map.setTransformRequest(i)}setZoom(i,t){return this.map.setZoom(i,t)}snapToNorth(i,t){return this.map.snapToNorth(i,t)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(i){return this.map.unproject(i)}updateImage(i,t){return this.map.updateImage(i,t)}zoomIn(i,t){return this.map.zoomIn(i,t)}zoomOut(i,t){return this.map.zoomOut(i,t)}zoomTo(i,t,e){return this.map.zoomTo(i,t,e)}addLayerGeoJSON(i,t){try{let e=this._dealOrderLayer(t);this.map.addSource(`${i.id}`,{type:"geojson",data:i.data}),this.map.addLayer({id:`${i.id}-layerIcgcMap`,type:i.type,source:`${i.id}`,layout:i.layout,paint:i.paint},e)}catch(e){console.error(`Error adding GeoJSON layer: ${e.message}`)}}addLayerWMS(i,t,e){try{let r=this._dealOrderLayer(e.layerPosition);e?(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,layout:e.layout,paint:e.paint},r)):(this.map.addSource(`${t}`,{type:"raster",tiles:[i],tileSize:256},r),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},r))}catch(r){console.error(`Error adding WMS layer: ${r.message}`)}}addLogo(i){try{let t=document.getElementById("map"),e;e=document.createElement("div"),e.id="logos",t.appendChild(e);const r=document.createElement("img");r.src=i.url,r.style.height=i.height;const n=document.getElementById("logos"),o=document.createElement("a");o.id=i.id,o.href=i.href,o.target="_blank",o.style.position="relative",o.style.bottom="1px",o.appendChild(r),n.appendChild(o)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(i){try{const t=o=>{this.map.setStyle(o)};let e=document.getElementById("map"),r;r=document.createElement("div"),r.id="basemap-group",r.classList.add="filter-group",e.appendChild(r);const n=document.getElementById("basemap-group");for(const o of i)for(const c of Object.keys(ur.baseStyles)){const l=ur.baseStyles[c];if(o===l.url){const _=document.createElement("div");_.className="basemap-item",_.title=l.key,_.style.backgroundImage=`url('${l.image}')`,n.appendChild(_),_.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(i){try{const t=o=>{map.setStyle(o.url)};let e=document.getElementById("map"),r;r=document.createElement("div"),r.id="basemap-group",r.classList.add="basemap-group",e.appendChild(r);const n=document.getElementById("basemap-group");i.forEach(o=>{const c=document.createElement("div");c.className="basemap-item",c.title=o.label,c.style.backgroundImage=`url('${o.image}')`,n.appendChild(c),c.addEventListener("click",()=>t(o))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(i,t,e){try{let r;this.map.on("mouseenter",i,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",i,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let o=this.map.queryRenderedFeatures(n.point);if(o&&o[0].source.includes(i)){let c=[n.lngLat.lng,n.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let l="";t.forEach(_=>{let v=o[0].properties[_];l=l+`<h4>${v}</h4>`}),r=l,this.addPopup(c,r,e)}}else{let l="";for(const _ in o[0].properties)l+="<b>"+_+"</b>:"+o[0].properties[_]+"<br>";r=l,this.addPopup(c,r,e)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(i,t){try{var e=new ms.ScaleControl(i);this.map.addControl(e,t)}catch(r){console.error(`Error adding scale: ${r.message}`)}}addExportControl(i,t){try{typeof i=="string"&&(t=i,i=void 0),i===void 0&&(i={PageSize:Iu.A4,PageOrientation:ef.Landscape,Format:Jc.PNG,DPI:Zy[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new ZV(i),t)}catch(e){console.error(`Error adding export control: ${e.message}`)}}addMarker(i){try{let t,e;return i.text===void 0?t=new ms.Marker(i.options).setLngLat(i.coord).addTo(this.map):(e=new ms.Popup({offset:i.textOffset}).setHTML(i.text),t=new ms.Marker(i.options).setLngLat(i.coord).setPopup(e).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(i,t,e){try{return e.image===void 0?new ms.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new ms.Popup().setLngLat(i).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${e.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${e.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(i){try{i===void 0&&(i="top-right"),this.map.addControl(new ms.FullscreenControl,i)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(i){try{let t;if(i.includes("-userFieldFilter-")?t=i.split("-userFieldFilter-")[0]:t=i,i.length>0){const e=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=i,r.checked=!0,e.appendChild(r);const n=document.createElement("label");n.setAttribute("for",i),n.textContent=t,e.appendChild(n),r.addEventListener("change",o=>{this.map.setLayoutProperty(i,"visibility",o.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(i){try{let t=i.features,e=document.getElementById("map"),r=document.createElement("nav");r.id="filter-group",e.appendChild(r);const n=document.getElementById("filter-group");this.map.addSource(`${i.id}`,{type:i.type,data:t}),t.features.forEach(o=>{const c=o.properties.icon,l=`poi-${c}`;if(!this.map.getLayer(l)){this.map.addLayer({id:l,type:"circle",source:`${i.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",c]},this._firstSymbolLayer());const _=document.createElement("input");_.type="checkbox",_.id=l,_.checked=!0,n.appendChild(_);const v=document.createElement("label");v.setAttribute("for",l),v.textContent=c,n.appendChild(v),_.addEventListener("change",S=>{this.map.setLayoutProperty(l,"visibility",S.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new ms.NavigationControl(i),t)}catch(e){return console.error(`Error creating navigation control: ${e.message}`),null}}addNavigationControl(i,t){try{t===void 0&&(t="top-right"),this.map.addControl(new ms.NavigationControl(i),t)}catch(e){console.error(`Error adding navigation control: ${e.message}`)}}addAttributionControl(i,t){try{this.map.addControl(new ms.AttributionControl(i),t)}catch(e){console.error(`Error adding attribution control: ${e.message}`)}}addImageLayerICGC(i,t,e){try{let r=null,n,o;e?(o=e,n=e.layerPosition):o={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:jm},r=this._findImageType(i,An.Orto,An.VectorAdmin,An.WMS,An.Vector),r||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");let c={id:t,tiles:i};this.addLayerWMS(i,t,o)}catch(r){console.error(`Error adding ICGC image layer: ${r.message}`)}}async addVectorLayerICGC(i,t,e){try{let{type:r="line",layerPosition:n=jm,layoutOptions:o={visibility:"visible"},paintOption:c}=e||{},l=this._dealOrderLayer(n);if(!i){console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",i,"font-weight: bold; font-style: italic;");return}if(i.includes("https")){let _=this._getKeyByUrlVector(i);this.map.addSource(_,{type:"vector",url:i});let v={id:_,type:"fill",source:_,"source-layer":"cobertes",maxzoom:18,layout:e.layout,paint:TW.cobertesSol};if(_==="cobertes2018"&&this.map.addLayer(v,l),o.visibility==="visible"){let S=this._getLegendByName(_);this.addLegend(S,_)}}else{let _=t;this.map.addSource(_,{type:"vector",url:ur.limitsUrl});let v={id:t,type:r,source:_,"source-layer":i,layout:e.layout,paint:e.paint||{}};r==="fill"||r==="polygon"?v.paint=c||{"fill-color":"#0000FF","fill-opacity":0}:r==="line"&&(v.paint=c||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(v,l)}}catch(r){console.error(`Error adding ICGC vector layer: ${r.message}`)}}async addFGBLayerICGC(i,t,e){try{e||(e.layout={visibility:!0},e.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},e.type="lines",e.layerPosition="labels");let r=this._dealOrderLayer(e.layerPosition);const n=await fetch(i),o={type:"FeatureCollection",features:[]};for await(const l of A2(n.body))o.features.push(l);let c=t;this.map.addSource(c,{type:"geojson",data:o}),i.includes("text")?this.map.addLayer({id:t,type:"symbol",source:c,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:e.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},r):this.map.addLayer({id:t,type:e.type,source:c,layout:e.layout,paint:e.paint},r)}catch(r){console.error(`Error adding ICGC FGB layer: ${r.message}`)}}addTerrainICGC(i,t){try{let e;for(const n in Jp)if(Jp.hasOwnProperty(n)){const o=Jp[n];o===i&&(e=o)}let r=e;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(n=>{n.source==="terrainICGC"&&this.removeLayer(n.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(i.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[r],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new GP({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(e){console.error(`Error adding 3D terrain: ${e.message}`)}}addLegend(i,t){try{this.map.addControl(new qq({url:i,idLayer:t}))}catch(e){console.error(`Error adding legend: ${e.message}`)}}_findImageType(i,t,e,r,n){const o=[t,e,r,n];for(const c of o)for(const[l,_]of Object.entries(c))if(_===i)return l;return null}_getKeyByUrlFGB(i){for(const t in An.FGBAdmin)if(An.FGBAdmin.hasOwnProperty(t)&&An.FGBAdmin[t]===i)return t;return null}_getLegendByName(i){for(const t in ur.vectorLayers){const e=ur.vectorLayers[t];if(e.key===i)return e.legend}return null}_getKeyByUrlVector(i){for(const t in An.Vector)if(An.Vector.hasOwnProperty(t)&&An.Vector[t]===i)return t;return null}async _raiseText3DStyle(){try{const i=await this.map.loadImage(ur.map3dOptions.imageIcon);this.map.addImage("stick",i.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===ur.map3dOptions.sourceLayerFilterId&&t.minzoom>=ur.map3dOptions.minZoomFilter&&i){const e=t.id;this.map.setLayoutProperty(e,"icon-image","stick"),this.map.setLayoutProperty(e,"text-offset",[0,-9]),this.map.setLayoutProperty(e,"symbol-placement","point"),this.map.setLayoutProperty(e,"symbol-avoid-edges",!1),this.map.setLayoutProperty(e,"text-allow-overlap",!0),this.map.setLayoutProperty(e,"text-ignore-placement",!1),this.map.setLayoutProperty(e,"text-pitch-alignment","auto"),this.map.setLayoutProperty(e,"text-rotation-alignment","auto"),this.map.setLayoutProperty(e,"text-justify","center"),this.map.setLayoutProperty(e,"text-anchor","bottom"),this.map.setLayoutProperty(e,"icon-anchor","bottom"),this.map.setPaintProperty(e,"text-color","#ffffff"),this.map.setPaintProperty(e,"text-halo-color","#000000"),this.map.setPaintProperty(e,"text-halo-width",2)}})}catch(i){return console.error(`Error dealing orto 3D: ${i.message}`),null}}_dealStyleMaps(i){try{if(i&&i.indexOf("icgc.cat")!=-1){for(const t in xu)if(xu.hasOwnProperty(t)){const e=xu[t];if(t===i)return e}return xu[0]}else return i}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(i){try{if(i=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new WS({intensity:4}),e=new ev({ambientLight:t});this.map.setTerrain({source:ur.map3dOptions.terrainSource,exaggeration:ur.map3dOptions.exaggeration});const r=this._createCitiesMapboxLayer();this.map.getLayer(ur.map3dOptions.layerId3d)||(this.map.addLayer(r,ur.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(ur.map3dOptions.layerId3d,ur.map3dOptions.minZoomRange,ur.map3dOptions.maxZoomRange),r.deck.setProps({effects:[e]}),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"})}else this.map.getLayer(ur.map3dOptions.layerId3d)&&(this.map.removeLayer(ur.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(i){return i===jm?this._firstSymbolLayer():i===CW?this._firstLineLayer():""}_firstSymbolLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="symbol"&&i[e].id.indexOf("contour")===-1&&i[e].id.indexOf("water")===-1){t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_firstLineLayer(){try{const i=this.map.getStyle().layers;let t;for(let e=0;e<i.length;e++)if(i[e].type==="line"){t=i[e].id;break}return t}catch(i){console.error(`Error getting first symbol layer: ${i.message}`)}}_createCitiesMapboxLayer(){try{return new bN({id:ur.map3dOptions.layerId3d,type:Mv,data:ur.map3dOptions.urlTilesetCities,loader:Lv,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:ur.map3dOptions.spaceErrorFactor}},onTilesetLoad:i=>{i.options.maximumScreenSpaceError=ur.map3dOptions.spaceErrorFactor},onTileLoad:i=>{i.content.cartographicOrigin.z-=ur.map3dOptions.zfactor},operation:"terrain+draw"})}catch(i){return console.error(`Error adding MapboxLayer: ${i.message}`),null}}};var IW={exports:{}};function LW(i,t){var e=i.getCenter(),r=i.getZoom(),n=i.getBearing(),o=i.getPitch();t.forEach(function(c){c.jumpTo({center:e,zoom:r,bearing:n,pitch:o})})}function MW(){var i,t=arguments.length;if(t===1)i=arguments[0];else{i=[];for(var e=0;e<t;e++)i.push(arguments[e])}var r=[];i.forEach(function(l,_){r[_]=c.bind(null,l,i.filter(function(v,S){return S!==_}))});function n(){i.forEach(function(l,_){l.on("move",r[_])})}function o(){i.forEach(function(l,_){l.off("move",r[_])})}function c(l,_){o(),LW(l,_),n()}return n(),function(){o(),r=[],i=[]}}var BW=MW;(function(i){var t=BW,e=YE.EventEmitter;function r(n,o,c,l){if(this.options=l||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new e,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof c=="string"&&document.body.querySelectorAll){var _=document.body.querySelectorAll(c)[0];if(!_)throw new Error("Cannot find element with specified container selector.");_.appendChild(this._controlContainer)}else if(c instanceof Element&&c.appendChild)c.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var v=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(v),this._clearSync=t(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var c=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",l=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=c,this._mapB.getContainer().style.clip=l,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(IW);async function RW(){try{const i=await AT.getConfigICGC(),t=new PW({container:"map",style:i.Styles.LIGHT,center:[1.808,41.618],zoom:10,maxZoom:19,hash:!0,pitch:0});t.on("load",()=>{t.addGeocoderICGC(),t.addGeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0},"bottom-right"),t.addExportControl({},"top-right"),t.addFullscreenControl({},"top-right"),t.addTerrainICGC(i.Terrains.ICGC5M,"bottom-right")})}catch(i){console.error(i)}}RW();export{Or as z};
